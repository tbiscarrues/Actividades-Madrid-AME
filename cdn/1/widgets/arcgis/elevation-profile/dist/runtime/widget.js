System.register(["jimu-core","jimu-ui","jimu-arcgis","esri/intl","esri/core/lang","esri/geometry/geometryEngine","esri/geometry/geometryEngineAsync","esri/geometry/Polyline","esri/geometry/Point","esri/geometry/SpatialReference","esri/core/unitUtils","esri/Graphic","esri/Color","jimu-ui/advanced/chart-engine","esri/widgets/Sketch/SketchViewModel","esri/layers/GraphicsLayer","esri/geometry/Extent","esri/widgets/ElevationProfile/ElevationProfileViewModel","esri/core/reactiveUtils","esri/layers/ElevationLayer","esri/symbols/support/jsonUtils","esri/layers/FeatureLayer","esri/core/promiseUtils"],(function(e,t){var i={},s={},o={},n={},l={},a={},r={},d={},c={},h={},u={},p={},v={},g={},f={},y={},m={},S={},b={},w={},L={},x={},I={};return Object.defineProperty(a,"__esModule",{value:!0}),Object.defineProperty(b,"__esModule",{value:!0}),Object.defineProperty(L,"__esModule",{value:!0}),{setters:[function(e){i.AppMode=e.AppMode,i.BaseWidget=e.BaseWidget,i.BrowserSizeMode=e.BrowserSizeMode,i.DataRecordsSelectionChangeMessage=e.DataRecordsSelectionChangeMessage,i.DataSourceComponent=e.DataSourceComponent,i.DataSourceManager=e.DataSourceManager,i.DataSourceSelectionMode=e.DataSourceSelectionMode,i.DataSourceStatus=e.DataSourceStatus,i.DataSourceTypes=e.DataSourceTypes,i.Immutable=e.Immutable,i.MessageManager=e.MessageManager,i.React=e.React,i.UrlManager=e.UrlManager,i.WidgetState=e.WidgetState,i.WidgetVersionManager=e.WidgetVersionManager,i.classNames=e.classNames,i.css=e.css,i.focusElementInKeyboardMode=e.focusElementInKeyboardMode,i.geometryUtils=e.geometryUtils,i.getAppStore=e.getAppStore,i.jsx=e.jsx,i.lodash=e.lodash,i.urlUtils=e.urlUtils},function(e){s.Alert=e.Alert,s.Button=e.Button,s.Card=e.Card,s.CardBody=e.CardBody,s.Checkbox=e.Checkbox,s.Collapse=e.Collapse,s.FloatingPanel=e.FloatingPanel,s.Icon=e.Icon,s.Label=e.Label,s.Loading=e.Loading,s.LoadingType=e.LoadingType,s.MobilePanel=e.MobilePanel,s.MultiSelect=e.MultiSelect,s.NumericInput=e.NumericInput,s.Option=e.Option,s.Popper=e.Popper,s.Select=e.Select,s.Switch=e.Switch,s.Tooltip=e.Tooltip,s.WidgetPlaceholder=e.WidgetPlaceholder,s.defaultMessages=e.defaultMessages},function(e){o.JimuMapViewComponent=e.JimuMapViewComponent},function(e){n.formatNumber=e.formatNumber},function(e){l.clone=e.clone},function(e){Object.keys(e).forEach((function(t){a[t]=e[t]}))},function(e){r.geodesicLength=e.geodesicLength,r.planarLength=e.planarLength},function(e){d.default=e.default},function(e){c.default=e.default},function(e){h.default=e.default},function(e){u.default=e.default},function(e){p.default=e.default},function(e){v.default=e.default},function(e){g.AnimatedThemeAm5=e.AnimatedThemeAm5,g.AxisRendererXAm5=e.AxisRendererXAm5,g.AxisRendererYAm5=e.AxisRendererYAm5,g.BulletAm5=e.BulletAm5,g.CircleAm5=e.CircleAm5,g.ColumnSeries=e.ColumnSeries,g.ContainerAm5=e.ContainerAm5,g.DarkThemeAm5=e.DarkThemeAm5,g.Exporting=e.Exporting,g.LabelAm5=e.LabelAm5,g.LegendAm5=e.LegendAm5,g.LineSeriesAm5=e.LineSeriesAm5,g.NumberFormatterAm5=e.NumberFormatterAm5,g.RectangleAm5=e.RectangleAm5,g.ResponsiveThemeAm5=e.ResponsiveThemeAm5,g.TooltipAm5=e.TooltipAm5,g.TriangleAm5=e.TriangleAm5,g.ValueAxisAm5=e.ValueAxisAm5,g.XYChartAm5=e.XYChartAm5,g.XYCursorAm5=e.XYCursorAm5,g.colorAm5=e.colorAm5,g.createRoot=e.createRoot,g.p0=e.p0,g.p100=e.p100,g.p50=e.p50},function(e){f.default=e.default},function(e){y.default=e.default},function(e){m.default=e.default},function(e){S.default=e.default},function(e){Object.keys(e).forEach((function(t){b[t]=e[t]}))},function(e){w.default=e.default},function(e){Object.keys(e).forEach((function(t){L[t]=e[t]}))},function(e){x.default=e.default},function(e){I.isAbortError=e.isAbortError}],execute:function(){e((()=>{var e={22936:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20"><path fill="#000" fill-rule="evenodd" d="M19.5 20a.5.5 0 0 0 0-1H1V1.5a.5.5 0 0 0-1 0V19a1 1 0 0 0 1 1zM14 4a1 1 0 1 1-2 0 1 1 0 0 1 2 0m-.581 1.956a2 2 0 0 1-.88-.01L9.366 11.54a2 2 0 1 1-3.06.395l-1.639-2.05a2 2 0 1 1 .831-.562l1.538 1.923a2 2 0 0 1 1.452-.186l3.165-5.581a2 2 0 1 1 2.66.03l2.267 4.535Q16.784 10 17 10a2 2 0 1 1-1.313.492zM5 8a1 1 0 1 1-2 0 1 1 0 0 1 2 0m3 6a1 1 0 1 0 0-2 1 1 0 0 0 0 2m9-1a1 1 0 1 0 0-2 1 1 0 0 0 0 2" clip-rule="evenodd"></path></svg>'},56499:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="m6.036 12.157 8.01-8.01a.5.5 0 1 1 .707.707l-8.01 8.01a1 1 0 0 1-1.415 0L1.146 8.682a.5.5 0 1 1 .708-.707z"></path></svg>'},93303:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M9.438.994c.213 0 .397.146.44.35q.227 1.084.316 1.852.562.242 1.048.599l1.728-.676a.455.455 0 0 1 .556.188l1.42 2.394a.43.43 0 0 1-.091.547 22 22 0 0 1-1.49 1.194q.03.27.03.552 0 .32-.038.63l1.465 1.12a.43.43 0 0 1 .111.563l-1.42 2.394a.454.454 0 0 1-.53.197 23 23 0 0 1-1.807-.66q-.49.35-1.055.586l-.263 1.794a.446.446 0 0 1-.445.376H6.574a.446.446 0 0 1-.44-.35 21 21 0 0 1-.317-1.853 5.3 5.3 0 0 1-1.047-.598l-1.728.675a.455.455 0 0 1-.556-.187l-1.42-2.395a.43.43 0 0 1 .091-.546q.85-.735 1.49-1.194a5.167 5.167 0 0 1 .008-1.183L1.19 6.243a.43.43 0 0 1-.112-.562l1.42-2.395a.455.455 0 0 1 .531-.196q1.078.35 1.807.66c.324-.233.679-.43 1.056-.587l.262-1.794A.446.446 0 0 1 6.6.994zm-.365 1H6.985l-.28 1.866-.467.19q-.353.144-.672.34l-.207.136-.42.293-.476-.197q-.492-.205-1.169-.433l-.221-.074-1.045 1.719L3.59 6.999l-.06.479a4 4 0 0 0-.021.816l.014.144.058.492-.419.294q-.433.304-.979.746l-.177.145 1.043 1.72 1.845-.703.406.29q.307.219.645.384l.228.103.474.199.059.49q.06.507.19 1.177l.043.219h2.088l.282-1.867.466-.19q.354-.144.672-.34l.207-.136.419-.293.476.198q.495.204 1.17.433l.22.072 1.044-1.718-1.56-1.165.06-.479a4 4 0 0 0 .02-.815l-.013-.144-.06-.492.42-.295a18 18 0 0 0 .98-.746l.176-.146-1.043-1.72-1.844.705-.406-.29a4.5 4.5 0 0 0-.646-.385l-.228-.103-.474-.199-.058-.49q-.049-.405-.14-.916zm-1.067 3a3 3 0 1 1 0 6 3 3 0 0 1 0-6m0 1a2 2 0 1 0 0 4 2 2 0 0 0 0-4" clip-rule="evenodd"></path></svg>'},56165:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20"><path fill="#000" fill-rule="evenodd" d="M2 1a1 1 0 0 0-1 1v17a1 1 0 0 0 1 1h2a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1zm2 1H2v17h2zM9 6a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h2a1 1 0 0 0 1-1V7a1 1 0 0 0-1-1zm2 1H9v12h2zM15 11a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v8a1 1 0 0 1-1 1h-2a1 1 0 0 1-1-1zm1 0h2v8h-2z" clip-rule="evenodd"></path></svg>'},96300:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M15 7.5a.52.52 0 0 1-.516.527H2.976L6.473 11.6a.535.535 0 0 1 0 .746.51.51 0 0 1-.73 0L1 7.5l4.743-4.846a.51.51 0 0 1 .73 0 .535.535 0 0 1 0 .746L2.976 6.973h11.508c.285 0 .516.236.516.527"></path></svg>'},30655:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M2.146 4.653a.485.485 0 0 1 .708 0L8 10.24l5.146-5.587a.485.485 0 0 1 .708 0 .54.54 0 0 1 0 .738l-5.5 5.956a.485.485 0 0 1-.708 0l-5.5-5.956a.54.54 0 0 1 0-.738" clip-rule="evenodd"></path></svg>'},34992:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M14.497 7c.277 0 .501-.224.502-.5v-.001A.5.5 0 0 0 14.5 6h-12l2.604-3.135a.528.528 0 0 0-.805-.682L1.243 5.718A1 1 0 0 0 1 6.372V6.5a.5.5 0 0 0 .5.5zM1.503 9c-.277 0-.501.224-.502.5v.001c0 .276.224.499.499.499h12l-2.604 3.135a.528.528 0 0 0 .805.682l3.056-3.535A1 1 0 0 0 15 9.628V9.5a.5.5 0 0 0-.5-.5z" clip-rule="evenodd"></path></svg>'},37568:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M11.347 2.146a.485.485 0 0 1 0 .708L5.76 8l5.587 5.146a.486.486 0 0 1 0 .708.54.54 0 0 1-.738 0l-5.956-5.5a.485.485 0 0 1 0-.708l5.956-5.5a.54.54 0 0 1 .738 0" clip-rule="evenodd"></path></svg>'},52943:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M4.653 13.854a.485.485 0 0 1 0-.708L10.24 8 4.653 2.854a.485.485 0 0 1 0-.708.54.54 0 0 1 .738 0l5.956 5.5a.485.485 0 0 1 0 .708l-5.956 5.5a.54.54 0 0 1-.738 0" clip-rule="evenodd"></path></svg>'},62838:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="m8.745 8 6.1 6.1a.527.527 0 1 1-.745.746L8 8.746l-6.1 6.1a.527.527 0 1 1-.746-.746l6.1-6.1-6.1-6.1a.527.527 0 0 1 .746-.746l6.1 6.1 6.1-6.1a.527.527 0 0 1 .746.746z"></path></svg>'},12046:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M11.227 1.312c-.404-.404-1.045-.417-1.432-.03L2.49 8.587l-.48 2.674a.637.637 0 0 0 .73.73l2.673-.48 7.305-7.306c.387-.387.374-1.028-.03-1.431zm-8.114 9.575.32-1.781 4.991-4.992 1.462 1.462-4.992 4.991zm7.473-6.012 1.402-1.4-1.462-1.463-1.401 1.402z" clip-rule="evenodd"></path><path fill="#000" d="M1.5 14a.5.5 0 0 0 0 1h13a.5.5 0 0 0 0-1z"></path></svg>'},46420:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M6.973 11.484c0 .285.236.516.527.516a.52.52 0 0 0 .527-.516V1.976L10.6 4.473c.206.202.54.202.746 0a.51.51 0 0 0 0-.73L7.5 0 3.654 3.743a.51.51 0 0 0 0 .73c.206.202.54.202.746 0l2.573-2.497zM1 8v7h13V8h1v8H0V8z" clip-rule="evenodd"></path></svg>'},9044:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M6 6.5a.5.5 0 0 1 1 0v6a.5.5 0 0 1-1 0zM9.5 6a.5.5 0 0 0-.5.5v6a.5.5 0 0 0 1 0v-6a.5.5 0 0 0-.5-.5"></path><path fill="#000" fill-rule="evenodd" d="M11 0H5a1 1 0 0 0-1 1v2H.5a.5.5 0 0 0 0 1h1.6l.81 11.1a1 1 0 0 0 .995.9h8.19a1 1 0 0 0 .995-.9L13.9 4h1.6a.5.5 0 0 0 0-1H12V1a1 1 0 0 0-1-1m0 3V1H5v2zm1.895 1h-9.79l.8 11h8.19z" clip-rule="evenodd"></path></svg>'},56509:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="m10.308.302-.589.808 3.84 2.796L9 6.555l5.013 3.736.597-.801-3.796-2.832 4.576-2.657zM.25 3l8.642 4.969-3.423.738 2.724 5.45-2.887 1.667-2.724-5.45-2.35 2.595zm.996 1.726-.01 5.644 1.527-1.684 2.909 5.771 1.155-.667-2.91-5.77 2.222-.48z" clip-rule="evenodd"></path></svg>'},45508:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M8 5.5a1 1 0 1 0 0-2 1 1 0 0 0 0 2M6.5 7.5A.5.5 0 0 1 7 7h1.5v4.5h1a.5.5 0 0 1 0 1h-3a.5.5 0 0 1 0-1h1V8H7a.5.5 0 0 1-.5-.5"></path><path fill="#000" fill-rule="evenodd" d="M8 16A8 8 0 1 1 8 0a8 8 0 0 1 0 16m0-1A7 7 0 1 0 8 1a7 7 0 0 0 0 14" clip-rule="evenodd"></path></svg>'},27442:e=>{"use strict";e.exports=v},22089:e=>{"use strict";e.exports=p},81449:e=>{"use strict";e.exports=l},7343:e=>{"use strict";e.exports=I},62243:e=>{"use strict";e.exports=b},56504:e=>{"use strict";e.exports=u},33420:e=>{"use strict";e.exports=m},90422:e=>{"use strict";e.exports=c},80196:e=>{"use strict";e.exports=d},53205:e=>{"use strict";e.exports=h},77958:e=>{"use strict";e.exports=a},97050:e=>{"use strict";e.exports=r},25804:e=>{"use strict";e.exports=n},79282:e=>{"use strict";e.exports=w},85633:e=>{"use strict";e.exports=x},59620:e=>{"use strict";e.exports=y},8968:e=>{"use strict";e.exports=L},86392:e=>{"use strict";e.exports=S},10624:e=>{"use strict";e.exports=f},62686:e=>{"use strict";e.exports=o},79244:e=>{"use strict";e.exports=i},14321:e=>{"use strict";e.exports=s},95080:e=>{"use strict";e.exports=g}},t={};function A(i){var s=t[i];if(void 0!==s)return s.exports;var o=t[i]={exports:{}};return e[i](o,o.exports,A),o.exports}A.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return A.d(t,{a:t}),t},A.d=(e,t)=>{for(var i in t)A.o(t,i)&&!A.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},A.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),A.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},A.p="";var E={};return A.p=window.jimuConfig.baseUrl,(()=>{"use strict";A.r(E),A.d(E,{__set_webpack_public_path__:()=>Ze,default:()=>Ke});var e,t=A(79244),i=A(14321);!function(e){e.IconText="ICONTEXT"}(e||(e={}));var s=A(62686);function o(e){var i;const s=null===(i=e.sys.color.surface)||void 0===i?void 0:i.paper;let o="65px",n="200px",l="250px",a="220px";return"125%"===e.ref.typeface.htmlFontSize?(o="95px",n="240px",l="290px",a="260px"):"87.5%"===e.ref.typeface.htmlFontSize?(o="60px",n="180px",l="235px",a="205px"):"75%"===e.ref.typeface.htmlFontSize&&(o="55px",n="175px",l="210px",a="190px"),t.css`
    overflow: auto;
    background-color: ${s};
    .widget-elevation-profile {
      width: 100%;
      height: 100%;
      min-height: 200px;

      .userGuideInfo {
        font-weight: 400;
        overflow-y: auto;
        height: ${o};
      }

      .front-section {
        min-width: ${"75%"===e.ref.typeface.htmlFontSize?"180px":"200px"};
        min-height: ${n};
        max-height: ${l};
        max-width: ${a};
      }

      .front-cards {
        border-radius: 7px;
      }

      .hidden {
        display: none;
      }

      .mainSection {
        padding: 20px;
      }

      .adjust-cards {
        gap: 2px 35px;
        width: 100%;
        max-height: -webkit-fill-available;
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
      }

      .loading-text {
        position: absolute;
        top: 50%;
        left: 50%;
        text-align: center;
        transform: translate(-50%, 50%);
        font-size: var(--calcite-font-size--2);
        color: var(--calcite-color-text-1);
      }
  `}function n(e){let i="3px 8px 2px 12px";return"125%"===e.ref.typeface.htmlFontSize?i="0px 8px 2px 10px":"87.5%"===e.ref.typeface.htmlFontSize?i="4px 8px 2px 13px":"75%"===e.ref.typeface.htmlFontSize&&(i="5px 8px 2px 14px"),t.css`
    .actionButton {
      margin: 2px 0px 2px 5px;
    }

    .exportHintStyle {
      font-style: italic;
    }

    .exportLabel {
      margin: 0 !important;
      font-weight: 500;
    }

    .showCustomizeEdit {
      display: block;
    }

    .hideCustomizeEdit {
      display: none;
    }

    .style-setting--unit-selector {
      width: 50px;
      margin-left: 0px;
      background: var(--ref-palette-neutral-300);
      color: var(--ref-palette-black);
      height: 26px;
    }

    .unitsLabel {
      margin: ${i};
      border-radius: 0px;
      color: var(--ref-palette-black);
    }

    .invalidRange {
      font-style: italic;
      color: ${e.sys.color.error.main};
    }

    .invalidValue {
      height: 28px!important;
      border: 1px solid  ${e.sys.color.error.main};
      box-shadow: 0 0 1px  ${e.sys.color.error.main};
    }
  `}function l(e){let i="calc(100% - 83px)";return"125%"===e.ref.typeface.htmlFontSize?i="calc(100% - 92px)":"87.5%"===e.ref.typeface.htmlFontSize?i="calc(100% - 78px)":"75%"===e.ref.typeface.htmlFontSize&&(i="calc(100% - 73px)"),t.css`
    .ep-widget-header {
      .chart-actions {
        float: right;
        width: 32px;
        height: 32px;
        margin: 2px 5px 2px 5px;
      }
    }

    .ep-widget-bodyContainer {
      height: ${i};

      .alignInfo {
        padding-right: 40px;
        padding-left: 40px;
      }

      .userInfo .left-part {
        font-weight: 400;
      }
    }

    .floatingInfoMsg {
      .alignDismissibleInfo {
        position: absolute;
        left: 53px;
        width: calc(100% - 109px);
        z-index: 1;
        bottom: 55px;
        margin: 0 auto;
      }

      .alignDismissibleInfo .left-part .text-left {
        overflow: hidden;
        text-overflow: ellipsis;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        display: -webkit-box;
        font-weight: 400;
      }

      .showMessage {
        display: flex;
      }

      .hideMessage {
        display: none;
      }
    }

    .ep-widget-footer {
      line-height: 1.3;
      background-color: unset;
      border: 1px solid ${e.ref.palette.neutral[300]};
      width: calc(100% - 9px);
      margin-left: 4px;

      .hidden {
        display: none;
      }

      .footer-display {
        display: inline-block;
      }

      .actionButton {
        float: right;
      }
    }
  `}function a(e){return t.css`
    .ep-shadow {
      box-shadow: 0 0 8px 3px rgba(0,0,0,0.2)!important;
    }

    .ep-legend {
      height: 100px;
      overflow-y: auto;
    }

    .ep-legend-section {
      border-radius: 2px;
      padding: 5px;
      margin-top: 10px;
      min-width: 120px;
    }

    .cursor-pointer {
      cursor: pointer
    }

    .legendLabel {
      margin-bottom: 0px;
      font-weight: bold;
      word-wrap: break-word;
    }

    .stat-content {
      display: block;
      padding: 12px 15px;
      padding-top: 0;
    }

    .profile-statistics {
      --max-width: 105px;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(var(--max-width), 1fr));
      gap: 2px 22px;
      width: 100%;
    }

    .statistic-info {
      display: block;
      text-align: start;
    }

    .statistic-label {
      font-weight: 500;
    }
  `}const r={_widgetLabel:"Elevation Profile",mapLoadingMsg:"Please wait while the map is loading",_action_select_label:"View profile",_action_view_label:"View Elevation Profile",selectLinesLabel:"Select line",selectLinesDesc:"Select a line to view the elevation.",selectButtonLabel:"Select",drawProfileLabel:"Draw profile",drawProfileDesc:"Draw a line to view the ground elevation.",drawButtonLabel:"Draw",backButtonLabel:"Reset",doneButtonLabel:"Done",clearButtonLabel:"Clear",newProfileButtonLabel:"New profile",drawUserInfo:"Click the map to place the first point and double-click to finish.",selectUserInfo:"Click a line on the map to begin.",emptyDrawStateWarning:"Draw on the map to generate an elevation profile.",emptySelectStateWarning:"Select a line on the map to generate an elevation profile.",infoMsgWhileDrawing:"Double-click or click Done to finish.",infoMsgWhileSelecting:"Select a connected line or click Done to finish.",addToSelectionWarning:"There are no additional connected lines to select.",chartRender:"Elevation Profile for the selected or drawn lines.",noFeaturesFound:"No selectable line in this location. Click a line from the selectable layers.",unknownError:"There was an unknown error generating the profile.",noProfileError:"No elevation information is available for this location.",tooComplexError:"Profile could not be generated. Input line is too complex.",tooComplexAnalysisError:"Analysis could not be performed for this line. Input line is too complex.",invalidGeometryError:"Profile could not be generated. Invalid geometry.",invalidElevationInfoError:"Profile could not be generated. Elevation options of the line are not supported.",chartStatistics:"Profile Statistics",chartFlip:"Reverse Direction",chartExport:"Export Profiles",settingsOptions:"Settings",exportHint:"Values will be exported to a CSV file.",customizeIntervalTooltip:"Customize at which distance interval values are extracted. This interval is only applied to ground and profile elevation values.",customizeIntervalLabel:"Customize interval",exportLabel:"Export",intervalErrorHint:"This value is out of range {xMin} - {xMax}.",intervalHintForInvalidEntry:"This value is out of range.",layerName:"Layer Name",intersectingLayerDisplayFieldLabel:"Attribute (Display Field)",oneFieldLabelForExport:"Field 1",twoFieldLabelForExport:"Field 2",statisticsLabel:"Profile Statistics",elevationUnitLabel:"Elevation units",distanceUnitLabel:"Distance units",selectableLayersLabel:"Selectable layers",selectLayerLabel:"Select layers",selectedLayerCount:"{selectedLayerCount} enabled",referenceLayerLabel:"{elevationLayerLabel} (Reference)",intersectingLayersLabel:"Intersecting layers",bufferSelectorLabel:"Intersection buffer",groundElevation:"Ground Elevation",uniformChartScaling:"Uniform scaling",uniformChartScalingInfo:"Use a uniform scale for the Distance and Elevation axes.",selectLayerWarning:"At least one layer should be enabled for selection",volumetricObj:"Volumetric objects",meters:"Meters",metersAbbreviation:"m",feet:"Feet",feetAbbreviation:"ft",kilometers:"Kilometers",kilometersAbbreviation:"km",miles:"Miles",milesAbbreviation:"mi",yards:"Yards",yardsAbbreviation:"yd",noStatsValue:"No value",distanceLabel:"Distance",elevationLabel:"Elevation",graphDistanceLabel:"Distance - {unit}",graphElevationLabel:"Elevation - {unit}",expandLegend:"Expand Legend",maxDistance:"MAX Distance",minElevation:"MIN Elevation",maxElevation:"MAX Elevation",avgElevation:"AVG Elevation",elevationGain:"Elevation Gain",elevationLoss:"Elevation Loss",maxPositiveSlope:"MAX Positive Slope",maxNegativeSlope:"MAX Negative Slope",avgPositiveSlope:"AVG Positive Slope",avgNegativeSlope:"AVG Negative Slope"},d=A(22936),c=A(56509),h=A(45508),u=A(12046),p=A(96300),v=A(56499),g=A(9044),f=A(56165),y=A(34992),m=A(93303),S=A(30655),b=()=>({epIcon:{elevationIcon:d,selectIcon:c,infoIcon:h,drawIcon:u,arrowNavBack:p,doneIcon:v,clearIcon:g,chartIcon:f,flipIcon:y,settingsIcon:m,iconExpandCollapse:S}}),w=[{value:"meters",abbreviation:"metersAbbreviation"},{value:"feet",abbreviation:"feetAbbreviation"},{value:"kilometers",abbreviation:"kilometersAbbreviation"},{value:"miles",abbreviation:"milesAbbreviation"},{value:"yards",abbreviation:"yardsAbbreviation"}],L=[{value:"maxDistance",label:r.maxDistance},{value:"minElevation",label:r.minElevation},{value:"maxElevation",label:r.maxElevation},{value:"avgElevation",label:r.avgElevation},{value:"elevationGain",label:r.elevationGain},{value:"elevationLoss",label:r.elevationLoss},{value:"maxPositiveSlope",label:r.maxPositiveSlope},{value:"maxNegativeSlope",label:r.maxNegativeSlope},{value:"avgPositiveSlope",label:r.avgPositiveSlope},{value:"avgNegativeSlope",label:r.avgNegativeSlope}];var x,I;!function(e){e.NoVisibleProfiles="no-visible-profiles",e.InvalidGeometry="invalid-geometry",e.TooComplex="too-complex",e.InvalidElevationInfo="invalid-elevation-info",e.UnknownError="unknown-error",e.RefinedButNoChartData="refined-but-no-chart-data",e.None="none"}(x||(x={})),function(e){e.MaxDistance="maxDistance",e.MinElevation="minElevation",e.MaxElevation="maxElevation",e.AvgElevation="avgElevation",e.ElevationGain="elevationGain",e.ElevationLoss="elevationLoss",e.MaxPositiveSlope="maxPositiveSlope",e.MaxNegativeSlope="maxNegativeSlope",e.AvgPositiveSlope="avgPositiveSlope",e.AvgNegativeSlope="avgNegativeSlope"}(I||(I={}));const M=e=>{switch(e){case I.MaxPositiveSlope:return I.MaxNegativeSlope;case I.MaxNegativeSlope:return I.MaxPositiveSlope;case I.AvgPositiveSlope:return I.AvgNegativeSlope;case I.AvgNegativeSlope:return I.AvgPositiveSlope;case I.ElevationLoss:return I.ElevationGain;case I.ElevationGain:return I.ElevationLoss}return e};var D;function C(e){const i=(e,s)=>{const o=(null==e?void 0:e.isDataSourceSet())&&(null==e?void 0:e.getChildDataSources());o&&o.forEach((e=>{(null==e?void 0:e.isDataSourceSet())?i(e,s):(null==e?void 0:e.type)!==t.DataSourceTypes.FeatureLayer&&(null==e?void 0:e.type)!==t.DataSourceTypes.SubtypeSublayer||s.push(e)}))},s=[],o=t.DataSourceManager.getInstance(),n=null==o?void 0:o.getDataSource(e);return i(n,s),s}function O(e,t){var i,s,o,n;let l=null===(i=null==e?void 0:e.elevationLayersSettings)||void 0===i?void 0:i.elevationUnit,a=null===(s=null==e?void 0:e.elevationLayersSettings)||void 0===s?void 0:s.linearUnit;return(null===(o=null==e?void 0:e.elevationLayersSettings)||void 0===o?void 0:o.elevationUnit)||(l="english"===(null==t?void 0:t.units)?"feet":"meters"),(null===(n=null==e?void 0:e.elevationLayersSettings)||void 0===n?void 0:n.linearUnit)||(a="english"===(null==t?void 0:t.units)?"miles":"kilometers"),[l,a]}function _(){return"#"+Math.floor(16777215*Math.random()).toString(16).padStart(6,"0")}!function(e){e[e.Feet=528e4]="Feet",e[e.Miles=1e3]="Miles",e[e.Kilometers=1609.344]="Kilometers",e[e.Meters=1609344]="Meters",e[e.Yards=176e4]="Yards"}(D||(D={}));const F=e=>{switch(e){case"feet":return D.Feet;case"miles":return D.Miles;case"kilometers":return D.Kilometers;case"meters":return D.Meters;case"yards":return D.Yards;default:return 1e3}},P=e=>"english"===(null==e?void 0:e.units)?"feet":"meters",j=(e,t,i)=>(i||(i=[]),null==t||t.forEach((t=>{const s=i.filter((e=>e.dataSourceId===t.layerId)),o=(null==s?void 0:s.length)>0?s[0]:{dataSourceId:t.layerId,mainDataSourceId:t.layerId,rootDataSourceId:e,fields:[]};("one"===t.elevationSettings.type||"two"===t.elevationSettings.type)&&t.elevationSettings.field1&&!o.fields.includes(t.elevationSettings.field1)&&o.fields.push(t.elevationSettings.field1),"two"===t.elevationSettings.type&&t.elevationSettings.field2&&!o.fields.includes(t.elevationSettings.field2)&&o.fields.push(t.elevationSettings.field2),t.displayField&&!o.fields.includes(t.displayField)&&o.fields.push(t.displayField),0===s.length&&i.push(o)})),i),V=()=>`${Math.random()}`.slice(2).toString()+Date.now();function T(e,t,i){return k(e,t,i)}function k(e,t,i){return t===i?+e:+e/R(t)*R(i)}function R(e){let t=1;switch(e){case"meters":t=1;break;case"kilometers":t=.001;break;case"feet":t=1/.3048;break;case"yards":t=1/.9144;break;case"miles":t=1/1609.344}return t}function N(e,t){const i=Math.floor(Math.log10(e)),s=e/Math.pow(10,i);let o;return o=t?s<1.5?1:s<3?2:s<5?2.5:s<7?5:10:s<=1?1:s<=2?2:s<=3?2.5:s<=5?5:10,o*Math.pow(10,i)}var U=A(25804),B=A(81449),z=A(77958),G=A(97050),W=A(80196),H=A(90422),Y=A(53205),X=A(56504),J=A(22089),q=A(27442);const K=(e,t)=>{var i,s,o,n;const l=e.layer;let a,r,d,c,h,u,p,v,g;if(r=!1,a={type:"simple-marker",style:"square",color:[0,255,255,0],outline:{color:t||"#00FFFF",width:2}},a.size=30,null==l?void 0:l.renderer)if(l.renderer.symbol)r=!0,a=Z(a,l.renderer.symbol);else if((null===(i=l.renderer.infos)||void 0===i?void 0:i.length)>0){for(h=0;h<l.renderer.infos.length;h++)l.typeIdField?d=e.attributes[l.typeIdField]:l.renderer.attributeField&&(d=e.attributes[l.renderer.attributeField]),c=l.renderer.infos[h].value,null!=d&&""!==d&&null!=c&&""!==c&&d.toString()===c.toString()&&(r=!0,a=Z(a,l.renderer.infos[h].symbol));r||l.renderer.defaultSymbol&&(r=!0,a=Z(a,l.renderer.defaultSymbol))}if((null===(s=null==l?void 0:l.graphics)||void 0===s?void 0:s.length)>0&&l._getSymbol(e)){u=e.getShape(),(null==u?void 0:u.shape)?u.shape.hasOwnProperty("r")?(r=!0,a.size=2*u.shape.r+10):u.shape.hasOwnProperty("width")&&(r=!0,(null===(n=null===(o=l.renderer)||void 0===o?void 0:o.infos)||void 0===n?void 0:n.length)>0&&(a=Z(a,l.renderer.infos[0].symbol)),a.size=u.shape.width+10):l.renderer.visualVariables&&(p=l._getRenderer(e),v=(e=>{let t=null;return e.renderer.visualVariables&&e.renderer.visualVariables.forEach((e=>{"sizeInfo"===e.type&&(t=e)})),t})(l),v&&(g=p.getSize(e,{sizeInfo:v,shape:l._getSymbol(e),resolution:l&&l.getResolutionInMeters&&l.getResolutionInMeters()}),null!==g&&(a.size=g+10)))}return new J.default({geometry:e.geometry,symbol:a,attributes:e.attributes})},Z=(e,t)=>{let i,s,o;return t.hasOwnProperty("height")&&t.hasOwnProperty("width")&&(i=t.height,s=t.width,o=i>s?i:s,o+=10,e.size=o),t.hasOwnProperty("size")&&(!o||o<t.size)&&(e.size=t.size+10),t.hasOwnProperty("xoffset")&&(e.xoffset=t.xoffset),t.hasOwnProperty("yoffset")&&(e.yoffset=t.yoffset),e},$=(e,t)=>{var i,s,o,n;const l=e.layer;let a,r,d,c;if(a=4,null==l?void 0:l.renderer)if(null===(i=l.renderer.symbol)||void 0===i?void 0:i.hasOwnProperty("width"))a=l.renderer.symbol.width;else if((null===(o=null===(s=l.renderer)||void 0===s?void 0:s.infos)||void 0===o?void 0:o.length)>0)for(c=0;c<l.renderer.infos.length;c++)l.typeIdField?r=e.attributes[l.typeIdField]:l.renderer.attributeField&&(r=e.attributes[l.renderer.attributeField]),d=l.renderer.infos[c].value,null!=r&&""!==r&&null!=d&&""!==d&&r.toString()===d.toString()&&l.renderer.infos[c].symbol.hasOwnProperty("width")&&(a=l.renderer.infos[c].symbol.width);else(null===(n=l.renderer.defaultSymbol)||void 0===n?void 0:n.hasOwnProperty("width"))&&(a=l.renderer.defaultSymbol.width);const h={type:"simple-line",color:t||"#00FFFF",width:4,style:"solid",outline:{color:"#00FFFF",width:a}};return new J.default({geometry:e.geometry,symbol:h,attributes:e.attributes})},Q=(e,t)=>{const i={type:"simple-fill",color:[0,255,255,0],style:"solid",outline:{color:t||"#00FFFF",width:2}};return new J.default({geometry:e.geometry,symbol:i,attributes:e.attributes})},ee={fontFamily:"Avenir Next",axisGridStroke:"#f4f4f4",axisLabelsFontWeight:"500",axisTooltipFontSize:12,axisTooltipPaddingTop:Math.round(3),axisTooltipPaddingBottom:Math.round(3),axisTooltipPaddingHorizontal:Math.round(3.75),xAxisMinGridDistance:50,xAxisLabelsSpacing:Math.round(6),xAxisMinLabelPosition:.05,xAxisMaxLabelPosition:.95,yAxisMinGridDistance:30,yAxisLabelSpacing:Math.round(3.75),yAxisMinLabelPosition:0,yAxisMaxLabelPosition:.95},te=Object.assign(Object.assign({},ee),{axisGridStroke:"#323232"});var ie=A(95080),se=function(e,t,i,s){return new(i||(i=Promise))((function(o,n){function l(e){try{r(s.next(e))}catch(e){n(e)}}function a(e){try{r(s.throw(e))}catch(e){n(e)}}function r(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(l,a)}r((s=s.apply(e,t||[])).next())}))};const oe="meters";class ne extends t.React.PureComponent{constructor(e){var s,o,n;super(e),this._chartContainer=t.React.createRef(),this.nls=e=>{const t=Object.assign({},r,i.defaultMessages);return this.props.intl&&this.props.intl.formatMessage?this.props.intl.formatMessage({id:e,defaultMessage:t[e]}):t[e]},this.componentWillUnmount=()=>{this._chart&&(this._chart.root.dispose(),this._chart=null)},this.componentDidUpdate=e=>{var t,i,s,o,n,l,a,r,d,c,h,u,p,v,g,f,y,m,S,b,w,L,x,I,A,E,M,D,C,O,_,F,P,j,V,T,k,R,N,U,B,z,G,W,H,Y,X,J,q,K,Z,$,Q,ee,te,se,oe,ne,le,ae,re,de,ce,he,ue,pe;if((null===(t=e.commonGeneralSettings)||void 0===t?void 0:t.showGridAxis)!==(null===(i=this.props.commonGeneralSettings)||void 0===i?void 0:i.showGridAxis)&&(null===(s=this._chart)||void 0===s?void 0:s.xAxes.values.length)>0&&this._chart.yAxes.values.length>0){if(this._chart){this._xAxis.get("renderer").grid.template.set("visible",null===(o=this.props.commonGeneralSettings)||void 0===o?void 0:o.showGridAxis);this._yAxis.get("renderer").grid.template.set("visible",null===(n=this.props.commonGeneralSettings)||void 0===n?void 0:n.showGridAxis)}return}if((null===(l=e.commonGeneralSettings)||void 0===l?void 0:l.showLegend)!==(null===(a=this.props.commonGeneralSettings)||void 0===a?void 0:a.showLegend)||(null===(r=e.commonGeneralSettings)||void 0===r?void 0:r.showAxisTitles)!==(null===(d=this.props.commonGeneralSettings)||void 0===d?void 0:d.showAxisTitles))return this._xAxisLabel.set("visible",null===(c=this.props.commonGeneralSettings)||void 0===c?void 0:c.showAxisTitles),this._yAxisLabel.set("visible",null===(h=this.props.commonGeneralSettings)||void 0===h?void 0:h.showAxisTitles),this._isRTL?this._chart.setAll({paddingTop:0,paddingRight:5,paddingBottom:(null===(u=this.props.commonGeneralSettings)||void 0===u?void 0:u.showAxisTitles)&&(null===(p=this.props.commonGeneralSettings)||void 0===p?void 0:p.showLegend)?2:(null===(v=this.props.commonGeneralSettings)||void 0===v?void 0:v.showAxisTitles)&&!(null===(g=this.props.commonGeneralSettings)||void 0===g?void 0:g.showLegend)?0:!(null===(f=this.props.commonGeneralSettings)||void 0===f?void 0:f.showAxisTitles)&&(null===(y=this.props.commonGeneralSettings)||void 0===y?void 0:y.showLegend)?2:(null===(m=this.props.commonGeneralSettings)||void 0===m?void 0:m.showAxisTitles)||(null===(S=this.props.commonGeneralSettings)||void 0===S?void 0:S.showLegend)?0:5,paddingLeft:5}):this._chart.setAll({paddingTop:0,paddingRight:0,paddingBottom:(null===(b=this.props.commonGeneralSettings)||void 0===b?void 0:b.showAxisTitles)&&(null===(w=this.props.commonGeneralSettings)||void 0===w?void 0:w.showLegend)?2:(null===(L=this.props.commonGeneralSettings)||void 0===L?void 0:L.showAxisTitles)&&!(null===(x=this.props.commonGeneralSettings)||void 0===x?void 0:x.showLegend)?0:!(null===(I=this.props.commonGeneralSettings)||void 0===I?void 0:I.showAxisTitles)&&(null===(A=this.props.commonGeneralSettings)||void 0===A?void 0:A.showLegend)?2:(null===(E=this.props.commonGeneralSettings)||void 0===E?void 0:E.showAxisTitles)||(null===(M=this.props.commonGeneralSettings)||void 0===M?void 0:M.showLegend)?0:5,paddingLeft:5}),void this.setState({showLegend:null===(D=this.props.commonGeneralSettings)||void 0===D?void 0:D.showLegend},(()=>{this.state.showLegend?this._chartLegend?this._chartLegend.set("visible",this.state.showLegend):this.displayChartLegend(this._accessChartParams):this._chartLegend&&this._chartLegend.set("visible",this.state.showLegend)}));if(e.volumetricObjLineStyle.lineColor!==this.props.volumetricObjLineStyle.lineColor)return void(this._chart&&(this._volumetricObjLineSeries.strokes.template.set("stroke",(0,ie.colorAm5)(this.props.volumetricObjLineStyle.lineColor)),this._volumetricObjLineSeries.fills.template.set("fill",(0,ie.colorAm5)(this.props.volumetricObjLineStyle.lineColor))));if(e.volumetricObjLabel!==this.props.volumetricObjLabel)return void(this._chart&&this._volumetricObjLineSeries.setAll({name:this.props.volumetricObjLabel?this.props.volumetricObjLabel:this.nls("volumetricObj")}));if(this.didElevationLayersInfoChanged(null==e?void 0:e.addedElelvationProfileLayers,null===(C=this.props)||void 0===C?void 0:C.addedElelvationProfileLayers))return void(this._chart&&(this._chart.root.dispose(),this._chart=null,this.createOrUpdateChartDefinition()));if(this._chart&&(null==e?void 0:e.profileSettingsForNewAddedLayer)!==(null===(O=this.props)||void 0===O?void 0:O.profileSettingsForNewAddedLayer))return this._chart.root.dispose(),this._chart=null,this._updatedProfileLayers=null===(_=this.props.currentConfig)||void 0===_?void 0:_.profileSettings.layers.concat(this.props.profileSettingsForNewAddedLayer),void this.createOrUpdateChartDefinition();const ve=this.didProfileLayersSettingsChanged(null===(F=e.currentConfig)||void 0===F?void 0:F.profileSettings.layers,null===(P=this.props.currentConfig)||void 0===P?void 0:P.profileSettings.layers),ge=this.didIntersectingLayersSettingsChanged(null===(V=null===(j=e.currentConfig)||void 0===j?void 0:j.assetSettings)||void 0===V?void 0:V.layers,null===(k=null===(T=this.props.currentConfig)||void 0===T?void 0:T.assetSettings)||void 0===k?void 0:k.layers);(ve||ge||e.assetIntersectionResult!==this.props.assetIntersectionResult||e.selectedLinearUnit!==this.props.selectedLinearUnit||e.selectedElevationUnit!==this.props.selectedElevationUnit||e.chartDataUpdateTime!==this.props.chartDataUpdateTime||e.theme!==this.props.theme||e.isFlip!==this.props.isFlip||e.isUniformChartScalingEnable!==this.props.isUniformChartScalingEnable||(null===(R=e.currentConfig)||void 0===R?void 0:R.advanceOptions)!==(null===(N=this.props.currentConfig)||void 0===N?void 0:N.advanceOptions)||(null===(B=null===(U=e.currentConfig)||void 0===U?void 0:U.profileSettings)||void 0===B?void 0:B.isProfileSettingsEnabled)!==(null===(G=null===(z=this.props.currentConfig)||void 0===z?void 0:z.profileSettings)||void 0===G?void 0:G.isProfileSettingsEnabled)||(null===(H=null===(W=e.currentConfig)||void 0===W?void 0:W.profileSettings)||void 0===H?void 0:H.isCustomizeOptionEnabled)!==(null===(X=null===(Y=this.props.currentConfig)||void 0===Y?void 0:Y.profileSettings)||void 0===X?void 0:X.isCustomizeOptionEnabled)||(null===(q=null===(J=e.currentConfig)||void 0===J?void 0:J.assetSettings)||void 0===q?void 0:q.isAssetSettingsEnabled)!==(null===(Z=null===(K=this.props.currentConfig)||void 0===K?void 0:K.assetSettings)||void 0===Z?void 0:Z.isAssetSettingsEnabled)||e.showVolumetricObj!==this.props.showVolumetricObj&&!this.props.showVolumetricObj)&&((e.showVolumetricObj!==this.props.showVolumetricObj&&!this.props.showVolumetricObj||e.chartDataUpdateTime!==this.props.chartDataUpdateTime||e.selectedLinearUnit!==this.props.selectedLinearUnit||e.selectedElevationUnit!==this.props.selectedElevationUnit||e.isFlip!==this.props.isFlip)&&this._chart&&(this._chart.root.dispose(),this._chart=null),(ve||ge||e.assetIntersectionResult!==this.props.assetIntersectionResult||e.theme.sys.color.mode!==this.props.theme.sys.color.mode||e.theme.sys.color.primary.main!==this.props.theme.sys.color.primary.main||e.theme.ref.typeface.htmlFontSize!==this.props.theme.ref.typeface.htmlFontSize||(null===($=e.currentConfig)||void 0===$?void 0:$.advanceOptions)!==(null===(Q=this.props.currentConfig)||void 0===Q?void 0:Q.advanceOptions)||(null===(te=null===(ee=e.currentConfig)||void 0===ee?void 0:ee.profileSettings)||void 0===te?void 0:te.isProfileSettingsEnabled)!==(null===(oe=null===(se=this.props.currentConfig)||void 0===se?void 0:se.profileSettings)||void 0===oe?void 0:oe.isProfileSettingsEnabled)||(null===(le=null===(ne=e.currentConfig)||void 0===ne?void 0:ne.profileSettings)||void 0===le?void 0:le.isCustomizeOptionEnabled)!==(null===(re=null===(ae=this.props.currentConfig)||void 0===ae?void 0:ae.profileSettings)||void 0===re?void 0:re.isCustomizeOptionEnabled)||(null===(ce=null===(de=e.currentConfig)||void 0===de?void 0:de.assetSettings)||void 0===ce?void 0:ce.isAssetSettingsEnabled)!==(null===(ue=null===(he=this.props.currentConfig)||void 0===he?void 0:he.assetSettings)||void 0===ue?void 0:ue.isAssetSettingsEnabled))&&this._chart&&(this._chart.root.dispose(),this._chart=null),ge&&(this.props.assetIntersectionResult.forEach((e=>{var t,i;null===(i=null===(t=this.props.currentConfig)||void 0===t?void 0:t.assetSettings)||void 0===i||i.layers.forEach((t=>{var i;t.layerId===(null===(i=null==e?void 0:e.settings)||void 0===i?void 0:i.layerId)&&(e.settings=t)}))})),this._chart&&(this._chart.root.dispose(),this._chart=null)),this._updatedProfileLayers=null===(pe=this.props.currentConfig)||void 0===pe?void 0:pe.profileSettings.layers.concat(this.props.profileSettingsForNewAddedLayer),this.createOrUpdateChartDefinition()),e.isExportEnable!==this.props.isExportEnable&&this.props.isExportEnable&&(this.props.setExportButton(!1),this.performExportOperation())},this.didElevationLayersInfoChanged=(e,i)=>{let s=!1;return(null==i?void 0:i.length)!==(null==e?void 0:e.length)||(null==i||i.some(((i,o)=>{var n,l;if(i.label!==(null===(n=e[o])||void 0===n?void 0:n.label)||!t.lodash.isDeepEqual(i.style,null===(l=e[o])||void 0===l?void 0:l.style))return s=!0,!0})),s)},this.getGroundSeriesLabel=e=>{let t=e;return t=this.props.intl.formatMessage({id:"referenceLayerLabel",defaultMessage:r.referenceLayerLabel},{elevationLayerLabel:e}),t},this.resetExportingInfo=()=>{this._groundExportingInfo={xCoordinate:"X",yCoordinate:"Y",x:this.nls("distanceLabel")+" ("+this.props.selectedLinearUnit+")"},this._intersectingLayersExportingInfo={}},this.exportDataForIntersectingLayers=()=>{const e={},t=ie.Exporting.new(this._accessChartParams.chart.root,{dataSource:this._accessChartParams.chartData}),i=new Date;t.setAll({filePrefix:this.nls("_widgetLabel")+"-"+i.toDateString()+" "+i.toLocaleTimeString(),dataFields:this._groundExportingInfo}),Object.entries(this._intersectionSeriesKey).forEach((([t,i])=>{const s=this._accessChartParams.chartData[t];Object.entries(i).forEach((([t,i])=>{var o;(null===(o=this._intersectingLayersExportingInfo)||void 0===o?void 0:o[t])&&i.forEach((i=>{const o={xCoordinate:s.xCoordinate,yCoordinate:s.yCoordinate,x:s.x,intersectingLayerY:i.value,intersectingLayerY2:void 0,intersectingLayerDisplayField:i.displayField,layerName:this._intersectingLayersExportingInfo[t].layerName};i.hasOwnProperty("y2")&&(o.intersectingLayerY2=i.y2),e[t]||(e[t]=[]),e[t].push(o)}))}))})),Object.keys(e).forEach((i=>{const s=e[i];this.props.isFlip&&s.reverse(),t.events.on("dataprocessed",(e=>{e.data=s}));const o=B.clone(this._intersectingLayersExportingInfo[i]);o.layerName=this.nls("layerName"),t.set("dataFields",o),t.download("csv"),t.events.removeType("dataprocessed")}))},this.performExportOperation=()=>{try{const e=ie.Exporting.new(this._accessChartParams.chart.root,{dataSource:this._accessChartParams.chartData}),t=new Date;e.setAll({filePrefix:this.nls("_widgetLabel")+"-"+t.toDateString()+" "+t.toLocaleTimeString(),dataFields:this._groundExportingInfo}),e.events.on("dataprocessed",(e=>{let t=[];const i=e.data;if(i){if(this.props.isCustomIntervalEnabled&&!isNaN(this.props.customDistanceInterval)){let e=0;i.forEach((i=>{i.x>=e&&(t.push(i),e+=this.props.customDistanceInterval)}))}else t=[...i];t=t.filter(((e,i)=>0===i||e.x!==t[i-1].x)),this.props.isFlip&&t.reverse(),e.data=t}return t})),e.download("csv"),e.events.removeType("dataprocessed"),this.exportDataForIntersectingLayers()}catch(e){console.log(e)}},this.didProfileLayersSettingsChanged=(e,t)=>{let i=!1;return(null==t?void 0:t.length)!==(null==e?void 0:e.length)||(null==t||t.some(((t,s)=>{if(t.style.lineType!==e[s].style.lineType||t.style.lineColor!==e[s].style.lineColor||t.style.lineThickness!==e[s].style.lineThickness||t.elevationSettings.type!==e[s].elevationSettings.type||t.elevationSettings.unit!==e[s].elevationSettings.unit||t.elevationSettings.field1!==e[s].elevationSettings.field1||t.elevationSettings.field2!==e[s].elevationSettings.field2||t.distanceSettings.type!==e[s].distanceSettings.type||t.distanceSettings.field!==e[s].distanceSettings.field||t.distanceSettings.unit!==e[s].distanceSettings.unit)return i=!0,!0})),i)},this.didIntersectingLayersSettingsChanged=(e,t)=>{let i=!1;return(null==t?void 0:t.length)===(null==e?void 0:e.length)&&(null==t||t.some(((t,s)=>{var o,n,l,a,r,d,c,h,u,p,v,g,f,y,m,S,b,w,L,x,I,A,E,M,D;if((null===(o=null==t?void 0:t.style)||void 0===o?void 0:o.type)!==(null===(l=null===(n=e[s])||void 0===n?void 0:n.style)||void 0===l?void 0:l.type)||(null==t?void 0:t.displayField)!==(null===(a=e[s])||void 0===a?void 0:a.displayField)||(null===(r=null==t?void 0:t.style)||void 0===r?void 0:r.intersectingAssetShape)!==(null===(c=null===(d=e[s])||void 0===d?void 0:d.style)||void 0===c?void 0:c.intersectingAssetShape)||(null===(h=null==t?void 0:t.style)||void 0===h?void 0:h.intersectingAssetSize)!==(null===(p=null===(u=e[s])||void 0===u?void 0:u.style)||void 0===p?void 0:p.intersectingAssetSize)||(null===(v=null==t?void 0:t.style)||void 0===v?void 0:v.intersectingAssetColor)!==(null===(f=null===(g=e[s])||void 0===g?void 0:g.style)||void 0===f?void 0:f.intersectingAssetColor)||(null===(y=null==t?void 0:t.elevationSettings)||void 0===y?void 0:y.type)!==(null===(S=null===(m=e[s])||void 0===m?void 0:m.elevationSettings)||void 0===S?void 0:S.type)||(null===(b=null==t?void 0:t.elevationSettings)||void 0===b?void 0:b.unit)!==(null===(L=null===(w=e[s])||void 0===w?void 0:w.elevationSettings)||void 0===L?void 0:L.unit)||(null===(x=null==t?void 0:t.elevationSettings)||void 0===x?void 0:x.field1)!==(null===(A=null===(I=e[s])||void 0===I?void 0:I.elevationSettings)||void 0===A?void 0:A.field1)||(null===(E=null==t?void 0:t.elevationSettings)||void 0===E?void 0:E.field2)!==(null===(D=null===(M=e[s])||void 0===M?void 0:M.elevationSettings)||void 0===D?void 0:D.field2))return i=!0,!0}))),i},this.createOrUpdateChartDefinition=()=>{var e,t;const{profileResult:i,selectedElevationUnit:s}=this.props;if((null===(e=null==i?void 0:i.lines)||void 0===e?void 0:e.length)>0&&this.props.selectedLinearUnit&&s&&this.props.theme){const e=i.lines[0].samples;let o;if(this._viewOutput=null,this._elevationLayersOutput=[],"3d"===this.props.mapView.view.type&&(o=this.props.showVolumetricObj&&this.props.isSelectModeActive?i.lines.length-2:i.lines.length-1),i.lines.length>0&&(this.props.showVolumetricObj&&"3d"===this.props.mapView.view.type&&(this._viewOutput=i.lines[o].samples),null===(t=this.props.addedElelvationProfileLayers)||void 0===t||t.forEach((e=>{i.lines.forEach(((t,i)=>{if((void 0===o||i<=o)&&t.id===e.id){const i={style:e.style,label:e.label};this._elevationLayersOutput.push({id:t.id,layerId:"esriCTProfileLayer"+this._elevationLayersOutput.length,samples:t.samples,profileStyles:i})}}))}))),e.length>0){const t=[];this._allDistances=[],e.length>0?(e.forEach(((e,o)=>{var n;let l=e.elevation;null!==l&&(l=k(e.elevation,i.effectiveUnits.elevation,s));const a={xCoordinate:e.x,yCoordinate:e.y,x:k(e.distance,i.effectiveUnits.distance,this.props.selectedLinearUnit),y:l,esriCTViewY:null,pathIdx:0,pointIdx:o};null===(n=this._elevationLayersOutput)||void 0===n||n.forEach((e=>{e.id!==i.lines[0].id&&(null===e.samples[o].elevation?a[e.layerId]=null:a[e.layerId]=k(e.samples[o].elevation,i.effectiveUnits.elevation,s))})),this._viewOutput&&(a.esriCTViewY=k(this._viewOutput[o].elevation,i.effectiveUnits.elevation,s)),t.push(a),this._allDistances.push(e.distance)})),this._minMaxOfEachProfile={},this._seriesKey=[],this._seriesValue=[],this.createDataForProfileLines(t).then((()=>{this.createDataForIntersectingAssets(t).then((()=>{var e,s;let o=[];if(this.props.isFlip){const e=t[t.length-1].x;o=[...t],o.forEach((t=>{t.x=e-t.x}))}const n=this.getSelectedUnits(),l=this.props.intl.formatMessage({id:"graphDistanceLabel",defaultMessage:r.graphDistanceLabel},{unit:n[0]}),a=this.props.intl.formatMessage({id:"graphElevationLabel",defaultMessage:r.graphElevationLabel},{unit:n[1]}),d={data:this.props.isFlip?o:t,series:[{x:{field:"x",label:l},y:{field:"y",label:a},color:null===(s=null===(e=this.props.addedElelvationProfileLayers.filter((e=>{var t,s;return e.id===(null===(s=null===(t=null==i?void 0:i.lines)||void 0===t?void 0:t[0])||void 0===s?void 0:s.id)}))[0])||void 0===e?void 0:e.style)||void 0===s?void 0:s.lineColor}]};this.setState({chartDefinition:d},(()=>{var e,t;if(this._chart)return this._xAxisLabel.set("text",l),this._yAxisLabel.set("text",a),this._accessChartParams.chart.zoomOutButton.get("background").set("fill",(0,ie.colorAm5)(this.props.theme.sys.color.primary.main)),this._xAxis.set("numberFormatter",this.makeFormatter(this._accessChartParams,n[2])),this._yAxis.set("numberFormatter",this.makeFormatter(this._accessChartParams,n[3])),void this.adjustAxisRanges(this._accessChartParams);this.createChart({definition:d,container:this._chartContainer.current,isDarkTheme:"dark"===this.props.theme.sys.color.mode,showGrid:null===(e=this.props.commonGeneralSettings)||void 0===e?void 0:e.showGridAxis,showTitleAxis:null===(t=this.props.commonGeneralSettings)||void 0===t?void 0:t.showAxisTitles,showLegend:this.state.showLegend,exbTheme:this.props.theme,zoomOutText:this.nls("zoomOut"),unitsAbbreviations:this.getSelectedUnits()})}))}))}))):this.setState({chartDefinition:null},(()=>{this._chart&&(this._chart.root.dispose(),this._chart=null)}))}}else this.setState({chartDefinition:null}),this._chart&&(this._chart.root.dispose(),this._chart=null)},this.checkForProfileSettings=()=>{var e,t,i,s;const o=[];return(null===(t=null===(e=this.props.drawingLayer)||void 0===e?void 0:e.graphics)||void 0===t?void 0:t.length)>0&&(null===(s=null===(i=this.props.drawingLayer.graphics.getItemAt(0))||void 0===i?void 0:i.attributes)||void 0===s?void 0:s.esriCTFeatureLayerId)&&this.props.drawingLayer.graphics.forEach((e=>{const t=e.getAttribute("esriCTFeatureLayerId");o.includes(t)||o.push(t)})),o},this.getSelectedUnits=()=>{const e=this.props.unitOptions.find((e=>e.value===this.props.selectedLinearUnit)),t=this.props.unitOptions.find((e=>e.value===this.props.selectedElevationUnit)),i=this.nls(e.value),s=this.nls(e.abbreviation);return[i,this.nls(t.value),s,this.nls(t.abbreviation)]},this._updateProfileResults=e=>{const t={distances:{},elevations:{}};var i,s,o;return t.distances=(i=e.distances,s=e.effectiveUnits.distance,o=this.props.selectedLinearUnit,i.map((e=>parseFloat(T(e,s,o).toString()))),i),t.elevations=function(e,t,i,s,o){return e.forEach((e=>{e.x=parseFloat(T(e.x,t,s).toString()),e.y=parseFloat(T(e.y,i,o).toString())})),e}(e.elevations,e.effectiveUnits.distance,e.effectiveUnits.elevation,this.props.selectedLinearUnit,this.props.selectedElevationUnit),t},this.clearChart=()=>{this.setState({chartDefinition:null})},this.getNearestElevationData=e=>{if(!this.props.profileResult)return null;const t=this._allDistances;let i=k(e,this.props.selectedLinearUnit,this.props.profileResult.effectiveUnits.distance);if(this.props.isFlip){const e=t[t.length-1];i=e-i}const s=t.reduce(((e,t)=>Math.abs(t-i)<Math.abs(e-i)?t:e));if(s>=0){const e=t?t.indexOf(s):-1;if(e>=0){return this.state.chartDefinition.data[e]}}return null},this.hideChartPosition=()=>{this.props.hideChartPosition()},this.getChartPadding=e=>{let t=0,i=0,s=0;return this._isRTL,t=5,i=e.showTitleAxis&&e.showLegend?2:e.showTitleAxis&&!e.showLegend?0:!e.showTitleAxis&&e.showLegend?2:e.showTitleAxis||e.showLegend?0:5,s=5,{paddingTop:0,paddingRight:t,paddingBottom:i,paddingLeft:s}},this.configureCursorAM5=({chart:e,xAxis:t,yAxis:i,params:s})=>{var o;const n=this.getFontSize(),l=ie.TooltipAm5.new(e.root,{pointerOrientation:"horizontal"});e.plotContainer.set("tooltip",l),null===(o=l.get("background"))||void 0===o||o.setAll({fill:(0,ie.colorAm5)(s.exbTheme.ref.palette.white),strokeWidth:.5,stroke:(0,ie.colorAm5)(s.exbTheme.ref.palette.neutral[700]),fillOpacity:1}),l.label.setAll({fontSize:n+3});const a=ie.XYCursorAm5.new(e.root,{behavior:"zoomXY",xAxis:t,yAxis:i});return e.set("cursor",a),a},this.setZoomButton=(e,t,i)=>{var s;const o=ie.TooltipAm5.new(e.root,{labelText:t});null===(s=o.get("background"))||void 0===s||s.setAll({fill:(0,ie.colorAm5)(i.sys.color.primary.main),fillOpacity:.6}),e.zoomOutButton.setAll({cursorOverStyle:"pointer",tooltipText:t,tooltip:o}),this._isRTL&&e.plotContainer.onPrivate("width",(t=>{e.zoomOutButton.set("dx",50-t)})),e.zoomOutButton.get("background").setAll({fill:(0,ie.colorAm5)(i.sys.color.primary.main),stroke:(0,ie.colorAm5)(i.sys.color.primary.main)}),e.zoomOutButton.get("background").states.create("hover",{}).setAll({fill:(0,ie.colorAm5)(i.sys.color.primary.main),stroke:(0,ie.colorAm5)(i.sys.color.primary.main)}),e.zoomOutButton.get("background").states.create("down",{}).setAll({fill:(0,ie.colorAm5)(i.sys.color.primary.dark),stroke:(0,ie.colorAm5)(i.sys.color.primary.dark)})},this.initChart=e=>se(this,void 0,void 0,(function*(){var t;const i=yield(0,ie.createRoot)(e.container,window.locale),s=e.isDarkTheme,o=s?te:ee;i.setThemes(s?[ie.ResponsiveThemeAm5.new(i),ie.DarkThemeAm5.new(i),ie.AnimatedThemeAm5.new(i)]:[ie.ResponsiveThemeAm5.new(i),ie.AnimatedThemeAm5.new(i)]);const n=i.container.children.push(ie.XYChartAm5.new(i,Object.assign(Object.assign({},this.getChartPadding(e)),{maxTooltipDistance:0,pinchZoomX:!0,pinchZoomY:!0,wheelY:"zoomXY",layout:i.verticalLayout})));this.setZoomButton(n,e.zoomOutText,e.exbTheme);const l=n.xAxes.push(ie.ValueAxisAm5.new(i,{renderer:ie.AxisRendererXAm5.new(i,{})})),a=n.yAxes.push(ie.ValueAxisAm5.new(i,{renderer:ie.AxisRendererYAm5.new(i,{})}));a.data.setAll(e.definition.data),l.data.setAll(e.definition.data);const r={params:e,chart:n,xAxis:l,yAxis:a,seriesInfos:new Map,messages:null,theme:o,pointerIsOver:!1,chartData:e.definition.data};this._accessChartParams=r,this.configureXAxis(r),this.configureYAxis(r);const d=this.configureCursorAM5(r);let c;if(this.resetExportingInfo(),null===(t=this._elevationLayersOutput)||void 0===t||t.forEach((t=>{if(t.id===this.props.profileResult.lines[0].id)c=this.addGroundSeries(r),c.data.setAll(e.definition.data),n.series.push(c);else{const i=this.addElevationSurfaceSeries(r,t.id,t.layerId,t.profileStyles);i.data.setAll(e.definition.data),t.series=i,n.series.push(i)}})),this._viewOutput&&this.props.showVolumetricObj&&"3d"===this.props.mapView.view.type){const t=this.addVolumetricObjLineSeries(r);t.data.setAll(e.definition.data),n.series.push(t)}return this.profilingWithCustomizeOptions(r),this.displayChartLegend(r),setTimeout((()=>{this.adjustAxisRanges(r)}),500),{chart:n,cursor:d,xAxis:l,yAxis:a,groundSeries:c}})),this.showChartTooltip=e=>{var t,i,s,o,n,l;const{cursor:a,xAxis:r,yAxis:d,chart:c,groundSeries:h}=e;this.props.intersectionHighlightLayer.removeAll();const u=a.getPrivate("positionX"),p=r.toAxisPosition(u),v=r.positionToValue(p),g=this.getNearestElevationData(v),f=d.get("numberFormatter");if(g){let e=u;if(null!=this.props.profileResult.statistics){const s=this.props.profileResult;let{maxDistance:o}=s.statistics;if(null!=o){o=k(o,s.effectiveUnits.distance,this.props.selectedLinearUnit);const n=this._isRTL?1-u:u,l=r.positionToValue(null!==(t=r.get("start"))&&void 0!==t?t:0),a=r.positionToValue(null!==(i=r.get("end"))&&void 0!==i?i:1);e=this.positionRelativeToData(n,l,a,0,o)}}this.props.isFlip?this.props.highlightChartPositionOnMap(1-e):this.props.highlightChartPositionOnMap(e);let p=null;const v=d.height(),y=v+c.get("paddingTop"),m=f.format(g.y,5);let S='<div style="overflow: hidden;">',b="";null===(s=this._elevationLayersOutput)||void 0===s||s.forEach((e=>{if(e.id===this.props.profileResult.lines[0].id)h.isVisible()&&null!==g.y&&(p=g.y,b+='<div style="display:inline-block; margin: 3px 0px 3px 0px; height: 2px; width:15px; background-color:'+this._chartSeries.get("stroke").toString()+';"></div> '+this._chartSeries.get("name")+":  <b>"+m+"</b> <br/>");else if(e.series.isVisible()&&null!==g[e.layerId]){const t=f.format(g[e.layerId],5);(null===p||p<g[e.layerId])&&(p=g[e.layerId]),b+='<div style="display:inline-block; margin: 3px 0px 3px 0px; height: 2px; width:15px; background-color:'+e.profileStyles.style.lineColor+';"></div> '+e.profileStyles.label+":  <b>"+t+"</b> <br/>"}}));const w=f.format(g.esriCTViewY,5);this.props.profileResult.lines.length>1&&this.props.showVolumetricObj&&"3d"===this.props.mapView.view.type&&this._volumetricObjLineSeries.isVisible()&&(p=g.esriCTViewY,(null===p||p<g.esriCTViewY)&&(p=g.esriCTViewY),b+='<div style="display:inline-block; margin: 3px 0px 3px 0px; height: 2px; width:15px; background-color:'+this._volumetricObjLineSeries.get("stroke").toString()+';"></div> '+this._volumetricObjLineSeries.get("name")+":  <b>"+w+"</b> <br/>");const L=this._seriesKey&&this._seriesKey[g.pointIdx]?this._seriesKey[g.pointIdx]:null;if(null===(n=null===(o=this._chart)||void 0===o?void 0:o.series)||void 0===n||n.values.forEach((e=>{if(e.get("valueYField")===L&&e.isVisible()&&null!==g[L]){const t=f.format(g[L],5);return(null===p||p<g[L])&&(p=g[L]),b+='<div style="display:inline-block; margin: 3px 0px 3px 0px; height: 2px; width:15px; background-color:'+e.get("stroke").toString()+';"></div> '+e.get("name")+":  <b>"+t+"</b> <br/>",!0}})),null!==this._intersectionSeriesKeyIndex[g.pointIdx]){const e=null===(l=this._intersectionSeriesKey)||void 0===l?void 0:l[this._intersectionSeriesKeyIndex[g.pointIdx]],t={},i=[];if(e){Object.keys(e).forEach((s=>{e[s].forEach((e=>{var s,o;null===(o=null===(s=this._chart)||void 0===s?void 0:s.series)||void 0===o||o.values.some((s=>{if(s.get("valueYField")===e.seriesId&&s.isVisible()&&void 0!==g[e.seriesId]){let o=f.format(g[e.seriesId],5);const n=e.layerId+e.featureIndex+o;return i.includes(n)||(i.push(n),t[e.layerId]||(t[e.layerId]=[]),t[e.layerId].includes(e.featureIndex)||t[e.layerId].push(e.featureIndex),(null===p||p<g[e.seriesId])&&(p=g[e.seriesId]),e.hasOwnProperty("y2")&&(o=f.format(e.value,5),o=o+" | "+f.format(e.y2,5)),e.displayField?b+='<div style="display:inline-block; '+e.assetStyle+'"></div> '+s.get("name")+" ("+e.displayField+"):  <b>"+o+"</b> <br/>":b+='<div style="display:inline-block; '+e.assetStyle+'"></div> '+s.get("name")+":  <b>"+o+"</b> <br/>"),!0}}))}))}))}this.highlightIntersectionsOnMap(t)}if(""!==b&&d.get("min")<=p){S=S+b+"</div>";const e=c.plotContainer.get("tooltip");e.set("html",S);const t={x:a.getPrivate("point").x,y:y-d.valueToPosition(p)*v-1};e.set("pointTo",t),e.show()}}},this.createChart=e=>se(this,void 0,void 0,(function*(){this._seriesToBeHiddenInLegend=[];const t=yield this.initChart(e),{chart:i,cursor:s}=t;this._chart=i,s.events.on("cursormoved",(()=>{this.showChartTooltip(t)})),s.events.on("cursorhidden",(()=>{this.props.intersectionHighlightLayer.removeAll(),i.plotContainer.get("tooltip").hide(),this.hideChartPosition()}))})),this.canShowProfileSettingsForBackward=e=>{var t,i;let s=!1;return e&&(e.hasOwnProperty("advanceOptions")||(null==e?void 0:e.profileSettings.hasOwnProperty("isProfileSettingsEnabled"))||(null==e?void 0:e.profileSettings.hasOwnProperty("isCustomizeOptionEnabled")))&&((null==e?void 0:e.advanceOptions)||(null===(t=null==e?void 0:e.profileSettings)||void 0===t?void 0:t.isProfileSettingsEnabled)&&(null===(i=null==e?void 0:e.profileSettings)||void 0===i?void 0:i.isCustomizeOptionEnabled))&&(s=!0),s},this.profilingWithCustomizeOptions=e=>{var t,i,s,o,n;if(this.canShowProfileSettingsForBackward(this.props.currentConfig)){const t=this.checkForProfileSettings();t.length>0&&t.forEach((t=>{this.addLineSeries(t,e)}))}this.props.currentConfig&&(this.props.currentConfig.hasOwnProperty("advanceOptions")&&(null===(t=this.props.currentConfig)||void 0===t?void 0:t.advanceOptions)||(null===(s=null===(i=this.props.currentConfig)||void 0===i?void 0:i.assetSettings)||void 0===s?void 0:s.isAssetSettingsEnabled))&&(null===(o=this.props.assetIntersectionResult)||void 0===o?void 0:o.length)>0&&(null===(n=this.props.assetIntersectionResult)||void 0===n||n.forEach((t=>{var i;if((null===(i=null==t?void 0:t.intersectionResult)||void 0===i?void 0:i.length)>0){"polyline"===t.intersectionResult[0].intersectingFeature.geometry.type?this.addIntersectingLineSeries(t,e):this.addPointSeries(t,e)}})))},this.adjustAxisRanges=e=>{var t;const{xAxis:i,yAxis:s}=e;if(null===(t=this.props.profileResult)||void 0===t?void 0:t.statistics){const{minX:e,maxX:t,minY:o,maxY:n}=this.getAdjustedBounds({data:this.props.profileResult,pixelWidth:i.width(),pixelHeight:s.height()});i.set("min",e),i.set("max",t),s.set("min",o),s.set("max",n)}},this.getAdjustedBounds=({data:e,pixelWidth:t,pixelHeight:i})=>{const s=e.statistics;let o=s.maxDistance;o=k(o,e.effectiveUnits.distance,this.props.selectedLinearUnit);let n=s.minElevation;n=k(n,e.effectiveUnits.elevation,this.props.selectedElevationUnit);let l=s.maxElevation;l=k(l,e.effectiveUnits.elevation,this.props.selectedElevationUnit);for(const e in this._minMaxOfEachProfile)this._minMaxOfEachProfile[e].max>l&&(l=this._minMaxOfEachProfile[e].max),this._minMaxOfEachProfile[e].min<n&&(n=this._minMaxOfEachProfile[e].min);const a=Math.max(o-0,.001);let r=Math.max(l-n,.001);if(e.dynamicElevationRange){const e=k(a,this.props.selectedLinearUnit,this.props.selectedElevationUnit);r=Math.max(r,e/300)}n-=.02*r,l=n+r+.02*r;const d=function(e,t,i=10){const s=N(t-e,!1);if(0===s)return[e,t];const o=N(s/(i-1),!0);return[Math.floor(e/o)*o,Math.ceil(t/o)*o]}(n,l,10);return r=d[1]-d[0],this.props.isUniformChartScalingEnable?this.getUniformBounds({bounds:{minX:0,maxX:o,minY:n,maxY:l},pixelWidth:t,pixelHeight:i,centered:!0}):{minX:0,maxX:0+a,minY:n,maxY:n+r}},this.getUniformBounds=({bounds:e,pixelWidth:t,pixelHeight:i,centered:s})=>{let{minX:o,maxX:n,minY:l,maxY:a}=e;const r=n-o,d=k(a-l,this.props.selectedElevationUnit,this.props.selectedLinearUnit)/i/(r/t);return d>=1?[o,n]=this.scaleRange([o,n],d,s):[l,a]=this.scaleRange([l,a],1/d,s),{minX:o,maxX:n,minY:l,maxY:a}},this.scaleRange=([e,t],i,s)=>{const o=(t-e)*i;if(s){const i=(e+t)/2-o/2;return[i,i+o]}return[e,e+o]},this.getFontSize=()=>{const e=this.props.theme;let t=9;return"125%"===e.ref.typeface.htmlFontSize?t=11:"87.5%"===e.ref.typeface.htmlFontSize?t=8:"75%"===e.ref.typeface.htmlFontSize&&(t=7),t},this.configureXAxis=e=>{var t;const{chart:i,xAxis:s,theme:o,params:n}=e;this._xAxis=s;const l=this.getFontSize(),a=n.unitsAbbreviations;this._xAxisLabel=ie.LabelAm5.new(e.chart.root,{text:n.definition.series[0].x.label,textAlign:"center",x:ie.p50,fontWeight:o.axisLabelsFontWeight,fontSize:l+3,visible:n.showTitleAxis,paddingBottom:0}),s.children.push(this._xAxisLabel),s.setAll({extraMax:.001,extraMin:.001,maxDeviation:0,numberFormatter:this.makeFormatter(e,a[2]),strictMinMax:!0,strictMinMaxSelection:!0,extraTooltipPrecision:2,cursorTooltipEnabled:!0});const r=s.get("renderer");r.setAll({inside:!1,minGridDistance:o.xAxisMinGridDistance,inversed:this._isRTL}),r.labels.template.setAll({centerX:ie.p0,centerY:ie.p0,fontFamily:o.fontFamily,fontSize:l,fontWeight:o.axisLabelsFontWeight,maxPosition:o.xAxisMaxLabelPosition,minPosition:o.xAxisMinLabelPosition,paddingLeft:0,paddingRight:0,paddingTop:o.xAxisLabelsSpacing});const d=s.set("tooltip",ie.TooltipAm5.new(i.root,{paddingBottom:0,paddingLeft:0,paddingRight:0,paddingTop:0}));null===(t=d.get("background"))||void 0===t||t.setAll({fill:(0,ie.colorAm5)(n.exbTheme.ref.palette.black),stroke:void 0}),d.label.setAll({fill:(0,ie.colorAm5)(n.exbTheme.ref.palette.white),fontFamily:o.fontFamily,fontSize:o.axisTooltipFontSize,paddingBottom:o.axisTooltipPaddingBottom,paddingLeft:o.axisTooltipPaddingHorizontal,paddingRight:o.axisTooltipPaddingHorizontal,paddingTop:o.axisTooltipPaddingTop}),r.grid.template.setAll({visible:e.params.showGrid,strokeOpacity:1,stroke:(0,ie.colorAm5)(o.axisGridStroke)})},this.configureYAxis=e=>{var t;const{yAxis:i,theme:s,chart:o,params:n}=e;this._yAxis=i;const l=n.unitsAbbreviations,a=this.getFontSize();this._yAxisLabel=ie.LabelAm5.new(e.chart.root,{text:n.definition.series[0].y.label,textAlign:"center",y:ie.p50,rotation:-90,fontWeight:"500",fontSize:a+3,visible:n.showTitleAxis}),this._isRTL?i.children.push(this._yAxisLabel):i.children.unshift(this._yAxisLabel),i.setAll({baseValue:-5e5,extraMax:0,extraMin:.01,maxDeviation:0,numberFormatter:this.makeFormatter(e,l[3]),strictMinMax:!0,strictMinMaxSelection:!0,cursorTooltipEnabled:!0,extraTooltipPrecision:2});const r=i.get("renderer");r.setAll({minGridDistance:s.yAxisMinGridDistance,opposite:this._isRTL,inside:!0}),r.labels.template.setAll({fontFamily:s.fontFamily,fontSize:a,fontWeight:s.axisLabelsFontWeight,maxPosition:s.yAxisMaxLabelPosition,minPosition:s.yAxisMinLabelPosition,paddingTop:-8,direction:this._isRTL?"rtl":"ltr"});const d=i.set("tooltip",ie.TooltipAm5.new(o.root,{paddingBottom:0,paddingLeft:0,paddingRight:0,paddingTop:0}));null===(t=d.get("background"))||void 0===t||t.setAll({fill:(0,ie.colorAm5)(n.exbTheme.ref.palette.black),stroke:void 0}),d.label.setAll({fill:(0,ie.colorAm5)(n.exbTheme.ref.palette.white),fontFamily:s.fontFamily,fontSize:s.axisTooltipFontSize,paddingBottom:s.axisTooltipPaddingBottom,paddingLeft:s.axisTooltipPaddingHorizontal,paddingRight:s.axisTooltipPaddingHorizontal,paddingTop:s.axisTooltipPaddingTop}),r.grid.template.setAll({visible:e.params.showGrid,strokeOpacity:1,stroke:(0,ie.colorAm5)(s.axisGridStroke)})},this.highlightIntersectionsOnMap=e=>{var t;const i=Object.keys(e);if((null===(t=this.props.assetIntersectionResult)||void 0===t?void 0:t.length)>0&&i.length>0){const t=[];i.forEach((i=>{const s=e[i];this.props.assetIntersectionResult.some((e=>{var o;if((null===(o=null==e?void 0:e.intersectionResult)||void 0===o?void 0:o.length)>0&&i===e.settings.layerId)return s.forEach((i=>{var s;const o=(null===(s=e.intersectionResult[i])||void 0===s?void 0:s.record).getFeature();t.push(((e,t)=>{switch(t||(t="#00FFFF"),e.geometry.type){case"point":return K(e,t);case"polyline":return $(e,t);case"polygon":return Q(e,t)}})(o,"#FFFF00"))})),!0}))})),t.length>0&&(this.props.intersectionHighlightLayer.removeAll(),this.props.intersectionHighlightLayer.addMany(t))}},this.positionRelativeToData=(e,t,i,s,o)=>(t+e*(i-t)-s)/(o-s),this.addGroundSeries=e=>{const t=this.props.addedElelvationProfileLayers.filter((e=>e.id===this.props.profileResult.lines[0].id))[0],i=ie.LineSeriesAm5.new(e.chart.root,{id:t.id,name:this.getGroundSeriesLabel(t.label),connect:!1,excludeFromTotal:!0,fill:(0,ie.colorAm5)(e.params.definition.series[0].color),stroke:(0,ie.colorAm5)(e.params.definition.series[0].color),valueXField:"x",valueYField:"y",xAxis:e.xAxis,yAxis:e.yAxis,legendLabelText:"{name}"});return"dotted-line"===t.style.lineType?i.strokes.template.setAll({strokeWidth:t.style.lineThickness,strokeDasharray:[2,4]}):"dashed-line"===t.style.lineType?i.strokes.template.setAll({strokeWidth:t.style.lineThickness,strokeDasharray:[8,4]}):i.strokes.template.set("strokeWidth",t.style.lineThickness),i.fills.template.setAll({fillOpacity:.1,visible:!0}),this._chartSeries=i,this.props.chartInfo(this._accessChartParams.chart),this._groundExportingInfo.y=this.getGroundSeriesLabel(t.label)+" ("+this.props.selectedElevationUnit+")",i},this.addElevationSurfaceSeries=(e,t,i,s)=>{const o=s.label,n=s.style.lineColor,l=ie.LineSeriesAm5.new(e.chart.root,{id:t,name:o,connect:!1,excludeFromTotal:!0,stroke:(0,ie.colorAm5)(n),valueXField:"x",valueYField:i,xAxis:e.xAxis,yAxis:e.yAxis,legendLabelText:"{name}"});return"dotted-line"===s.style.lineType?l.strokes.template.setAll({strokeWidth:s.style.lineThickness,strokeDasharray:[2,4]}):"dashed-line"===s.style.lineType?l.strokes.template.setAll({strokeWidth:s.style.lineThickness,strokeDasharray:[8,4]}):l.strokes.template.set("strokeWidth",s.style.lineThickness),l.fills.template.setAll({visible:!0}),this.props.chartInfo(this._accessChartParams.chart),this._groundExportingInfo[i]=o+" "+this.nls("elevationLabel")+" ("+this.props.selectedElevationUnit+")",l},this.addVolumetricObjLineSeries=e=>{const t=this.props.volumetricObjLabel?this.props.volumetricObjLabel:this.nls("volumetricObj"),i=this.props.volumetricObjLineStyle.lineColor,s=ie.LineSeriesAm5.new(e.chart.root,{id:this.props.currentConfig.elevationLayersSettings.volumetricObjSettingsOptions.id,name:t,connect:!1,excludeFromTotal:!0,fill:(0,ie.colorAm5)(i),stroke:(0,ie.colorAm5)(i),valueXField:"x",valueYField:"esriCTViewY",xAxis:e.xAxis,yAxis:e.yAxis,legendLabelText:"{name}"});return"dotted-line"===this.props.volumetricObjLineStyle.lineType?s.strokes.template.setAll({strokeWidth:this.props.volumetricObjLineStyle.lineThickness,strokeDasharray:[2,4]}):"dashed-line"===this.props.volumetricObjLineStyle.lineType?s.strokes.template.setAll({strokeWidth:this.props.volumetricObjLineStyle.lineThickness,strokeDasharray:[8,4]}):s.strokes.template.set("strokeWidth",this.props.volumetricObjLineStyle.lineThickness),s.fills.template.setAll({fillOpacity:.1,visible:!0}),this._volumetricObjLineSeries=s,this.props.chartInfo(this._accessChartParams.chart),this._groundExportingInfo.esriCTViewY=t+" "+this.nls("elevationLabel")+" ("+this.props.selectedElevationUnit+")",s},this.getDistanceOfIntersectingPointOnLine=(e,t)=>{var i;if(e&&(null===(i=null==t?void 0:t.paths)||void 0===i?void 0:i.length)>0){const i=z.nearestCoordinate(t,e).coordinate,s=[];let o=0;t.paths.forEach((e=>{e.forEach(((i,n)=>{if(0!==n){const l=[[B.clone(e[n-1]),B.clone(i)]];s[o++]=new W.default({hasZ:t.hasZ,hasM:t.hasM,paths:l,spatialReference:t.spatialReference.toJSON()})}}))}));const n=[];s.forEach((e=>{n.push(this.getLengthAsPerMapProjection(e,this.props.selectedLinearUnit))}));let l=0,a=-1;return s.some(((e,s)=>{if(z.intersects(e,i)){const s=e.getPoint(0,0);if(z.intersects(s,i))a=l+0;else{const e={paths:[[[s.x,s.y],[i.x,i.y]]],spatialReference:t.spatialReference},o=new W.default(e);a=l+this.getLengthAsPerMapProjection(o,this.props.selectedLinearUnit)}return!0}l+=n[s]})),a}return-1},this.createDataForIntersectingAssets=e=>se(this,void 0,void 0,(function*(){var t,i,s,o,n,l;if(this.props.currentConfig){if(((null===(t=this.props.currentConfig)||void 0===t?void 0:t.hasOwnProperty("advanceOptions"))&&(null===(i=this.props.currentConfig)||void 0===i?void 0:i.advanceOptions)||(null===(o=null===(s=this.props.currentConfig)||void 0===s?void 0:s.assetSettings)||void 0===o?void 0:o.hasOwnProperty("isAssetSettingsEnabled"))&&(null===(n=this.props.currentConfig.assetSettings)||void 0===n?void 0:n.isAssetSettingsEnabled))&&(null===(l=this.props.assetIntersectionResult)||void 0===l?void 0:l.length)>0){const t=new Promise((t=>{this._intersectionSeriesKey={},this.props.assetIntersectionResult.forEach((t=>{var i,s,o,n;if((null===(i=null==t?void 0:t.settings)||void 0===i?void 0:i.elevationSettings)&&(null===(s=t.intersectionResult)||void 0===s?void 0:s.length)>0){const i=null===(n=null===(o=null==t?void 0:t.intersectionResult[0].intersectingFeature)||void 0===o?void 0:o.geometry)||void 0===n?void 0:n.type;"point"===i?this.createElevationDataForIntersectingPointLayer(t,e):"polyline"===i&&this.createElevationDataForIntersectingLineLayer(t,e)}})),t(e)}));return t}yield Promise.resolve()}})),this.createElevationDataForIntersectingPointLayer=(e,t)=>{var i;const s=e.settings.layerId,o=null===(i=null==e?void 0:e.settings)||void 0===i?void 0:i.elevationSettings,n=X.default.getMetersPerUnitForSR(new Y.default(this.props.mapView.view.spatialReference.toJSON()));null==e||e.intersectionResult.forEach(((i,l)=>{var a,r,d,c,h,u;const p=this.getDistanceOfIntersectingPointOnLine(i.intersectingFeature.geometry,e.inputGeometry);let v;const g=i.intersectingFeature,f=(null===(a=null==e?void 0:e.settings)||void 0===a?void 0:a.displayField)?i.record.getFormattedFieldValue(null===(r=null==e?void 0:e.settings)||void 0===r?void 0:r.displayField,this.props.intl):void 0,y=null===(c=null===(d=null==e?void 0:e.settings)||void 0===d?void 0:d.style)||void 0===c?void 0:c.intersectingAssetShape,m=null===(u=null===(h=null==e?void 0:e.settings)||void 0===h?void 0:h.style)||void 0===u?void 0:u.intersectingAssetColor;let S=y;S||(S="circle");let b,w="";switch(S){case"rectangle":w+="margin: 0px 3px 0px 3px; height: 7px; width: 15px; background-color: "+m+";";break;case"circle":w+="margin: 0px 3px 0px 3px; height: 10px; width: 10px; background-color: "+m+"; border-radius: 50%;";break;case"square":w+="margin: 0px 3px 0px 3px; height: 10px; width: 10px; background-color: "+m+";";break;case"triangle":w+="margin: 0px 3px 0px 3px; width: 0; height: 0; border:5px solid transparent; border-bottom: 10px solid "+m+";"}"z"===o.type?(v=i.intersectingFeature.geometry.z*n,v=k(v,oe,this.props.selectedElevationUnit)):"one"===o.type&&o.field1&&null!==g.attributes[o.field1]?(v=g.attributes[o.field1],o.unit&&o.unit!==this.props.selectedElevationUnit&&(v=k(v,o.unit,this.props.selectedElevationUnit))):"two"===o.type&&o.field1&&o.field2&&null!==g.attributes[o.field1]&&null!==g.attributes[o.field2]&&(v=g.attributes[o.field1],o.unit&&o.unit!==this.props.selectedElevationUnit&&(v=k(v,o.unit,this.props.selectedElevationUnit)),b=g.attributes[o.field2],o.unit&&o.unit!==this.props.selectedElevationUnit&&(b=k(b,o.unit,this.props.selectedElevationUnit)));const L=t.filter((e=>e.x>=p));let x;if(L.length<1){const e=t.length;t[e-1].x<p&&(x=t[e-1])}else null==L||L.some((e=>(x=e,!0)));const I=s+l+"y",A=s+l+"y2";x&&(void 0===v?"match profile"===o.type&&x.layerName?x[I]=x[x.layerName+"y"]:x[I]=x.y:x[I]=v,"two"===o.type?(x[A]=void 0===b?x.y:b,this.updateMinMaxForIntersectionProfile({pointIndex:x.pointIdx,layerId:s,seriesID:A,newValue:x[I],newValue2:x[A],displayField:f,assetShapeStyle:w,featureIndex:l})):this.updateMinMaxForIntersectionProfile({pointIndex:x.pointIdx,layerId:s,seriesID:I,newValue:x[I],newValue2:void 0,displayField:f,assetShapeStyle:w,featureIndex:l}))}))},this._getElevationValueForPointOnLineGeometry=(e,t,i)=>{let s;const o=this.getDistanceOfIntersectingPointOnLine(t,i.geometry),n=this.getLengthAsPerMapProjection(i.geometry,this.props.selectedLinearUnit),l=X.default.getMetersPerUnitForSR(new Y.default(this.props.mapView.view.spatialReference.toJSON()));if("z"===e.type)s=t.z*l,s=k(s,oe,this.props.selectedElevationUnit);else if("one"===e.type&&e.field1&&null!==i.attributes[e.field1])s=i.attributes[e.field1],e.unit&&e.unit!==this.props.selectedElevationUnit&&(s=k(s,e.unit,this.props.selectedElevationUnit));else if("two"===e.type&&e.field1&&e.field2&&null!==i.attributes[e.field1]&&null!==i.attributes[e.field2]){let t=i.attributes[e.field1];e.unit&&e.unit!==this.props.selectedElevationUnit&&(t=k(t,e.unit,this.props.selectedElevationUnit));let l=i.attributes[e.field2];e.unit&&e.unit!==this.props.selectedElevationUnit&&(l=k(l,e.unit,this.props.selectedElevationUnit));s=t+(l-t)/n*o}return s},this.createElevationDataForIntersectingLineLayer=(e,i)=>{const s=e.settings.elevationSettings,o=e.settings.layerId,n=i.length;null==e||e.intersectionResult.forEach(((l,a)=>{var r,d,c,h;const u=l.intersectingFeature,p=(null===(r=null==e?void 0:e.settings)||void 0===r?void 0:r.displayField)?l.record.getFormattedFieldValue(null===(d=null==e?void 0:e.settings)||void 0===d?void 0:d.displayField,this.props.intl):void 0,v="margin: 3px 0px 3px 0px; height: 2px; width:15px; background-color:"+(null===(h=null===(c=null==e?void 0:e.settings)||void 0===c?void 0:c.style)||void 0===h?void 0:h.intersectingAssetColor)+";";l.connectedFeatureForProfiling.forEach((l=>{let r=[],d=[];const c=[],h=[];l.paths.forEach(((l,g)=>{d=[],r=[],c[g]=[],h[g]=[];const f=o+"y_I_"+a+"_"+g,y=o+"y-point_"+a+"_"+g;l.forEach(((l,m)=>{const S=new H.default(l),b=z.nearestCoordinate(e.inputGeometry,S).coordinate;let w=this.getDistanceOfIntersectingPointOnLine(b,e.inputGeometry);const L=this._getElevationValueForPointOnLineGeometry(s,S,u);if(r.push(L),d.push(w),0!==m){let e=d[m-1],l=L,u=r[m-1];w<e&&(e+=w,w=e-w,e-=w,l=r[m-1],u=L);const S=w-e,b=B.clone(e);e+=S;let x=i.filter((t=>t.x>=b&&t.x<e));if(0===x.length&&(0===e&&n>0?x=[i[0]]:(x=i.filter((t=>t.x<e)),x.length>0&&(x=[x[x.length-1]]))),x.length>1){if(void 0===l||void 0===u)x.forEach((e=>{let t=e.y;"match profile"===s.type&&e.layerName&&(t=e[e.layerName+"y"]),e[f]=t,this.updateMinMaxForIntersectionProfile({pointIndex:e.pointIdx,layerId:o,seriesID:f,newValue:t,newValue2:void 0,displayField:p,assetShapeStyle:v,featureIndex:a})}));else{const e=(l-u)/S;x.forEach((t=>{let i=0;i=t.x-b;const s=u+e*i;t[f]=s,this.updateMinMaxForIntersectionProfile({pointIndex:t.pointIdx,layerId:o,seriesID:f,newValue:s,newValue2:void 0,displayField:p,assetShapeStyle:v,featureIndex:a})}))}const e=x[0],t=x[x.length-1];e.x===t.x?(c[g].push([e]),h[g].push([l])):(c[g].push([e,t]),h[g].push([u,l]))}else if(1===x.length){let e=!1;c[g].length>0&&c[g].some((i=>{if(t.lodash.isDeepEqual(x,i))return e=!0,!0})),e||(c[g].push([x[0]]),h[g].push([u]))}else if(0===x.length){let t;i[n-1].x<e&&(t=i[n-1],void 0===l&&(l="match profile"===s.type&&t.layerName?t[t.layerName+"y"]:t.y),t[y]=l,this.updateMinMaxForIntersectionProfile({pointIndex:t.pointIdx,layerId:o,seriesID:y,newValue:l,newValue2:void 0,displayField:p,assetShapeStyle:v,featureIndex:a})),c[g].push([]),h[g].push([])}}}))})),c.forEach(((e,t)=>{const i=o+"y_I_"+a+"_"+t,n=o+"y-point_"+a+"_"+t;let l=0;if(e.forEach((e=>{l+=e.length})),l>1)e.forEach(((e,n)=>{if(e.length>0){let l,r;1===e.length&&(r=h[t][n][0],l=e[0],void 0===r&&(r="match profile"===s.type&&l.layerName?l[l.layerName+"y"]:l.y),l[i]=r,this.updateMinMaxForIntersectionProfile({pointIndex:l.pointIdx,layerId:o,seriesID:i,newValue:r,newValue2:void 0,displayField:p,assetShapeStyle:v,featureIndex:a}))}}));else if(1===l){let i,l;e.some(((e,r)=>{if(e.length>0&&e[0])return i=e[0],l=h[t][r][0],void 0===l&&(l="match profile"===s.type&&i.layerName?i[i.layerName+"y"]:i.y),i[n]=l,this.updateMinMaxForIntersectionProfile({pointIndex:i.pointIdx,layerId:o,seriesID:n,newValue:l,newValue2:void 0,displayField:p,assetShapeStyle:v,featureIndex:a}),!0}))}}))})),l.disconnectedFeatureForProfiling.forEach(((t,n)=>{const l=this._getElevationValueForPointOnLineGeometry(s,t,u),r=this.getDistanceOfIntersectingPointOnLine(t,e.inputGeometry),d=i.filter((e=>e.x>=r));let c;const h=o+"y-point_"+a+"_"+n+"_d";if(d.length<1){const e=i.length;i[e-1].x<r&&(c=i[e-1])}else null==d||d.some((e=>{if(!e.hasOwnProperty(h))return c=e,!0}));c&&(void 0===l?"match profile"===s.type&&c.layerName?c[h]=c[c.layerName+"y"]:c[h]=c.y:c[h]=l,this.updateMinMaxForIntersectionProfile({pointIndex:c.pointIdx,layerId:o,seriesID:h,newValue:c[h],newValue2:void 0,displayField:p,assetShapeStyle:v,featureIndex:a}))}))}))},this.createDataForProfileLines=e=>se(this,void 0,void 0,(function*(){if(this.canShowProfileSettingsForBackward(this.props.currentConfig)){const t=this.checkForProfileSettings();if(t.length>0){return new Promise(((i,s)=>{this.getDistanceOfAllSelectedFeatures().then((s=>{t.forEach((t=>{let i=0;this.props.drawingLayer.graphics.forEach(((o,n)=>se(this,void 0,void 0,(function*(){const l=o.attributes.esriCTFeatureLayerId,a=this.getConfiguredSettingsForLine(l);if((null==a?void 0:a.elevationSettings)&&l===t){const t=s[n],l=B.clone(i);i+=t;const r=e.filter((e=>e.x>=l&&e.x<=i));this.addElevationForSelectedFeature(a.elevationSettings,o,t,r,l)}else i+=s[n]}))))})),i(e)}))}))}yield Promise.resolve()}else yield Promise.resolve()})),this.removeNegativeExponents=e=>{let t;return t=e.toString().toLowerCase().split("e-").length>1?0:e,t},this.getLengthAsPerMapProjection=(e,t)=>{const i=this.props.mapView.view.spatialReference.isWebMercator||this.props.mapView.view.spatialReference.isGeographic?z.geodesicLength(e,t):z.planarLength(e,t);return this.removeNegativeExponents(i)},this.getDistanceAsPerMapProjection=(e,t)=>this.props.mapView.view.spatialReference.isWebMercator||this.props.mapView.view.spatialReference.isGeographic?G.geodesicLength(e,t):G.planarLength(e,t),this.getConfiguredSettingsForLine=e=>this._updatedProfileLayers.find((t=>t.layerId===e)),this.getDistanceAsPerConfiguredFieldAndUnits=(e,t)=>{const i=t.attributes[e.field];return isNaN(Number(i))?0:k(i,e.unit,this.props.selectedLinearUnit)},this.updateMinMaxForIntersectionProfile=e=>{let t=e.newValue,i=e.newValue;this._intersectionSeriesKey[e.pointIndex]||(this._intersectionSeriesKey[e.pointIndex]={}),this._intersectionSeriesKeyIndex[e.pointIndex]=e.pointIndex;const s={seriesId:e.seriesID,value:e.newValue,assetStyle:e.assetShapeStyle,featureIndex:e.featureIndex,layerId:e.layerId};void 0!==e.newValue2&&(s.y2=e.newValue2,i<e.newValue2&&(i=e.newValue2),t>e.newValue2&&(t=e.newValue2)),void 0!==e.displayField&&null!==e.displayField&&(s.displayField=e.displayField),this._intersectionSeriesKey[e.pointIndex][e.layerId]||(this._intersectionSeriesKey[e.pointIndex][e.layerId]=[]),this._intersectionSeriesKey[e.pointIndex][e.layerId].push(s),this._minMaxOfEachProfile[e.layerId]?this._minMaxOfEachProfile[e.layerId]&&(this._minMaxOfEachProfile[e.layerId].min>t&&(this._minMaxOfEachProfile[e.layerId].min=t),this._minMaxOfEachProfile[e.layerId].max<i&&(this._minMaxOfEachProfile[e.layerId].max=i)):this._minMaxOfEachProfile[e.layerId]={min:t,max:i}},this.updateMinMaxForProfile=(e,t,i)=>{this._seriesKey[e]=t+"y",this._seriesValue[e]=i,this._intersectionSeriesKeyIndex[e]=null,this._minMaxOfEachProfile[t]?this._minMaxOfEachProfile[t]&&(this._minMaxOfEachProfile[t].min>i&&(this._minMaxOfEachProfile[t].min=i),this._minMaxOfEachProfile[t].max<i&&(this._minMaxOfEachProfile[t].max=i)):this._minMaxOfEachProfile[t]={min:i,max:i}},this.addElevationForSelectedFeature=(e,t,i,s,o)=>{var n,l;let a,r;const d=t.attributes.esriCTFeatureLayerId;if("one"===e.type&&e.field1&&null!==t.attributes[e.field1])a=t.attributes[e.field1],e.unit&&e.unit!==this.props.selectedElevationUnit&&(a=k(a,e.unit,this.props.selectedElevationUnit)),s.forEach((e=>{e[d+"y"]=a,e.layerName=d,this.updateMinMaxForProfile(e.pointIdx,d,a)}));else if("two"===e.type&&e.field1&&e.field2&&null!==t.attributes[e.field1]&&null!==t.attributes[e.field2]){a=t.attributes[e.field1],e.unit&&e.unit!==this.props.selectedElevationUnit&&(a=k(a,e.unit,this.props.selectedElevationUnit)),r=t.attributes[e.field2],e.unit&&e.unit!==this.props.selectedElevationUnit&&(r=k(r,e.unit,this.props.selectedElevationUnit));const n=(r-a)/i;s.forEach((e=>{let t=0;t=e.x-o;const i=a+n*t;e[d+"y"]=i,e.layerName=d,this.updateMinMaxForProfile(e.pointIdx,d,i)}))}else if("z"===e.type&&t.geometry.hasZ){const e=t.geometry;if((null===(n=e.paths)||void 0===n?void 0:n.length)>0){const t=[];let i=0;e.paths.forEach((s=>{s.forEach(((o,n)=>{if(0!==n){const l=[[B.clone(s[n-1]),B.clone(o)]];t[i++]=new W.default({hasZ:e.hasZ,hasM:e.hasM,paths:l,spatialReference:e.spatialReference.toJSON()})}}))}));const o=X.default.getMetersPerUnitForSR(new Y.default(this.props.mapView.view.spatialReference.toJSON()));let n=null===(l=s[0])||void 0===l?void 0:l.x;const a=this.props.drawingLayer.elevationInfo;t.forEach(((e,i)=>{const l=this.getLengthAsPerMapProjection(e,this.props.selectedLinearUnit),r=t[i].paths[0][0][2]*o,c=t[i].paths[0][1][2]*o,h=s.filter((e=>e.x>=n&&e.x<=n+l));let u=k(r,oe,this.props.selectedElevationUnit),p=k(c,oe,this.props.selectedElevationUnit);"3d"===this.props.mapView.view.type&&a&&(null==h?void 0:h.length)>0&&("relative-to-ground"!==a.mode&&"relative-to-scene"!==a.mode||(u+=h[0].y,p+=h[h.length-1].y));const v=(p-u)/l;h.forEach((e=>{if(!e[d+"y"]){let t=0;t=e.x-n;let i=u+v*t;"3d"===this.props.mapView.view.type&&"on-the-ground"===(null==a?void 0:a.mode)&&(i=e.y),e[d+"y"]=i,e.layerName=d,this.updateMinMaxForProfile(e.pointIdx,d,i)}})),n+=l}))}}else e.type&&s.forEach((e=>{e[d+"y"]=e.y,e.layerName=d,this.updateMinMaxForProfile(e.pointIdx,d,e.y)}))},this.getDistanceOfAllSelectedFeatures=()=>{const e=[];return this.props.drawingLayer.graphics.forEach((t=>{e.push(this.getDistanceAsPerMapProjection(t.geometry,this.props.selectedLinearUnit))})),Promise.all(e)},this.addLineSeries=(e,i)=>{var s;let o=null,n="";const l=t.DataSourceManager.getInstance();if(this._updatedProfileLayers.length>0&&(o=this._updatedProfileLayers.filter((t=>t.layerId===e))),1===(null==o?void 0:o.length)){const t=l.getDataSource(e);if(t){const l=null!==(s=t.layer)&&void 0!==s?s:t.restLayer;n=null==l?void 0:l.title;const a=ie.LineSeriesAm5.new(i.chart.root,{name:n,connect:!1,excludeFromTotal:!0,stroke:(0,ie.colorAm5)(o[0].style.lineColor),valueXField:"x",valueYField:e+"y",xAxis:i.xAxis,yAxis:i.yAxis,legendLabelText:"{name}"});"dotted-line"===o[0].style.lineType?a.strokes.template.setAll({strokeWidth:o[0].style.lineThickness,strokeDasharray:[2,4]}):"dashed-line"===o[0].style.lineType?a.strokes.template.setAll({strokeWidth:o[0].style.lineThickness,strokeDasharray:[8,4]}):a.strokes.template.set("strokeWidth",o[0].style.lineThickness),a.fills.template.setAll({visible:!0}),a.data.setAll(i.params.definition.data),i.chart.series.push(a),this._groundExportingInfo[e+"y"]=n+" "+this.nls("elevationLabel")+" ("+this.props.selectedElevationUnit+")"}}},this.getDisplayFieldAlias=(e,i)=>{var s,o;const n=t.DataSourceManager.getInstance().getDataSource(e),l=null===(s=null==n?void 0:n.getSchema())||void 0===s?void 0:s.fields;return(null===(o=null==l?void 0:l[i])||void 0===o?void 0:o.alias)||i},this.createPointSeriesForIntersectingLines=(e,t,i,s,o)=>{const n=ie.LineSeriesAm5.new(e.chart.root,{calculateAggregates:!1,name:i,stroke:(0,ie.colorAm5)(t.style.intersectingAssetColor),valueXField:"x",valueYField:t.layerId+"y-point_"+s+"_"+o,xAxis:e.xAxis,yAxis:e.yAxis}),l=ie.ContainerAm5.new(e.chart.root,{centerX:ie.p50,centerY:ie.p50});return l.children.push(ie.RectangleAm5.new(e.chart.root,{x:ie.p50,y:ie.p50,width:t.style.intersectingAssetSize?t.style.intersectingAssetSize:6,height:t.style.intersectingAssetSize?t.style.intersectingAssetSize:6,fill:(0,ie.colorAm5)(t.style.intersectingAssetColor),stroke:(0,ie.colorAm5)(t.style.intersectingAssetColor)})),n.bullets.push((function(t){return ie.BulletAm5.new(e.chart.root,{sprite:l})})),this._seriesToBeHiddenInLegend.push(n.uid),n.data.setAll(e.params.definition.data),e.chart.series.push(n),n},this.createSeriesForIntersectingLines=(e,t,i,s,o)=>{const n=ie.LineSeriesAm5.new(e.chart.root,{name:i,connect:!1,excludeFromTotal:!0,stroke:(0,ie.colorAm5)(t.style.intersectingAssetColor),valueXField:"x",valueYField:t.layerId+"y_I_"+s+"_"+o,xAxis:e.xAxis,yAxis:e.yAxis,legendLabelText:"{name}"}),l=t.style.intersectingAssetSize?t.style.intersectingAssetSize:4;"dotted-line"===t.style.intersectingAssetShape?n.strokes.template.setAll({strokeWidth:l,strokeDasharray:[2,4]}):"dashed-line"===t.style.intersectingAssetShape?n.strokes.template.setAll({strokeWidth:l,strokeDasharray:[8,4]}):n.strokes.template.set("strokeWidth",l),n.fills.template.setAll({visible:!0}),n.data.setAll(e.params.definition.data);const a=this.createPointSeriesForIntersectingLines(e,t,i,s,o);return n.on("visible",(function(e,t){e?(a.show(0),n.show(0)):(a.hide(0),n.hide(0))})),e.chart.series.push(n),n},this.addIntersectingLineSeries=(e,t)=>{var i;const s=null==e?void 0:e.title,o=null==e?void 0:e.settings,n=[];o&&s&&(null==e||e.intersectionResult.forEach(((e,i)=>{e.connectedFeatureForProfiling.forEach((e=>{e.paths.forEach(((e,l)=>{const a=this.createSeriesForIntersectingLines(t,o,s,i,l);n.length>0&&this._seriesToBeHiddenInLegend.push(a.uid),n.push(a)}))})),e.disconnectedFeatureForProfiling.forEach(((e,l)=>{const a=this.createSeriesForIntersectingLines(t,o,s,i,l+"_d");n.length>0&&this._seriesToBeHiddenInLegend.push(a.uid),n.push(a)}))})),this._intersectingLayersExportingInfo[o.layerId]={xCoordinate:"X",yCoordinate:"Y",x:this.nls("distanceLabel")+" ("+this.props.selectedLinearUnit+")",intersectingLayerY:this.nls("elevationLabel")+" ("+this.props.selectedElevationUnit+")",layerName:s,intersectingLayerDisplayField:this.getDisplayFieldAlias(o.layerId,o.displayField)},null===(i=n[0])||void 0===i||i.on("visible",(function(e){n.forEach((t=>{e?t.show(0):t.hide(0)}))})))},this.addPointSeries=(e,t)=>{const i=null==e?void 0:e.title,s=null==e?void 0:e.settings,o=[];if(s&&i){for(let n=0;n<e.intersectionResult.length;n++){let e;if("two"===s.elevationSettings.type){e=ie.ColumnSeries.new(t.chart.root,{sequencedInterpolation:!1,name:i,stroke:(0,ie.colorAm5)(s.style.intersectingAssetColor),valueXField:"x",openValueYField:s.layerId+n+"y",valueYField:s.layerId+n+"y2",xAxis:t.xAxis,yAxis:t.yAxis});this.createBulletsForDumbbellPlotSeries(t,e,s).set("locationY",1);this.createBulletsForPointSeries(t,e,s).set("locationY",.5);this.createBulletsForDumbbellPlotSeries(t,e,s).set("locationY",0)}else e=ie.LineSeriesAm5.new(t.chart.root,{calculateAggregates:!1,name:i,stroke:(0,ie.colorAm5)(s.style.intersectingAssetColor),valueXField:"x",valueYField:s.layerId+n+"y",xAxis:t.xAxis,yAxis:t.yAxis}),this.createBulletsForPointSeries(t,e,s);this._seriesToBeHiddenInLegend.push(e.uid),null==e||e.data.setAll(t.params.definition.data),t.chart.series.push(e),o.push(e)}const n=ie.LineSeriesAm5.new(t.chart.root,{name:i,connect:!1,excludeFromTotal:!0,stroke:(0,ie.colorAm5)(s.style.intersectingAssetColor),valueXField:"x",valueYField:s.layerId+"y-linePoint",xAxis:t.xAxis,yAxis:t.yAxis,legendLabelText:"{name}"});n.strokes.template.setAll({strokeWidth:1,strokeOpacity:0}),n.fills.template.setAll({visible:!0}),n.data.setAll(t.params.definition.data),this.createBulletsForPointSeries(t,n,s,!0),null==n||n.on("visible",(function(e){o.forEach((t=>{e?t.show(0):t.hide(0)}))})),n.data.setAll(t.params.definition.data),t.chart.series.push(n);const l=this.getDisplayFieldAlias(s.layerId,s.displayField);"two"===s.elevationSettings.type?this._intersectingLayersExportingInfo[s.layerId]={xCoordinate:"X",yCoordinate:"Y",x:this.nls("distanceLabel")+" ("+this.props.selectedLinearUnit+")",intersectingLayerY:this.nls("oneFieldLabelForExport")+" "+this.nls("elevationLabel")+" ("+this.props.selectedElevationUnit+")",intersectingLayerY2:this.nls("twoFieldLabelForExport")+" "+this.nls("elevationLabel")+" ("+this.props.selectedElevationUnit+")",layerName:i,intersectingLayerDisplayField:l}:this._intersectingLayersExportingInfo[s.layerId]={xCoordinate:"X",yCoordinate:"Y",x:this.nls("distanceLabel")+" ("+this.props.selectedLinearUnit+")",intersectingLayerY:this.nls("elevationLabel")+" ("+this.props.selectedElevationUnit+")",layerName:i,intersectingLayerDisplayField:l}}},this.createBulletsForPointSeries=(e,t,i,s)=>{let o=i.style.intersectingAssetSize?i.style.intersectingAssetSize:6;s&&o>10&&(o=10);const n=ie.ContainerAm5.new(e.chart.root,{centerX:ie.p50,centerY:ie.p50});let l;switch(i.style.intersectingAssetShape){case"rectangle":l=ie.RectangleAm5.new(e.chart.root,{x:ie.p50,y:ie.p50,interactive:!0,width:o,height:o/2,fill:(0,ie.colorAm5)(i.style.intersectingAssetColor),stroke:(0,ie.colorAm5)(i.style.intersectingAssetColor)});break;case"square":l=ie.RectangleAm5.new(e.chart.root,{x:ie.p50,y:ie.p50,interactive:!0,width:o,height:o,fill:(0,ie.colorAm5)(i.style.intersectingAssetColor),stroke:(0,ie.colorAm5)(i.style.intersectingAssetColor)});break;case"triangle":l=ie.TriangleAm5.new(e.chart.root,{x:ie.p50,y:ie.p50,interactive:!0,width:o,height:o,fill:(0,ie.colorAm5)(i.style.intersectingAssetColor),stroke:(0,ie.colorAm5)(i.style.intersectingAssetColor)});break;default:l=ie.CircleAm5.new(e.chart.root,{interactive:!0,radius:o,fill:(0,ie.colorAm5)(i.style.intersectingAssetColor),stroke:(0,ie.colorAm5)(i.style.intersectingAssetColor),x:ie.p50,y:ie.p50})}n.children.push(l),l.states.create("hover",{scale:1.3});const a=ie.BulletAm5.new(e.chart.root,{sprite:n});return t.bullets.push((function(){return a})),a},this.createBulletsForDumbbellPlotSeries=(e,t,i)=>{const s=i.style.intersectingAssetSize?i.style.intersectingAssetSize:6,o=ie.ContainerAm5.new(e.chart.root,{centerX:ie.p50,centerY:ie.p50});o.children.push(ie.RectangleAm5.new(e.chart.root,{width:"circle"===i.style.intersectingAssetShape?2*s:s+2,height:1,fill:(0,ie.colorAm5)(i.style.intersectingAssetColor),stroke:(0,ie.colorAm5)(i.style.intersectingAssetColor)}));const n=ie.BulletAm5.new(e.chart.root,{sprite:o});return t.bullets.push((function(){return n})),n},this.displayChartLegend=e=>{const{chart:t}=e,i=t.children.push(ie.LegendAm5.new(t.root,{x:this._isRTL?ie.p100:ie.p0,centerX:this._isRTL?ie.p100:ie.p0,reverseChildren:this._isRTL,visible:this.state.showLegend}));i.itemContainers.template.setAll({reverseChildren:this._isRTL,paddingTop:5,marginBottom:0,paddingBottom:0}),i.labels.template.setAll({direction:this._isRTL?"rtl":"ltr",textAlign:this._isRTL?"end":"start",paddingRight:this._isRTL?5:0}),i.valueLabels.template.set("forceHidden",!0);const s=t.series.values.filter((e=>!this._seriesToBeHiddenInLegend.includes(e.uid)));i.data.setAll(s),i.itemContainers.each((e=>{e.events.on("click",(e=>{this.props.toggleLegendSeriesState(e.target.dataItem.dataContext.isHidden(),e.target.dataItem.dataContext.get("id"))}))})),this._chartLegend=i},this.makeFormatter=(e,t)=>{const i=ie.NumberFormatterAm5.new(e.chart.root,{});return i.format=(e,i,s=2)=>{if("string"==typeof e)return"";return`${U.formatNumber(e,{maximumFractionDigits:s})} ${t}`},i},this._minMaxOfEachProfile={},this._allDistances=[],this._seriesKey=[],this._seriesValue=[],this._intersectionSeriesKey={},this._intersectionSeriesKeyIndex=[],this._groundExportingInfo={},this._intersectingLayersExportingInfo={},this._seriesToBeHiddenInLegend=[],this._elevationLayersOutput=[];const l=(0,t.getAppStore)().getState();this._isRTL=null===(s=null==l?void 0:l.appContext)||void 0===s?void 0:s.isRTL,this._chart=null,this._xAxis=null,this._xAxisLabel=null,this._yAxisLabel=null,this._yAxis=null,this._chartSeries=null,this._viewOutput=null,this._volumetricObjLineSeries=null,this._accessChartParams=null,this._updatedProfileLayers=null===(o=this.props.currentConfig)||void 0===o?void 0:o.profileSettings.layers.concat(this.props.profileSettingsForNewAddedLayer),this.state={chartDefinition:null,showLegend:null===(n=this.props.commonGeneralSettings)||void 0===n?void 0:n.showLegend},this.props.profileResult&&this.createOrUpdateChartDefinition()}render(){return(0,t.jsx)(t.React.Fragment,null,this.state&&this.state.chartDefinition&&(0,t.jsx)("div",{tabIndex:-1,className:"w-100 h-100 p-2"},(0,t.jsx)("div",{tabIndex:0,"aria-label":this.nls("chartRender"),className:"w-100 h-100",ref:this._chartContainer})))}}var le=A(52943),ae=A.n(le),re=function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(s=Object.getOwnPropertySymbols(e);o<s.length;o++)t.indexOf(s[o])<0&&Object.prototype.propertyIsEnumerable.call(e,s[o])&&(i[s[o]]=e[s[o]])}return i};const de=e=>{const i=window.SVG,{className:s}=e,o=re(e,["className"]),n=(0,t.classNames)("jimu-icon jimu-icon-component",s);return i?t.React.createElement(i,Object.assign({className:n,src:ae()},o)):t.React.createElement("svg",Object.assign({className:n},o))};var ce=A(30655),he=A.n(ce),ue=function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(s=Object.getOwnPropertySymbols(e);o<s.length;o++)t.indexOf(s[o])<0&&Object.prototype.propertyIsEnumerable.call(e,s[o])&&(i[s[o]]=e[s[o]])}return i};const pe=e=>{const i=window.SVG,{className:s}=e,o=ue(e,["className"]),n=(0,t.classNames)("jimu-icon jimu-icon-component",s);return i?t.React.createElement(i,Object.assign({className:n,src:he()},o)):t.React.createElement("svg",Object.assign({className:n},o))};class ve extends t.React.PureComponent{constructor(e){super(e),this.nls=e=>{const t=Object.assign({},r,i.defaultMessages);return this.props.intl&&this.props.intl.formatMessage?this.props.intl.formatMessage({id:e,defaultMessage:t[e]}):t[e]},this.componentDidMount=()=>{this.generateStats()},this.generateStats=()=>{var e,t;this._selectedStats=[],null===(t=null===(e=this.props.activeDsConfig.elevationLayersSettings.addedElevationLayers[this.props.index])||void 0===e?void 0:e.selectedStatistics)||void 0===t||t.forEach((e=>{e.enabled&&this._selectedStats.push({label:e.label,name:e.name})})),this.props.isShowViewLineInGraph&&!this.props.activeDsConfig.elevationLayersSettings.addedElevationLayers[this.props.index]&&this.props.activeDsConfig.elevationLayersSettings.volumetricObjSettingsOptions.selectedStatistics.forEach((e=>{e.enabled&&this._selectedStats.push({label:e.label,name:e.name})})),this.selectedStatisticsDisplay()},this.componentDidUpdate=e=>{e.selectedElevationUnit===this.props.selectedElevationUnit&&e.selectedLinearUnit===this.props.selectedLinearUnit&&e.selectedStatsDisplay===this.props.selectedStatsDisplay&&e.isFlip===this.props.isFlip&&e.chartDataUpdateTime===this.props.chartDataUpdateTime||this.generateStats(),e.renderSeries!==this.props.renderSeries&&this.selectedStatisticsDisplay()},this.selectedStatisticsDisplay=()=>{const e=[];let s="",o=null,n="";this._selectedStats.forEach((l=>{var a,r;this.props.renderSeries||this.props.seriesId!==this.props.toggledSeriesId?(n=l.name,this.props.chartProfileResult?(this.props.isFlip&&l.name!==I.AvgElevation&&l.name!==I.MaxDistance&&l.name!==I.MaxElevation&&l.name!==I.MinElevation&&(n=M(l.name)),o=null===(r=null===(a=this.props.chartProfileResult)||void 0===a?void 0:a.statistics)||void 0===r?void 0:r[n],s=this.getStatsValueWithUnit(o,n)):s=this.nls("noStatsValue")):s=this.nls("noStatsValue"),e.push((0,t.jsx)(t.React.Fragment,null,(0,t.jsx)("div",{tabIndex:0,className:"statistic-info"},(0,t.jsx)(i.Label,{id:this.props.parentWidgetId+this.props.index,"aria-label":this.nls(l.name),className:"statistic-label text-break mb-1 pt-4"},this.nls(l.name)),(0,t.jsx)("div",{tabIndex:0,"aria-label":s},s))))})),this.setState({statsResultList:e})},this.getStatsValueWithUnit=(e,t)=>{let i="",s=null;return w.forEach((o=>{var n,l;t===I.MaxDistance?o.value===this.props.selectedLinearUnit&&(s=k(e,null===(n=this.props.chartProfileResult)||void 0===n?void 0:n.effectiveUnits.distance,this.props.selectedLinearUnit),i=this.props.intl.formatNumber(s,{maximumFractionDigits:2})+" "+this.nls(o.abbreviation)):t===I.MaxPositiveSlope||t===I.MaxNegativeSlope||t===I.AvgPositiveSlope||t===I.AvgNegativeSlope?i=null===e?this.nls("noStatsValue"):this.props.intl.formatNumber(e,{maximumFractionDigits:2})+" \xb0":o.value===this.props.selectedElevationUnit&&(s=k(e,null===(l=this.props.chartProfileResult)||void 0===l?void 0:l.effectiveUnits.elevation,this.props.selectedElevationUnit),i=this.props.intl.formatNumber(s,{maximumFractionDigits:2})+" "+this.nls(o.abbreviation))})),i},this.onExpandClick=()=>{this.setState({legendExpanded:!this.state.legendExpanded})},this.state={legendExpanded:0===this.props.index,statsResultList:[]}}render(){const e="3px solid"+this.props.statsLineColor;return(0,t.jsx)("div",{tabIndex:-1},(0,t.jsx)("div",{tabIndex:-1,className:"ep-legend-section ep-shadow py-1",style:{borderLeft:e}},(0,t.jsx)("div",{tabIndex:0,className:"d-flex justify-content-between w-100 align-items-center"},(0,t.jsx)(i.Label,{id:this.props.parentWidgetId+this.props.index,"aria-label":this.props.legendName,className:"w-100 legendLabel text-break"},this.props.legendName),(0,t.jsx)(i.Button,{id:this.props.parentWidgetId+this.props.index,role:"button","aria-expanded":this.state.legendExpanded,title:this.nls("expandLegend"),type:"tertiary",icon:!0,size:"sm",onClick:this.onExpandClick.bind(this)},!this.state.legendExpanded&&(0,t.jsx)(de,{size:"m",autoFlip:!0}),this.state.legendExpanded&&(0,t.jsx)(pe,{size:"m"}))),(0,t.jsx)(i.Collapse,{isOpen:this.state.legendExpanded},(0,t.jsx)("div",{tabIndex:-1,className:"stat-content"},(0,t.jsx)("div",{tabIndex:0,className:"profile-statistics"},this.state.statsResultList.map(((e,i)=>(0,t.jsx)(t.React.Fragment,{key:i},e))))))))}}var ge=A(46420),fe=A.n(ge);const{epIcon:ye}=b(),me=(0,t.getAppStore)().getState().portalSelf;class Se extends t.React.PureComponent{constructor(e){var s,o,l,d,c,h,u,p,v,g,f,y,m,S,b,L,x,I,A,E,M,D,_,j,V,T,R,N,U,B,z,G,W,H,Y,X,J,q,K,Z,$,Q,ee,te,ie,se,oe,ne;super(e),this._selectableLayers=[],this._intersectingLayers=[],this._alertElement=t.React.createRef(),this.nls=e=>{const t=Object.assign({},r,i.defaultMessages);return this.props.intl&&this.props.intl.formatMessage?this.props.intl.formatMessage({id:e,defaultMessage:t[e]}):t[e]},this.updateOutputStatistics=t.lodash.debounce((()=>{this.props.buildOutputStatistics(this.state.selectedElevationUnit,this.state.selectedLinearUnit,this.state.isFlipChart)}),700),this.componentDidMount=()=>{this.getSelectableLayers(this.props.activeDataSource),this.getIntersectingLayers(this.props.activeDataSource),this.props.intersectingBufferRuntime({enabled:this.state.isBufferSelectorEnableInConfig,bufferDistance:this.state.selectedBufferDistance,bufferUnits:this.state.selectedBufferUnit,bufferSymbol:this.state.selectedBufferSymbol}),(this.props.selectMode||this.props.drawMode)&&setTimeout((()=>{var e;(0,t.focusElementInKeyboardMode)(null===(e=this._alertElement)||void 0===e?void 0:e.current)}),100)},this.componentDidUpdate=e=>{var i,s,o,n,l,a,r,d,c,h,u,p,v,g,f,y,m,S,b,w,L,x,I,A,E,M,D,C,_,F,P,j,V,T,k,R,N,U,B,z,G,W,H,Y,X,J,q,K,Z,$,Q,ee,te,ie,se,oe,ne,le,ae,re,de,ce,he,ue,pe,ve,ge,fe,ye,Se,be,we,Le,xe,Ie,Ae,Ee,Me,De;const Ce=this.props.activeDatasourceConfig,Oe=e.activeDatasourceConfig,_e=O(Ce,me);if(e.commonDsGeneralSettings.showLegend!==(null===(i=this.props.commonDsGeneralSettings)||void 0===i?void 0:i.showLegend)||e.chartDataUpdateTime!==this.props.chartDataUpdateTime||this.didElevationLayersInfoChanged(null===(s=null==Oe?void 0:Oe.elevationLayersSettings)||void 0===s?void 0:s.addedElevationLayers,null===(o=null==Ce?void 0:Ce.elevationLayersSettings)||void 0===o?void 0:o.addedElevationLayers)||(null===(n=null==Oe?void 0:Oe.elevationLayersSettings)||void 0===n?void 0:n.groundLayerId)!==(null===(l=null==Ce?void 0:Ce.elevationLayersSettings)||void 0===l?void 0:l.groundLayerId)||(null===(a=null==Oe?void 0:Oe.elevationLayersSettings)||void 0===a?void 0:a.showVolumetricObjLineInGraph)!==(null===(r=null==Ce?void 0:Ce.elevationLayersSettings)||void 0===r?void 0:r.showVolumetricObjLineInGraph)||(null===(c=null===(d=null==Oe?void 0:Oe.elevationLayersSettings)||void 0===d?void 0:d.volumetricObjSettingsOptions)||void 0===c?void 0:c.displayStatistics)!==(null===(u=null===(h=null==Ce?void 0:Ce.elevationLayersSettings)||void 0===h?void 0:h.volumetricObjSettingsOptions)||void 0===u?void 0:u.displayStatistics)||this.didStatisticsListChanged(null===(v=null===(p=null==Oe?void 0:Oe.elevationLayersSettings)||void 0===p?void 0:p.volumetricObjSettingsOptions)||void 0===v?void 0:v.selectedStatistics,null===(f=null===(g=null==Ce?void 0:Ce.elevationLayersSettings)||void 0===g?void 0:g.volumetricObjSettingsOptions)||void 0===f?void 0:f.selectedStatistics)){const e=(null===(S=null===(m=null===(y=null==Ce?void 0:Ce.elevationLayersSettings)||void 0===y?void 0:y.addedElevationLayers.filter((e=>e.displayStatistics)))||void 0===m?void 0:m[0])||void 0===S?void 0:S.displayStatistics)||(null===(b=null==Ce?void 0:Ce.elevationLayersSettings)||void 0===b?void 0:b.showVolumetricObjLineInGraph)&&(null===(L=null===(w=null==Ce?void 0:Ce.elevationLayersSettings)||void 0===w?void 0:w.volumetricObjSettingsOptions)||void 0===L?void 0:L.displayStatistics);this.setState({showLegend:null===(x=this.props.commonDsGeneralSettings)||void 0===x?void 0:x.showLegend,displayStats:e,addedElevationLayers:null===(I=null==Ce?void 0:Ce.elevationLayersSettings)||void 0===I?void 0:I.addedElevationLayers},(()=>{this.state.displayStats&&this.props.profileResult||this.setState({statisticsOpen:!1}),this.displayStatisticsInfo(this._chart),this.exportOptionDisplay()}))}e.chartRender!==this.props.chartRender&&!this.props.chartRender&&this.state.statisticsOpen&&this.setState({statisticsOpen:!1}),e.commonDsGeneralSettings.allowExport===(null===(A=this.props.commonDsGeneralSettings)||void 0===A?void 0:A.allowExport)&&e.chartDataUpdateTime===this.props.chartDataUpdateTime||this.setState({allowExport:null===(E=this.props.commonDsGeneralSettings)||void 0===E?void 0:E.allowExport,isExport:!1},(()=>{e.chartDataUpdateTime!==this.props.chartDataUpdateTime&&(this.setState({distanceInterval:this.getDefaultIntervalValue()}),this.showIntervalError(this.getDefaultIntervalValue()))})),e.noFeaturesFoundError!==this.props.noFeaturesFoundError&&this.setState({noFeaturesError:this.props.noFeaturesFoundError}),e.viewModelErrorState===this.props.viewModelErrorState&&e.profileErrorMsg===this.props.profileErrorMsg||this.setState({noValidInput:this.props.viewModelErrorState,viewModelErrorMsg:this.props.profileErrorMsg}),(null===(M=null==Oe?void 0:Oe.elevationLayersSettings)||void 0===M?void 0:M.elevationUnit)===(null===(D=null==Ce?void 0:Ce.elevationLayersSettings)||void 0===D?void 0:D.elevationUnit)&&(null===(C=null==Oe?void 0:Oe.elevationLayersSettings)||void 0===C?void 0:C.linearUnit)===(null===(_=null==Ce?void 0:Ce.elevationLayersSettings)||void 0===_?void 0:_.linearUnit)&&(null==Oe?void 0:Oe.advanceOptions)===(null==Ce?void 0:Ce.advanceOptions)&&(null===(F=null==Oe?void 0:Oe.profileSettings)||void 0===F?void 0:F.isProfileSettingsEnabled)===(null===(P=null==Ce?void 0:Ce.profileSettings)||void 0===P?void 0:P.isProfileSettingsEnabled)&&(null===(j=null==Oe?void 0:Oe.profileSettings)||void 0===j?void 0:j.isCustomizeOptionEnabled)===(null===(V=null==Ce?void 0:Ce.profileSettings)||void 0===V?void 0:V.isCustomizeOptionEnabled)&&(null===(T=null==Oe?void 0:Oe.assetSettings)||void 0===T?void 0:T.isAssetSettingsEnabled)===(null===(k=null==Ce?void 0:Ce.assetSettings)||void 0===k?void 0:k.isAssetSettingsEnabled)||this.setState({selectedElevationUnit:(null===(R=null==Ce?void 0:Ce.elevationLayersSettings)||void 0===R?void 0:R.elevationUnit)?null===(N=Ce.elevationLayersSettings)||void 0===N?void 0:N.elevationUnit:_e[0],selectedLinearUnit:(null===(U=null==Ce?void 0:Ce.elevationLayersSettings)||void 0===U?void 0:U.linearUnit)?null===(B=Ce.elevationLayersSettings)||void 0===B?void 0:B.linearUnit:_e[1],isProfileSettingsOptionEnabled:null==Ce?void 0:Ce.profileSettings.isProfileSettingsEnabled,isCustomizeOptionEnabled:null==Ce?void 0:Ce.profileSettings.isCustomizeOptionEnabled,isAssetSettingsOptionEnabled:null===(z=null==Ce?void 0:Ce.assetSettings)||void 0===z?void 0:z.isAssetSettingsEnabled,profileLayers:null==Ce?void 0:Ce.profileSettings.layers,intersectingLayers:null===(G=null==Ce?void 0:Ce.assetSettings)||void 0===G?void 0:G.layers},(()=>{this.displayStatisticsInfo(this._chart),this.showIntervalError(this.getDefaultIntervalValue()),this.exportOptionDisplay(),this.getSelectableLayers(this.props.activeDataSource),this.getIntersectingLayers(this.props.activeDataSource)})),(null===(W=null==Oe?void 0:Oe.elevationLayersSettings)||void 0===W?void 0:W.showVolumetricObjLineInGraph)===(null===(H=null==Ce?void 0:Ce.elevationLayersSettings)||void 0===H?void 0:H.showVolumetricObjLineInGraph)&&t.lodash.isDeepEqual(null===(X=null===(Y=null==Oe?void 0:Oe.elevationLayersSettings)||void 0===Y?void 0:Y.volumetricObjSettingsOptions)||void 0===X?void 0:X.style,null===(q=null===(J=null==Ce?void 0:Ce.elevationLayersSettings)||void 0===J?void 0:J.volumetricObjSettingsOptions)||void 0===q?void 0:q.style)&&(null===(Z=null===(K=null==Oe?void 0:Oe.elevationLayersSettings)||void 0===K?void 0:K.volumetricObjSettingsOptions)||void 0===Z?void 0:Z.volumetricObjLabel)===(null===(Q=null===($=null==Ce?void 0:Ce.elevationLayersSettings)||void 0===$?void 0:$.volumetricObjSettingsOptions)||void 0===Q?void 0:Q.volumetricObjLabel)||this.setState({showViewLineGraph:null===(ee=null==Ce?void 0:Ce.elevationLayersSettings)||void 0===ee?void 0:ee.showVolumetricObjLineInGraph,volumetricObjStyle:null===(ie=null===(te=null==Ce?void 0:Ce.elevationLayersSettings)||void 0===te?void 0:te.volumetricObjSettingsOptions)||void 0===ie?void 0:ie.style,volumetricObjLabel:null===(oe=null===(se=null==Ce?void 0:Ce.elevationLayersSettings)||void 0===se?void 0:se.volumetricObjSettingsOptions)||void 0===oe?void 0:oe.volumetricObjLabel}),this.didProfileLayersSettingsChanged(null==Oe?void 0:Oe.profileSettings.layers,null==Ce?void 0:Ce.profileSettings.layers)&&this.setState({profileLayers:null==Ce?void 0:Ce.profileSettings.layers},(()=>{this.getSelectableLayers(this.props.activeDataSource)})),this.didIntersectingLayersSettingsChanged(null===(ne=null==Oe?void 0:Oe.assetSettings)||void 0===ne?void 0:ne.layers,null===(le=null==Ce?void 0:Ce.assetSettings)||void 0===le?void 0:le.layers)&&this.setState({intersectingLayers:null===(ae=null==Ce?void 0:Ce.assetSettings)||void 0===ae?void 0:ae.layers},(()=>{this.getIntersectingLayers(this.props.activeDataSource)})),(this.props.drawMode&&e.onDrawingComplete!==this.props.onDrawingComplete||e.isNewSegmentsForSelection!==this.props.isNewSegmentsForSelection||e.noGraphicAfterFirstSelection!==this.props.noGraphicAfterFirstSelection)&&this.setState({dismissInfoMsg:this.props.selectMode&&this.props.isNewSegmentsForSelection||this.props.drawMode&&!this.props.onDrawingComplete,dismissWarningMsg:!this.props.isNewSegmentsForSelection&&!this.props.noGraphicAfterFirstSelection&&this.props.selectMode}),(null===(de=null===(re=null==Oe?void 0:Oe.assetSettings)||void 0===re?void 0:re.assetIntersectingBuffer)||void 0===de?void 0:de.enabled)===(null===(he=null===(ce=null==Ce?void 0:Ce.assetSettings)||void 0===ce?void 0:ce.assetIntersectingBuffer)||void 0===he?void 0:he.enabled)&&(null===(pe=null===(ue=null==Oe?void 0:Oe.assetSettings)||void 0===ue?void 0:ue.assetIntersectingBuffer)||void 0===pe?void 0:pe.bufferDistance)===(null===(ge=null===(ve=null==Ce?void 0:Ce.assetSettings)||void 0===ve?void 0:ve.assetIntersectingBuffer)||void 0===ge?void 0:ge.bufferDistance)&&(null===(ye=null===(fe=null==Oe?void 0:Oe.assetSettings)||void 0===fe?void 0:fe.assetIntersectingBuffer)||void 0===ye?void 0:ye.bufferUnits)===(null===(be=null===(Se=null==Ce?void 0:Ce.assetSettings)||void 0===Se?void 0:Se.assetIntersectingBuffer)||void 0===be?void 0:be.bufferUnits)&&t.lodash.isDeepEqual(null===(Le=null===(we=null==Oe?void 0:Oe.assetSettings)||void 0===we?void 0:we.assetIntersectingBuffer)||void 0===Le?void 0:Le.bufferSymbol,null===(Ie=null===(xe=null==Ce?void 0:Ce.assetSettings)||void 0===xe?void 0:xe.assetIntersectingBuffer)||void 0===Ie?void 0:Ie.bufferSymbol)||this.setState({isBufferSelectorEnableInConfig:null==Ce?void 0:Ce.assetSettings.assetIntersectingBuffer.enabled,isBufferSelectorEnableAtRuntime:null==Ce?void 0:Ce.assetSettings.assetIntersectingBuffer.enabled,selectedBufferDistance:(null==Ce?void 0:Ce.assetSettings.assetIntersectingBuffer.bufferDistance)||this.state.selectedBufferDistance,selectedBufferUnit:(null==Ce?void 0:Ce.assetSettings.assetIntersectingBuffer.bufferUnits)||this.state.selectedBufferUnit,selectedBufferSymbol:null==Ce?void 0:Ce.assetSettings.assetIntersectingBuffer.bufferSymbol},(()=>{this.props.intersectingBufferRuntime({enabled:this.state.isBufferSelectorEnableInConfig,bufferDistance:this.state.selectedBufferDistance,bufferUnits:this.state.selectedBufferUnit,bufferSymbol:this.state.selectedBufferSymbol})})),this.state.statisticsOpen&&e.currentPageId!==this.props.currentPageId&&this.setState({statisticsOpen:!1}),(null==e?void 0:e.newAddedLayer)===(null===(Ae=this.props)||void 0===Ae?void 0:Ae.newAddedLayer)&&(null==e?void 0:e.profileSettingsForNewAddedLayer)===(null===(Ee=this.props)||void 0===Ee?void 0:Ee.profileSettingsForNewAddedLayer)||this.setState({newAddedLayers:null===(Me=this.props)||void 0===Me?void 0:Me.newAddedLayer,profileSettingsForNewlyAddedLayers:null===(De=this.props)||void 0===De?void 0:De.profileSettingsForNewAddedLayer},(()=>{this.state.newAddedLayers!==this.state.selectedLayers&&this.getSelectableLayers(this.props.activeDataSource)}))},this.didElevationLayersInfoChanged=(e,i)=>{let s=!1;return(null==i?void 0:i.length)!==(null==e?void 0:e.length)||(null==i||i.some(((i,o)=>{var n,l,a,r,d,c;if(!t.lodash.isDeepEqual(i.useDataSource,null===(n=e[o])||void 0===n?void 0:n.useDataSource)||i.label!==(null===(l=e[o])||void 0===l?void 0:l.label)||i.elevationLayerUrl!==(null===(a=e[o])||void 0===a?void 0:a.elevationLayerUrl)||!t.lodash.isDeepEqual(i.style,null===(r=e[o])||void 0===r?void 0:r.style)||i.displayStatistics!==(null===(d=e[o])||void 0===d?void 0:d.displayStatistics)||this.didStatisticsListChanged(null===(c=e[o])||void 0===c?void 0:c.selectedStatistics,i.selectedStatistics))return s=!0,!0})),s)},this.didStatisticsListChanged=(e,t)=>{let i=!1;return null==t||t.some(((t,s)=>{if(t.name!==e[s].name||t.label!==e[s].label||t.enabled!==e[s].enabled)return i=!0,!0})),i},this.didProfileLayersSettingsChanged=(e,t)=>{let i=!1;return(null==e?void 0:e.length)!==(null==t?void 0:t.length)&&(i=!0),i},this.didIntersectingLayersSettingsChanged=(e,t)=>{let i=!1;return(null==e?void 0:e.length)!==(null==t?void 0:t.length)&&(i=!0),i},this.showIntervalError=e=>{this.setState({distanceInterval:e}),e>=0&&e<=this.getMaxDistance()?this.setState({showInValidIntervalErrorMsg:!1}):this.setState({showInValidIntervalErrorMsg:!0,getIntervalsError:this.getIntervalLimitValues(0,this.getMaxDistance())})},this.getSelectableLayers=e=>{var i;const s=C(e);this._selectableLayers=[];const o=[];let n=!1;if(null==s||s.forEach((e=>{var t,i,s,l;e&&e.getLayerDefinition()&&e.getLayerDefinition().geometryType&&"esriGeometryPolyline"===e.getLayerDefinition().geometryType&&((null===(t=this.props.activeDatasourceConfig)||void 0===t?void 0:t.hasOwnProperty("advanceOptions"))||this.state.isProfileSettingsOptionEnabled)&&((null===(i=this.props.activeDatasourceConfig)||void 0===i?void 0:i.hasOwnProperty("advanceOptions"))&&(null===(s=this.props.activeDatasourceConfig)||void 0===s?void 0:s.advanceOptions)||this.state.isCustomizeOptionEnabled?0===this.state.profileLayers.length?n=!1:null===(l=this.state.profileLayers)||void 0===l||l.forEach((t=>{(null==t?void 0:t.layerId)===e.id&&(this._selectableLayers.push({label:e.getSchema().label,value:e.id}),o.push(e.id),n=!0)})):(this._selectableLayers.push({label:e.getSchema().label,value:e.id}),o.push(e.id),n=!0))})),(null===(i=this.state.newAddedLayers)||void 0===i?void 0:i.length)>0){const e=t.DataSourceManager.getInstance();this.state.newAddedLayers.forEach((t=>{const i=null==e?void 0:e.getDataSource(t);i&&(this._selectableLayers.push({label:i.getSchema().label,value:i.id}),o.push(i.id),n=!0)}))}this.props.selectableLayersRuntime(o),this.setState({selectedLayers:o,isAnyProfileLineLayers:n})},this.getIntersectingLayers=e=>{const t=C(e);this._intersectingLayers=[];const i=[];let s=!1;null==t||t.forEach((e=>{var t,o;e&&e.getLayerDefinition()&&e.getLayerDefinition().geometryType&&this.state.isAssetSettingsOptionEnabled&&(0===(null===(t=this.state.intersectingLayers)||void 0===t?void 0:t.length)?s=!1:"esriGeometryPolyline"!==e.getLayerDefinition().geometryType&&"esriGeometryPoint"!==e.getLayerDefinition().geometryType||null===(o=this.state.intersectingLayers)||void 0===o||o.forEach((t=>{(null==t?void 0:t.layerId)===e.id&&(this._intersectingLayers.push({label:e.getSchema().label,value:e.id}),i.push(e.id),s=!0)})))})),this.props.intersectingLayersRuntime(i),this.setState({selectedIntersectedLayers:i,isAnyIntersectingLayers:s})},this.onDoneClick=()=>{this.props.doneClick()?this.setState({enableForNewProfile:!0}):this.setState({enableForNewProfile:!1,initialEmptyState:!1,emptyStateIfDoneClick:!0,noFeaturesError:!1,noValidInput:!1},(()=>{setTimeout((()=>{var e;(0,t.focusElementInKeyboardMode)(null===(e=this._alertElement)||void 0===e?void 0:e.current)}),100)}))},this.toggleStatistics=()=>{this.setState({statisticsOpen:!this.state.statisticsOpen},(()=>{this.displayStatisticsInfo(this._chart,!0)}))},this.toggleSettings=()=>{this.setState({settingsOptionsOpen:!this.state.settingsOptionsOpen})},this.highlightChartPosition=e=>{this.props.chartPosition(e)},this.hideChartPosition=()=>{this.props.hideChartPosition()},this.onChartFlip=()=>{this.setState({isFlipChart:!this.state.isFlipChart,toggledSeriesId:""},(()=>{this.displayStatisticsInfo(this._chart),this.exportOptionDisplay()}))},this.onNewProfileClick=()=>{this.createNewProfile(),this.props.jimuMapView.clearSelectedFeatures(),this.setState({enableForNewProfile:!1})},this.onClearButtonClick=()=>{this.createNewProfile()},this.createNewProfile=()=>{this.props.activateDrawSelectToolForNewProfile(),this.setState({initialEmptyState:!0,emptyStateIfDoneClick:!1,noFeaturesError:!1,noValidInput:!1,statisticsOpen:!1,isExport:!1},(()=>{setTimeout((()=>{var e;(0,t.focusElementInKeyboardMode)(null===(e=this._alertElement)||void 0===e?void 0:e.current)}),100)}))},this.onElevationUnitChange=e=>{this.setState({selectedElevationUnit:e.target.value},(()=>{this.displayStatisticsInfo(this._chart)}))},this.onLinearUnitChange=e=>{this.setState({selectedLinearUnit:e.target.value},(()=>{this.displayStatisticsInfo(this._chart),this.showIntervalError(this.getDefaultIntervalValue()),this.exportOptionDisplay()}))},this.onLayerSelected=(e,t,i)=>{let s=!0;this.setState({selectedLayers:i}),0===i.length&&(s=!1),this.setState({isLayerSelected:s}),this.props.selectableLayersRuntime(i)},this.onIntersectedLayerSelected=(e,t,i)=>{this.setState({selectedIntersectedLayers:i}),this.props.intersectingLayersRuntime(i)},this.displaySelectedFields=e=>{let t=this.nls("selectLayerLabel");return e&&e.length&&(t=this.props.intl.formatMessage({id:"selectedLayerCount",defaultMessage:r.selectedLayerCount},{selectedLayerCount:e.length})),t},this.updateBufferValues=()=>{this.props.intersectingBufferRuntime({enabled:this.state.isBufferSelectorEnableAtRuntime,bufferDistance:this.state.selectedBufferDistance,bufferUnits:this.state.selectedBufferUnit,bufferSymbol:this.state.selectedBufferSymbol})},this.onBufferSelectorChange=e=>{this.setState({isBufferSelectorEnableAtRuntime:e.target.checked},(()=>{this.updateBufferValues()}))},this.onBufferUnitsChange=e=>{const t=((e,t)=>{const i=F(t);return e>i?i:e})(this.state.selectedBufferDistance,e.target.value);this.setState({selectedBufferUnit:e.target.value,selectedBufferDistance:t},(()=>{this.updateBufferValues()}))},this.onBufferDistanceChange=e=>{this.setState({selectedBufferDistance:null!=e?e:0},(()=>{this.updateBufferValues()}))},this.onUniformScalingChange=e=>{this.setState({isUniformScalingEnable:e.target.checked})},this.setExportButtonState=e=>{this.setState({exportData:e})},this.customizeIntervalChange=e=>{this.setState({isCustomizeInterval:e.target.checked}),e.target.checked&&this.onDistanceIntervalChange(this.state.distanceInterval)},this.getMaxDistance=()=>{var e,t;return(null===(t=null===(e=this.props.profileResult)||void 0===e?void 0:e.statistics)||void 0===t?void 0:t.maxDistance)?k(this.props.profileResult.statistics.maxDistance,this.props.profileResult.effectiveUnits.distance,this.state.selectedLinearUnit):0},this.onExportButtonClick=()=>{this.state.showInValidIntervalErrorMsg?this.setState({exportData:!1}):this.setState({exportData:!0})},this.onExportCancelButtonClick=()=>{this.setState({isExport:!1})},this.getDefaultIntervalValue=()=>{const e=this.getMaxDistance();let t=1;return e<1&&e>=.1?t=.1:e<.1&&e>=.01?t=.01:e<.01&&e>=.001?t=.001:e<.001&&e>=1e-4&&(t=1e-4),t},this.onDistanceIntervalChange=e=>{this.setState({distanceInterval:null!=e?e:0},(()=>{0===this.state.distanceInterval?this.setState({showInValidIntervalErrorMsg:!0,getIntervalsError:this.getIntervalLimitValues(null,null)}):this.state.distanceInterval>=0&&this.state.distanceInterval<=this.getMaxDistance()?this.setState({showInValidIntervalErrorMsg:!1}):this.setState({showInValidIntervalErrorMsg:!0,getIntervalsError:this.getIntervalLimitValues(0,this.getMaxDistance())})}))},this.getIntervalLimitValues=(e,t)=>{let i="";return i=e||t?this.props.intl.formatMessage({id:"intervalErrorHint",defaultMessage:r.intervalErrorHint},{xMin:e,xMax:this.truncateMaxIntervalDistance(t)}):this.nls("intervalHintForInvalidEntry"),i},this.truncateMaxIntervalDistance=e=>{let t;if(!isNaN(e)&&null!==e){const i=4;t=new RegExp(i>0?"^\\d*[.]?\\d{0,"+i+"}":"^\\d*").exec(e.toString())[0],t=this.props.intl.formatNumber(t,{maximumFractionDigits:i})}return t},this.adjustInfoIconPosition=()=>{let e=-8;return"125%"===this.props.theme.ref.typeface.htmlFontSize&&(e=-11),e},this.exportOptionDisplay=()=>{const e=(0,t.getAppStore)().getState().appContext.isRTL,s=w.find((e=>e.value===this.state.selectedLinearUnit));return(0,t.jsx)("div",null,(0,t.jsx)(i.Popper,{css:n(this.props.theme),open:this.state.isExport,reference:"export"+this.props.widgetId,placement:"right-start",version:0,toggle:e=>{this.setState({isExport:!this.state.isExport})}},(0,t.jsx)("div",{style:{width:250},className:"p-2"},(0,t.jsx)(i.Label,{"aria-label":this.nls("chartExport"),className:"exportLabel text-break"},this.nls("chartExport")),(0,t.jsx)(i.Label,{tabIndex:0,className:"pt-2 pl-1 exportHintStyle"},this.nls("exportHint")),(0,t.jsx)("div",{className:"pt-1 pb-1 d-flex"},(0,t.jsx)(i.Tooltip,{role:"tooltip",tabIndex:0,"aria-label":this.nls("customizeIntervalTooltip"),title:this.nls("customizeIntervalTooltip"),showArrow:!0,placement:"top"},(0,t.jsx)(i.Button,{className:"d-inline",style:{marginTop:this.adjustInfoIconPosition(),marginLeft:-4},type:"tertiary",icon:!0},(0,t.jsx)(i.Icon,{icon:ye.infoIcon}))),(0,t.jsx)(i.Label,{className:"w-100 d-flex pl-1"},this.nls("customizeIntervalLabel")),(0,t.jsx)(i.Switch,{role:"switch","aria-label":this.nls("customizeIntervalLabel"),title:this.nls("customizeIntervalLabel"),checked:this.state.isCustomizeInterval,onChange:this.customizeIntervalChange})),(0,t.jsx)("div",{className:this.state.isCustomizeInterval?"showCustomizeEdit":"hideCustomizeEdit"},(0,t.jsx)("div",{className:(0,t.classNames)("d-flex",this.state.showInValidIntervalErrorMsg?"pb-1":"pb-2")},(0,t.jsx)(i.NumericInput,{"aria-label":this.nls("customizeIntervalLabel"),size:"sm",defaultValue:this.state.distanceInterval,value:this.state.distanceInterval,title:this.state.distanceInterval+"",className:(0,t.classNames)("ml-1 w-100",this.state.showInValidIntervalErrorMsg?"invalidValue":""),showHandlers:!1,onChange:this.onDistanceIntervalChange}),(0,t.jsx)("div",{title:this.nls(s.abbreviation),className:"style-setting--unit-selector border"},(0,t.jsx)(i.Label,{className:"text-truncate unitsLabel"},this.nls(s.abbreviation)))),(0,t.jsx)(i.Label,{className:(0,t.classNames)("ml-1 pb-1 invalidRange",this.state.isCustomizeInterval&&this.state.showInValidIntervalErrorMsg?"showCustomizeEdit":"hideCustomizeEdit")},this.state.getIntervalsError)),(0,t.jsx)("div",{style:{height:35},className:"mt-1 mb-2 d-flex w-100"},(0,t.jsx)("div",{className:"align-items-center w-100 pt-1",style:{display:"inline-block"}},(0,t.jsx)(i.Button,{role:"button","aria-label":this.nls("exportLabel"),title:this.nls("exportLabel"),className:"actionButton text-break",style:{float:e?"left":"right"},size:"default",type:"primary",onClick:this.onExportButtonClick},this.nls("exportLabel")),(0,t.jsx)(i.Button,{role:"button","aria-label":this.nls("cancel"),title:this.nls("cancel"),className:"actionButton text-break",style:{float:e?"right":"left"},size:"default",type:"secondary",onClick:this.onExportCancelButtonClick},this.nls("cancel")))))))},this.displayStatisticsInfo=(e,s=!1)=>{var o,n,l,a;const r=[],d=[];if(this.setState({legendStats:[]}),null==e?void 0:e.series){null===(o=null==e?void 0:e.series)||void 0===o||o.values.forEach(((e,t)=>{this.state.addedElevationLayers.forEach((t=>{t.id===e.get("id")&&t.displayStatistics&&d.push({id:e.get("id"),name:e.get("name"),color:t.style.lineColor,statistics:this.props.visibleGroundProfileStats.filter((e=>e.id===t.id))[0],selectedStatsList:t.selectedStatistics})}))}));const i=null===(l=null===(n=this.props.activeDatasourceConfig)||void 0===n?void 0:n.elevationLayersSettings)||void 0===l?void 0:l.volumetricObjSettingsOptions;this.state.showViewLineGraph&&(null==i?void 0:i.displayStatistics)&&(null===(a=null==e?void 0:e.series)||void 0===a||a.values.forEach(((e,t)=>{(null==i?void 0:i.id)===e.get("id")&&d.push({id:e.get("id"),name:e.get("name"),color:i.style.lineColor,statistics:this.props.visibleGroundProfileStats.filter((e=>e.id===i.id))[0],selectedStatsList:i.selectedStatistics})}))),d.forEach(((e,i)=>(r.push((0,t.jsx)(ve,{theme:this.props.theme,intl:this.props.intl,parentWidgetId:this.props.widgetId,index:i,key:e.name+i,isShowViewLineInGraph:this.state.showViewLineGraph,legendName:e.name,activeDsConfig:this.props.activeDatasourceConfig,selectedElevationUnit:this.state.selectedElevationUnit,selectedLinearUnit:this.state.selectedLinearUnit,chartDataUpdateTime:this.props.chartDataUpdateTime,chartProfileResult:e.statistics,selectedStatsDisplay:e.selectedStatsList,statsLineColor:e.color,seriesId:e.id,renderSeries:this.state.renderSeries,toggledSeriesId:this.state.toggledSeriesId,isFlip:this.state.isFlipChart})),!0)))}else r.push((0,t.jsx)(i.Loading,{type:i.LoadingType.Donut}));this.setState({legendStats:r},(()=>{s||this.updateOutputStatistics()}))},this.statisticsDisplay=()=>(0,t.jsx)("div",null,this.props.isMobile?(0,t.jsx)(i.MobilePanel,{open:this.state.statisticsOpen,title:this.nls("statisticsLabel"),css:a(this.props.theme),onClose:()=>{this.setState({statisticsOpen:!this.state.statisticsOpen})}},(0,t.jsx)("div",{style:{height:"calc(100% - 15px)",overflow:"auto"},className:"pr-4 pl-4 pt-2 pb-4"},this.state.legendStats.map(((e,i)=>(0,t.jsx)(t.React.Fragment,{key:i},e))))):(0,t.jsx)(i.FloatingPanel,{css:a(this.props.theme),open:this.state.statisticsOpen,reference:"statistics"+this.props.widgetId,headerTitle:this.nls("statisticsLabel"),flipOptions:{fallbackPlacements:["left","right","top","bottom"]},onHeaderClose:()=>{this.setState({statisticsOpen:!this.state.statisticsOpen})},defaultSize:{width:400,height:1===this.state.legendStats.length?435:475}},(0,t.jsx)("div",{style:{height:"calc(100% - 15px)",overflow:"auto"},className:"pr-4 pl-4 pt-2 pb-4"},this.state.legendStats.map(((e,i)=>(0,t.jsx)(t.React.Fragment,{key:i},e)))))),this.settingsOptionsRender=()=>(0,t.jsx)("div",null,(0,t.jsx)(i.Popper,{css:(this.props.theme,t.css`
  .settingsLabel {
    margin: 0 !important;
    font-weight: 500;
  }

  .selectLayerWarningMsg {
    padding: 1px !important;
    background-color: transparent !important;
    border: none !important;
    font-size: 11px;
  }

  .selectLayerWarningMsg .left-part {
    color: var(--sys-color-warning-dark) !important;
    margin-right: 0 !important;
  }

  .custom-multiselect .jimu-dropdown .jimu-btn .dropdown-button-content {
    padding-top: 3px;
    padding-bottom: 3px;
  }
  `),open:this.state.settingsOptionsOpen,reference:"settingsOptions"+this.props.widgetId,placement:"right-start",version:0,toggle:e=>{this.setState({settingsOptionsOpen:!this.state.settingsOptionsOpen})}},(0,t.jsx)("div",{tabIndex:-1,style:{width:175}},(0,t.jsx)("div",{tabIndex:-1,className:"p-2"},(0,t.jsx)(i.Label,{"aria-label":this.nls("elevationUnitLabel"),className:"settingsLabel text-break"},this.nls("elevationUnitLabel")),(0,t.jsx)(i.Select,{"aria-label":this.nls("elevationUnitLabel")+" "+this.state.selectedElevationUnit,className:"pt-1",name:"elevationUnit",size:"sm",onChange:this.onElevationUnitChange,value:this.state.selectedElevationUnit},w.map((e=>(0,t.jsx)(i.Option,{role:"option","aria-label":e.value,key:e.value,value:e.value},this.nls(e.value)))))),(0,t.jsx)("div",{className:"p-2"},(0,t.jsx)(i.Label,{"aria-label":this.nls("distanceUnitLabel"),className:"settingsLabel text-break"},this.nls("distanceUnitLabel")),(0,t.jsx)(i.Select,{"aria-label":this.nls("distanceUnitLabel")+" "+this.state.selectedLinearUnit,className:"pt-1",name:"linearUnit",size:"sm",onChange:this.onLinearUnitChange,value:this.state.selectedLinearUnit},w.map((e=>(0,t.jsx)(i.Option,{role:"option","aria-label":e.value,key:e.value,value:e.value},this.nls(e.value)))))),this.state.isAnyProfileLineLayers&&(0,t.jsx)(t.React.Fragment,null,(0,t.jsx)("div",{className:"p-2"},(0,t.jsx)(i.Label,{"aria-label":this.nls("selectableLayersLabel"),className:"settingsLabel text-break"},this.nls("selectableLayersLabel")),!this.state.isLayerSelected&&(0,t.jsx)(i.Alert,{tabIndex:0,className:"w-100 selectLayerWarningMsg py-1",open:!this.state.isLayerSelected,text:this.nls("selectLayerWarning"),type:"warning",withIcon:!0}),(0,t.jsx)(i.MultiSelect,{items:(0,t.Immutable)(this._selectableLayers),values:(0,t.Immutable)(this.state.selectedLayers),className:"pt-1 custom-multiselect",buttonProps:{showDynamicTitle:!0},size:"sm",fluid:!0,onClickItem:this.onLayerSelected,displayByValues:this.displaySelectedFields}))),(this.props.selectMode||this.props.drawMode)&&this.state.isAnyIntersectingLayers&&(0,t.jsx)(t.React.Fragment,null,(0,t.jsx)("div",{className:"p-2"},(0,t.jsx)(i.Label,{"aria-label":this.nls("intersectingLayersLabel"),className:"settingsLabel text-break"},this.nls("intersectingLayersLabel")),(0,t.jsx)(i.MultiSelect,{items:(0,t.Immutable)(this._intersectingLayers),values:(0,t.Immutable)(this.state.selectedIntersectedLayers),className:"pt-1 custom-multiselect",buttonProps:{showDynamicTitle:!0},size:"sm",fluid:!0,onClickItem:this.onIntersectedLayerSelected,displayByValues:this.displaySelectedFields}))),this.state.isAssetSettingsOptionEnabled&&this.state.isBufferSelectorEnableInConfig&&(0,t.jsx)("div",{className:"p-2"},(0,t.jsx)(i.Label,{"aria-label":this.nls("bufferSelectorLabel"),className:"w-100 d-flex"},(0,t.jsx)("div",{className:"flex-grow-1 settingsLabel text-break"},this.nls("bufferSelectorLabel")),(0,t.jsx)(i.Switch,{role:"switch","aria-label":this.nls("bufferSelectorLabel"),title:this.nls("bufferSelectorLabel"),checked:this.state.isBufferSelectorEnableAtRuntime,onChange:this.onBufferSelectorChange})),this.state.isBufferSelectorEnableAtRuntime&&(0,t.jsx)(t.React.Fragment,null,(0,t.jsx)(i.NumericInput,{"aria-label":this.nls("bufferSelectorLabel")+this.state.selectedBufferDistance,size:"sm",min:0,max:F(this.state.selectedBufferUnit),defaultValue:this.state.selectedBufferDistance,value:this.state.selectedBufferDistance,onChange:this.onBufferDistanceChange}),(0,t.jsx)(i.Select,{"aria-label":this.state.selectedBufferUnit,className:"pt-1 pb-1",size:"sm",name:"bufferUnits",value:this.state.selectedBufferUnit,onChange:this.onBufferUnitsChange},w.map(((e,s)=>(0,t.jsx)(i.Option,{role:"option","aria-label":e.value,key:s,value:e.value},this.nls(e.value))))))),(0,t.jsx)(t.React.Fragment,null,(0,t.jsx)("div",{className:"pl-2 pb-2 pr-2"},(0,t.jsx)(i.Label,{className:"cursor-pointer settingsLabel text-break",title:this.nls("uniformChartScalingInfo")},(0,t.jsx)(i.Checkbox,{role:"checkbox",className:"mr-2 font-13","aria-label":this.nls("uniformChartScaling"),checked:this.state.isUniformScalingEnable,onChange:this.onUniformScalingChange.bind(this)}),this.nls("uniformChartScaling"))))))),this.dismissInfoMsg=()=>{this.setState({dismissInfoMsg:!this.state.dismissInfoMsg})},this.dismissWarningMsg=()=>{this.setState({dismissWarningMsg:!this.state.dismissWarningMsg})},this.getChartInfo=e=>{this._chart=e,setTimeout((()=>{this.displayStatisticsInfo(this._chart)}),50)},this.onToggleSeries=(e,t)=>{this.setState({renderSeries:!e,toggledSeriesId:t},(()=>{this.displayStatisticsInfo(this._chart,!0)}))},this.toggleExport=()=>{this.setState({isExport:!this.state.isExport})};const le=O(this.props.activeDatasourceConfig,me);this._chart=null;let ae=null===(l=null===(o=null===(s=this.props.activeDatasourceConfig)||void 0===s?void 0:s.assetSettings)||void 0===o?void 0:o.assetIntersectingBuffer)||void 0===l?void 0:l.bufferUnits;""===ae&&(ae=P(me));const re=this.props.activeDatasourceConfig?(null===(d=this.props.activeDatasourceConfig.elevationLayersSettings)||void 0===d?void 0:d.showVolumetricObjLineInGraph)&&(null===(h=null===(c=this.props.activeDatasourceConfig.elevationLayersSettings)||void 0===c?void 0:c.volumetricObjSettingsOptions)||void 0===h?void 0:h.displayStatistics):(null===(u=this.props.defaultConfig.elevationLayersSettings)||void 0===u?void 0:u.showVolumetricObjLineInGraph)&&(null===(v=null===(p=this.props.defaultConfig.elevationLayersSettings)||void 0===p?void 0:p.volumetricObjSettingsOptions)||void 0===v?void 0:v.displayStatistics),de=(null===(y=null===(f=null===(g=this.props.addedElelvationProfileLayers)||void 0===g?void 0:g.filter((e=>e.displayStatistics)))||void 0===f?void 0:f[0])||void 0===y?void 0:y.displayStatistics)||re;this.state={initialEmptyState:!0,emptyStateIfDoneClick:!1,enableForNewProfile:!1,settingsOptionsOpen:!1,unitOptions:w,isFlipChart:!1,selectedElevationUnit:this.props.activeDatasourceConfig?le[0]:null===(m=this.props.defaultConfig.elevationLayersSettings)||void 0===m?void 0:m.elevationUnit,selectedLinearUnit:this.props.activeDatasourceConfig?le[1]:null===(S=this.props.defaultConfig.elevationLayersSettings)||void 0===S?void 0:S.linearUnit,selectedLayers:[],selectedIntersectedLayers:[],profileLayers:null===(b=this.props.activeDatasourceConfig)||void 0===b?void 0:b.profileSettings.layers,intersectingLayers:(null===(I=null===(x=null===(L=this.props.activeDatasourceConfig)||void 0===L?void 0:L.assetSettings)||void 0===x?void 0:x.layers)||void 0===I?void 0:I.length)>0?null===(E=null===(A=this.props.activeDatasourceConfig)||void 0===A?void 0:A.assetSettings)||void 0===E?void 0:E.layers:[],isAnyProfileLineLayers:!1,isAnyIntersectingLayers:!1,isProfileSettingsOptionEnabled:null===(M=this.props.activeDatasourceConfig)||void 0===M?void 0:M.profileSettings.isProfileSettingsEnabled,isCustomizeOptionEnabled:null===(D=this.props.activeDatasourceConfig)||void 0===D?void 0:D.profileSettings.isCustomizeOptionEnabled,isAssetSettingsOptionEnabled:null===(j=null===(_=this.props.activeDatasourceConfig)||void 0===_?void 0:_.assetSettings)||void 0===j?void 0:j.isAssetSettingsEnabled,noFeaturesError:this.props.noFeaturesFoundError,dismissInfoMsg:this.props.selectMode&&this.props.isNewSegmentsForSelection||this.props.drawMode&&!this.props.onDrawingComplete,dismissWarningMsg:!this.props.isNewSegmentsForSelection&&!this.props.noGraphicAfterFirstSelection&&this.props.selectMode,statisticsOpen:!1,legendStats:[],showLegend:null===(V=this.props.commonDsGeneralSettings)||void 0===V?void 0:V.showLegend,displayStats:de,renderSeries:!0,toggledSeriesId:"",isUniformScalingEnable:!1,isLayerSelected:!0,isBufferSelectorEnableInConfig:null===(N=null===(R=null===(T=this.props.activeDatasourceConfig)||void 0===T?void 0:T.assetSettings)||void 0===R?void 0:R.assetIntersectingBuffer)||void 0===N?void 0:N.enabled,isBufferSelectorEnableAtRuntime:null===(z=null===(B=null===(U=this.props.activeDatasourceConfig)||void 0===U?void 0:U.assetSettings)||void 0===B?void 0:B.assetIntersectingBuffer)||void 0===z?void 0:z.enabled,selectedBufferDistance:(null===(H=null===(W=null===(G=this.props.activeDatasourceConfig)||void 0===G?void 0:G.assetSettings)||void 0===W?void 0:W.assetIntersectingBuffer)||void 0===H?void 0:H.bufferDistance)||10,selectedBufferUnit:ae||P(me),selectedBufferSymbol:null===(J=null===(X=null===(Y=this.props.activeDatasourceConfig)||void 0===Y?void 0:Y.assetSettings)||void 0===X?void 0:X.assetIntersectingBuffer)||void 0===J?void 0:J.bufferSymbol,noValidInput:this.props.viewModelErrorState,viewModelErrorMsg:this.props.profileErrorMsg,isExport:!1,isCustomizeInterval:!1,allowExport:null===(q=this.props.commonDsGeneralSettings)||void 0===q?void 0:q.allowExport,exportData:!1,showViewLineGraph:this.props.activeDatasourceConfig?null===(K=this.props.activeDatasourceConfig.elevationLayersSettings)||void 0===K?void 0:K.showVolumetricObjLineInGraph:null===(Z=this.props.defaultConfig.elevationLayersSettings)||void 0===Z?void 0:Z.showVolumetricObjLineInGraph,volumetricObjStyle:this.props.activeDatasourceConfig?null===(Q=null===($=this.props.activeDatasourceConfig.elevationLayersSettings)||void 0===$?void 0:$.volumetricObjSettingsOptions)||void 0===Q?void 0:Q.style:null===(te=null===(ee=this.props.defaultConfig.elevationLayersSettings)||void 0===ee?void 0:ee.volumetricObjSettingsOptions)||void 0===te?void 0:te.style,volumetricObjLabel:this.props.activeDatasourceConfig?null===(se=null===(ie=this.props.activeDatasourceConfig.elevationLayersSettings)||void 0===ie?void 0:ie.volumetricObjSettingsOptions)||void 0===se?void 0:se.volumetricObjLabel:null===(ne=null===(oe=this.props.defaultConfig.elevationLayersSettings)||void 0===oe?void 0:oe.volumetricObjSettingsOptions)||void 0===ne?void 0:ne.volumetricObjLabel,distanceInterval:1,showInValidIntervalErrorMsg:!1,getIntervalsError:"",addedElevationLayers:this.props.addedElelvationProfileLayers,newAddedLayers:this.props.newAddedLayer,profileSettingsForNewlyAddedLayers:this.props.profileSettingsForNewAddedLayer},this._selectableLayers=[],this._intersectingLayers=[]}render(){var s,o,n;let a="",r="",d="";this.state.initialEmptyState&&this.props.drawMode||this.state.emptyStateIfDoneClick&&this.props.drawMode?a=this.nls("drawUserInfo"):(this.state.initialEmptyState&&this.props.selectMode||this.state.emptyStateIfDoneClick&&this.props.selectMode)&&(a=this.nls("selectUserInfo")),this.state.emptyStateIfDoneClick&&this.props.drawMode?r=this.nls("emptyDrawStateWarning"):this.state.emptyStateIfDoneClick&&this.props.selectMode&&(r=this.nls("emptySelectStateWarning")),this.props.drawMode&&this.props.chartRender?d=this.nls("infoMsgWhileDrawing"):this.props.selectMode&&this.props.chartRender&&(d=this.props.isNewSegmentsForSelection&&this.props.noGraphicAfterFirstSelection?this.nls("infoMsgWhileSelecting"):this.nls("addToSelectionWarning"));const c=this.nls("noFeaturesFound"),h=this.settingsOptionsRender(),u=this.statisticsDisplay(),p=this.exportOptionDisplay();return(0,t.jsx)("div",{className:"h-100 w-100",css:l(this.props.theme)},(0,t.jsx)("div",{style:{height:35},className:"ep-widget-header d-flex w-100"},(0,t.jsx)("div",{className:"align-items-center w-100 pt-1",style:{display:"inline-block"}},(0,t.jsx)(i.Button,{role:"button","aria-label":this.nls("settingsOptions"),"aria-haspopup":"dialog",title:this.nls("settingsOptions"),icon:!0,id:"settingsOptions"+this.props.widgetId,className:"chart-actions",color:this.state.settingsOptionsOpen?"primary":"default",size:"sm",type:"default",onClick:this.toggleSettings},(0,t.jsx)(i.Icon,{size:16,icon:ye.settingsIcon})),this.state.allowExport&&this.props.chartRender&&(this.props.drawMode&&this.props.onDrawingComplete||this.props.selectMode)&&(0,t.jsx)(i.Button,{role:"button","aria-label":this.nls("chartExport"),"aria-haspopup":"dialog",title:this.nls("chartExport"),icon:!0,id:"export"+this.props.widgetId,className:"chart-actions",color:this.state.isExport?"primary":"default",size:"sm",type:"default",onClick:this.toggleExport},(0,t.jsx)(i.Icon,{size:16,icon:fe()})),this.props.chartRender&&(0,t.jsx)(t.React.Fragment,null,(0,t.jsx)(i.Button,{role:"button","aria-label":this.nls("chartFlip"),title:this.nls("chartFlip"),icon:!0,className:"chart-actions",color:this.state.isFlipChart?"primary":"default",size:"sm",type:"default",onClick:this.onChartFlip},(0,t.jsx)(i.Icon,{size:16,icon:ye.flipIcon})),this.state.displayStats&&(0,t.jsx)(i.Button,{role:"button","aria-label":this.nls("chartStatistics"),"aria-haspopup":"dialog",title:this.nls("chartStatistics"),icon:!0,id:"statistics"+this.props.widgetId,className:"chart-actions",color:this.state.statisticsOpen?"primary":"default",size:"sm",type:"default",onClick:this.toggleStatistics},(0,t.jsx)(i.Icon,{size:16,icon:ye.chartIcon}))),this.state.settingsOptionsOpen&&h,this.state.isExport&&p,this.state.statisticsOpen&&u)),(0,t.jsx)("div",{className:(0,t.classNames)("ep-widget-bodyContainer d-flex w-100",this.props.chartRender?"":"align-items-center")},(0,t.jsx)("div",{className:(0,t.classNames)("w-100",this.props.chartRender?"":"alignInfo align-items-center",this.props.noFeaturesFoundError?"alignInfo align-items-center":"")},!this.props.displayLoadingIndicator&&(0,t.jsx)(t.React.Fragment,null,!this.props.chartRender&&!this.state.noFeaturesError&&!this.state.noValidInput&&(0,t.jsx)("div",{tabIndex:0,ref:this._alertElement,"aria-label":a},(0,t.jsx)(i.Alert,{className:"mb-4 w-100 userInfo py-1",open:!this.props.chartRender&&!this.state.noFeaturesError&&!this.state.noValidInput,text:a,type:"info",withIcon:!0})),this.state.emptyStateIfDoneClick&&!this.props.chartRender&&!this.state.noFeaturesError&&!this.state.noValidInput&&(0,t.jsx)(i.Alert,{tabIndex:0,className:"w-100 userInfo py-1",open:this.state.emptyStateIfDoneClick&&!this.props.chartRender&&!this.state.noFeaturesError&&!this.state.noValidInput,text:r,type:"warning",withIcon:!0}),this.state.noFeaturesError&&(0,t.jsx)(i.Alert,{tabIndex:0,className:"w-100 userInfo py-1",open:this.state.noFeaturesError,text:c,type:"warning",withIcon:!0}),this.state.noValidInput&&(0,t.jsx)(i.Alert,{tabIndex:0,className:"w-100 userInfo py-1",open:this.state.noValidInput,text:this.state.viewModelErrorMsg,type:"warning",withIcon:!0})),(this.props.chartRender||this.state.exportData)&&(0,t.jsx)(ne,{ref:"chartObj",intl:this.props.intl,isExportEnable:this.state.exportData,parentWidgetId:this.props.widgetId,isSelectModeActive:this.props.selectMode,commonGeneralSettings:this.props.commonDsGeneralSettings,activeDs:this.props.activeDataSource,currentConfig:this.props.activeDatasourceConfig,theme:this.props.theme,selectedLinearUnit:this.state.selectedLinearUnit,selectedElevationUnit:this.state.selectedElevationUnit,showVolumetricObj:this.state.showViewLineGraph,volumetricObjLineStyle:this.state.volumetricObjStyle,volumetricObjLabel:this.state.volumetricObjLabel,chartDataUpdateTime:this.props.chartDataUpdateTime,profileResult:this.props.profileResult,unitOptions:this.state.unitOptions,highlightChartPositionOnMap:this.highlightChartPosition.bind(this),hideChartPosition:this.hideChartPosition.bind(this),chartInfo:this.getChartInfo.bind(this),toggleLegendSeriesState:this.onToggleSeries,isFlip:this.state.isFlipChart,isUniformChartScalingEnable:this.state.isUniformScalingEnable,drawingLayer:this.props.drawingLayer,intersectionHighlightLayer:this.props.intersectionHighlightLayer,mapView:this.props.jimuMapView,assetIntersectionResult:this.props.intersectionResult,setExportButton:this.setExportButtonState,isCustomIntervalEnabled:this.state.isCustomizeInterval,customDistanceInterval:this.state.distanceInterval,addedElelvationProfileLayers:this.state.addedElevationLayers,profileSettingsForNewAddedLayer:this.state.profileSettingsForNewlyAddedLayers})),this.props.displayLoadingIndicator&&(0,t.jsx)(t.React.Fragment,null,(0,t.jsx)(i.Loading,{type:i.LoadingType.Donut}))),(0,t.jsx)("div",{className:"floatingInfoMsg"},!this.state.enableForNewProfile&&this.props.chartRender&&(0,t.jsx)(t.React.Fragment,null,(0,t.jsx)("div",{title:d},(0,t.jsx)(i.Alert,{tabIndex:0,className:(0,t.classNames)("alignDismissibleInfo py-1",this.state.dismissInfoMsg?"showMessage":"hideMessage"),onClose:this.dismissInfoMsg,open:this.state.dismissInfoMsg,text:d,type:"info",withIcon:!0,closable:!0})),(0,t.jsx)("div",{title:d},(0,t.jsx)(i.Alert,{tabIndex:0,className:(0,t.classNames)("alignDismissibleInfo py-1",this.state.dismissWarningMsg?"showMessage":"hideMessage"),onClose:this.dismissWarningMsg,open:this.state.dismissWarningMsg,text:d,type:"warning",withIcon:!0,closable:!0})))),(0,t.jsx)("div",{className:"ep-widget-footer"},(0,t.jsx)("div",{className:"w-100 footer-display"},(0,t.jsx)(i.Button,{role:"button","aria-label":this.nls("backButtonLabel"),title:this.nls("backButtonLabel"),className:"m-1 text-break",size:"default",type:"tertiary",onClick:this.props.onNavBack},(0,t.jsx)(i.Icon,{size:16,autoFlip:!0,icon:ye.arrowNavBack}),this.nls("backButtonLabel")),(null===(s=this.props.commonDsGeneralSettings)||void 0===s?void 0:s.buttonStyle)===e.IconText&&(0,t.jsx)(i.Button,{role:"button","aria-label":this.nls("doneButtonLabel"),title:this.nls("doneButtonLabel"),className:this.state.enableForNewProfile||this.props.onDrawingComplete||this.state.noValidInput||this.props.selectMode&&this.props.chartRender&&!this.props.isNewSegmentsForSelection?"hidden":"m-1 actionButton text-break",size:"default",type:"primary",onClick:this.onDoneClick},(0,t.jsx)(t.React.Fragment,null,(0,t.jsx)(i.Icon,{size:16,icon:ye.doneIcon}),this.nls("doneButtonLabel"))),this.props.chartRender&&(null===(o=this.props.commonDsGeneralSettings)||void 0===o?void 0:o.buttonStyle)===e.IconText&&(0,t.jsx)(t.React.Fragment,null,(0,t.jsx)(i.Button,{role:"button","aria-label":this.nls("clearButtonLabel"),title:this.nls("clearButtonLabel"),className:this.state.enableForNewProfile||this.props.onDrawingComplete||this.props.selectMode&&this.props.chartRender&&!this.props.isNewSegmentsForSelection?"hidden":"m-1 actionButton text-break",size:"default",type:"default",onClick:this.onClearButtonClick},(0,t.jsx)(i.Icon,{size:16,icon:ye.clearIcon}),this.nls("clearButtonLabel"))),(this.state.enableForNewProfile||this.props.onDrawingComplete||this.state.noValidInput||this.props.selectMode&&this.props.chartRender&&!this.props.isNewSegmentsForSelection)&&(null===(n=this.props.commonDsGeneralSettings)||void 0===n?void 0:n.buttonStyle)===e.IconText&&(0,t.jsx)(i.Button,{role:"button","aria-label":this.nls("newProfileButtonLabel"),title:this.nls("newProfileButtonLabel"),className:"m-1 actionButton text-break",size:"default",type:"primary",onClick:this.onNewProfileClick},(0,t.jsx)(t.React.Fragment,null,(0,t.jsx)(i.Icon,{size:16,icon:this.props.drawMode?ye.drawIcon:ye.selectIcon}),this.nls("newProfileButtonLabel"))))))}}var be=A(10624),we=A(59620),Le=A(33420),xe=A(86392),Ie=A(62243),Ae=A(79282),Ee=A(8968),Me=A(85633),De=A(7343);const Ce="Volumetric objects",Oe="MAX Distance",_e="MIN Elevation",Fe="MAX Elevation",Pe="AVG Elevation",je="Elevation Gain",Ve="Elevation Loss",Te="MAX Positive Slope",ke="MAX Negative Slope",Re="AVG Positive Slope",Ne="AVG Negative Slope";A(45508),A(62838),A(37568);var Ue;!function(e){e.Single="single",e.Multiple="multiple"}(Ue||(Ue={}));const Be=[{value:"maxDistance",label:Oe},{value:"minElevation",label:_e},{value:"maxElevation",label:Fe},{value:"avgElevation",label:Pe},{value:"elevationGain",label:je},{value:"elevationLoss",label:Ve},{value:"maxPositiveSlope",label:Te},{value:"maxNegativeSlope",label:ke},{value:"avgPositiveSlope",label:Re},{value:"avgNegativeSlope",label:Ne}],ze=(V(),{id:"",useDataSource:null,label:"",elevationLayerUrl:"",style:{lineType:"solid-line",lineColor:"#b54900",lineThickness:2},displayStatistics:!1,selectedStatistics:[]}),Ge={layerId:"",elevationSettings:{type:"",unit:"",field1:"",field2:""},distanceSettings:{type:"map",field:"",unit:""},style:{lineType:"solid-line",lineColor:"",lineThickness:3}};class We extends t.WidgetVersionManager{constructor(){super(...arguments),this.versions=[{version:"1.15.0",description:"Upgrade output data source json and use data sources",upgradeFullInfo:!0,upgrader:e=>{var t;const i=e.outputDataSourceJsons,s=e.widgetJson.config.configInfo,o=e.widgetJson.set("useDataSources",(e=>{var t,i,s;let o=[];for(const n in e)(null===(t=e[n].profileSettings.layers)||void 0===t?void 0:t.length)>0&&(o=j(n,e[n].profileSettings.layers,o)),(null===(s=null===(i=e[n].assetSettings)||void 0===i?void 0:i.layers)||void 0===s?void 0:s.length)>0&&(o=j(n,e[n].assetSettings.layers,o));return o})(s)),n=Object.assign(Object.assign({},e),{widgetJson:o});let l=n;return null===(t=n.widgetJson.outputDataSources)||void 0===t||t.forEach((e=>{let t=i[e];t=t.set("geometryType","esriGeometryPolyline");const s=i.set(e,t);l=Object.assign(Object.assign({},n),{outputDataSourceJsons:s})})),l}},{version:"1.16.0",description:"Upgrade Elevation layers settings and profile settings",upgrader:e=>{let t=e;if(t.configInfo)for(const i in t.configInfo){const s=e.configInfo[i].profileChartSettings,o=new Ae.default({url:s.elevationLayerURL}),n={id:V(),useDataSource:null,label:o.title,elevationLayerUrl:s.elevationLayerURL,style:{lineType:"solid-line",lineColor:s.groundColor,lineThickness:2},displayStatistics:s.displayStatistics,selectedStatistics:s.selectedStatistics},l={displayNextSelectableLine:!0,style:{lineType:"dotted-line",lineColor:"#fcfc03",lineThickness:3}},a=[];Be.forEach((e=>{const t={name:e.value,label:e.label,enabled:!0};a.push(t)})),a.sort(((e,t)=>e.label.localeCompare(t.label)));const r={id:V(),style:{lineType:"solid-line",lineColor:s.volumetricObjLineColor,lineThickness:2},volumetricObjLabel:s.volumetricObjLabel,displayStatistics:!1,selectedStatistics:a};t=t.setIn(["configInfo",i,"elevationLayersSettings","addedElevationLayers"],[n]),t=t.setIn(["configInfo",i,"elevationLayersSettings","groundLayerId"],n.id),t=t.setIn(["configInfo",i,"elevationLayersSettings","linearUnit"],s.linearUnit),t=t.setIn(["configInfo",i,"elevationLayersSettings","elevationUnit"],s.elevationUnit),t=t.setIn(["configInfo",i,"elevationLayersSettings","showVolumetricObjLineInGraph"],s.showVolumetricObjLineInGraph),t=t.setIn(["configInfo",i,"elevationLayersSettings","volumetricObjSettingsOptions"],r),t=t.setIn(["configInfo",i,"profileSettings","graphicsHighlightColor"],s.graphicsHighlightColor),t=t.setIn(["configInfo",i,"profileSettings","nextSelectableLineOptions"],l),t=t.setIn(["configInfo",i,"profileSettings","supportAddedLayers"],!1)}return t}},{version:"1.17.0",description:"Upgrade Selection mode options settings in profile settings",upgrader:e=>{let t=e;if(t.configInfo)for(const i in t.configInfo){const s=e.configInfo[i].profileSettings,o={selectionMode:s.nextSelectableLineOptions.displayNextSelectableLine?Ue.Multiple:Ue.Single,style:{lineType:s.nextSelectableLineOptions.style.lineType,lineColor:s.nextSelectableLineOptions.style.lineColor,lineThickness:s.nextSelectableLineOptions.style.lineThickness}};t=t.setIn(["configInfo",i,"profileSettings","selectionModeOptions"],o)}return t}}]}}const He=new We;var Ye=function(e,t,i,s){return new(i||(i=Promise))((function(o,n){function l(e){try{r(s.next(e))}catch(e){n(e)}}function a(e){try{r(s.throw(e))}catch(e){n(e)}}function r(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(l,a)}r((s=s.apply(e,t||[])).next())}))};const{epIcon:Xe}=b(),Je={style:"esriSMSCircle",color:[0,0,128,128],name:"Circle",outline:{color:[0,0,128,255],width:1},type:"esriSMS",size:18};class qe extends t.BaseWidget{constructor(s){var o,n,l,a,d;super(s),this._resultsAfterIntersectionTimeout=null,this.nls=e=>{const t=Object.assign({},r,i.defaultMessages);return this.props.intl&&this.props.intl.formatMessage?this.props.intl.formatMessage({id:e,defaultMessage:t[e]}):t[e]},this.createDrawingLayers=()=>{this._drawingLayer=new we.default({listMode:"hide",effect:"bloom(0.8, 1px, 0)"}),this._nextPossibleSelectionLayer=new we.default({listMode:"hide",effect:"bloom(0.8, 0px, 1%)"}),this._bufferLayer=new we.default({listMode:"hide"}),this._intersectionHighlightLayer=new we.default({listMode:"hide",effect:"bloom(0.8, 1px, 0)"})},this.componentDidMount=()=>{this.setState({noFeaturesError:!1,viewModelErrorState:!1})},this.waitForChildDataSourcesReady=e=>Ye(this,void 0,void 0,(function*(){yield null==e?void 0:e.whenAllJimuLayerViewLoaded();const i=t.DataSourceManager.getInstance().getDataSource(null==e?void 0:e.dataSourceId);return(null==i?void 0:i.isDataSourceSet())&&!i.areChildDataSourcesCreated()&&(yield i.childDataSourcesReady()),Promise.resolve(i)})),this.loadConfiguredDataSources=e=>{var i,s,o,n,l,a,r,d,c,h;const u=t.DataSourceManager.getInstance().getDataSource(e),p=[],v=[];return null===(l=null===(n=null===(o=null===(s=null===(i=this.props.config)||void 0===i?void 0:i.configInfo)||void 0===s?void 0:s[e])||void 0===o?void 0:o.profileSettings)||void 0===n?void 0:n.layers)||void 0===l||l.forEach((e=>Ye(this,void 0,void 0,(function*(){!v.includes(e.layerId)&&v.push(e.layerId)})))),null===(h=null===(c=null===(d=null===(r=null===(a=this.props.config)||void 0===a?void 0:a.configInfo)||void 0===r?void 0:r[e])||void 0===d?void 0:d.assetSettings)||void 0===c?void 0:c.layers)||void 0===h||h.forEach((e=>Ye(this,void 0,void 0,(function*(){!v.includes(e.layerId)&&v.push(e.layerId)})))),v.forEach((e=>{p.push(new Promise(((t,i)=>{try{(null==u?void 0:u.isDataSourceSet())&&(null==u||u.createDataSourceById(e).then((e=>{t(e)}),(()=>{t(null)})))}catch(e){t(null)}})))})),p},this.getSelectedFeatureRecords=e=>{let t=[];const i=C(e);null==i||i.forEach((e=>Ye(this,void 0,void 0,(function*(){var i,s,o,n;if(yield e.ready(),e.getSelectedRecords().length>0){t=e.getSelectedRecords();let l=!1;const a=null===(i=null==t?void 0:t[0])||void 0===i?void 0:i.dataSource.getMainDataSource().id;if((null==t?void 0:t[0].feature)&&(this.getSelectableLayers(this.state.currentDatasource),"polyline"===(null===(o=null===(s=null==t?void 0:t[0].feature)||void 0===s?void 0:s.geometry)||void 0===o?void 0:o.type)&&this._selectableLayersAtRuntime.includes(a)&&(l=!0)),l)return this.displayFeaturesResult(a,[null===(n=null==t?void 0:t[0])||void 0===n?void 0:n.feature]),!0}}))))},this.onDataSourceInfoChange=e=>{var i,s;if(null===(i=null==e?void 0:e.selectedIds)||void 0===i?void 0:i.length){let e=[];e=t.DataSourceManager.getInstance().getDataSource(this.state.dsToGetSelectedOnLoad).getSelectedRecords(),this.displayFeaturesResult(this.state.dsToGetSelectedOnLoad,[null===(s=null==e?void 0:e[0])||void 0===s?void 0:s.feature]),this.setState({dsToGetSelectedOnLoad:""})}},this.getSelectedFeatureOnLoad=()=>Ye(this,void 0,void 0,(function*(){var e,i,s,o;const n=t.UrlManager.getInstance(),l=t.urlUtils.getDataSourceInfosFromUrlParams(n.getQueryObject(),n.getHashObject());for(const n in l){let a=n;const r=t.DataSourceManager.getInstance().getDataSource(n);if((null==r?void 0:r.type)===t.DataSourceTypes.SubtypeGroupLayer){a=(yield r.getSublayerDataSourceByRecordId((null===(e=l[n])||void 0===e?void 0:e.selection).ids[0])).id}if(this._selectableLayersAtRuntime.includes(a)){const e=null===(i=l[n])||void 0===i?void 0:i.selection;if((null===(s=null==e?void 0:e.ids)||void 0===s?void 0:s.length)||(null===(o=null==e?void 0:e.queryParams)||void 0===o?void 0:o.geometry)){this.setState({dsToGetSelectedOnLoad:a});break}}}})),this.activeViewChangeHandler=e=>Ye(this,void 0,void 0,(function*(){var i,s,o,n,l;if(this._addedNewLayerOnMap=[],this._defaultProfileSettingsForNewAddedLayer=[],this.setState({newAddedLayer:[],profileSettingsForNewAddedLayer:[],updatedSelectableLayersAtRuntime:this._selectableLayersAtRuntime}),e&&e.view){this._mapView=e,this.state.jimuMapView&&(this.state.currentSketchVM&&!this.state.currentSketchVM.destroyed&&this.state.currentSketchVM.destroy(),this.clearAll(),this.setState({initialStage:!0,resultStage:!1,drawModeActive:null===(i=this.props.config.generalSettings)||void 0===i?void 0:i.isDrawToolActive,selectModeActive:null===(s=this.props.config.generalSettings)||void 0===s?void 0:s.isSelectToolActive}),this.destroyDrawingLayers(),this.createDrawingLayers()),this.setState({onWidgetLoadShowLoadingIndicator:!0,layersLoaded:!1});try{(null===(l=null===(n=null===(o=this.props.config)||void 0===o?void 0:o.configInfo)||void 0===n?void 0:n[null==e?void 0:e.dataSourceId])||void 0===l?void 0:l.profileSettings.isCustomizeOptionEnabled)?yield Promise.all(this.loadConfiguredDataSources(e.dataSourceId)):yield this.waitForChildDataSourcesReady(this._mapView)}catch(e){console.error(e)}this.setState({onWidgetLoadShowLoadingIndicator:!1,layersLoaded:!0}),e&&this.setState({jimuMapView:e},(()=>{if(""===e.dataSourceId)this.setState({currentDatasource:"default"},(()=>{this._activeCurrentDs=this.state.currentDatasource,this._selectedUnit=O(this.props.config.configInfo[this.state.currentDatasource],this.props.portalSelf),this.getSelectableLayers(this.state.currentDatasource)}));else if(this.state.jimuMapView.dataSourceId===this.props.config.activeDataSource&&this.props.config.configInfo[this.props.config.activeDataSource]){if(this.props.config.activeDataSource&&this.props.config.configInfo[this.props.config.activeDataSource]){let e=this.props.config.activeDataSource;this.state.jimuMapView&&this.state.jimuMapView.dataSourceId&&(e=this.props.config.configInfo.hasOwnProperty(this.state.jimuMapView.dataSourceId)?this.state.jimuMapView.dataSourceId:"default",this.setState({currentDatasource:e},(()=>{this._activeCurrentDs=this.state.currentDatasource,"default"!==this.state.currentDatasource&&this.checkLineLayerAvailableInDsAndConfig(this.state.currentDatasource),this.setConfigForDataSources(),this.getSelectableLayers(this.state.currentDatasource)})))}}else this.setState({currentDatasource:this.state.jimuMapView.dataSourceId},(()=>{this.getSelectableLayers(this.state.currentDatasource)})),this.checkLineLayerAvailableInDsAndConfig(this.state.jimuMapView.dataSourceId);setTimeout((()=>{var i;const s={mode:"3d"===this.state.jimuMapView.view.type?"relative-to-ground":"on-the-ground",offset:null};this._drawingLayer.set("elevationInfo",s),this._nextPossibleSelectionLayer.set("elevationInfo",s),this.state.jimuMapView.view.map.addMany([this._bufferLayer,this._nextPossibleSelectionLayer,this._drawingLayer,this._intersectionHighlightLayer]),this.createApiWidget(e),this.createEpViewModel(e);const o=(0,t.getAppStore)().getState().widgetsRuntimeInfo[this.props.id].state;o!==t.WidgetState.Opened&&o||this.loadSelectDrawToolOnLoad(this._activeCurrentDs),this.getSelectedFeatureOnLoad(),this._addedLayerAfterWidgetLoaded=!1,this._prevJimuMapView&&this._jimuLayerViewRemovedListener&&this._prevJimuMapView.removeJimuLayerViewRemovedListener(this._jimuLayerViewRemovedListener),this._prevJimuMapView=e,null===(i=e.view)||void 0===i||i.on("layerview-create",(t=>{this.getValidAddedLayers(e)})),this._jimuLayerViewRemovedListener=e=>{this.onJimuLayerViewRemove(e)},e.addJimuLayerViewRemovedListener(this._jimuLayerViewRemovedListener),this._addedLayerAfterWidgetLoaded||this.getValidAddedLayers(e)}),100)}))}else this.setState({initialStage:!1,resultStage:!1})})),this.onJimuLayerViewRemove=e=>{var i,s,o;if(this.isSupportAddedLayers()){const n=[],l=[...this._addedNewLayerOnMap],a=[...this._defaultProfileSettingsForNewAddedLayer];null===(i=this._drawingLayer.graphics)||void 0===i||i.forEach((e=>{e.attributes.esriCTFeatureLayerId&&n.push(e.attributes.esriCTFeatureLayerId)}));const r=t.DataSourceManager.getInstance().getDataSource(e.layerDataSourceId);r.type!==t.DataSourceTypes.FeatureLayer&&r.type!==t.DataSourceTypes.SubtypeSublayer||"esriGeometryPolyline"===(null===(s=null==r?void 0:r.getLayerDefinition())||void 0===s?void 0:s.geometryType)&&(this._addedLayerAfterWidgetLoaded=!0,l.includes(r.id)&&l.splice(l.indexOf(r.id),1),null===(o=this._defaultProfileSettingsForNewAddedLayer)||void 0===o||o.forEach(((e,t)=>{e.layerId===r.id&&a.splice(t,1)})),this._defaultProfileSettingsForNewAddedLayer=a,this._addedNewLayerOnMap=l),n.length&&(null==n||n.some((e=>{if(!this._addedNewLayerOnMap.includes(e))return this.onBackClick(),!0}))),this.setState({newAddedLayer:this._addedNewLayerOnMap,profileSettingsForNewAddedLayer:this._defaultProfileSettingsForNewAddedLayer,updatedSelectableLayersAtRuntime:this.getUpdatedSelectableLayers()},(()=>{this._addedNewLayerOnMap.length||(this.getSelectableLayers(this.state.currentDatasource),this.getUpdatedSelectableLayers().length||(this.clearAll(),this.setState({initialStage:!0,startChartRendering:!1,onDrawingComplete:!1,resultStage:!1,drawModeActive:!1,selectModeActive:!1})),this.setState({updatedSelectableLayersAtRuntime:this.getUpdatedSelectableLayers()}))}))}},this.getUpdatedSelectableLayers=()=>this._selectableLayersAtRuntime.concat(this._addedNewLayerOnMap).filter(((e,t,i)=>i.indexOf(e)===t)),this.getValidAddedLayers=e=>{var i;this.isSupportAddedLayers()&&(this._addedNewLayerOnMap=[],this._defaultProfileSettingsForNewAddedLayer=[],null===(i=this.getAllAddedJimuLayerViews(e))||void 0===i||i.forEach((e=>{var i;if(e){const s=t.DataSourceManager.getInstance().getDataSource(e.layerDataSourceId);if(s.type===t.DataSourceTypes.FeatureLayer||s.type===t.DataSourceTypes.SubtypeSublayer)"esriGeometryPolyline"!==(null===(i=null==s?void 0:s.getLayerDefinition())||void 0===i?void 0:i.geometryType)||this._addedNewLayerOnMap.includes(s.id)||(this._addedLayerAfterWidgetLoaded=!0,this.getInfoForNewAddedLayer(s));else{const t=C(e.layerDataSourceId);null==t||t.forEach((e=>{var t;"esriGeometryPolyline"!==(null===(t=null==e?void 0:e.getLayerDefinition())||void 0===t?void 0:t.geometryType)||this._addedNewLayerOnMap.includes(e.id)||(this._addedLayerAfterWidgetLoaded=!0,this.getInfoForNewAddedLayer(e))}))}}})),this.setState({newAddedLayer:this._addedNewLayerOnMap,profileSettingsForNewAddedLayer:this._defaultProfileSettingsForNewAddedLayer,updatedSelectableLayersAtRuntime:this._selectableLayersAtRuntime.concat(this._addedNewLayerOnMap)}))},this.isSupportAddedLayers=()=>{var e,t,i;let s=!1;const o=this.props.config.configInfo[this.state.currentDatasource];return((null==o?void 0:o.hasOwnProperty("advanceOptions"))||(null===(e=null==o?void 0:o.profileSettings)||void 0===e?void 0:e.hasOwnProperty("isProfileSettingsEnabled")))&&((null==o?void 0:o.advanceOptions)||(null===(t=null==o?void 0:o.profileSettings)||void 0===t?void 0:t.isProfileSettingsEnabled))&&(null===(i=null==o?void 0:o.profileSettings)||void 0===i?void 0:i.supportAddedLayers)&&(s=!0),s},this.getAllAddedJimuLayerViews=e=>e.getAllJimuLayerViews().filter((e=>e.fromRuntime)),this.getInfoForNewAddedLayer=e=>{var i,s,o;if(!this._addedNewLayerOnMap.includes(e.id)){this._addedNewLayerOnMap.push(e.id);const n=O(this.props.config.configInfo[this.state.currentDatasource],this.props.portalSelf);let l="no elevation";e.getLayerDefinition().hasZ&&(l="z");const a=Object.assign({},Ge);(null===(i=e.layerDefinition)||void 0===i?void 0:i.hasGeometryProperties)&&(null===(o=null===(s=e.layerDefinition)||void 0===s?void 0:s.geometryProperties)||void 0===o?void 0:o.shapeLengthFieldName)&&(a.distanceSettings.field=e.layerDefinition.geometryProperties.shapeLengthFieldName);const r=Object.assign({},a);r.layerId=e.id,r.elevationSettings.type=l,r.elevationSettings.unit=n[0],r.distanceSettings.unit=n[1],r.style.lineColor=_(),this._defaultProfileSettingsForNewAddedLayer.push((0,t.Immutable)(r))}},this.loadSelectDrawToolOnLoad=e=>{if("default"===e)this.state.drawModeActive&&this.manageActiveDrawSelect();else if(this.state.drawModeActive||this.state.selectModeActive){if(this.state.lineLayersNotFound&&this.state.selectModeActive)return;this.manageActiveDrawSelect()}else this.setState({resultStage:!1,initialStage:!0})},this.manageActiveDrawSelect=()=>{this.setState({resultStage:!0,initialStage:!1},(()=>{this.clearAll(!0),this._displayDefaultCursor(),this.activateDrawOrSelectTool()}))},this.checkLineLayerAvailableInDsAndConfig=e=>{var t;const i=C(e);let s=!0;null==i||i.forEach((e=>{e&&e.getLayerDefinition()&&e.getLayerDefinition().geometryType&&"esriGeometryPolyline"===e.getLayerDefinition().geometryType&&(s=!1)})),e&&this.props.config.configInfo[e]&&this.canShowSelectAndDrawOptions(this.props.config.configInfo[e])?this.canShowProfilingForBackward(this.props.config.configInfo[e])&&0===(null===(t=this.props.config.configInfo[e])||void 0===t?void 0:t.profileSettings.layers.length)&&(s=!0):s=!0,this.setState({lineLayersNotFound:s})},this.setConfigForDataSources=()=>{var e,t,i,s,o,n,l;const a=this.props.config.configInfo[this.state.currentDatasource],r=a?null===(e=a.elevationLayersSettings)||void 0===e?void 0:e.groundLayerId:null===(t=this._defaultConfig.elevationLayersSettings)||void 0===t?void 0:t.groundLayerId;this.setState({addedElevationLayers:a?null===(i=a.elevationLayersSettings)||void 0===i?void 0:i.addedElevationLayers:null===(s=this._defaultConfig.elevationLayersSettings)||void 0===s?void 0:s.addedElevationLayers,groundLayerId:r,graphicsHighlightColor:this.props.mapSelectionHighlightColor||"#00ffff",selectionModeOptions:a?null===(o=a.profileSettings)||void 0===o?void 0:o.selectionModeOptions:this._defaultConfig.profileSettings.selectionModeOptions,selectedLinearUnit:a?this._selectedUnit[1]:null===(n=this._defaultConfig.elevationLayersSettings)||void 0===n?void 0:n.linearUnit,selectedElevationUnit:a?this._selectedUnit[0]:null===(l=this._defaultConfig.elevationLayersSettings)||void 0===l?void 0:l.elevationUnit})},this.createDefaultConfigForDataSource=()=>{let e="",t="";const i=ze;return i.useDataSource=null,i.elevationLayerUrl="https://elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/Terrain3D/ImageServer",i.displayStatistics=!0,i.selectedStatistics=L,i.style={lineType:"solid-line",lineColor:_(),lineThickness:2},e=P(this.props.portalSelf),t=(e=>"english"===(null==e?void 0:e.units)?"miles":"kilometers")(this.props.portalSelf),{elevationLayersSettings:{addedElevationLayers:[i],groundLayerId:i.id,linearUnit:t,elevationUnit:e,showVolumetricObjLineInGraph:!1,volumetricObjSettingsOptions:{id:"",style:{lineType:"solid-line",lineColor:"#cf4ccf",lineThickness:2},volumetricObjLabel:this.nls("volumetricObj"),displayStatistics:!0,selectedStatistics:[]}}}},this.canShowProfilingForBackward=e=>{var t,i,s,o;let n=!1;return e&&((null==e?void 0:e.hasOwnProperty("advanceOptions"))||(null===(t=null==e?void 0:e.profileSettings)||void 0===t?void 0:t.hasOwnProperty("isProfileSettingsEnabled"))&&(null===(i=null==e?void 0:e.profileSettings)||void 0===i?void 0:i.hasOwnProperty("isCustomizeOptionEnabled")))&&((null==e?void 0:e.advanceOptions)||(null===(s=null==e?void 0:e.profileSettings)||void 0===s?void 0:s.isProfileSettingsEnabled)&&(null===(o=null==e?void 0:e.profileSettings)||void 0===o?void 0:o.isCustomizeOptionEnabled))&&(n=!0),n},this.canShowSelectAndDrawOptions=e=>{var t;let i=!0;return(null===(t=null==e?void 0:e.profileSettings)||void 0===t?void 0:t.hasOwnProperty("isProfileSettingsEnabled"))&&(i=e.profileSettings.isProfileSettingsEnabled),i},this.createApiWidget=e=>{var i,s;const o=new be.default({view:e?e.view:null,layer:new we.default,updateOnGraphicClick:!1,defaultCreateOptions:{mode:"click",hasZ:"3d"===(null===(i=null==e?void 0:e.view)||void 0===i?void 0:i.type)},polylineSymbol:{type:"simple-line",color:this.state.graphicsHighlightColor,width:5},pointSymbol:Ee.fromJSON(Je),defaultUpdateOptions:{toggleToolOnClick:!1}});o.on("create",(i=>{if("start"===i.state){const e={type:"simple-line",color:this.state.graphicsHighlightColor,width:5};this.state.currentSketchVM.set("polylineSymbol",e)}else if("complete"===i.state&&(this.setState({noFeaturesError:!1}),this.state.selectModeActive)){this.setState({loadingIndicator:!0});const s={returnAllFields:!0,returnFullGeometry:!0};e.selectFeaturesByGraphic(i.graphic,"intersects",t.DataSourceSelectionMode.New,s).then((e=>{var t;const i=Object.values(this.state.jimuMapView.jimuLayerViews),s={};for(let o=0;o<i.length;o++)if((null===(t=e[i[o].id])||void 0===t?void 0:t.length)>0){s[i[o].getLayerDataSource().id]=e[i[o].id]}this.queryForNewSelection(s,!0)}),(e=>{const t=this.getErrorMsgState(x.UnknownError);this.setState({loadingIndicator:!1,viewModelErrorState:t[0],profileErrorMsg:t[1]})}))}})),this.setState({currentSketchVM:o}),null===(s=null==e?void 0:e.view)||void 0===s||s.on("click",(t=>{const i=this._nextPossibleSelectionLayer;this.state.addToSelectionTool&&(t.stopPropagation(),e.view.hitTest(t).then((e=>{if(e&&e.results){const t=e.results.filter((e=>"graphic"===e.type)).filter((e=>e.graphic.layer===i&&"polyline"===e.graphic.geometry.type));t&&t.length>0&&(this.clearChart(),this._newFeatureSelection=!1,this._mapView.clearSelectedFeatures(),this.selectFeatureForProfiling(t[0].graphic))}})))}))},this.getGroundSeriesLabel=e=>{let t=e;return t=this.props.intl.formatMessage({id:"referenceLayerLabel",defaultMessage:r.referenceLayerLabel},{elevationLayerLabel:e}),t},this.createEpViewModel=(e,t)=>{var i,s,o;if(!e.view)return;const n=[];this._defaultViewModel&&(this._defaultViewModel.profiles=n);const l=null===(i=this.state.addedElevationLayers)||void 0===i?void 0:i.filter((e=>e.id===this.state.groundLayerId)),a=null===(s=this.state.addedElevationLayers)||void 0===s?void 0:s.filter((e=>!(e.id===this.state.groundLayerId)));l&&("3d"===e.view.type?n.push({id:l[0].id,type:"ground",color:l[0].style.lineColor,title:this.getGroundSeriesLabel(l[0].label)}):n.push({id:l[0].id,type:"query",source:new Ae.default({url:l[0].elevationLayerUrl}),color:l[0].style.lineColor,title:this.getGroundSeriesLabel(l[0].label)})),null==a||a.forEach((e=>{n.push({id:e.id,type:"query",source:new Ae.default({url:e.elevationLayerUrl}),color:e.style.lineColor,title:e.label})}));const r=this.checkForVolumetricObjects(e.view.type);if(r&&n.push(r),"3d"===e.view.type&&n.push({type:"input",color:this.state.graphicsHighlightColor}),this._defaultViewModel&&t){if(t&&(this._defaultViewModel.view=e.view,this._defaultViewModel.profiles=n,null===(o=this._defaultViewModel.input)||void 0===o?void 0:o.geometry)){const e=new AbortController;this.setState({loadingIndicator:!0,startChartRendering:!1,profileResult:null,chartDataUpdateTime:Date.now()}),Ie.whenOnce((()=>1===this._defaultViewModel.progress),e.signal).then((()=>Ye(this,void 0,void 0,(function*(){var t,i,s;const o=this.state.addedElevationLayers.filter((e=>e.id===this.state.groundLayerId)),n=null===(s=null===(i=null===(t=this._defaultViewModel)||void 0===t?void 0:t.chartData)||void 0===i?void 0:i.lines)||void 0===s?void 0:s.filter((e=>e.id===o[0].id));this._defaultViewModel.chartData&&(null==n?void 0:n.length)?(yield new Promise((e=>setTimeout(e,500))),this.onChartDataReady(e.signal)):this.onErrorInChartData(!0,this.nls("noProfileError"))}))))}}else this._defaultViewModel=new xe.default({view:e?e.view:null,profiles:n});const d=this._defaultViewModel;null==Ie||Ie.watch((()=>d.errorState),(e=>{var t;const i=this.getErrorMsgState(e);0!==(null==i?void 0:i.length)&&i&&(null===(t=this._abortController)||void 0===t||t.abort(),this.onErrorInChartData(i[0],i[1]))}),{initial:!0}),null==Ie||Ie.watch((()=>{var e;return null===(e=d.input)||void 0===e?void 0:e.geometry}),(()=>Ye(this,void 0,void 0,(function*(){var e,t,i,s;if(d.input)try{null===(e=this._abortController)||void 0===e||e.abort();const{signal:o}=this._abortController=new AbortController;if(this.setState({loadingIndicator:!0,onDrawingComplete:"created"===this._defaultViewModel.state}),yield Ie.whenOnce((()=>1===d.progress),o),o.aborted)return;if(yield new Promise((e=>setTimeout(e,1500))),this._defaultViewModel.chartData){const e=this.state.addedElevationLayers.filter((e=>e.id===this.state.groundLayerId)),n=null===(s=null===(i=null===(t=this._defaultViewModel)||void 0===t?void 0:t.chartData)||void 0===i?void 0:i.lines)||void 0===s?void 0:s.filter((t=>t.id===e[0].id));if(!(null==n?void 0:n.length))return void this.onErrorInChartData(!0,this.nls("noProfileError"));yield new Promise((e=>setTimeout(e,500))),yield this.onChartDataReady(o)}else this.onErrorInChartData(!0,this.state.profileErrorMsg)}catch(e){if(!De.isAbortError(e))throw new Error(e)}}))))},this.checkForVolumetricObjects=e=>{var t,i,s,o,n;const l=null===(t=this.props.config.configInfo[this.state.currentDatasource])||void 0===t?void 0:t.elevationLayersSettings;return"3d"===e&&(null==l?void 0:l.showVolumetricObjLineInGraph)?{id:null===(i=null==l?void 0:l.volumetricObjSettingsOptions)||void 0===i?void 0:i.id,type:"view",color:null===(o=null===(s=null==l?void 0:l.volumetricObjSettingsOptions)||void 0===s?void 0:s.style)||void 0===o?void 0:o.lineColor,title:null===(n=null==l?void 0:l.volumetricObjSettingsOptions)||void 0===n?void 0:n.volumetricObjLabel}:null},this.onChartDataReady=e=>Ye(this,void 0,void 0,(function*(){if(this.state.drawModeActive||this.state.selectModeActive){const t=yield this.createBufferGraphics(!0);if(e.aborted)return;this.setState({intersectionResult:t,viewModelErrorState:!1,profileResult:this._defaultViewModel.chartData,chartDataUpdateTime:Date.now()},(()=>Ye(this,void 0,void 0,(function*(){yield new Promise((e=>setTimeout(e,500))),this.setState({loadingIndicator:!1,startChartRendering:!0})}))))}})),this.onErrorInChartData=(e,t)=>{this.setState({loadingIndicator:!1,viewModelErrorState:e,profileErrorMsg:t||this.nls("unknownError"),startChartRendering:!1,profileResult:null,chartDataUpdateTime:Date.now()})},this.createBufferGraphics=e=>Ye(this,void 0,void 0,(function*(){return new Promise((i=>{var s,o,n;if(this._bufferGraphics=null,this._selectedBufferValues)if(null===(s=this._defaultViewModel)||void 0===s?void 0:s.input)if(this._selectedBufferValues.enabled&&this._selectedBufferValues.bufferDistance>0){let s=this._defaultViewModel.input.geometry.clone?this._defaultViewModel.input.geometry.clone():this._defaultViewModel.input.geometry;z&&!z.isSimple(s)&&(s=z.simplify(s)),t.geometryUtils.createBuffer(s,[this._selectedBufferValues.bufferDistance],this._selectedBufferValues.bufferUnits).then((t=>{var s,o;const n=Array.isArray(t)?t[0]:t,l=new J.default({geometry:n,symbol:null==Ee?void 0:Ee.fromJSON(this._selectedBufferValues.bufferSymbol)});this._bufferGraphics=l,l&&this._bufferGraphics&&(null===(s=this._bufferLayer)||void 0===s||s.removeAll(),null===(o=this._bufferLayer)||void 0===o||o.add(l)),this.checkForIntersectingLayer(e).then((e=>{i(e)}))}))}else null===(o=this._bufferLayer)||void 0===o||o.removeAll(),this.checkForIntersectingLayer(e).then((e=>{i(e)}));else null===(n=this._bufferLayer)||void 0===n||n.removeAll(),e||this.setState({intersectionResult:[]}),i([]);else i([])}))})),this.onBufferChange=e=>{this._selectedBufferValues=e,this.createBufferGraphics()},this.getErrorMsgState=e=>{switch(e){case x.TooComplex:return[!0,this.nls("tooComplexError")];case x.InvalidGeometry:return[!0,this.nls("invalidGeometryError")];case x.InvalidElevationInfo:return[!0,this.nls("invalidElevationInfoError")];case x.UnknownError:return[!0,this.nls("unknownError")];case x.NoVisibleProfiles:case x.RefinedButNoChartData:return[!0,this.nls("noProfileError")];case x.None:return[]}},this.getSelectableLayers=e=>{const t=C(e),i=[],s=this.canShowSelectAndDrawOptions(this.props.config.configInfo[e])&&this.canShowProfilingForBackward(this.props.config.configInfo[e]);null==t||t.forEach((t=>{var o,n,l,a,r,d,c,h,u,p,v;const g=t;g&&g.layerDefinition&&g.layerDefinition.geometryType&&"esriGeometryPolyline"===g.layerDefinition.geometryType&&((null===(o=this.props.config.configInfo[e])||void 0===o?void 0:o.hasOwnProperty("advanceOptions"))||(null===(l=null===(n=this.props.config.configInfo[e])||void 0===n?void 0:n.profileSettings)||void 0===l?void 0:l.hasOwnProperty("isProfileSettingsEnabled")))&&((null===(a=this.props.config.configInfo[e])||void 0===a?void 0:a.hasOwnProperty("advanceOptions"))||(null===(d=null===(r=this.props.config.configInfo[e])||void 0===r?void 0:r.profileSettings)||void 0===d?void 0:d.isProfileSettingsEnabled))&&(((null===(c=this.props.config.configInfo[e])||void 0===c?void 0:c.advanceOptions)||(null===(u=null===(h=this.props.config.configInfo[e])||void 0===h?void 0:h.profileSettings)||void 0===u?void 0:u.isProfileSettingsEnabled))&&s?null===(v=null===(p=this.props.config.configInfo[e])||void 0===p?void 0:p.profileSettings.layers)||void 0===v||v.forEach((e=>{e.layerId===t.id&&i.push(t.id)})):i.push(t.id))})),this._selectableLayersAtRuntime=i,this.setState({updatedSelectableLayersAtRuntime:this.isSupportAddedLayers()?i.concat(this._addedNewLayerOnMap).filter(((e,t,i)=>i.indexOf(e)===t)):i})},this.getValidFeatureRecord=e=>{let t=null;return e.some((e=>{var i,s,o,n,l,a;let r=null;if((null===(s=null===(i=null==e?void 0:e.feature)||void 0===i?void 0:i.layer)||void 0===s?void 0:s.id)?r=e.feature.layer.id:(null===(n=null===(o=null==e?void 0:e.dataSource)||void 0===o?void 0:o.layer)||void 0===n?void 0:n.id)&&(r=e.dataSource.layer.id),r&&"polyline"===(null===(a=null===(l=e.feature)||void 0===l?void 0:l.geometry)||void 0===a?void 0:a.type)){const i=this.getDSLayerID(r);if("default"===this.state.currentDatasource){if(this.getValidAddedLayers(this.state.jimuMapView),this._addedNewLayerOnMap.includes(e.dataSource.id))return t={},t.record=e,t.dsLayerId=e.dataSource.id,this._selectableLayersAtRuntime=[e.dataSource.id],!0}else if(this._isSelectableLayersChangedAtRuntime||this.getSelectableLayers(this.state.currentDatasource),this._selectableLayersAtRuntime.includes(i))return t={},t.record=e,t.dsLayerId=i,!0}})),t},this.getDSLayerID=e=>{var t,i;let s="";if(null===(i=null===(t=this.state)||void 0===t?void 0:t.jimuMapView)||void 0===i?void 0:i.dataSourceId){const t=C(this.state.jimuMapView.dataSourceId);null==t||t.forEach((t=>{if(t.jimuChildId===e)return s=t.id,!0}))}return s},this.getOutfieldsForDs=e=>{let t=[];const i=e.getLayerDefinition();return this.props.useDataSources.forEach((i=>{i.dataSourceId===e.id&&i.fields&&(t=[...i.fields])})),t.includes(i.objectIdField)||t.push(i.objectIdField),t},this.getFeatureFromLayer=(e,i)=>Ye(this,void 0,void 0,(function*(){const s=t.DataSourceManager.getInstance().getDataSource(e),o={};return o.where=s.getLayerDefinition().objectIdField+" = "+i,o.outFields=this.getOutfieldsForDs(s),o.returnGeometry=!0,o.returnFullGeometry=!0,o.returnZ=!0,o.notAddFieldsToClient=!0,o.outSR=this._mapView.view.spatialReference.toJSON(),new Promise((e=>s.query(o).then((t=>{if((null==t?void 0:t.records.length)>0){let i;t.records.forEach((e=>(i=e.feature,null!=i?i:null))),e(i)}}))))})),this.displayFeaturesResult=(e,t)=>{var i;const s={};s[e]=t,this.setState({initialStage:!1,resultStage:!0,selectModeActive:!0,drawModeActive:!1,onDrawingComplete:!1,startChartRendering:!1,viewModelErrorState:!1}),this._defaultViewModel&&this._defaultViewModel.clear(),(this.state.drawModeActive||this.state.selectModeActive)&&(null===(i=this.state.currentSketchVM)||void 0===i||i.cancel()),this._selectedFeaturesRecords=[],this._selectedRecordsDsId=[],this.hideChartPosition(),this.queryForNewSelection(s,!1)},this.componentDidUpdate=e=>{var i,s,o,n,l,a,r,d,c,h,u,p,v,g,f,y,m,S,b,w,L,x,I,A,E,M,D,C,O,_,F,P,j,V,T,k,R,N,U,B,z,G,W,H,Y,X,J,q,K;const Z=null===(n=null===(o=null===(s=null===(i=(0,t.getAppStore)())||void 0===i?void 0:i.getState())||void 0===s?void 0:s.widgetsRuntimeInfo)||void 0===o?void 0:o[this.props.id])||void 0===n?void 0:n.state;if(Z===t.WidgetState.Opened||!Z){const t=null===(l=this.props)||void 0===l?void 0:l.selectedFeatureRecords;if((null==t?void 0:t.length)>0&&(!e||!e.mutableStatePropsVersion||!e.mutableStatePropsVersion.selectedFeatureRecords||(null===(a=null==e?void 0:e.mutableStatePropsVersion)||void 0===a?void 0:a.selectedFeatureRecords)!==(null===(r=this.props.mutableStatePropsVersion)||void 0===r?void 0:r.selectedFeatureRecords))){const e=this.getValidFeatureRecord(t);if(!(null==e?void 0:e.record))return;this.getFeatureFromLayer(e.dsLayerId,e.record.getId()).then((t=>{this.displayFeaturesResult(e.dsLayerId,[t])}))}}if(this.props.appMode!==e.appMode&&this.props.appMode===t.AppMode.Run?this.state.addToSelectionTool&&this._displayAddToSelectionCursor():this.props.appMode!==e.appMode&&this.props.appMode===t.AppMode.Design&&this._displayDefaultCursor(),!this._mapView)return;if(e.useMapWidgetIds===this.props.useMapWidgetIds&&e.config.activeDataSource===this.props.config.activeDataSource||this.props.config.configInfo[this.props.config.activeDataSource]&&this.setState({currentDatasource:this.props.config.activeDataSource},(()=>{var e,t;this.checkLineLayerAvailableInDsAndConfig(this.state.currentDatasource),this.getSelectedFeatureRecords(null===(e=this._mapView)||void 0===e?void 0:e.dataSourceId),this.setState({addedElevationLayers:null===(t=this.props.config.configInfo[this.state.currentDatasource].elevationLayersSettings)||void 0===t?void 0:t.addedElevationLayers})})),e.state!==this.props.state&&!this.state.profileResult&&(this.state.drawModeActive||this.state.selectModeActive)){const e=(0,t.getAppStore)().getState().widgetsRuntimeInfo[this.props.id].state;e!==t.WidgetState.Opened&&e||(this.loadSelectDrawToolOnLoad(this._activeCurrentDs),this.getSelectedFeatureRecords(null===(d=this._mapView)||void 0===d?void 0:d.dataSourceId))}const $=null===(c=this.props.config.configInfo)||void 0===c?void 0:c[this.state.currentDatasource],Q=null===(h=e.config.configInfo)||void 0===h?void 0:h[this.state.currentDatasource];this.props.config.configInfo.hasOwnProperty(this.state.currentDatasource)&&(this.checkLineLayerAvailableInDsAndConfig(this.state.currentDatasource),this.setConfigForDataSources()),(this.didElevationLayersColorLabelChanged(null===(u=null==Q?void 0:Q.elevationLayersSettings)||void 0===u?void 0:u.addedElevationLayers,null===(p=null==$?void 0:$.elevationLayersSettings)||void 0===p?void 0:p.addedElevationLayers)||e.mapSelectionHighlightColor!==this.props.mapSelectionHighlightColor)&&this.setState({graphicsHighlightColor:this.props.mapSelectionHighlightColor||"#00ffff",addedElevationLayers:null===(v=null==$?void 0:$.elevationLayersSettings)||void 0===v?void 0:v.addedElevationLayers},(()=>{if(this._drawingLayer&&this._drawingLayer.graphics.length>0){const e={type:"simple-line",color:this.state.graphicsHighlightColor,width:5};this._drawingLayer.graphics.items.forEach((t=>{t.symbol=e}))}this._defaultViewModel&&this.createEpViewModel(this._mapView,!0)})),t.lodash.isDeepEqual(null===(g=null==Q?void 0:Q.profileSettings)||void 0===g?void 0:g.selectionModeOptions,null===(f=null==$?void 0:$.profileSettings)||void 0===f?void 0:f.selectionModeOptions)||this.setState({selectionModeOptions:null===(y=null==$?void 0:$.profileSettings)||void 0===y?void 0:y.selectionModeOptions},(()=>{var e,t,i,s;if((null===(e=this.state.selectionModeOptions)||void 0===e?void 0:e.selectionMode)===Ue.Multiple)if(this._nextPossibleSelectionLayer&&this._nextPossibleSelectionLayer.graphics.length>0){const e=this.state.selectionModeOptions.style,o={type:"simple-line",color:e.lineColor,style:"dotted-line"===e.lineType?"short-dot":"dashed-line"===e.lineType?"short-dash":"solid",width:"3d"===(null===(s=null===(i=null===(t=this.state)||void 0===t?void 0:t.jimuMapView)||void 0===i?void 0:i.view)||void 0===s?void 0:s.type)?e.lineThickness+3:e.lineThickness};this._nextPossibleSelectionLayer.graphics.items.forEach((e=>{e.symbol=o}))}else this.highlightNextPossibleSelection();else this._displayDefaultCursor(),this._nextPossibleSelectionLayer.removeAll(),this.setState({addToSelectionTool:!1,noGraphicAfterFirstSelection:!0})})),(null===(m=null==Q?void 0:Q.elevationLayersSettings)||void 0===m?void 0:m.groundLayerId)!==(null===(S=null==$?void 0:$.elevationLayersSettings)||void 0===S?void 0:S.groundLayerId)&&this.setState({groundLayerId:null===(b=null==$?void 0:$.elevationLayersSettings)||void 0===b?void 0:b.groundLayerId,addedElevationLayers:null===(w=null==$?void 0:$.elevationLayersSettings)||void 0===w?void 0:w.addedElevationLayers},(()=>{this.state.initialStage||this.activateToolForNewProfile(),this.createEpViewModel(this._mapView,!0)})),(null===(L=null==Q?void 0:Q.profileSettings)||void 0===L?void 0:L.supportAddedLayers)===(null===(x=null==$?void 0:$.profileSettings)||void 0===x?void 0:x.supportAddedLayers)&&((null==Q?void 0:Q.hasOwnProperty("advanceOptions"))&&(null==Q?void 0:Q.advanceOptions))===((null==$?void 0:$.hasOwnProperty("advanceOptions"))&&(null==$?void 0:$.advanceOptions))&&((null==Q?void 0:Q.profileSettings.hasOwnProperty("isProfileSettingsEnabled"))&&(null===(I=null==Q?void 0:Q.profileSettings)||void 0===I?void 0:I.isProfileSettingsEnabled))===((null==$?void 0:$.profileSettings.hasOwnProperty("isProfileSettingsEnabled"))&&(null===(A=null==$?void 0:$.profileSettings)||void 0===A?void 0:A.isProfileSettingsEnabled))||((null===(E=null==$?void 0:$.profileSettings)||void 0===E?void 0:E.isProfileSettingsEnabled)&&(null===(M=null==$?void 0:$.profileSettings)||void 0===M?void 0:M.supportAddedLayers)?this.getValidAddedLayers(this._mapView):(this._addedNewLayerOnMap=[],this._defaultProfileSettingsForNewAddedLayer=[],this.setState({newAddedLayer:[],profileSettingsForNewAddedLayer:[],updatedSelectableLayersAtRuntime:this._selectableLayersAtRuntime}))),(null===(D=null==Q?void 0:Q.elevationLayersSettings)||void 0===D?void 0:D.elevationUnit)===(null===(C=null==$?void 0:$.elevationLayersSettings)||void 0===C?void 0:C.elevationUnit)&&(null===(O=null==Q?void 0:Q.elevationLayersSettings)||void 0===O?void 0:O.linearUnit)===(null===(_=null==$?void 0:$.elevationLayersSettings)||void 0===_?void 0:_.linearUnit)||this.setState({selectedLinearUnit:null===(F=null==$?void 0:$.elevationLayersSettings)||void 0===F?void 0:F.linearUnit,selectedElevationUnit:null===(P=null==$?void 0:$.elevationLayersSettings)||void 0===P?void 0:P.elevationUnit}),this.didElevationLayersInfoChanged(null===(j=null==Q?void 0:Q.elevationLayersSettings)||void 0===j?void 0:j.addedElevationLayers,null===(V=null==$?void 0:$.elevationLayersSettings)||void 0===V?void 0:V.addedElevationLayers)&&$&&Q&&this.setState({addedElevationLayers:null===(T=null==$?void 0:$.elevationLayersSettings)||void 0===T?void 0:T.addedElevationLayers},(()=>{this.createEpViewModel(this._mapView,!0)})),(this.didProfileLayersSettingsChanged(null==Q?void 0:Q.profileSettings.layers,null==$?void 0:$.profileSettings.layers)||this.checkForPrevCurrentAdvanceConfig(Q,$,this.nls("selectableLayersLabel")))&&this.setState({profileLineLayers:null==$?void 0:$.profileSettings.layers},(()=>{var e;this.getSelectableLayers(this.state.currentDatasource);let t=!1;(null==$?void 0:$.profileSettings.isProfileSettingsEnabled)&&0===this.state.profileLineLayers.length&&!this.state.drawModeActive&&(!(null==$?void 0:$.profileSettings.isCustomizeOptionEnabled)&&!this.state.selectModeActive||(null==$?void 0:$.profileSettings.isCustomizeOptionEnabled)&&this.state.selectModeActive)&&(this.onBackClick(),t=!0),(null==$?void 0:$.profileSettings.isProfileSettingsEnabled)||this.state.drawModeActive||(this.onBackClick(),t=!0),(null===(e=null==$?void 0:$.assetSettings)||void 0===e?void 0:e.isAssetSettingsEnabled)?this.createBufferGraphics():this._bufferLayer&&this._bufferLayer.removeAll(),this.setState({lineLayersNotFound:t})})),(this.didIntersectingLayersSettingsChanged(null===(k=null==Q?void 0:Q.assetSettings)||void 0===k?void 0:k.layers,null===(R=null==$?void 0:$.assetSettings)||void 0===R?void 0:R.layers)||this.checkForPrevCurrentAdvanceConfig(Q,$,this.nls("intersectingLayersLabel")))&&((null===(N=null==$?void 0:$.assetSettings)||void 0===N?void 0:N.isAssetSettingsEnabled)?this.createBufferGraphics():this._bufferLayer&&this._bufferLayer.removeAll()),t.lodash.isDeepEqual(null===(B=null===(U=null==Q?void 0:Q.elevationLayersSettings)||void 0===U?void 0:U.volumetricObjSettingsOptions)||void 0===B?void 0:B.style,null===(G=null===(z=null==$?void 0:$.elevationLayersSettings)||void 0===z?void 0:z.volumetricObjSettingsOptions)||void 0===G?void 0:G.style)&&(null===(H=null===(W=null==Q?void 0:Q.elevationLayersSettings)||void 0===W?void 0:W.volumetricObjSettingsOptions)||void 0===H?void 0:H.volumetricObjLabel)===(null===(X=null===(Y=null==$?void 0:$.elevationLayersSettings)||void 0===Y?void 0:Y.volumetricObjSettingsOptions)||void 0===X?void 0:X.volumetricObjLabel)&&(null===(J=null==Q?void 0:Q.elevationLayersSettings)||void 0===J?void 0:J.showVolumetricObjLineInGraph)===(null===(q=null==$?void 0:$.elevationLayersSettings)||void 0===q?void 0:q.showVolumetricObjLineInGraph)||this._defaultViewModel&&"3d"===(null===(K=this.state.jimuMapView.view)||void 0===K?void 0:K.type)&&this.createEpViewModel(this._mapView,!0)},this.didElevationLayersColorLabelChanged=(e,t)=>{let i=!1;return null==t||t.some(((t,s)=>{var o,n;if(t.style.lineColor!==(null===(o=null==e?void 0:e[s])||void 0===o?void 0:o.style.lineColor)||t.label!==(null===(n=null==e?void 0:e[s])||void 0===n?void 0:n.label))return i=!0,!0})),i},this.didElevationLayersInfoChanged=(e,i)=>{let s=!1;return(null==i?void 0:i.length)!==(null==e?void 0:e.length)||(null==i||i.some(((i,o)=>{var n,l,a;if(i.id!==(null===(n=e[o])||void 0===n?void 0:n.id)||!t.lodash.isDeepEqual(i.useDataSource,null===(l=e[o])||void 0===l?void 0:l.useDataSource)||i.elevationLayerUrl!==(null===(a=e[o])||void 0===a?void 0:a.elevationLayerUrl))return s=!0,!0})),s)},this.checkForPrevCurrentAdvanceConfig=(e,t,i)=>{var s,o,n,l,a,r,d,c;let h=!1;return i===this.nls("selectableLayersLabel")&&(!e||((null==e?void 0:e.hasOwnProperty("advanceOptions"))&&(null==e?void 0:e.advanceOptions))===((null==t?void 0:t.hasOwnProperty("advanceOptions"))&&(null==t?void 0:t.advanceOptions))&&((null==e?void 0:e.profileSettings.hasOwnProperty("isProfileSettingsEnabled"))&&(null===(s=null==e?void 0:e.profileSettings)||void 0===s?void 0:s.isProfileSettingsEnabled))===((null==t?void 0:t.profileSettings.hasOwnProperty("isProfileSettingsEnabled"))&&(null===(o=null==t?void 0:t.profileSettings)||void 0===o?void 0:o.isProfileSettingsEnabled))&&((null==e?void 0:e.profileSettings.hasOwnProperty("isCustomizeOptionEnabled"))&&(null===(n=null==e?void 0:e.profileSettings)||void 0===n?void 0:n.isCustomizeOptionEnabled))===((null==t?void 0:t.profileSettings.hasOwnProperty("isCustomizeOptionEnabled"))&&(null===(l=null==t?void 0:t.profileSettings)||void 0===l?void 0:l.isCustomizeOptionEnabled))||(h=!0)),i===this.nls("intersectingLayersLabel")&&e&&(((null==e?void 0:e.hasOwnProperty("advanceOptions"))&&(null==e?void 0:e.advanceOptions))!==((null==t?void 0:t.hasOwnProperty("advanceOptions"))&&(null==t?void 0:t.advanceOptions))||(null==e?void 0:e.hasOwnProperty("assetSettings"))&&((null===(a=null==e?void 0:e.assetSettings)||void 0===a?void 0:a.hasOwnProperty("isAssetSettingsEnabled"))&&(null===(r=null==e?void 0:e.assetSettings)||void 0===r?void 0:r.isAssetSettingsEnabled))!==((null===(d=null==t?void 0:t.assetSettings)||void 0===d?void 0:d.hasOwnProperty("isAssetSettingsEnabled"))&&(null===(c=null==t?void 0:t.assetSettings)||void 0===c?void 0:c.isAssetSettingsEnabled)))&&(h=!0),h},this.didProfileLayersSettingsChanged=(e,t)=>{let i=!1;return(null==e?void 0:e.length)!==(null==t?void 0:t.length)&&(i=!0),i},this.didIntersectingLayersSettingsChanged=(e,t)=>{let i=!1;return(null==e?void 0:e.length)!==(null==t?void 0:t.length)&&(i=!0),i},this.componentWillUnmount=()=>{var e,t;this._defaultViewModel&&this._defaultViewModel.clear(),this.state.currentSketchVM&&(null===(e=this.state.currentSketchVM)||void 0===e||e.cancel()),this.destroyDrawingLayers(),this._displayDefaultCursor(),null===(t=this._mapView)||void 0===t||t.clearSelectedFeatures()},this.buildOutputStatistics=(e,t,i)=>{var s,o;this.buildStatsValuesAsOutput(null===(s=this._defaultViewModel)||void 0===s?void 0:s.visibleProfiles,null===(o=this.props.outputDataSources)||void 0===o?void 0:o[0],e,t,i)},this.getOutputDataSource=e=>t.DataSourceManager.getInstance().getDataSource(e),this.buildStatsValuesAsOutput=(e,s,o,n,l)=>{var a,r,d,c,h,u,p,v,g,f,y;if(!this.getOutputDataSource(s))return;let m=[];const S=[],b=this.state.addedElevationLayers.filter((e=>e.id===this.state.groundLayerId)),w=null===(d=null===(r=null===(a=this._defaultViewModel)||void 0===a?void 0:a.chartData)||void 0===r?void 0:r.lines)||void 0===d?void 0:d.filter((e=>e.id===b[0].id));if(0===(null===(h=null===(c=this._defaultViewModel)||void 0===c?void 0:c.chartData)||void 0===h?void 0:h.lines.length)||!(null==w?void 0:w.length))return void(null===(p=null===(u=this.props)||void 0===u?void 0:u.outputDataSources)||void 0===p||p.forEach((e=>{var i;null===(i=this.getOutputDataSource(e))||void 0===i||i.setStatus(t.DataSourceStatus.NotReady)})));null===(v=this.state.addedElevationLayers)||void 0===v||v.forEach(((t,i)=>{var s,a,r,d,c,h,u;const p=null==e?void 0:e.filter((e=>e.id===t.id)),v=null===(r=null===(a=null===(s=this._defaultViewModel)||void 0===s?void 0:s.chartData)||void 0===a?void 0:a.lines)||void 0===r?void 0:r.filter((e=>e.id===p[0].id));if(null==v?void 0:v.length){m=[];const e={};m.push({alias:this.nls("name"),type:"string",name:"name"},{alias:"OBJECTID",type:"double",name:"OBJECTID"}),L.forEach((e=>{m.push({alias:this.nls(e.value).replace(/ /g,""),type:"string",name:e.value})}));const s=this.outputStatisticsValueDisplay(null==p?void 0:p[0],o,n,l);e.name=(null===(d=null==p?void 0:p[0])||void 0===d?void 0:d.result)?t.label:this.nls("noStatsValue"),e.OBJECTID=i,s.forEach(((t,i)=>{var s;e[null===(s=m[i+2])||void 0===s?void 0:s.name]=null==t?void 0:t.statValue}));const a=m.length;L.forEach((e=>{m.push({alias:this.nls(e.value).replace(/ /g,""),type:"string",name:this.nls(e.value).replace(/ /g,"")})})),s.forEach(((t,i)=>{var s;e[null===(s=m[i+a])||void 0===s?void 0:s.name]=null==t?void 0:t.statValue}));const r={type:"polyline",paths:[],spatialReference:{wkid:4326}},v=new J.default({attributes:e,geometry:null!==(u=null===(h=null===(c=this._defaultViewModel)||void 0===c?void 0:c.input)||void 0===h?void 0:h.geometry)&&void 0!==u?u:r});S.push(v)}}));const x=[];m.forEach((e=>{if(e.name){const t={fieldName:e.name,label:e.alias};x.push(t)}}));const I=Object.assign({},i.defaultMessages),A=new Me.default({id:s+"_layer",title:this.props.intl.formatMessage({id:"outputStatistics",defaultMessage:I.outputStatistics},{name:this.props.label}),fields:m,geometryType:"polyline",source:S,objectIdField:"OBJECTID",popupTemplate:{title:this.props.intl.formatMessage({id:"outputStatistics",defaultMessage:I.outputStatistics},{name:this.props.label}),fieldInfos:x,content:[{type:"fields",fieldInfos:x}]}}),E=this.getOutputDataSource(s);A&&E&&(E.layer=A),null===(g=this.getOutputDataSource(s))||void 0===g||g.setStatus(t.DataSourceStatus.Unloaded),null===(f=this.getOutputDataSource(s))||void 0===f||f.setCountStatus(t.DataSourceStatus.Unloaded),null===(y=this.getOutputDataSource(s))||void 0===y||y.addSourceVersion()},this.outputStatisticsValueDisplay=(e,t,i,s)=>{const o=[];let n="",l=null,a="";return L.forEach((r=>{var d;a=r.value,(null==e?void 0:e.statistics)?(s&&a!==I.AvgElevation&&a!==I.MaxDistance&&a!==I.MaxElevation&&a!==I.MinElevation&&(a=M(a)),l=null===(d=null==e?void 0:e.statistics)||void 0===d?void 0:d[a],n=this.getStatsValueWithUnit(e,l,a,t,i)):n=this.nls("noStatsValue"),o.push({statName:r.value,statValue:n})})),o},this.getStatsValueWithUnit=(e,t,i,s,o)=>{let n="",l=null;return w.forEach((a=>{i===I.MaxDistance?a.value===o&&(l=k(t,null==e?void 0:e.effectiveUnits.distance,o),n=this.props.intl.formatNumber(l,{maximumFractionDigits:2})+" "+this.nls(a.abbreviation)):i===I.MaxPositiveSlope||i===I.MaxNegativeSlope||i===I.AvgPositiveSlope||i===I.AvgNegativeSlope?n=null===t?this.nls("noStatsValue"):this.props.intl.formatNumber(t,{maximumFractionDigits:2})+" \xb0":a.value===s&&(l=k(t,null==e?void 0:e.effectiveUnits.elevation,s),n=this.props.intl.formatNumber(l,{maximumFractionDigits:2})+" "+this.nls(a.abbreviation))})),n},this.queryForNewSelection=(e,i)=>Ye(this,void 0,void 0,(function*(){var s,o,n,l,a,r,d,c;let h=null;if(Object.keys(e).length>0)for(const u in e){let p,v=u;const g=t.DataSourceManager.getInstance().getDataSource(u);if(g.type===t.DataSourceTypes.SubtypeGroupLayer){const e=yield g.getSublayerDataSourceByRecordId(g.layerId);v=e.id,p=yield this.getFeatureFromLayer(v,e.getSelectedRecordIds())}const f=p?[p]:e[v];if(f.length>0&&"polyline"===(null===(s=f[0].geometry)||void 0===s?void 0:s.type)&&this._selectableLayersAtRuntime.includes(v)){if("3d"===this.state.jimuMapView.view.type&&(null===(n=null===(o=f[0])||void 0===o?void 0:o.layer)||void 0===n?void 0:n.elevationInfo)){const e=null===(a=null===(l=f[0])||void 0===l?void 0:l.layer)||void 0===a?void 0:a.elevationInfo;this._drawingLayer.set("elevationInfo",e),this._nextPossibleSelectionLayer.set("elevationInfo",e)}this._newFeatureSelection=!0,this.setState({noGraphicAfterFirstSelection:!0}),h=new J.default({geometry:null===(r=f[0])||void 0===r?void 0:r.geometry,attributes:(null===(d=f[0])||void 0===d?void 0:d.attributes)?null===(c=f[0])||void 0===c?void 0:c.attributes:{}}),h.attributes.esriCTFeatureLayerId=v,i&&this._mapView.clearSelectedFeatures();break}}(this._drawingLayer||this._bufferLayer)&&(this._drawingLayer.removeAll(),this._bufferLayer.removeAll()),h?(this.setState({drawModeActive:!1,noFeaturesError:!1,viewModelErrorState:!1}),t.geometryUtils.projectToSpatialReference([h.geometry],this.state.jimuMapView.view.spatialReference).then((e=>{(null==e?void 0:e.length)>0&&(h.geometry=e[0]),this.selectFeatureForProfiling(h)}),(e=>{console.log(e),this.selectFeatureForProfiling(h)}))):(this.state.selectModeActive&&this.state.currentSketchVM.create("point"),this.setState({loadingIndicator:!1,noFeaturesError:!0},(()=>{setTimeout((()=>{var e;null===(e=this._mapView)||void 0===e||e.clearSelectedFeatures()}),100)})))})),this.checkForIntersectingLayer=e=>new Promise((i=>{var s,o,n,l,a;const r=[];if((null===(s=this._intersectingLayersAtRuntime)||void 0===s?void 0:s.length)>0){const e=null===(n=null===(o=this._defaultViewModel)||void 0===o?void 0:o.input)||void 0===n?void 0:n.geometry,i=t.DataSourceManager.getInstance();(null===(a=null===(l=this.props.config.configInfo[this.state.currentDatasource])||void 0===l?void 0:l.assetSettings)||void 0===a?void 0:a.layers).forEach((t=>{if(this._intersectingLayersAtRuntime.includes(t.layerId)){const s=i.getDataSource(t.layerId);s&&s.layer&&this.considerLayerVisibility(s.id)&&r.push(this.queryForIntersectingLayers(t,e))}}))}Promise.all(r).then((t=>{e||this.setState({intersectionResult:t}),i(t)}))})),this.queryForIntersectingLayers=(e,i)=>Ye(this,void 0,void 0,(function*(){const s=this._bufferGraphics,o=t.DataSourceManager.getInstance().getDataSource(null==e?void 0:e.layerId);return new Promise((t=>{var n,l,a,r;if("esriGeometryPolyline"===(null===(n=null==o?void 0:o.layerDefinition)||void 0===n?void 0:n.geometryType)||"esriGeometryPoint"===(null===(l=null==o?void 0:o.layerDefinition)||void 0===l?void 0:l.geometryType)){const n={};n.geometry=(null==s?void 0:s.geometry)?s.geometry.toJSON():i.toJSON(),n.returnGeometry=!0,n.returnZ=!0;const l=this.filterExistingFeatures(o);l&&(n.where=l),n.outFields=[o.layerDefinition.objectIdField],e.displayField&&!n.outFields.includes(e.displayField)&&n.outFields.push(e.displayField),(null===(a=e.elevationSettings)||void 0===a?void 0:a.field1)&&!n.outFields.includes(e.elevationSettings.field1)&&n.outFields.push(e.elevationSettings.field1),(null===(r=e.elevationSettings)||void 0===r?void 0:r.field2)&&!n.outFields.includes(e.elevationSettings.field2)&&n.outFields.push(e.elevationSettings.field2),n.outFields=this.getOutfieldsForDs(o),n.notAddFieldsToClient=!0,n.outSR=this._mapView.view.spatialReference.toJSON(),n.distance=.1,n.units="esriSRUnit_Meter";try{o.query(n).then((n=>{const l=[];(null==n?void 0:n.records.length)>0&&n.records.forEach((e=>{const t=e.feature,o=[],n=[],a={connectedFeatureForProfiling:n,disconnectedFeatureForProfiling:o,intersectingFeature:t,record:e},r=t.geometry;if("polyline"===r.type){let e=i;const t=z.intersect(r,s?s.geometry:e);if(t&&n.push(t),s){const t=s.geometry;e=new W.default({hasZ:t.hasZ,hasM:t.hasM,paths:t.rings,spatialReference:t.spatialReference})}const l=z.intersectLinesToPoints(r,e);l.length>0&&l.forEach((e=>{if(t){z.intersects(e,t)||o.push(e)}else o.push(e)}))}l.push(a)}));const a={title:o.getLabel(),settings:e,intersectionResult:l,inputGeometry:i};t(a)}),(e=>{console.log(e),t(null)}))}catch(e){t(null)}}else t(null)}))})),this.considerLayerVisibility=e=>{var t;const i=null===(t=this._mapView.getJimuLayerViewByDataSourceId(e))||void 0===t?void 0:t.layer;return i&&i.visible&&(i.minScale>=this._mapView.view.scale&&i.maxScale<=this._mapView.view.scale||0===i.minScale&&i.maxScale<=this._mapView.view.scale||0===i.maxScale&&i.minScale>=this._mapView.view.scale||0===i.minScale&&0===i.maxScale)},this.queryForIndividualLayers=e=>{const i=[],s=t.DataSourceManager.getInstance();return this._selectableLayersAtRuntime.forEach((t=>{const o=s.getDataSource(t);o&&this.considerLayerVisibility(o.id)&&i.push(this.queryIndividualLayer(o,e))})),i},this.queryIndividualLayer=(e,t)=>Ye(this,void 0,void 0,(function*(){const i=this.getMetersForVerticalSR(e),s=this.filterExistingFeatures(e),o=Date.now(),n={};n.geometry=t.toJSON(),n.returnFullGeometry=!0,n.returnGeometry=!0,n.returnZ=!0,n.outFields=e.getAllUsedFields(),n.notAddFieldsToClient=!0,n.outSR=this._mapView.view.spatialReference.toJSON(),n.where=s?s+" AND "+o+"="+o:o+"="+o;let l=[];try{yield e.query(n).then((t=>{const s=[];(null==t?void 0:t.records.length)>0&&t.records.forEach((t=>{const o=t.feature;if(s.push(o),i){const e=X.default.getMetersPerUnitForSR(new Y.default(this._mapView.view.spatialReference.toJSON())),t=o.geometry;t.paths.length>0&&t.paths.forEach((t=>{t.length>0&&t.forEach((t=>{t.length>1&&(t[2]=t[2]*i/e)}))}))}o.attributes.esriCTFeatureLayerId=e.dataSourceJson.id})),l=s}),(e=>{console.log(e)}))}catch(e){l=[]}return l})),this.getMetersForVerticalSR=e=>{var t,i;let s=1;const o=e.layerDefinition;return s=(null===(t=null==o?void 0:o.sourceSpatialReference)||void 0===t?void 0:t.vcsWkid)?X.default.getMetersPerVerticalUnitForSR(new Y.default({wkid:null==o?void 0:o.sourceSpatialReference.vcsWkid})):(null===(i=null==o?void 0:o.sourceSpatialReference)||void 0===i?void 0:i.vcsWkt)?X.default.getMetersPerVerticalUnitForSR(new Y.default({wkid:null==o?void 0:o.sourceSpatialReference.vcsWkt})):null,s},this.filterExistingFeatures=e=>{let t="";const i=e.getLayerDefinition().objectIdField,s=this._drawingLayer.graphics.filter((t=>{var i;return!(!(null===(i=null==t?void 0:t.attributes)||void 0===i?void 0:i.hasOwnProperty("esriCTFeatureLayerId"))||t.attributes.esriCTFeatureLayerId!==e.getDataSourceJson().id)}));return s.forEach(((o,n)=>{var l;(null===(l=null==o?void 0:o.attributes)||void 0===l?void 0:l.hasOwnProperty("esriCTFeatureLayerId"))&&o.attributes.esriCTFeatureLayerId===e.getDataSourceJson().id&&(n===s.length-1?t+=i+" <> "+o.attributes[i]:t+=i+" <> "+o.attributes[i]+" and ")})),t},this.selectFeatureForProfiling=e=>{var t,i;let s=!1,o=!1;const n=this._drawingLayer.graphics.length;if(n>0){const t=this._drawingLayer.graphics.getItemAt(0).geometry,i=this._drawingLayer.graphics.getItemAt(n-1).geometry,l=t.getPoint(0,0),a=i.getPoint(0,i.paths[0].length-1),r=e.geometry.getPoint(0,0),d=e.geometry.getPoint(0,e.geometry.paths[0].length-1);z.intersects(r,l)?(s=!0,o=!0):z.intersects(d,l)?(s=!0,o=!1):z.intersects(d,a)?(s=!1,o=!0):z.intersects(r,a)&&(s=!1,o=!1)}const l={type:"simple-line",color:new q.default(this.state.graphicsHighlightColor?this.state.graphicsHighlightColor:"#00ffff").toRgba(),width:5},a=e.geometry;if(o){const e=[];for(let t=a.paths.length-1;t>=0;t--){const i=[];for(let e=a.paths[t].length-1;e>=0;e--)i.push(a.paths[t][e]);e.push(i)}a.paths=e}const r=new J.default({geometry:a,attributes:e.attributes,symbol:l});let d=!1;!this.state.addToSelectionTool&&this._defaultViewModel&&(this._defaultViewModel.input=r,d=!0),null===(t=this.state.jimuMapView)||void 0===t||t.view.map.reorder(this._drawingLayer,(null===(i=this.state.jimuMapView)||void 0===i?void 0:i.view.map.layers.length)-1),s?this._drawingLayer.graphics.add(r,0):this._drawingLayer.graphics.add(r),this.broadcastSelectedFeatures(e),this._nextPossibleSelectionLayer.removeAll(),setTimeout((()=>{this.renderChartOnSelect(d),this.state.selectionModeOptions.selectionMode===Ue.Multiple&&this.highlightNextPossibleSelection()}),200)},this.broadcastSelectedFeatures=e=>{const i=t.DataSourceManager.getInstance().getDataSource(e.attributes.esriCTFeatureLayerId),s=i.buildRecord(e);if(s){const e={},o={};this._selectedFeaturesRecords.push(s),this._selectedRecordsDsId.push(i.id),this._selectedFeaturesRecords.forEach((t=>{const i=t.dataSource.id;e[i]||(e[i]=[]),e[i].push(t),o[i]||(o[i]=[]),o[i].push(t.getId())}));for(const i in e){const s=t.DataSourceManager.getInstance().getDataSource(i);null==s||s.selectRecordsByIds(o[i],e[i])}t.MessageManager.getInstance().publishMessage(new t.DataRecordsSelectionChangeMessage(this.props.id,this._selectedFeaturesRecords,this._selectedRecordsDsId))}},this.createSinglePathPolyline=e=>{const t=[];e.paths.forEach((e=>{e.forEach((e=>t.push(e)))}));const i=new W.default({hasZ:e.hasZ,spatialReference:e.spatialReference.toJSON()});return i.addPath(t),i},this.renderChartOnSelect=e=>{if(this.state.addToSelectionTool){let t;if(this._drawingLayer.graphics.length>1){const e=new W.default({spatialReference:this._drawingLayer.graphics.getItemAt(0).geometry.spatialReference.toJSON(),hasZ:!1});let i=[];this._drawingLayer.graphics.forEach((t=>{const s=t.geometry;if(s.hasZ&&(e.hasZ=!0),s.paths.length>1)s.paths.forEach((t=>{i.length>0?(t.forEach((e=>i.push(e))),e.addPath(i),i=[]):e.addPath(t)}));else{const t=e.paths.length;t>0?s.paths.forEach((i=>{i.forEach((i=>e.paths[t-1].push(i)))})):s.paths.forEach((e=>{e.forEach((e=>i.push(e)))}))}})),i.length>0&&e.addPath(i),t=new J.default({geometry:e})}else 1===this._drawingLayer.graphics.length&&(t=this._drawingLayer.graphics.getItemAt(0));!e&&this._defaultViewModel&&(this._defaultViewModel.input=t)}},this.highlightNextPossibleSelection=()=>{var e,t;let i,s,o,n;const l=this._drawingLayer.graphics.length;if(l>0){o=this._drawingLayer.graphics.getItemAt(0).geometry,i=o.getPoint(0,0);let a=o.paths[0].length-1;s=o.getPoint(0,a),l>1&&(n=this._drawingLayer.graphics.getItemAt(l-1).geometry,a=n.paths[0].length-1,s=n.getPoint(0,a));const r=new J.default({geometry:i});null===(e=this.state.jimuMapView)||void 0===e||e.view.map.reorder(this._nextPossibleSelectionLayer,(null===(t=this.state.jimuMapView)||void 0===t?void 0:t.view.map.layers.length)-1),this._nextPossibleSelectionLayer.graphics.add(r);const d=new J.default({geometry:s});this._nextPossibleSelectionLayer.graphics.add(d),this.queryForNextPossibleSelection([i,s])}},this.queryForNextPossibleSelection=e=>{let t=[];e.forEach((e=>{t=t.concat(this.queryForIndividualLayers(this.pointToExtent(e)))})),this.setState({nextPossibleloadingIndicator:!0}),Promise.all(t).then((t=>{this.setState({nextPossibleloadingIndicator:!1});const i=[],s=t.flat();(null==s?void 0:s.length)>0&&(s.forEach((t=>{var s,o,n,l,a,r,d,c,h;if((null===(o=null===(s=null==t?void 0:t.geometry)||void 0===s?void 0:s.paths)||void 0===o?void 0:o.length)>0){const s=null===(l=null===(n=t.geometry)||void 0===n?void 0:n.getPoint)||void 0===l?void 0:l.call(n,0,0),o=t.geometry.paths[t.geometry.paths.length-1].length-1,u=null===(r=null===(a=t.geometry)||void 0===a?void 0:a.getPoint)||void 0===r?void 0:r.call(a,0,o);if(s&&z.intersects(e[0],s)||u&&z.intersects(e[0],u)||s&&z.intersects(e[1],s)||u&&z.intersects(e[1],u)){const e=this.state.selectionModeOptions.style,s={type:"simple-line",color:e.lineColor,style:"dotted-line"===e.lineType?"short-dot":"dashed-line"===e.lineType?"short-dash":"solid",width:"3d"===(null===(h=null===(c=null===(d=this.state)||void 0===d?void 0:d.jimuMapView)||void 0===c?void 0:c.view)||void 0===h?void 0:h.type)?e.lineThickness+3:e.lineThickness},o=new J.default({geometry:t.geometry,attributes:t.attributes,symbol:s});i.push(o)}}})),i&&i.length>0&&this._nextPossibleSelectionLayer.graphics.addMany(i)),setTimeout((()=>{this.updateStateCanAddToSelection()}),200)}),(e=>{console.log(e),this.updateStateCanAddToSelection()}))},this.updateStateCanAddToSelection=()=>{var e;null===(e=this.state.currentSketchVM)||void 0===e||e.cancel();let t=!1;this._nextPossibleSelectionLayer.graphics.filter((e=>"polyline"===e.geometry.type)).length>0?t=!0:this._newFeatureSelection?this.setState({noGraphicAfterFirstSelection:!0}):this.setState({noGraphicAfterFirstSelection:!1}),t?this._activateAddToSelectionTool():this._deActivateAddToSelectionTool()},this._activateAddToSelectionTool=()=>{var e;this.state.addToSelectionTool||this.setState({addToSelectionTool:!0}),this.state.jimuMapView&&this.state.jimuMapView.view&&(this.state.jimuMapView.view.popupEnabled=!1),this._displayAddToSelectionCursor(),null===(e=this._nextPossibleSelectionLayer)||void 0===e||e.set("visible",!0)},this._deActivateAddToSelectionTool=()=>{var e;this.state.addToSelectionTool&&this.setState({addToSelectionTool:!1}),this.state.jimuMapView&&this.state.jimuMapView.view&&(this.state.jimuMapView.view.popupEnabled=!0),this._displayDefaultCursor(),null===(e=this._nextPossibleSelectionLayer)||void 0===e||e.set("visible",!1)},this._displayAddToSelectionCursor=()=>{this.state.jimuMapView&&this.state.jimuMapView.view&&this.state.jimuMapView.view&&this.state.jimuMapView.view.container&&null!==this.state.jimuMapView.view.container.style.cursor&&(this.state.jimuMapView.view.container.style.cursor="copy")},this.activateDrawOrSelectTool=()=>{this.state.currentSketchVM&&((this.state.drawModeActive||this.state.selectModeActive)&&this.state.currentSketchVM.cancel(),this.setState({onDrawingComplete:!1,startChartRendering:!1,viewModelErrorState:!1,loadingIndicator:!1},(()=>{this.state.drawModeActive&&this._defaultViewModel&&this._defaultViewModel.start({mode:"sketch"}),this.state.selectModeActive&&this.state.currentSketchVM.create("point")})))},this.destroyDrawingLayers=()=>{this._drawingLayer&&(this._drawingLayer.removeAll(),this._drawingLayer.destroy()),this._nextPossibleSelectionLayer&&(this._nextPossibleSelectionLayer.removeAll(),this._nextPossibleSelectionLayer.destroy()),this._bufferLayer&&(this._bufferLayer.removeAll(),this._bufferLayer.destroy()),this._intersectionHighlightLayer&&(this._intersectionHighlightLayer.removeAll(),this._intersectionHighlightLayer.destroy()),this.hideChartPosition()},this._displayDefaultCursor=()=>{this.state.jimuMapView&&this.state.jimuMapView.view&&this.state.jimuMapView.view&&this.state.jimuMapView.view.container&&null!==this.state.jimuMapView.view.container.style.cursor&&(this.state.jimuMapView.view.container.style.cursor=null)},this.pointToExtent=(e,t=5)=>{const i=t*(this.state.jimuMapView.view.extent.width/this.state.jimuMapView.view.width),s={xmin:e.x-i,ymin:e.y-i,xmax:e.x+i,ymax:e.y+i,spatialReference:this.state.jimuMapView.view.spatialReference};return new Le.default(s)},this.selectableLayersAvailableAtRuntime=e=>{this._selectableLayersAtRuntime=e,this._isSelectableLayersChangedAtRuntime=!0,this.setState({updatedSelectableLayersAtRuntime:e})},this.intersectingLayersAvailableAtRuntime=e=>{this._intersectingLayersAtRuntime=e,this._resultsAfterIntersectionTimeout&&clearTimeout(this._resultsAfterIntersectionTimeout),this._resultsAfterIntersectionTimeout=setTimeout((()=>{this._resultsAfterIntersectionTimeout=null,this.createBufferGraphics()}),500)},this.onSelectButtonClicked=()=>{this.setState({initialStage:!1,resultStage:!0,selectModeActive:!0,drawModeActive:!1},(()=>{this.activateDrawOrSelectTool()}))},this.onDrawButtonClicked=()=>{this.setState({initialStage:!1,resultStage:!0,selectModeActive:!1,drawModeActive:!0},(()=>{this.activateDrawOrSelectTool()}))},this.onBackClick=()=>{this.clearAll(),this.getSelectableLayers(this.state.currentDatasource),this.setState({initialStage:!0,startChartRendering:!1,onDrawingComplete:!1,resultStage:!1,drawModeActive:!1,selectModeActive:!1})},this.clearAll=e=>{var t;this._defaultViewModel&&this._defaultViewModel.clear(),(this.state.drawModeActive||this.state.selectModeActive)&&(null===(t=this.state.currentSketchVM)||void 0===t||t.cancel()),this._deActivateAddToSelectionTool(),this.clearGraphics(),this._selectedRecordsDsId=[],this._selectedFeaturesRecords=[],!e&&this._mapView.clearSelectedFeatures(),this.clearChart()},this.clearGraphics=()=>{this._drawingLayer&&this._drawingLayer.removeAll(),this._nextPossibleSelectionLayer&&this._nextPossibleSelectionLayer.removeAll(),this._bufferLayer&&this._bufferLayer.removeAll(),this._intersectionHighlightLayer&&this._intersectionHighlightLayer.removeAll(),this.hideChartPosition()},this.clearChart=()=>{this.setState({profileResult:null,noFeaturesError:!1},(()=>{var e,i;null===(i=null===(e=this.props)||void 0===e?void 0:e.outputDataSources)||void 0===i||i.forEach((e=>{var i;null===(i=this.getOutputDataSource(e))||void 0===i||i.setStatus(t.DataSourceStatus.NotReady)}))}))},this.activateToolForNewProfile=()=>{this.clearAll(),this.setState({initialStage:!1,resultStage:!0},(()=>{this.activateDrawOrSelectTool()}))},this.onDoneButtonCLicked=()=>{let e=!1;return this._defaultViewModel.stop(),"created"!==this._defaultViewModel.state&&"selected"!==this._defaultViewModel.state||(e=!0),e?this.stopFurtherSelectingLines():this.activateDrawOrSelectTool(),e},this.stopFurtherSelectingLines=()=>{this._deActivateAddToSelectionTool(),this._nextPossibleSelectionLayer&&this._nextPossibleSelectionLayer.removeAll()},this.highlightChartPosition=e=>{this._defaultViewModel&&(this._defaultViewModel.hoveredChartPosition=e)},this.hideChartPosition=()=>{this._defaultViewModel&&(this._defaultViewModel.hoveredChartPosition=null)},this.onViewsCreate=e=>{this.setState({isMapLoaded:!0})},this.renderFrontLandingPage=()=>{var s,o,n,l;const a=this.props.config.configInfo[this.state.currentDatasource];let r=!1;return((null==a?void 0:a.hasOwnProperty("advanceOptions"))||(null===(s=null==a?void 0:a.profileSettings)||void 0===s?void 0:s.hasOwnProperty("isProfileSettingsEnabled")))&&((null==a?void 0:a.hasOwnProperty("advanceOptions"))||(null===(o=null==a?void 0:a.profileSettings)||void 0===o?void 0:o.isProfileSettingsEnabled))&&(r=!0),(0,t.jsx)("div",{tabIndex:-1,className:"h-100 w-100 d-flex align-items-center mainSection"},(0,t.jsx)("div",{tabIndex:-1,className:"adjust-cards"},(0,t.jsx)(i.Card,{tabIndex:0,"aria-label":this.nls("selectLinesDesc"),button:!0,"data-testid":"selectButton",className:(0,t.classNames)("front-cards mt-4 mb-4 shadow",this.state.updatedSelectableLayersAtRuntime.length>0&&r?"front-section":"hidden"),onClick:this.onSelectButtonClicked,onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||this.onSelectButtonClicked()}},(0,t.jsx)(i.CardBody,{className:"w-100 h-100 p-4"},(0,t.jsx)("h5",{className:"text-truncate",style:{textAlign:"center"}},this.nls("selectLinesLabel")),(0,t.jsx)("p",{title:this.nls("selectLinesDesc"),className:"m-4 userGuideInfo"},this.nls("selectLinesDesc")),(0,t.jsx)("div",{style:{textAlign:"center"}},(0,t.jsx)(i.Button,{role:"button","aria-label":this.nls("selectButtonLabel"),title:this.nls("selectButtonLabel"),size:"default",type:"secondary",className:"text-break"},(null===(n=this.props.config.generalSettings)||void 0===n?void 0:n.buttonStyle)===e.IconText&&(0,t.jsx)(t.React.Fragment,null,(0,t.jsx)(i.Icon,{size:"12",icon:Xe.selectIcon}),this.nls("selectButtonLabel")))))),(0,t.jsx)(i.Card,{tabIndex:0,"aria-label":this.nls("drawProfileDesc"),button:!0,"data-testid":"drawButton",className:(0,t.classNames)("front-cards front-section mt-4 mb-4 shadow",0!==this.state.updatedSelectableLayersAtRuntime.length&&r?"":"h-100 "),onClick:this.onDrawButtonClicked,onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||this.onDrawButtonClicked()}},(0,t.jsx)(i.CardBody,{className:"w-100 h-100 p-4"},(0,t.jsx)("h5",{className:"text-truncate",style:{textAlign:"center"}},this.nls("drawProfileLabel")),(0,t.jsx)("p",{title:this.nls("drawProfileDesc"),className:"m-4 userGuideInfo"},this.nls("drawProfileDesc")),(0,t.jsx)("div",{style:{textAlign:"center"}},(0,t.jsx)(i.Button,{role:"button","aria-label":this.nls("drawButtonLabel"),title:this.nls("drawButtonLabel"),size:"default",type:"secondary",className:"text-break"},(null===(l=this.props.config.generalSettings)||void 0===l?void 0:l.buttonStyle)===e.IconText&&(0,t.jsx)(t.React.Fragment,null,(0,t.jsx)(i.Icon,{size:"12",icon:Xe.drawIcon}),this.nls("drawButtonLabel"))))))))},this.resetToDefault=()=>{var e,t;this.buildStatsValuesAsOutput(null,null===(e=this.props.outputDataSources)||void 0===e?void 0:e[0],this.state.selectedElevationUnit,this.state.selectedLinearUnit,!1),(this.state.drawModeActive||this.state.selectModeActive)&&(null===(t=this.state.currentSketchVM)||void 0===t||t.cancel()),this._defaultViewModel&&this._defaultViewModel.clear(),this.clearGraphics(),this._displayDefaultCursor()},this._defaultConfig=this.createDefaultConfigForDataSource(),this._newFeatureSelection=!1,this.createDrawingLayers(),this._activeCurrentDs="default",this._selectableLayersAtRuntime=[],this._intersectingLayersAtRuntime=[],this._isSelectableLayersChangedAtRuntime=!1,this._defaultViewModel=null,this._selectedBufferValues=null;const c=this.props.config.configInfo[this.props.config.activeDataSource];this._selectedUnit=O(c,this.props.portalSelf),this._bufferGraphics=null,this._addedNewLayerOnMap=[],this._defaultProfileSettingsForNewAddedLayer=[],this._addedLayerAfterWidgetLoaded=!1,this._jimuLayerViewRemovedListener=null,this._prevJimuMapView=null,this._selectedRecordsDsId=[],this._selectedFeaturesRecords=[],this.state={initialStage:!0,resultStage:!1,selectModeActive:null===(o=this.props.config.generalSettings)||void 0===o?void 0:o.isSelectToolActive,addToSelectionTool:!1,drawModeActive:null===(n=this.props.config.generalSettings)||void 0===n?void 0:n.isDrawToolActive,onDrawingComplete:!1,currentDatasource:this.props.config.activeDataSource,currentSketchVM:null,jimuMapView:null,startChartRendering:!1,addedElevationLayers:null===(l=null==c?void 0:c.elevationLayersSettings)||void 0===l?void 0:l.addedElevationLayers,groundLayerId:null===(a=null==c?void 0:c.elevationLayersSettings)||void 0===a?void 0:a.groundLayerId,graphicsHighlightColor:this.props.mapSelectionHighlightColor||"#00ffff",selectionModeOptions:null===(d=null==c?void 0:c.profileSettings)||void 0===d?void 0:d.selectionModeOptions,profileResult:null,selectedLinearUnit:this._selectedUnit[1],selectedElevationUnit:this._selectedUnit[0],noFeaturesError:!1,profileLineLayers:[],lineLayersNotFound:!(this.canShowSelectAndDrawOptions(c)&&this.canShowProfilingForBackward(c)&&0!==c.profileSettings.layers.length||this.canShowSelectAndDrawOptions(c)&&!this.canShowProfilingForBackward(c)),viewModelErrorState:!1,profileErrorMsg:"",noGraphicAfterFirstSelection:!1,onWidgetLoadShowLoadingIndicator:!0,loadingIndicator:!1,nextPossibleloadingIndicator:!1,selectedFeatureRecord:null,intersectionResult:null,chartDataUpdateTime:0,isMapLoaded:!1,layersLoaded:!1,dsToGetSelectedOnLoad:"",newAddedLayer:[],profileSettingsForNewAddedLayer:[],updatedSelectableLayersAtRuntime:[]}}render(){var e,n,l,a,r,d;const c=this.renderFrontLandingPage();let h;const u=this.props.useMapWidgetIds&&this.props.useMapWidgetIds[0];if(this.props.hasOwnProperty("useMapWidgetIds")&&this.props.useMapWidgetIds&&1===this.props.useMapWidgetIds.length&&(h=(0,t.jsx)(s.JimuMapViewComponent,{useMapWidgetId:this.props.useMapWidgetIds[0],onActiveViewChange:this.activeViewChangeHandler.bind(this),onViewsCreate:this.onViewsCreate})),!u)return this.resetToDefault(),(0,t.jsx)(i.WidgetPlaceholder,{icon:Xe.elevationIcon,widgetId:this.props.id,"data-testid":"widgetPlaceholder",message:this.props.intl.formatMessage({id:"_widgetLabel",defaultMessage:this.nls("_widgetLabel")})});const p=[];let v=null;const g=this.props.config.configInfo[this.state.currentDatasource];if(this.state.dsToGetSelectedOnLoad){if(g&&((null==g?void 0:g.hasOwnProperty("advanceOptions"))||(null===(e=null==g?void 0:g.profileSettings)||void 0===e?void 0:e.hasOwnProperty("isProfileSettingsEnabled"))&&(null===(n=null==g?void 0:g.profileSettings)||void 0===n?void 0:n.hasOwnProperty("isCustomizeOptionEnabled"))))if(!(null==g?void 0:g.advanceOptions)||(null===(l=null==g?void 0:g.profileSettings)||void 0===l?void 0:l.isProfileSettingsEnabled)&&!(null===(a=null==g?void 0:g.profileSettings)||void 0===a?void 0:a.isCustomizeOptionEnabled)){const e=C(this.state.currentDatasource);null==e||e.forEach((e=>{e&&e.getLayerDefinition()&&e.getLayerDefinition().geometryType&&"esriGeometryPolyline"===e.getLayerDefinition().geometryType&&(p.push({dataSourceId:e.id,mainDataSourceId:e.id,rootDataSourceId:this.state.currentDatasource,fields:[]}),v=null==p?void 0:p.filter((e=>e.dataSourceId===this.state.dsToGetSelectedOnLoad)))}))}else v=null===(r=this.props.useDataSources)||void 0===r?void 0:r.filter((e=>e.dataSourceId===this.state.dsToGetSelectedOnLoad));v=v.length>0?v[0]:null}return(0,t.jsx)("div",{css:o(this.props.theme),className:"jimu-widget"},(0,t.jsx)("div",{className:"widget-elevation-profile"},!this.state.layersLoaded&&(0,t.jsx)(t.React.Fragment,null,(0,t.jsx)(i.Loading,{type:i.LoadingType.Donut}),(0,t.jsx)("p",{className:"loading-text pt-2"},this.nls("mapLoadingMsg"))),this.state.layersLoaded&&this.state.onWidgetLoadShowLoadingIndicator&&this.state.isMapLoaded&&(0,t.jsx)(i.Loading,{type:i.LoadingType.Donut}),h,v&&(0,t.jsx)(t.DataSourceComponent,{useDataSource:v,onDataSourceInfoChange:this.onDataSourceInfoChange,widgetId:this.props.id}),!this.state.onWidgetLoadShowLoadingIndicator&&this.state.initialStage&&c,!this.state.onWidgetLoadShowLoadingIndicator&&this.state.resultStage&&(0,t.jsx)(Se,{theme:this.props.theme,intl:this.props.intl,widgetId:this.props.id,isMobile:this.props.browserSizeMode===t.BrowserSizeMode.Small,displayLoadingIndicator:this.state.loadingIndicator||this.state.nextPossibleloadingIndicator,activeDataSource:this.state.currentDatasource,commonDsGeneralSettings:this.props.config.generalSettings,defaultConfig:this._defaultConfig,activeDatasourceConfig:this.props.config.configInfo[this.state.currentDatasource],profileResult:this.state.profileResult,intersectionResult:this.state.intersectionResult,visibleGroundProfileStats:null===(d=this._defaultViewModel)||void 0===d?void 0:d.visibleProfiles,selectMode:this.state.selectModeActive,drawMode:this.state.drawModeActive,onDrawingComplete:this.state.onDrawingComplete,isNewSegmentsForSelection:this.state.addToSelectionTool,noGraphicAfterFirstSelection:this.state.noGraphicAfterFirstSelection,chartRender:this.state.startChartRendering,noFeaturesFoundError:this.state.noFeaturesError,onNavBack:this.onBackClick,doneClick:this.onDoneButtonCLicked,activateDrawSelectToolForNewProfile:this.activateToolForNewProfile,selectableLayersRuntime:this.selectableLayersAvailableAtRuntime,intersectingLayersRuntime:this.intersectingLayersAvailableAtRuntime,chartPosition:this.highlightChartPosition,hideChartPosition:this.hideChartPosition,buildOutputStatistics:this.buildOutputStatistics,intersectingBufferRuntime:this.onBufferChange,drawingLayer:this._drawingLayer,intersectionHighlightLayer:this._intersectionHighlightLayer,jimuMapView:this.state.jimuMapView,viewModelErrorState:this.state.viewModelErrorState,profileErrorMsg:this.state.profileErrorMsg,chartDataUpdateTime:this.state.chartDataUpdateTime,currentPageId:this.props.currentPageId,addedElelvationProfileLayers:this.state.addedElevationLayers,groundLayerId:this.state.groundLayerId,newAddedLayer:this.state.newAddedLayer,profileSettingsForNewAddedLayer:this.state.profileSettingsForNewAddedLayer})))}}qe.versionManager=He,qe.mapExtraStateProps=(e,t)=>{var i,s,o,n,l,a,r,d;return{appMode:null===(i=e.appRuntimeInfo)||void 0===i?void 0:i.appMode,browserSizeMode:e.browserSizeMode,selectedFeatureRecords:null===(s=null==t?void 0:t.mutableStateProps)||void 0===s?void 0:s.selectedFeatureRecords,currentPageId:null===(o=e.appRuntimeInfo)||void 0===o?void 0:o.currentPageId,mapSelectionHighlightColor:null===(d=null===(r=null===(l=null===(n=e.appConfig)||void 0===n?void 0:n.widgets)||void 0===l?void 0:l[null===(a=t.useMapWidgetIds)||void 0===a?void 0:a[0]])||void 0===r?void 0:r.config)||void 0===d?void 0:d.selectionHighlightColor}};const Ke=qe;function Ze(e){A.p=e}})(),E})())}}}));