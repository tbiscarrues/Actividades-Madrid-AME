System.register(["jimu-core","jimu-ui","jimu-arcgis","esri/views/3d/webgl","jimu-ui/advanced/map"],(function(e,t){var i={},s={},n={},r={},a={};return{setters:[function(e){i.BaseVersionManager=e.BaseVersionManager,i.Immutable=e.Immutable,i.React=e.React,i.appActions=e.appActions,i.classNames=e.classNames,i.css=e.css,i.getAppStore=e.getAppStore,i.jsx=e.jsx,i.lodash=e.lodash,i.utils=e.utils},function(e){s.Button=e.Button,s.Dropdown=e.Dropdown,s.DropdownButton=e.DropdownButton,s.DropdownItem=e.DropdownItem,s.DropdownMenu=e.DropdownMenu,s.Icon=e.Icon,s.Nav=e.Nav,s.NumericInput=e.NumericInput,s.Progress=e.Progress,s.Select=e.Select,s.Slider=e.Slider,s.Tooltip=e.Tooltip,s.WidgetPlaceholder=e.WidgetPlaceholder,s.defaultMessages=e.defaultMessages},function(e){n.JimuMapViewComponent=e.JimuMapViewComponent,n.loadArcGISJSAPIModules=e.loadArcGISJSAPIModules},function(e){r.fromRenderCoordinates=e.fromRenderCoordinates,r.toRenderCoordinates=e.toRenderCoordinates},function(e){a.DrawingElevationMode3D=e.DrawingElevationMode3D,a.JimuDraw=e.JimuDraw,a.JimuDrawCreationMode=e.JimuDrawCreationMode}],execute:function(){e((()=>{var e={29316:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20"><path fill="#000" fill-rule="evenodd" d="m20 1-3.803 14-7.38-2.184 2.796-3.497-4.711 2.965L0 10.279zm-1.605 1.864-15.519 7.2 3.856 1.12L16.24 5.2l-5.665 7.084 4.869 1.44z" clip-rule="evenodd"></path><path fill="#000" d="m8.8 14 3 .695L8.8 18z"></path></svg>'},93303:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M9.438.994c.213 0 .397.146.44.35q.227 1.084.316 1.852.562.242 1.048.599l1.728-.676a.455.455 0 0 1 .556.188l1.42 2.394a.43.43 0 0 1-.091.547 22 22 0 0 1-1.49 1.194q.03.27.03.552 0 .32-.038.63l1.465 1.12a.43.43 0 0 1 .111.563l-1.42 2.394a.454.454 0 0 1-.53.197 23 23 0 0 1-1.807-.66q-.49.35-1.055.586l-.263 1.794a.446.446 0 0 1-.445.376H6.574a.446.446 0 0 1-.44-.35 21 21 0 0 1-.317-1.853 5.3 5.3 0 0 1-1.047-.598l-1.728.675a.455.455 0 0 1-.556-.187l-1.42-2.395a.43.43 0 0 1 .091-.546q.85-.735 1.49-1.194a5.167 5.167 0 0 1 .008-1.183L1.19 6.243a.43.43 0 0 1-.112-.562l1.42-2.395a.455.455 0 0 1 .531-.196q1.078.35 1.807.66c.324-.233.679-.43 1.056-.587l.262-1.794A.446.446 0 0 1 6.6.994zm-.365 1H6.985l-.28 1.866-.467.19q-.353.144-.672.34l-.207.136-.42.293-.476-.197q-.492-.205-1.169-.433l-.221-.074-1.045 1.719L3.59 6.999l-.06.479a4 4 0 0 0-.021.816l.014.144.058.492-.419.294q-.433.304-.979.746l-.177.145 1.043 1.72 1.845-.703.406.29q.307.219.645.384l.228.103.474.199.059.49q.06.507.19 1.177l.043.219h2.088l.282-1.867.466-.19q.354-.144.672-.34l.207-.136.419-.293.476.198q.495.204 1.17.433l.22.072 1.044-1.718-1.56-1.165.06-.479a4 4 0 0 0 .02-.815l-.013-.144-.06-.492.42-.295a18 18 0 0 0 .98-.746l.176-.146-1.043-1.72-1.844.705-.406-.29a4.5 4.5 0 0 0-.646-.385l-.228-.103-.474-.199-.058-.49q-.049-.405-.14-.916zm-1.067 3a3 3 0 1 1 0 6 3 3 0 0 1 0-6m0 1a2 2 0 1 0 0 4 2 2 0 0 0 0-4" clip-rule="evenodd"></path></svg>'},24362:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="m13.838 3-1.94-1.616.641-.768L16 3.5l-3.46 2.884-.641-.768L13.838 4H3.37C2.061 4 1 5.191 1 6.5S2.061 9 3.37 9h9.25C14.487 9 16 10.133 16 12s-1.513 3-3.38 3H1v-1h11.62c1.314 0 2.38-.686 2.38-2s-1.066-2-2.38-2H3.37C1.509 10 0 8.361 0 6.5S1.509 3 3.37 3z"></path></svg>'},3981:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M8.793 1.14a.984.984 0 0 1 1.32-.085l.094.085 5.5 5.624c.36.368.388.948.083 1.35l-.083.096-6.5 6.646a1 1 0 0 1-.576.291l-.131.009h-4a1 1 0 0 1-.608-.21l-.099-.09-3.5-3.579a1.04 1.04 0 0 1-.083-1.35l.083-.096zm.707.706-8.492 8.685q-.011.012-.007.032l.007.015 3.497 3.577h3.989l6.498-6.644c.007-.008.01-.022.007-.033l-.007-.015zM3.006 10.19l1.838-1.85 3.922 4.107.005.01q.003.016-.005.025l-.413.358h-2.85l-2.497-2.615L3 10.214q-.003-.015.005-.024" clip-rule="evenodd"></path></svg>'},7835:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M.438 1C.196 1 0 1.224 0 1.5s.196.5.438.5h15.125c.241 0 .437-.224.437-.5s-.196-.5-.437-.5zM0 7.5c0-.276.196-.5.438-.5h15.125c.241 0 .437.224.437.5s-.196.5-.437.5H.438C.196 8 0 7.776 0 7.5M0 13.5c0-.276.196-.5.438-.5h15.125c.241 0 .437.224.437.5s-.196.5-.437.5H.438C.196 14 0 13.776 0 13.5"></path></svg>'},40904:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M5 1H4v14h1zm7 0h-1v14h1z" clip-rule="evenodd"></path></svg>'},97408:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="m2 1 12 7-12 7zm9.983 6.999L3 2.723v10.553z" clip-rule="evenodd"></path></svg>'},50313:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="m9.489.072.848.29-.989 2.71-.784-.465zM12.594 2.974l-2.44 1.128.25.85 2.579-1.194zM2.04 7.854l.39.784 2.578-1.191-.529-.72zM5.554 2.862 4.58.896 5.392.52l.974 1.966zM4.272 4.591l-2.624-.894-.299.82 2.805.957z"></path><path fill="#000" fill-rule="evenodd" d="m6.3 3.383 9 6.285h-3.874l2.315 4.421-2.686 1.294-2.373-4.498L6.3 14.009zM7.299 5.3v5.748l1.537-2.014 2.653 5.03.886-.427-2.601-4.97h2.347z" clip-rule="evenodd"></path></svg>'},39815:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M16 1a1 1 0 1 1-2 0 1 1 0 0 1 2 0m-4 2a1 1 0 1 0 0-2 1 1 0 0 0 0 2m-1.812 10L11 4 3 9.328l4.438.337zM2 15a1 1 0 1 1-2 0 1 1 0 0 1 2 0m2 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2m3-3a1 1 0 1 1-2 0 1 1 0 0 1 2 0" clip-rule="evenodd"></path></svg>'},74919:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M7 2h2a2 2 0 0 1 2 2v7.817l-3 2.812-3-2.812V4a2 2 0 0 1 2-2m5 2v8.25L8 16l-4-3.75V4a3 3 0 0 1 3-3h2a3 3 0 0 1 3 3M9 6a1 1 0 1 1-2 0 1 1 0 0 1 2 0m1 0a2 2 0 1 1-4 0 2 2 0 0 1 4 0" clip-rule="evenodd"></path></svg>'},86058:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M14.582 5 11 10.949V12H9v-1.274L5.316 7h-.515L2 12.383V14H0v-2h1.073L4 6.374V5h2v1.27L9.688 10h.716L14 4.029V3h2v2z"></path></svg>'},26900:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M7.734.46 2.86 5.377v-2.99L1 0zM1.764 2.99A8 8 0 1 0 8.956.057l-.743.946a7 7 0 1 1-6.107 3.22l-.094-.992zM9 8a1 1 0 1 1-2 0 1 1 0 0 1 2 0" clip-rule="evenodd"></path></svg>'},11417:e=>{"use strict";e.exports=r},62686:e=>{"use strict";e.exports=n},79244:e=>{"use strict";e.exports=i},14321:e=>{"use strict";e.exports=s},48993:e=>{"use strict";e.exports=a}},t={};function o(i){var s=t[i];if(void 0!==s)return s.exports;var n=t[i]={exports:{}};return e[i](n,n.exports,o),n.exports}o.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return o.d(t,{a:t}),t},o.d=(e,t)=>{for(var i in t)o.o(t,i)&&!o.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.p="";var l={};return o.p=window.jimuConfig.baseUrl,(()=>{"use strict";o.r(l),o.d(l,{__set_webpack_public_path__:()=>hi,default:()=>li});var e,t,i,s,n,r,a,h=o(79244),c=o(14321),d=o(62686),u=o(11417);!function(e){e.Rotate="ROTATE",e.Path="PATH",e.Route="ROUTE"}(e||(e={})),function(e){e.SLOW="slow",e.DEFAULT="default",e.FAST="fast"}(t||(t={})),function(e){e.Point="POINT",e.MapCenter="MAPCENTER"}(i||(i={})),function(e){e.CW="CW",e.CCW="CCW"}(s||(s={})),function(e){e.Smoothed="CURVED",e.RealPath="LINE"}(n||(n={})),function(e){e.Forward="FORWARD",e.Backward="BACKWARD"}(r||(r={})),function(e){e.Horizontal="HORIZONTAL",e.Vertical="VERTICAL",e.Palette="PALETTE"}(a||(a={}));const p="Please select at least one fly style.",g="Rotate fly",v="Fly along path",m="Plan routes",f="Draw a point",y="Draw a path",w="Select a feature",M="Clear drawing or selection",C="Around Map Center",S="Routes",P="Select a route";var b,I=function(e,t,i,s){return new(i||(i=Promise))((function(n,r){function a(e){try{l(s.next(e))}catch(e){r(e)}}function o(e){try{l(s.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,o)}l((s=s.apply(e,t||[])).next())}))};class x{constructor(){this.symbolJsonUtils=null,this.getDefaultPointSymbol=e=>this.symbolJsonUtils.fromJSON({type:"PointSymbol3D",symbolLayers:[{type:"Icon",material:{color:e},size:12,outline:{color:[255,255,255],size:.75}}],verticalOffset:{screenLength:5,minWorldLength:5,maxWorldLength:10},callout:{type:"line",color:[255,255,255],size:2,border:{color:[50,50,50]}}}),this.getDefaultLineSymbol=e=>this.symbolJsonUtils.fromJSON({type:"LineSymbol3D",symbolLayers:[{type:"Line",material:{color:e,transparency:50},join:"round",cap:"round",size:2.25}]})}setup(){return I(this,void 0,void 0,(function*(){return yield(0,d.loadArcGISJSAPIModules)(["esri/symbols/support/jsonUtils"]).then((e=>I(this,void 0,void 0,(function*(){[this.symbolJsonUtils]=e})))),this}))}}!function(e){e[e.Default=0]="Default",e[e.Custom=1]="Custom"}(b||(b={}));class A{constructor(e){return this.update(e)}update(e){const{graphics:t,isPicked:i}=e;return this.setGraphics(t),this.isPicked=i,this.symbolType=b.Default,this}setGraphics(e){this.graphics=e}getGraphics(){return this.graphics}getMainGraphic(){return this.graphics?this.graphics[0]:null}getConfig(){var e;const t={graphics:null,isPicked:this.isPicked,symbolType:b.Default};return t.graphics=null===(e=this.graphics)||void 0===e?void 0:e.map((e=>{const t=e.clone();if(t.symbol=null,t.toJSON)return t.toJSON()})),t}}const L={ControllerStyleSize:{[a.Horizontal]:{w:262,h:44},[a.Palette]:{w:146,h:94}},SPEED:{MIN:0,MAX:1,MULTIPLIER:8,DECIMAL:3,DEFAULT_SPEED:50},ALT:{MIN:0,MAX:800,STEP:10},TILT:{MIN:0,MAX:90,STEP:1},TIME:{MIN:0},CALCULATED_VALUE_ROUNDED:{ANGLE:0,ELEV:1,TIME:1}};function G(e,t,i){const s=J(t)?t:1,n=[];return u.toRenderCoordinates(i,e,0,null,n,0,s),n}function T(e,t,i){const s=J(t)?t:1,n=[];return u.fromRenderCoordinates(i,e,0,n,0,null,s),n}function R(e){return e*Math.PI/180}function j(e){return 180*e/Math.PI}function D(e,t){const i=t[0]-e[0],s=t[1]-e[1],n=t[2]-e[2],r=i*i+s*s+n*n;return Math.sqrt(r)}function F(e,t,i){const s=[];return s[0]=(t[0]-e[0])*i+e[0],s[1]=(t[1]-e[1])*i+e[1],s[2]=(t[2]-e[2])*i+e[2],s}function V(e,t,i,s,n,r,a){const o=e,l=null!=t?t:null,h=null!=i?i:null;if(null===l||null===h)return 0;const c=n.create();s.subtract(c,l,o);const d=n.create();s.subtract(d,h,l);const u=n.create();r.renderCoordsHelper.worldUpAtPosition(l,u);return j(a.angle(c,d,u))}function O(e,t){return k(t.groundView.elevationSampler.queryElevation(e),t)}function k(e,t){var i,s,n;const r=null!==(n=null===(s=null===(i=t.groundView)||void 0===i?void 0:i.elevationSampler)||void 0===s?void 0:s.noDataValue)&&void 0!==n?n:34028234663852886e21;if(null==e?void 0:e.hasZ){if("point"===e.type){e.z===r&&(e.z=0)}if("polyline"===e.type){const t=e.paths[0];t[0][2]===r&&t.forEach((e=>{e[2]=0}))}}return e}function N(e){let t=0;for(let i=0,s=e.length;i<s;i++){const s=e[i];J(s)&&!1!==s.isInUse&&t++}return t}function E(e,t){const i=L.SPEED.MIN,s=L.SPEED.MAX,n=L.SPEED.MULTIPLIER;let r;const a=(s-i)/2;return e<a?r=1/((a-e)/a*n):(r=(e-a)/(s-a)*n,0===r&&(r=1)),parseFloat(r.toFixed(J(t)?t:L.SPEED.DECIMAL))}function U(e,t){return(i=Number(e),_((null==i?void 0:i.toFixed)?parseFloat(i.toFixed(L.CALCULATED_VALUE_ROUNDED.ANGLE)):NaN)).toString()+" "+t;var i}function _(e){return null===e||isNaN(e)?0:e}function H(e,t){const i=null==e?void 0:e.find((e=>e.idx===t.routeUuid));return i}function B(e,t){var i;const s=H(e,t);return null===(i=null==s?void 0:s.records)||void 0===i?void 0:i.find((e=>e.idx===t.recordUuid))}function z(e,t,i){const s=H(e,t);return null==s?void 0:s.records[i]}function W(e){return(null==e?void 0:e.startsWith("fly__"))?e.replace("fly__",""):e}function J(e){return null!=e}var $;!function(e){e[e.Choose3DMap=0]="Choose3DMap",e[e.ConfigError=1]="ConfigError"}($||($={}));class q{constructor(e){this.getDefaultError=()=>this.chooseMapTip,this.isError=()=>this.isNoMapId()||this.isNoScene()||this.isNoModeInSetting(),this.setError=e=>{e!==this.widget.state.errorTip&&this.widget.setState({errorTip:e})},this.setErrorByType=e=>{e===$.Choose3DMap&&this.setError(this.chooseMapTip)},this.isNoScene=()=>!J(this.widget.state.jimuMapView),this.isNoModeInSetting=()=>N(this.widget.props.config.itemsList)<1,this.isNoMapId=()=>!J(this.widget.props.useMapWidgetIds)||!J(this.widget.props.useMapWidgetIds[0]),this.checkErrorInConfig=()=>{this.isNoScene()||this.isNoMapId()?this.setError(this.chooseMapTip):this.isNoModeInSetting()?this.setError(this.configErrorTip):J(this.widget.jimuMapView)&&this.setError("")},this.widget=e.widget,this.chooseMapTip=this.widget.props.intl.formatMessage({id:"select3DMapHint",defaultMessage:c.defaultMessages.select3DMapHint}),this.configErrorTip=this.widget.props.intl.formatMessage({id:"configErrorTip",defaultMessage:p})}}function Z(e){const t=e.sys.color.surface.paper,i={color:e.sys.color.divider.secondary,width:"1px"};return h.css`
    position: relative;
    border: ${i.width} solid ${i.color};

    .bar {
      display: flex;
      background-color: ${t};

      .btns, dropdowns{
        width: 32px;
        height: 32px;

        .caret-icon {
          margin-left: 0; /* overwrite dropdown's default style ,#22450 */
        }
      }
      .btns {
        margin: 5px;
        border-radius: 0;
        padding: 0;
      }

      .speed-controller{
        margin: 0 8px;
      }

      .progress-bar-wrapper {
        /*display: flex;*/
        position: absolute;
        width: 100%;
        bottom: 0px;
      }
      .items {
        display: flex;
        position: relative;
      }
      .items .item {
        display: flex;
        background: ${t};
      }
      /*.items .btn .jimu-icon{
        margin: 0;
      }*/
      .separator-line{
        width: 2px;
        margin: 4px 1px;
        border-right: ${i.width} solid ${i.color};
      }
      .speed-wrapper{
        width: 214px;
      }

      .one-fly-mode {
        .speed-wrapper{
          width: 168px;
        }
      }
    }
    .bar .hide,
    .bar .items.hide {
      display: none;
    }
    `}function X(e,t){let i="hide";return e&&(i=""),t&&(i+=" one-fly-mode"),i}function Q(e){let t="";return e&&(t="hide"),t}class Y extends h.React.PureComponent{renderSeparator(){return(0,h.jsx)("div",{className:"separator-line"})}render(){return(0,h.jsx)("div",{css:Z(this.props.theme),className:"fly-wrapper  d-flex"},(0,h.jsx)(c.Nav,{navbar:!0,className:"bar"},this.props.isAroundMapCenterMode&&(0,h.jsx)("div",{className:"items d-flex flex-row justify-content-around"},!this.props.isOnly1FlyModeInUse&&(0,h.jsx)("div",{className:"setting-btns-wrapper items "},(0,h.jsx)("div",{className:"item"},this.props.flyStyleContent,this.renderSeparator())),(0,h.jsx)("div",{className:"d-flex"},(0,h.jsx)("div",{className:"item"},this.props.playStateContent))),!this.props.isAroundMapCenterMode&&(0,h.jsx)("div",{className:"items d-flex flex-row justify-content-around"},(0,h.jsx)("div",{className:"d-flex"},(0,h.jsx)("div",{className:"setting-btns-wrapper items "+Q(this.props.isPlaying)},!this.props.isOnly1FlyModeInUse&&(0,h.jsx)("div",{className:"item"},this.props.flyStyleContent,this.renderSeparator()),!this.props.isRouteMode&&(0,h.jsx)(h.React.Fragment,null,(0,h.jsx)("div",{className:"item"},(0,h.jsx)("div",{className:"d-flex"},this.props.graphicInteractionManager)),(0,h.jsx)("div",{className:"item"},this.props.liveViewSettingContent)),this.props.isRouteMode&&(0,h.jsx)(h.React.Fragment,null,this.props.graphicInteractionManager,this.props.routeListContent)),(0,h.jsx)("div",{className:X(this.props.isPlaying,this.props.isOnly1FlyModeInUse)},(0,h.jsx)("div",{className:"speed-wrapper h-100"},this.props.speedController))),(0,h.jsx)("div",{className:"d-flex"},(0,h.jsx)("div",{className:"item"},this.renderSeparator(),this.props.playStateContent)),(0,h.jsx)("div",{className:"progress-bar-wrapper "+X(this.props.isPlaying,this.props.isOnly1FlyModeInUse)},this.props.progressBar))))}}function K(e){const t=e.sys.color.surface.paper,i={color:e.sys.color.divider.secondary,width:"1px"},s=48,n=32,r=144,a="left",o="right";return h.css`
    .plan-route-mode {
      margin-top: ${-44}px;
    }

    .palette-wrapper {
      position: relative;
      width: ${r}px;
      height: ${92}px;

      .hide{
        display: none;
      }

      .btns,
      .dropdowns{
        position: absolute;
        width: ${n}px;
        height: ${n}px;
        border-radius: 50%;
        padding: 0;

        .icon-btn-sizer { /* fixed UI size for dot in dropdown-btn ,#10356 */
          min-width: 22px;
          min-height: 22px;

          .dropdown-button-content { /* supports off panel in controller ,#21681 */
            text-align: center;
          }
        }
      }
      .btns:not([aria-expanded="true"]) {
        border: ${i.width} solid ${i.color};
      }

      .btns:not(.active),
      .dropdowns {
        background-color: ${t}; /* for btn style update ,#22451 */
      }

      .play-btn{
        width: ${s}px;
        height: ${s}px;
        bottom: 0;
        ${a}: ${48}px;
      }
      .draw-btn{
        ${a}: 16px;
        top: 16px;
      }
      .pick-btn{
        top: 0;
        ${a}: ${56}px;
      }
      .clear-btn{
        ${o}: 16px;
        top: 16px;
      }

      .flystyle-btn{
        ${a}: 0;
        bottom: ${8}px;
      }
      .routes-dropdown,
      .liveview-btn{
        ${o}: 0;
        bottom: ${8}px;
      }

      .progress-bar-wrapper{
        position: absolute;
        width: ${54}px;
        height: ${54}px;
        ${a}: ${45}px;
        bottom: 20px;
      }

      .speed-controller-btn{
        position: absolute;
        width: ${40}px;
        height: ${16}px;
        bottom: 0;
        ${a}: 78px;
        border: ${i.width} solid ${i.color};
        border-radius: 10px;
        background-color: ${t};
      }

      .speed-controller-text{
        font-size: 10px;
        padding: 0;

        .icon-btn-sizer{
          min-height: 0;
        }
      }

      {/* non-AroundMapCenterMode */}
      .only-1-fly-item {
        .draw-btn{
          ${a}: 0px;
          top: auto;
          bottom: ${8}px;
        }

        .pick-btn{
          top: 8px;
          ${a}: ${30}px;
        }
        .clear-btn{
          ${o}: ${30}px;
          top: 8px;
        }

        .routes-dropdown,
        .liveview-btn{
          ${o}: 0;
          bottom: ${8}px;
        }
      }
    }`}function ee(e){let t=" hide ";return e&&(t=""),t}function te(e){let t="";return e&&(t=" hide "),t}class ie extends h.React.PureComponent{render(){return(0,h.jsx)("div",{css:K(this.props.theme),className:"fly-wrapper  d-flex"},(0,h.jsx)("div",{className:"palette-wrapper "+(this.props.isInController?"m-2 ":" ")+(this.props.isAroundMapCenterMode?"around-map-center":"")},this.props.isAroundMapCenterMode&&(0,h.jsx)(h.React.Fragment,null,!this.props.isOnly1FlyModeInUse&&(0,h.jsx)("div",null,this.props.flyStyleContent),this.props.playStateContent),!this.props.isAroundMapCenterMode&&(0,h.jsx)("div",{className:"palette-wrapper "+(this.props.isOnly1FlyModeInUse?"only-1-fly-item":"")},(0,h.jsx)("div",{className:"progress-bar-wrapper"+ee(this.props.isPlaying)},this.props.progressBar),(0,h.jsx)("div",{className:te(this.props.isPlaying)},this.props.flyStyleContent,!this.props.isRouteMode&&(0,h.jsx)(h.React.Fragment,null,this.props.graphicInteractionManager,this.props.liveViewSettingContent),this.props.isRouteMode&&(0,h.jsx)(h.React.Fragment,null,this.props.graphicInteractionManager,this.props.routeListContent)),this.props.playStateContent,(0,h.jsx)("div",{className:ee(this.props.isPlaying)},this.props.speedController))))}}function se(e){return h.css`
  padding: 5px 10px;
  border: 1px solid ${e.ref.palette.neutral[500]};

  .dropdown-items{
    padding: 10px;
  }
  .dropdown-item{
    padding: 5px 0;
  }
  .dropdown-item-title{
    font-size: 13px;
    padding-bottom:5px;
  }

  .dropdown-item-comment{
    font-style:italic;
    font-size: 12px;
    color: ${e.ref.palette.neutral[600]};
    letter-spacing: 0;
  }

  .setting-altitude-separator{
    margin: 0 8px 0 4px;
  }

  .alt-wrapper {
    align-items: center;
    font-size: 13px;
  }
  .alt-input {
    width: 60px
  }
  `}var ne=o(7835),re=o.n(ne),ae=function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(s=Object.getOwnPropertySymbols(e);n<s.length;n++)t.indexOf(s[n])<0&&Object.prototype.propertyIsEnumerable.call(e,s[n])&&(i[s[n]]=e[s[n]])}return i};const oe=e=>{const t=window.SVG,{className:i}=e,s=ae(e,["className"]),n=(0,h.classNames)("jimu-icon jimu-icon-component",i);return t?h.React.createElement(t,Object.assign({className:n,src:re()},s)):h.React.createElement("svg",Object.assign({className:n},s))};class le extends h.React.PureComponent{constructor(t){super(t),this.togglePopup=()=>{this.setState({isPopupOpen:!this.state.isPopupOpen})},this.handleActivedRouteChangeBySelect=e=>{const t=e.target.value;this.handleActivedRouteChange(t)},this.handleActivedRouteChange=e=>{this.props.onActivedRouteChange(e)},this.getStyle=()=>h.css`
      .routes-dropdown {
        width: 170px;

        .jimu-dropdown-button,
        .jimu-dropdown-button:hover{
          height: 100%;
          border: none;
        }
      }
      `,this._getItemByActivedItemUuid=()=>{let t=null;return J(this.props.activatedItemUuid)&&J(this.props.itemsList)&&(t=this.props.itemsList.find((t=>t.config.uuid===this.props.activatedItemUuid&&e.Route===t.config.name))),t},this.getActivedRouteName=e=>{const t=H(null==e?void 0:e.routes,{routeUuid:this.props.activedRouteUuid});return null==t?void 0:t.displayName},this.state={isPopupOpen:!1}}componentDidUpdate(e,t){const i=!e.graphicInteractionManagerRef&&!!this.props.graphicInteractionManagerRef;if(!(e.itemsList!==this.props.itemsList||i))return;const s=this._findFirstInUseRoute(this._getRoutesConfig());s&&this.handleActivedRouteChange(s.idx)}getRouteItemStyle(){return h.css`
      .route-item {
        max-width: 120px;
        text-overflow: ellipsis;
        overflow: hidden;
      }
    `}render(){const{isRouteMode:e,isEnable:t,layout:i}=this.props,s=this.props.intl.formatMessage({id:"plannedRoutesTip",defaultMessage:S}),n=this._getItemByActivedItemUuid(),r=null==n?void 0:n.config,o=this.getActivedRouteName(r),l=this.props.intl.formatMessage({id:"Select a route",defaultMessage:P}),d=this._getRoutesConfig();return e&&(0,h.jsx)("div",{className:"h-100 item",css:this.getStyle()},i===a.Palette&&(0,h.jsx)(c.Dropdown,{isOpen:this.state.isPopupOpen,disabled:!t,toggle:this.togglePopup,activeIcon:!0,className:"btns routes-dropdown dropdowns"},(0,h.jsx)(c.DropdownButton,{icon:!0,className:"dropdown-btn",type:"tertiary",arrow:!1,title:null!=o?o:s,"aria-label":l},(0,h.jsx)(oe,null)),(0,h.jsx)(c.DropdownMenu,{showArrow:!0,css:se(this.props.theme)},d.map(((e,t)=>e.isInUse&&(0,h.jsx)("div",{key:t},(0,h.jsx)(c.DropdownItem,{title:e.displayName,onClick:()=>{this.handleActivedRouteChange(e.idx)},active:this.props.activedRouteUuid===e.idx,"aria-pressed":this.props.activedRouteUuid===e.idx},(0,h.jsx)("div",{css:this.getRouteItemStyle()},(0,h.jsx)("div",{className:"mx-2 route-item"},e.displayName)))))))),i===a.Horizontal&&(0,h.jsx)(h.React.Fragment,null,(0,h.jsx)(c.Select,{onChange:this.handleActivedRouteChangeBySelect,placeholder:null!=o?o:s,"aria-label":l,className:"routes-dropdown",disabled:!t,useFirstOption:!0},d.map(((e,t)=>e.isInUse&&(0,h.jsx)("option",{key:t,label:e.displayName,title:e.displayName,value:e.idx,selected:this.props.activedRouteUuid===e.idx},(0,h.jsx)("div",{css:this.getRouteItemStyle()},(0,h.jsx)("div",{className:"route-item"},e.displayName))))))))}_getRoutesConfig(){const e=this._getItemByActivedItemUuid(),t=null==e?void 0:e.config;return null==t?void 0:t.routes}_findFirstInUseRoute(e){return e.find((e=>!!e.isInUse))}}class he{constructor(e){this.GraphicsLayer=null,this.Point=null,this.clearAll=()=>{J(this.auxGraphicsLayer)&&this.auxGraphicsLayer.removeAll(),J(this.auxMovingObjLayer)&&this.auxMovingObjLayer.removeAll()},this.deposeMoving=()=>{this.auxMovingObjLayer.removeAll()},this.drawPoint=(e,t)=>{const i=J(t)?t:"darkgreen",s=new this.Graphic({geometry:e,symbol:{type:"point-3d",symbolLayers:[{type:"icon",size:12,resource:{primitive:"circle"},material:{color:i},outline:{color:"limegreen"}}]}});return this.auxMovingObjLayer.add(s),s},this.drawPointGL=(e,t)=>{const i=T(e,1,this.sceneView),s=new this.Point({x:i[0],y:i[1],z:i[2],spatialReference:this.sceneView.spatialReference});s.z<100&&(s.z=100);const n=J(t)?t:"darkgreen",r=new this.Graphic({geometry:s,symbol:{type:"point-3d",symbolLayers:[{type:"icon",size:12,resource:{primitive:"circle"},material:{color:n},outline:{color:"limegreen"}}]}});return this.auxMovingObjLayer.add(r),r},this.drawLine=(e,t)=>{const i=J(t)?t:"lightblue",s=new this.Graphic({geometry:{type:"polyline",paths:e,spatialReference:this.sceneView.spatialReference},symbol:{type:"line-3d",symbolLayers:[{type:"line",material:{color:i},size:3}]}});return this.auxGraphicsLayer.add(s),s},this.drawLineXY=(e,t)=>{const i=[];for(let t=0,s=e.length;t<s;t++){const s=e[t],n=s[0],r=s[1],a=s[2];0===a?i.push([n,r]):i.push([n,r,a])}const s=J(t)?t:"lightblue",n=new this.Graphic({geometry:{type:"polyline",paths:i,spatialReference:this.sceneView.spatialReference},symbol:{type:"line-3d",symbolLayers:[{type:"line",material:{color:s},size:3}]}});return this.auxGraphicsLayer.add(n),n},this.drawLineGL=(e,t,i)=>{const s=J(i)?i:"lightblue",n=[];for(let i=0,s=e.length;i<s;i++){const s=T(e[i],1,t);n.push(s)}const r=new this.Graphic({geometry:{type:"polyline",paths:n,spatialReference:this.sceneView.spatialReference},symbol:{type:"line-3d",symbolLayers:[{type:"line",material:{color:s},size:3}]}});return this.auxGraphicsLayer.add(r),r},(0,d.loadArcGISJSAPIModules)(["esri/layers/GraphicsLayer","esri/geometry/Point","esri/Graphic","esri/views/3d/support/projectionUtils","esri/geometry/support/webMercatorUtils"]).then((e=>{[this.GraphicsLayer,this.Point,this.Graphic,this.projectionUtils,this.webMercatorUtils]=e,this.auxGraphicsLayer=new this.GraphicsLayer({listMode:"hide"}),this.sceneView.map.add(this.auxGraphicsLayer),this.auxMovingObjLayer=new this.GraphicsLayer({listMode:"hide"}),this.sceneView.map.add(this.auxMovingObjLayer)})),this.sceneView=e.sceneView}}var ce;!function(e){e[e.NONE=0]="NONE",e[e.In=1]="In",e[e.Out=2]="Out",e[e.InOut=3]="InOut",e[e.Linear=4]="Linear"}(ce||(ce={}));const de=(e,t,i,s)=>i*e/s+t,ue=(e,t,i,s)=>i*(e/=s)*e+t,pe=(e,t,i,s)=>(e/=s/2)<1?i/2*e*e+t:-i/2*(--e*(e-2)-1)+t;var ge=function(e,t,i,s){return new(i||(i=Promise))((function(n,r){function a(e){try{l(s.next(e))}catch(e){r(e)}}function o(e){try{l(s.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,o)}l((s=s.apply(e,t||[])).next())}))};class ve{constructor(){this.easing=(e,t)=>{switch(this.state.mode){case ce.In:return this.easingIn(e,t);case ce.InOut:return this.easingInOut(e,t);case ce.Linear:return this.linear(e,t);case ce.NONE:return this.uniformSpeed(e,t)}},this.uniformSpeed=(e,t)=>{this.updateCurrentDuration(e*t);const i=this.getMovementByFrame(e)*t;return this.state.progress=0,{interp:0,step:i,progress:this.state.progress}},this.linear=(e,t)=>{const i=this.updateCurrentDuration(e*t);let s=0,n=0;return i<this.state.interp.time.duration?(s=de(i,this.state.interp.value.start,this.state.interp.value.end,this.state.interp.time.duration),n=s-this.state.interp.cache.lastVal,this.state.interp.cache.lastVal=s,this.state.progress=s/this.state.interp.value.end):this.state.progress=1,{interp:s,step:n,progress:this.state.progress}},this.easingIn=(e,t)=>{const i=this.updateCurrentDuration(e*t);let s=0,n=0;return i<this.state.interp.time.duration?(s=ue(i,this.state.interp.value.start,this.state.interp.value.end,this.state.interp.time.duration),n=s-this.state.interp.cache.lastVal,this.state.interp.cache.lastVal=s,this.state.interp.cache.lastStep=n):n=this.state.interp.cache.lastStep*t,this.state.progress=-1,{interp:s,step:n,progress:this.state.progress}},this.easingInOut=(e,t)=>{const i=this.updateCurrentDuration(e*t);let s=0,n=0;return i<this.state.interp.time.duration?(s=pe(i,this.state.interp.value.start,this.state.interp.value.end,this.state.interp.time.duration),n=s-this.state.interp.cache.lastVal,this.state.interp.cache.lastVal=s,this.state.progress=s/this.state.interp.value.end):this.state.progress=1,{interp:s,step:n,progress:this.state.progress}},this.getMovementByFrame=e=>this.getSpeed()/(1e3/e)}setup(){return ge(this,void 0,void 0,(function*(){return yield(0,d.loadArcGISJSAPIModules)(["esri/core/scheduling"]).then((e=>{[this.scheduling]=e})),this.state={speed:L.SPEED.DEFAULT_SPEED,mode:ce.NONE,progress:0,amount:-1,interp:{time:{begin:0,currentDuration:0,duration:1e4},value:{start:0,end:0},cache:{lastVal:0,lastStep:0}}},this.animateHandler=null,this}))}getState(){return this.state}setState(e){this.state=e}init(e,t,i,s){this.state.mode=e,this.state.interp.value.start=t,this.state.interp.value.end=i,this.state.interp.time.duration=s}reset(){this.state.interp.time.begin=0,this.state.interp.time.currentDuration=0,this.state.progress=0}computeDuration(){return this.state.amount/this.state.speed*1e3}getDuration(){return this.state.interp.time.duration}setAmount(e){return this.state.amount=e,this}getAmount(){return this.state.amount}getProgress(){return this.state.progress}progressForward(){return this.state.progress+=1e-4,this.state.progress}progressBackward(){return this.state.progress-1e-4}updateCurrentDuration(e){return this.state.interp.time.currentDuration=this.state.interp.time.currentDuration+e,isNaN(this.state.interp.time.currentDuration)&&(this.state.interp.time.currentDuration=0),this.state.interp.time.currentDuration}getSpeed(){return this.state.speed}setSpeed(e){this.state.speed=e}update(e){return ge(this,void 0,void 0,(function*(){null===this.animateHandler&&(this.animateHandler=this.scheduling.addFrameTask({update:t=>{e(t)}}))}))}stop(){null!==this.animateHandler&&(this.animateHandler.pause(),this.animateHandler.remove(),this.animateHandler=null)}insertAnExtraFrame(e){var t;null===(t=this.scheduling)||void 0===t||t.schedule((t=>{e(t)}))}}class me{constructor(){return this.abort(),this.update(),this}destructor(){this.signalHandler&&(this.signalHandler.abort(),this.signalHandler=null)}update(){return this.signalHandler=null,this.signalHandler=new AbortController,this.signalHandler.signal}abort(){var e;(null===(e=this.signalHandler)||void 0===e?void 0:e.signal)&&this.signalHandler.abort()}}class fe{constructor(){this.DEFAULT_SPEED=(L.SPEED.MIN+L.SPEED.MAX)/2,this.state=fe._getDefualtLiveviewSetting()}static _getDefualtLiveviewSetting(){return{speedFactor:.5,fixHeading:NaN,fixTilt:NaN,fixAltitude:0,initCamOffset:{height:60,distance:90}}}getState(){return this.state}setState(e){this.state=e}getCamOffsetHeight(){return this.state.initCamOffset.height}getCamOffsetDistance(){return this.state.initCamOffset.distance}setSpeedFactor(e){let t;t=void 0===e?this.DEFAULT_SPEED:e,this.state.speedFactor=parseFloat(t)}getSpeedFactor(){return void 0===this.state.speedFactor?.5:this.state.speedFactor}getMappingSpeedFactor(){if(void 0===this.state.speedFactor)return this.DEFAULT_SPEED;return E(this.state.speedFactor)}setHeadingFactor(e){let t=0;void 0!==e&&(t=e),this.state.fixHeading=t}getHeadingFactor(){return J(this.state.fixHeading)?this.state.fixHeading:0}setTiltFactor(e){let t=0;void 0!==e&&(t=e),this.state.fixTilt=t}getTiltFactor(e){return e||J(this.state.fixTilt)?this.state.fixTilt:0}setAltitudeFactor(e){let t=0;void 0!==e&&(t=e),this.state.fixAltitude=t}getAltitudeFactor(e){return e||J(this.state.fixAltitude)?this.state.fixAltitude:0}}var ye,we,Me=function(e,t,i,s){return new(i||(i=Promise))((function(n,r){function a(e){try{l(s.next(e))}catch(e){r(e)}}function o(e){try{l(s.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,o)}l((s=s.apply(e,t||[])).next())}))};!function(e){e.Rotate="ROTATE",e.Smoothed="CURVED",e.RealPath="LINE",e.AroundMapCenter="AROUND_MAP_CENTER"}(ye||(ye={})),function(e){e[e.INITED=-1]="INITED",e[e.PREPARING=0]="PREPARING",e[e.PREPARED=1]="PREPARED",e[e.RUNNING=2]="RUNNING",e[e.STOPPED=3]="STOPPED"}(we||(we={}));class Ce{constructor(){this.Camera=null,this._resume=e=>Me(this,void 0,void 0,(function*(){yield this.preparing();return!!(yield e)&&(yield this.prepared(),this._doFly(),!0)})),this.rotateBySceneMode=(e,t,i,s)=>{const n=this.vec3d.fromValues(e[0],e[1],e[2]),r=this.vec3d.create();J(s)&&(this.vec3.negate(r,s),this.vec3.add(n,n,r));const a=this.mat4d.create();return this.mat4.rotate(a,a,R(i),t),this.vec3.transformMat4(n,n,a),J(s)&&this.vec3.subtract(n,n,r),n},this.queryGeometryElevInfo=e=>{var t;return J(null===(t=this.sceneView.groundView)||void 0===t?void 0:t.elevationSampler)?k(this.sceneView.groundView.elevationSampler.queryElevation(e),this.sceneView):e.hasZ?e:void 0},this._coordsToGeoArray=e=>{const t=[];let i;for(let s=0,n=e.length;s<n;s++)i=this.vec3d.fromValues(e[s].x,e[s].y,e[s].z),t.push(i);return t},this.getPrepareGoToOptionsBeforeTerrainLoaded=e=>{const t={animate:!0,maxDuration:4e3,easing:"out-expo",signal:this.abortSignalHandler.update()};return e&&!e.animate&&(t.animate=!1,delete t.maxDuration,delete t.easing),t},this.getPrepareGoToOptionsAfterTerrainLoaded=e=>{const t={animate:!0,maxDuration:1e3,easing:"out-expo",signal:this.abortSignalHandler.update()};return e&&!e.animate&&(t.animate=!1,delete t.maxDuration,delete t.easing),t}}setup(e){return Me(this,void 0,void 0,(function*(){return yield(0,d.loadArcGISJSAPIModules)(["esri/core/libs/gl-matrix-2/vec3f64","esri/core/libs/gl-matrix-2/mat4f64","esri/core/libs/gl-matrix-2/vec3","esri/core/libs/gl-matrix-2/mat4","esri/core/libs/gl-matrix-2/quatf64","esri/core/libs/gl-matrix-2/quat","esri/views/3d/support/cameraUtils","esri/geometry/Point","esri/views/3d/support/mathUtils","esri/core/reactiveUtils","esri/Camera"]).then((t=>Me(this,void 0,void 0,(function*(){[this.libVec3f64,this.libMat4f64,this.libVec3,this.libMat4,this.libQuatf64,this.libQuat,this.cameraUtils,this.Point,this.esriMathUtils,this.reactiveUtils,this.Camera]=t,this.vec3=this.libVec3.vec3,this.vec3d=this.libVec3f64.vec3f64,this.mat4=this.libMat4.mat4,this.mat4d=this.libMat4f64.mat4f64,this.quat=this.libQuat.quat,this.quatd=this.libQuatf64.quatf64,yield this.clear();const{id:i,type:s,geometry:n,direction:r,config:a,sceneView:o,flyCallbacks:l}=e;this.id=i,this.type=s,this.geometry=n,this.direction=r,this.cameraInfo=a.cameraInfo,J(a.liveviewSettingState)&&this.liveviewSetting.setState(a.liveviewSettingState),this.sceneView=o,this.flyCallbacks=l,this._isDebug=!1,this._isDebug&&(this.auxHelper=new he({sceneView:this.sceneView})),this.DEBUG={planTime:0,startTime:0,endTime:0},this.eventHandlers.push(this.sceneView.on("drag",(e=>{this.flyState<=we.RUNNING&&"start"===e.action&&this.handleMapInteractionStart(),"end"===e.action&&this.handleMapInteractionEnd()}))),this.eventHandlers.push(this.sceneView.on("mouse-wheel",(e=>{this.flyState<=we.RUNNING&&this.handleMapInteractionStart(e)})))})))),this}))}destructor(){this.onStop(),this.clear()}isInited(){return this.flyState>=we.INITED}isEnableToFly(){const e=this.flyState;return e===we.PREPARED||e===we.STOPPED||e===we.PREPARING}isEnableToPause(){return this.flyState>=we.PREPARING}init(){this.flyState=we.INITED,this.animate.reset()}preparing(){return Me(this,void 0,void 0,(function*(){var e;this.flyState=we.PREPARING,"function"==typeof(null===(e=this.flyCallbacks)||void 0===e?void 0:e.onPreparing)&&this.flyCallbacks.onPreparing()}))}prepared(){return Me(this,void 0,void 0,(function*(){return this.flyState=we.PREPARED,setTimeout((()=>null),50)}))}_doFly(){this.isLiveviewMode||this.onStart()}setConfig(e){this.cameraInfo=e.cameraInfo,this.liveviewSetting.setState(e.liveviewSettingState)}getConfig(){return{cameraInfo:this.cameraInfo,liveviewSettingState:this.liveviewSetting.getState()}}pause(){return Me(this,void 0,void 0,(function*(){return!!this.isEnableToPause()&&(this.stopAnimat(),this.onPause(),!0)}))}resume(e){return Me(this,void 0,void 0,(function*(){}))}stop(e){this.stopAnimat(),this.onStop()}clear(){return Me(this,void 0,void 0,(function*(){var e,t,i,s;J(this.eventHandlers)&&this.eventHandlers.forEach((e=>{e.remove()})),this.eventHandlers=null,this.eventHandlers=[],this.abortSignalHandler&&this.abortSignalHandler.abort(),this.abortSignalHandler=null,this.abortSignalHandler=new me,this._isDebug&&(null===(e=this.auxHelper)||void 0===e||e.clearAll()),J(null===(t=this._cache)||void 0===t?void 0:t.paths)&&(null===(i=this._cache)||void 0===i||i.paths.destructor()),this.id=null,this.type=null,this.geometry=null,this.direction=null,this.cameraInfo=null,this.sceneView=null,this.flyCallbacks=null,this.auxHelper=null,null===(s=this.animate)||void 0===s||s.stop(),this.animate=null,this.animate=yield(new ve).setup(),this.liveviewSetting=null,this.liveviewSetting=new fe,this.flyState=null,this.isLiveviewMode=!1,this.shownProgress=0,this._cache={paths:null,cachedGeo:null,cameraGL:{pos:null,upDir:null},lookAtTargetGL:{pos:null,upAxis:null,baseAlt:null}},this.resetCameraWhenFinishedFlag=!1,this._isDebug=!1,this.DEBUG={planTime:null,startTime:null,endTime:null}}))}updateAnimat(e){return Me(this,void 0,void 0,(function*(){return yield this.animate.update((t=>{e(t)}))}))}stopAnimat(){var e;null===(e=this.animate)||void 0===e||e.stop(),this.updateProgressBar()}setIsLiveview(e){return Me(this,void 0,void 0,(function*(){return this.isLiveviewMode=e,e?yield this.fly({animate:!1}):yield this.pause()}))}setLiveviewSettingInfo(e,t){return Me(this,void 0,void 0,(function*(){if(!J(e))return!1;let i=!1;const s=e.altitude;void 0!==s&&(i=!0,this.liveviewSetting.setAltitudeFactor(s));const n=e.tilt;return void 0!==n&&(i=!0,this.liveviewSetting.setTiltFactor(n)),i&&J(this.animate)&&this.isLiveviewMode&&this.animate.insertAnExtraFrame((e=>Me(this,void 0,void 0,(function*(){yield t(e)})))),!0}))}getDefaultDuration(){return this.flyState>=we.PREPARED?this.animate.getDuration():null}onStart(){var e;this.flyState=we.RUNNING,this._isDebug&&(this.DEBUG.planTime=this.animate.state.interp.time.duration,this.DEBUG.startTime=(new Date).getTime()),"function"==typeof(null===(e=this.flyCallbacks)||void 0===e?void 0:e.onFly)&&this.flyCallbacks.onFly()}onPause(){var e;this.abortSignalHandler.abort(),this.flyState=we.STOPPED,"function"==typeof(null===(e=this.flyCallbacks)||void 0===e?void 0:e.onPause)&&this.flyCallbacks.onPause()}onStop(){var e;if(this.abortSignalHandler.abort(),this.flyState=we.STOPPED,this._isDebug){this.DEBUG.endTime=(new Date).getTime();const e=(this.DEBUG.endTime-this.DEBUG.startTime)/1e3,t=this.DEBUG.planTime/1e3;console.log("DEBUG 1.fly sum time ==> "+e.toFixed(2)+" s"),console.log("DEBUG 2.plan time ==> "+t.toFixed(2)+" s");const i=(e-t)/t*100;console.log("DEBUG 3.mistake ==> "+i.toFixed(5)+" %")}"function"==typeof(null===(e=this.flyCallbacks)||void 0===e?void 0:e.onFinish)&&this.flyCallbacks.onFinish()}updateProgressBar(){var e,t;if("function"==typeof(null===(e=this.flyCallbacks)||void 0===e?void 0:e.onUpdateProgress)){const e=Math.ceil(100*this.getProgress());let i=!1;(e<=1||e>=99||Math.abs(e-this.shownProgress)>=1)&&(i=!0),i&&(this.shownProgress=e),i&&(null===(t=this.flyCallbacks)||void 0===t||t.onUpdateProgress(this.shownProgress))}}concatGeoPaths(e){let t=[];for(let i=0;i<e.paths.length;i++)t=t.concat(e.paths[i]);return t}geoCoordToRenderCoord(e){const t=[];for(let i=0,s=e.length;i<s;i++){let s=e[i];s=G([s[0],s[1],s[2]],null,this.sceneView),t.push(s)}return t}}function Se(e,t){const i=e.state.camera.clone();let s=i.set("eye",t.eye);return s=i.set("center",t.center),s=i.set("up",t.up),s}var Pe=function(e,t,i,s){return new(i||(i=Promise))((function(n,r){function a(e){try{l(s.next(e))}catch(e){r(e)}}function o(e){try{l(s.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,o)}l((s=s.apply(e,t||[])).next())}))};class be extends Ce{constructor(){super(...arguments),this._updateCameraGlByTilt=(e,t)=>{if(!J(this._cache.lookAtTargetGL.pos))return null;e<1?e=1:e>89&&(e=89);const i=this.vec3d.create();this.vec3.subtract(i,this._cache.cameraGL.pos,this._cache.lookAtTargetGL.pos);const s=this.vec3.length(i),n=this.vec3d.create();this.vec3.normalize(n,this._cache.lookAtTargetGL.upAxis);const r=this.vec3d.create();this.vec3.scale(r,n,s);const a=this.vec3d.create();this.vec3.add(a,this._cache.lookAtTargetGL.pos,r);const o=this.vec3d.create();this.vec3.cross(o,n,i);let l=this.vec3d.create();l=this.rotateBySceneMode(a,o,e,this._cache.lookAtTargetGL.pos);const h=this.mat4d.create();this.mat4.rotate(h,h,R(e),o);const c=this.vec3d.create();this.vec3.subtract(c,l,this._cache.lookAtTargetGL.pos);const d=this.vec3d.create();if(this.vec3.cross(d,c,o),this.vec3.normalize(d,d),this._cache.cameraGL.pos=l,this._cache.cameraGL.upDir=d,null==t?void 0:t.isUpdateCameraConfig){const e=Se(this.sceneView,{eye:this._cache.cameraGL.pos,center:this._cache.lookAtTargetGL.pos,up:this._cache.cameraGL.upDir});this.cameraInfo=this.cameraUtils.internalToExternal(this.sceneView,e),this.cameraInfo=this.cameraInfo.toJSON()}},this._computeCurrentTilt=()=>{const e=this.vec3d.create();this.vec3.subtract(e,this._cache.cameraGL.pos,this._cache.lookAtTargetGL.pos);const t=this.vec3d.create();this.vec3.normalize(t,this._cache.lookAtTargetGL.upAxis);return j(this.vec3.angle(e,t))},this._updateInitCamera=(e,t)=>{var i;let s,n=e;this._isDebug&&(null===(i=this.auxHelper)||void 0===i||i.drawPoint(n)),n=this.queryGeometryElevInfo(n),this._cache.lookAtTargetGL.pos=G([n.x,n.y,n.z],null,this.sceneView),this._cache.lookAtTargetGL.upAxis=this.vec3d.create(),this._cache.lookAtTargetGL.baseAlt=n.z,this.sceneView.renderCoordsHelper.worldUpAtPosition(this._cache.lookAtTargetGL.pos,this._cache.lookAtTargetGL.upAxis),s=J(this.cameraInfo)?this.Camera.fromJSON(this.cameraInfo):this.sceneView.camera.clone();const r=this.cameraUtils.externalToInternal(this.sceneView,s);return this._cache.cameraGL.pos=r.eye,this._cache.cameraGL.upDir=r.up,(null==t?void 0:t.isUpdateTilt)&&this._updateCameraGlByTilt(this._getTilt()),n},this.fly=e=>Pe(this,void 0,void 0,(function*(){return J(null==e?void 0:e.speedFactor)&&this.liveviewSetting.setSpeedFactor(e.speedFactor),this.isInited()?this.isEnableToFly()?yield this.resume(null==e?void 0:e.animate):yield Promise.reject(new Error("isEnableToFly() === false")):(yield this.prepare(),yield this.resume(),!0)})),this.getApiCamera=()=>{const e=Se(this.sceneView,{eye:this._cache.cameraGL.pos,center:this._cache.lookAtTargetGL.pos,up:this._cache.cameraGL.upDir}),t=this.cameraUtils.internalToExternal(this.sceneView,e);return t.position.z<0&&(t.position.z=0),t},this.resumeCamera=e=>Pe(this,void 0,void 0,(function*(){const t=e;try{yield this.sceneView.goTo(this.getApiCamera(),{animate:t,signal:this.abortSignalHandler.update()})}catch(e){return"AbortError"===e.name&&(console.log("sceneView.goTo() Aborted"),!1)}return!0})),this.getProgress=()=>0}setIsLiveview(e){const t=Object.create(null,{setIsLiveview:{get:()=>super.setIsLiveview}});return Pe(this,void 0,void 0,(function*(){return yield t.setIsLiveview.call(this,e),yield this.setLiveviewSettingInfo(this.getLiveViewSettingInfo())}))}setLiveviewSettingInfo(e){const t=Object.create(null,{setLiveviewSettingInfo:{get:()=>super.setLiveviewSettingInfo}});return Pe(this,void 0,void 0,(function*(){return yield t.setLiveviewSettingInfo.call(this,e,(()=>Pe(this,void 0,void 0,(function*(){if(J(e)&&J(e.tilt)&&J(this._cache.lookAtTargetGL.pos)&&e.tilt>=0){this._updateCameraGlByTilt(e.tilt,{isUpdateCameraConfig:!0});try{yield this.sceneView.goTo(this.getApiCamera(),{animate:!1,signal:this.abortSignalHandler.update()})}catch(e){return"AbortError"===e.name&&(console.log("sceneView.goTo() Aborted"),!1)}return!0}return!1}))))}))}_getTilt(){let e=this.liveviewSetting.getTiltFactor(!0);return(null==e||isNaN(e))&&(e=this._computeCurrentTilt(),this.liveviewSetting.setTiltFactor(e)),e}getLiveViewSettingInfo(){return{tilt:this._getTilt(),altitude:null,speed:this.liveviewSetting.getSpeedFactor()}}prepare(e){const t=Object.create(null,{preparing:{get:()=>super.preparing},prepared:{get:()=>super.prepared}});return Pe(this,void 0,void 0,(function*(){var i;const s=this.geometry;J(e)&&(J(e.angleLimit)?(this.optionsAngleLimit=e.angleLimit,this.angleLimitCounter=e.angleLimit):J(this.optionsAngleLimit),J(e.duration)&&(this.duration=e.duration)),t.preparing.call(this),this._updateInitCamera(s,{isUpdateTilt:!1}),J(this.duration)?this.animate.init(ce.Linear,0,null!==(i=this.optionsAngleLimit)&&void 0!==i?i:360,this.duration):this.animate.init(ce.NONE,0,0,this.duration);try{yield this.sceneView.goTo(this.getApiCamera(),this.getPrepareGoToOptionsBeforeTerrainLoaded(e))}catch(e){return"AbortError"===e.name?console.log("sceneView.goTo() Aborted"):console.error(e),!1}if(null==e?void 0:e.waitingForTerrain){yield this.reactiveUtils.whenOnce((()=>!this.sceneView.groundView.updating)),this._updateInitCamera(this.geometry,{isUpdateTilt:!0});try{yield this.sceneView.goTo(this.getApiCamera(),this.getPrepareGoToOptionsAfterTerrainLoaded(e))}catch(e){return"AbortError"===e.name&&console.log("sceneView.goTo() Aborted"),!1}yield this.reactiveUtils.whenOnce((()=>!this.sceneView.groundView.updating))}return yield t.prepared.call(this),!0}))}_doFly(){const e=Object.create(null,{_doFly:{get:()=>super._doFly}});return Pe(this,void 0,void 0,(function*(){return e._doFly.call(this),yield this.updateAnimat((e=>{var t;const i=this.animate.easing(e.deltaTime,this.liveviewSetting.getMappingSpeedFactor());let n=i.step;const r=i.progress;if(J(this.direction)&&this.direction===s.CW&&(n=-n),this.isLiveviewMode);else if(null===this.optionsAngleLimit||isNaN(this.optionsAngleLimit))this._rotateCam(n);else{r>=1&&(n=this.angleLimitCounter);const e=Math.min(Math.abs(n),this.angleLimitCounter);this.angleLimitCounter-=e,this.angleLimitCounter>0?this._rotateCam(n):this.stop()}this._isDebug&&(null===(t=this.auxHelper)||void 0===t||t.drawPointGL(this._cache.cameraGL.pos,"red"));const a=this.getApiCamera();this.sceneView.goTo(a,{animate:!1}).catch((function(e){if("AbortError"!==e.name)throw new Error(e);console.log("sceneView.goTo() Aborted")}))}))}))}_rotateCam(e){const t=this._cache.lookAtTargetGL.upAxis;let i=this.vec3d.create();i=this.rotateBySceneMode(this._cache.cameraGL.pos,t,e,this._cache.lookAtTargetGL.pos),this._cache.cameraGL.pos=i;const s=this.mat4d.create();this.mat4.rotate(s,s,R(e),t);const n=this._cache.cameraGL.upDir;this.vec3.transformMat4(n,n,s),this.vec3.normalize(n,n),this._cache.cameraGL.upDir=n}resume(e){const t=Object.create(null,{resume:{get:()=>super.resume}});return Pe(this,void 0,void 0,(function*(){return t.resume.call(this),yield this._resume(this.resumeCamera(e))}))}clear(){const e=Object.create(null,{clear:{get:()=>super.clear}});return Pe(this,void 0,void 0,(function*(){yield e.clear.call(this),this._cache.lookAtTargetGL.pos=null}))}handleMapInteractionStart(){return Pe(this,void 0,void 0,(function*(){this.pause()}))}handleMapInteractionEnd(){return Pe(this,void 0,void 0,(function*(){}))}}class Ie{constructor(e,t){this.points=null!=e?e:[],this.points=this.normalPoints4Bspline(this.points),this.iter=null!=t?t:3}getSpline(){const e=this.bspline(this.points,this.iter);return this.mergePoints(e)}clear(){this.points=null,this.iter=null}normalPoints4Bspline(e){var t;const i=[];for(let s=0,n=e.length;s<n;s++){const n=e[s],r=n[0],a=n[1],o=null!==(t=n[2])&&void 0!==t?t:0;i.push(r,a,o)}return i}mergePoints(e){const t=[];for(let i=0,s=e.length/3;i<s;i++){const s=e[3*i],n=e[3*i+1],r=e[3*i+2],a=[];a.push(s,n,r),t.push(a)}return t}bspline(e,t){if(!J(t)||0===t)return e;const i=e.length/3,s=[e[0],e[1],e[2]],n=.2,r=.8;for(let t=0;t<i-1;t++){const i=3*t;s[3+2*i+0]=r*e[i+0]+n*e[i+3],s[3+2*i+1]=r*e[i+1]+n*e[i+4],s[3+2*i+2]=r*e[i+2]+n*e[i+5],s[3+2*i+3]=n*e[i+0]+r*e[i+3],s[3+2*i+4]=n*e[i+1]+r*e[i+4],s[3+2*i+5]=n*e[i+2]+r*e[i+5]}return s.push(e[e.length-3],e[e.length-2],e[e.length-1]),this.bspline(s,t-1)}}function xe(e,t,i){const s=void 0!==t?t*t:1;return e=i?e:function(e,t){let i=e[0];const s=[i];let n;for(let r=1,a=e.length;r<a;r++)n=e[r],Ae(n,i)>t&&(s.push(n),i=n);i!==n&&s.push(n);return s}(e,s),e=function(e,t){const i=e.length,s=new("undefined"!=typeof Uint8Array?Uint8Array:Array)(i);let n=0,r=i-1;const a=[],o=[];let l,h,c,d;s[n]=s[r]=1;for(;J(r)&&0!==r;){for(h=0,l=n+1;l<r;l++)c=Le(e[l],e[n],e[r]),c>h&&(d=l,h=c);h>t&&(s[d]=1,a.push(n,d,d,r)),r=a.pop(),n=a.pop()}for(l=0;l<i;l++)J(s[l])&&o.push(e[l]);return o}(e,s),e}function Ae(e,t){const i=e[0]-t[0],s=e[1]-t[1],n=e[2]-t[2];return i*i+s*s+n*n}function Le(e,t,i){let s=t[0],n=t[1],r=t[2],a=i[0]-s,o=i[1]-n,l=i[2]-r;if(0!==a||0!==o||0!==l){const t=((e[0]-s)*a+(e[1]-n)*o+(e[2]-r)*l)/(a*a+o*o+l*l);t>1?(s=i[0],n=i[1],r=i[2]):t>0&&(s+=a*t,n+=o*t,r+=l*t)}return a=e[0]-s,o=e[1]-n,l=e[2]-r,a*a+o*o+l*l}class Ge{constructor(){this.c0=0,this.c1=0,this.c2=0,this.c3=0,this.init=(e,t,i,s)=>{this.c0=e,this.c1=i,this.c2=-3*e+3*t-2*i-s,this.c3=2*e-2*t+i+s},this.initCatmullRom=(e,t,i,s,n)=>{this.init(t,i,n*(i-e),n*(s-t))},this.initNonuniformCatmullRom=(e,t,i,s,n,r,a)=>{let o=(t-e)/n-(i-e)/(n+r)+(i-t)/r,l=(i-t)/r-(s-t)/(r+a)+(s-i)/a;o*=r,l*=r,this.init(t,i,o,l)},this.calc=e=>{const t=e*e,i=t*e;return this.c0+this.c1*e+this.c2*t+this.c3*i}}}class Te{constructor(e,t,i){this.set=(e,t,i)=>(this.x=e,this.y=t,this.z=i,this),this.add=e=>(this.x+=e.x,this.y+=e.y,this.z+=e.z,this),this.subVectors=(e,t)=>(this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this),this.distanceToSquared=e=>{const t=this.x-e.x,i=this.y-e.y,s=this.z-e.z;return t*t+i*i+s*s},this.distanceTo=e=>Math.sqrt(this.distanceToSquared(e)),this.x=null!=e?e:0,this.y=null!=t?t:0,this.z=null!=i?i:0}}const Re=new Te,je=new Ge,De=new Ge,Fe=new Ge;class Ve{constructor(e,t,i,s){this._geoArrayToCoords=e=>{const t=[];for(let i=0,s=e.length;i<s;i++)t.push(new Te(e[i][0],e[i][1],e[i][2]));return t},this.getPoint=(e,t)=>{const i=null!=t?t:new Te,s=this.points,n=s.length,r=(n-(!0===this.closed?0:1))*e;let a,o=Math.floor(r),l=r-o;!0===this.closed?o+=o>0?0:(Math.floor(Math.abs(o)/n)+1)*n:0===l&&o===n-1&&(o=n-2,l=1),!0===this.closed||o>0?a=s[(o-1)%n]:(Re.subVectors(s[0],s[1]).add(s[0]),a=Re);const h=s[o%n],c=s[(o+1)%n];let d;if(!0===this.closed||o+2<n?d=s[(o+2)%n]:(Re.subVectors(s[n-1],s[n-2]).add(s[n-1]),d=Re),"centripetal"===this.curveType||"chordal"===this.curveType){const e="chordal"===this.curveType?.5:.25;let t=Math.pow(a.distanceToSquared(h),e),i=Math.pow(h.distanceToSquared(c),e),s=Math.pow(c.distanceToSquared(d),e);i<1e-4&&(i=1),t<1e-4&&(t=i),s<1e-4&&(s=i),je.initNonuniformCatmullRom(a.x,h.x,c.x,d.x,t,i,s),De.initNonuniformCatmullRom(a.y,h.y,c.y,d.y,t,i,s),Fe.initNonuniformCatmullRom(a.z,h.z,c.z,d.z,t,i,s)}else"catmullrom"===this.curveType&&(je.initCatmullRom(a.x,h.x,c.x,d.x,this.tension),De.initCatmullRom(a.y,h.y,c.y,d.y,this.tension),Fe.initCatmullRom(a.z,h.z,c.z,d.z,this.tension));return i.set(je.calc(l),De.calc(l),Fe.calc(l)),i},this.getSpacedPoints=e=>{void 0===e&&(e=5);const t=[];for(let i=0;i<=e;i++)t.push(this.getPointAt(i/e));return t},this.getPointAt=(e,t)=>{const i=this.getUtoTmapping(e);return this.getPoint(i,t)},this.getUtoTmapping=(e,t)=>{const i=this.getLengths();let s=0;const n=i.length;let r;r=J(t)?t:e*i[n-1];let a,o=0,l=n-1;for(;o<=l;)if(s=Math.floor(o+(l-o)/2),a=i[s]-r,a<0)o=s+1;else{if(!(a>0)){l=s;break}l=s-1}if(s=l,i[s]===r)return s/(n-1);const h=i[s];return(s+(r-h)/(i[s+1]-h))/(n-1)},this.getLength=()=>{const e=this.getLengths();return e[e.length-1]},this.getLengths=e=>{if(void 0===e&&(e=this.arcLengthDivisions),J(this.cacheArcLengths)&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let i,s,n=this.getPoint(0),r=0;for(t.push(0),s=1;s<=e;s++)i=this.getPoint(s/e),r+=i.distanceTo(n),t.push(r),n=i;return this.cacheArcLengths=t,t},this.points=this._geoArrayToCoords(e),this.closed=null!=t&&t,this.curveType=null!=i?i:"centripetal",this.tension=null!=s?s:.3,this.arcLengthDivisions=2e4}destructor(){}}class Oe{constructor(e,t,i,s,n){this.longLineProcessing={threshold:400,distance:150},this.acuteAngleProcessing={angle:90,threshold:300,distance:100},this.geoArrayToCoords=e=>{const t=[];for(let i=0,s=e.length;i<s;i++){let s=e[i];s=G([s[0],s[1],s[2]],null,this.sceneView),t.push(s)}return t},this.getLength=()=>this.curve.getLength(),this.sceneView=t,this.points=this.geoArrayToCoords(e),this.vec3=i,this.vec3d=s,this.esriMathUtils=n;const r=xe(this.points,5,!0);this.points=this.preProcessing(r);const a=new Ie(this.points);this.curve=new Ve(a.getSpline()),a.clear()}destructor(){this.points=null,this.curve=null}getUtoTmapping(e,t){return this.curve.getUtoTmapping(0,t)}getPoint(e){return this.curve.getPoint(e)}preProcessing(e){const t=[];let i=null;for(let s=0;s<e.length-1;s++){const n=e[s],r=e[s+1],a=e[s+2],o=D(n,r),l=J(a)?D(r,a):null;let h=!1;if(J(o)&&J(l)){const e=V(n,r,a,this.vec3,this.vec3d,this.sceneView,this.esriMathUtils);h=Math.abs(e)>this.acuteAngleProcessing.angle}const c=!(0!==s),d=!(e.length-1!==s+1);let u;if(t.push(n),J(i)&&!c&&(t.push(i),i=null),u=this._getInsertControlPointRes(o,h),!0===u.isInsert&&!c&&!d){const e=this._getInsertedPoint(n,r,"forward",u.distance);t.push(e)}u=this._getInsertControlPointRes(l,h),!0!==u.isInsert||d||(i=this._getInsertedPoint(r,a,"backward",u.distance)),d&&t.push(r)}for(let e=0,i=t.length;e<i;e++){let i=t[e];i=T(i,null,this.sceneView),t.splice(e,1,i)}return t}_getInsertControlPointRes(e,t){const i=e>this.acuteAngleProcessing.threshold,s=null!==e&&e>this.longLineProcessing.threshold;return t&&i?{isInsert:!0,distance:this.acuteAngleProcessing.distance}:s?{isInsert:!0,distance:this.longLineProcessing.distance}:{isInsert:!1,distance:0}}_getInsertedPoint(e,t,i,s){const n=this.vec3d.create(),r=this.vec3d.create(),a=this.vec3d.create(),o=this.vec3d.create();return"forward"===i?(this.vec3.subtract(n,e,t),this.vec3.normalize(r,n),this.vec3.scale(a,r,s),this.vec3.add(o,t,a)):(this.vec3.subtract(n,t,e),this.vec3.normalize(r,n),this.vec3.scale(a,r,s),this.vec3.add(o,e,a)),o}_getMidpoint(e,t,i){const s=this.vec3d.create(),n=this.vec3d.create(),r=this.vec3d.create(),a=this.vec3d.create(),o=J(i)?i:D(e,t);return this.vec3.subtract(s,e,t),this.vec3.normalize(n,s),this.vec3.scale(r,n,o/2),this.vec3.add(a,t,r),a}}var ke=function(e,t,i,s){return new(i||(i=Promise))((function(n,r){function a(e){try{l(s.next(e))}catch(e){r(e)}}function o(e){try{l(s.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,o)}l((s=s.apply(e,t||[])).next())}))};class Ne extends Ce{constructor(){super(...arguments),this._updateInitCamera=e=>{e=this.queryGeometryElevInfo(e),this._cache.cachedGeo=this.concatGeoPaths(e),this._cache.paths=new Oe(this._cache.cachedGeo,this.sceneView,this.vec3,this.vec3d,this.esriMathUtils);const t=this._cache.paths.getLength();return this.animate.setAmount(t),e},this.getProgress=()=>this.animate.getProgress(),this.getCameraByProgress=()=>{let e,t;0===this.animate.getProgress()?(e=0*this.animate.getAmount(),this.animate.progressForward(),t=this.animate.getAmount()*this.animate.getProgress()):(e=this.animate.getAmount()*this.animate.progressBackward(),e<0&&(e=0,this.animate.progressForward()),t=this.animate.getAmount()*this.animate.getProgress());let i=this._cache.paths.getUtoTmapping(0,e);i=this._cache.paths.getPoint(i),i=this._coordToGeo(i);let s=this._cache.paths.getUtoTmapping(0,t);s=this._cache.paths.getPoint(s),s=this._coordToGeo(s);const n=parseFloat(i[2])+0,r=G([i[0],i[1],n],null,this.sceneView);let a=this.getCameraPosition(i,s);J(a)||(a=this._cache.cameraGL.pos);const o=this.vec3d.create();this.sceneView.renderCoordsHelper.worldUpAtPosition(a,o);const l=[0,0,0];l[0]=a[0],l[1]=a[1],l[2]=a[2];const h=[0,0,0];return h[0]=r[0],h[1]=r[1],h[2]=r[2],this._cache.cameraGL.pos=l,this._cache.cameraGL.upDir=o,this._cache.lookAtTargetGL.pos=h,this._cache.lookAtTargetGL.upAxis=null,this._cache.lookAtTargetGL.baseAlt=null,{lookAt:h,camPos:l,up:o}},this.getApiCamera=e=>{let t=e.camPos,i=e.lookAt;const s=e.up;if(!J(t)||!J(i)||!J(s))return null;let n=0,r=T(i,1,this.sceneView),a=new this.Point({x:r[0],y:r[1],z:r[2],type:"point",spatialReference:this.sceneView.spatialReference});n=a.z,a.z=parseFloat(a.z)+this.liveviewSetting.getAltitudeFactor(),a.z<0&&(a.z=0),i=G([a.x,a.y,a.z],null,this.sceneView),r=T(t,1,this.sceneView),a=new this.Point({x:r[0],y:r[1],z:r[2],type:"point",spatialReference:this.sceneView.spatialReference}),a.z=n+this.liveviewSetting.getAltitudeFactor()+this.liveviewSetting.getCamOffsetHeight(),t=G([a.x,a.y,a.z],null,this.sceneView);const o=Se(this.sceneView,{eye:t,center:i,up:s});return this.cameraUtils.internalToExternal(this.sceneView,o)},this.getCameraPosition=(e,t)=>{var i,s,n;if(e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2])return null;const r=null!==(i=this.liveviewSetting.getCamOffsetHeight())&&void 0!==i?i:100,a=null!==(s=this.liveviewSetting.getCamOffsetDistance())&&void 0!==s?s:100,o=G([e[0],e[1],e[2]],null,this.sceneView),l=G([t[0],t[1],t[2]],null,this.sceneView),h=this.vec3d.create();this.vec3.subtract(h,o,l);const c=this.vec3.length(h),d=this.vec3d.create();this.vec3.normalize(d,h);const u=c+a,p=this.vec3d.create();this.vec3.scale(p,d,u);const g=this.vec3d.create();this.vec3.add(g,l,p);const v=T(g,1,this.sceneView),m=new this.Point({x:v[0],y:v[1],z:v[2],type:"point",spatialReference:this.sceneView.spatialReference});m.z<r&&(m.z=r),m.z<0&&(m.z=0),this._isDebug&&(null===(n=this.auxHelper)||void 0===n||n.drawPoint(m));return G([m.x,m.y,m.z],null,this.sceneView)},this.resumeCamera=e=>ke(this,void 0,void 0,(function*(){const t=e;try{yield this.sceneView.goTo(this.getApiCamera(this.getCameraByProgress()),{animate:t,signal:this.abortSignalHandler.update()})}catch(e){return"AbortError"===e.name&&(console.log("sceneView.goTo() Aborted"),!1)}return!0})),this.stop=e=>{super.stop();const t=e&&e.ignoreResetCameraWhenFinished;this.resetCameraWhenFinishedFlag&&!t&&(this.sceneView.goTo(this.cameraInfo),this.resetCameraWhenFinishedFlag=!1)},this._coordToGeo=e=>J(e)?this.vec3d.fromValues(e.x,e.y,e.z):null}setLiveviewSettingInfo(e){const t=Object.create(null,{setLiveviewSettingInfo:{get:()=>super.setLiveviewSettingInfo}});return ke(this,void 0,void 0,(function*(){return yield t.setLiveviewSettingInfo.call(this,e,(()=>ke(this,void 0,void 0,(function*(){const e=this.getApiCamera(this.getCameraByProgress());try{yield this.sceneView.goTo(e,{animate:!1,signal:this.abortSignalHandler.update()})}catch(e){return"AbortError"===e.name&&(console.log("sceneView.goTo() Aborted"),!1)}return!0}))))}))}getLiveViewSettingInfo(){return{tilt:null,altitude:this.liveviewSetting.getAltitudeFactor(),speed:this.liveviewSetting.getSpeedFactor()}}prepare(e){const t=Object.create(null,{preparing:{get:()=>super.preparing},prepared:{get:()=>super.prepared}});return ke(this,void 0,void 0,(function*(){var i,s;let n=this.geometry;if("polyline"!==(null==n?void 0:n.type))return alert("Wrong geo type!"),!1;if(J(null==e?void 0:e.duration)&&(this.duration=e.duration),t.preparing.call(this),n=this._updateInitCamera(n),!this.isLiveviewMode){const e=this.animate.computeDuration();this.animate.init(ce.Linear,0,this.animate.getAmount(),null!==(i=this.duration)&&void 0!==i?i:e)}this._isDebug&&(null===(s=this.auxHelper)||void 0===s||s.drawLineXY(this._cache.paths,"lightgreen"));try{yield this.sceneView.goTo(this.getApiCamera(this.getCameraByProgress()),this.getPrepareGoToOptionsBeforeTerrainLoaded(e))}catch(e){return"AbortError"===e.name&&console.log("sceneView.goTo() Aborted"),!1}if(null==e?void 0:e.waitingForTerrain){yield this.reactiveUtils.whenOnce((()=>!this.sceneView.groundView.updating)),n=this._updateInitCamera(n);try{yield this.sceneView.goTo(this.getApiCamera(this.getCameraByProgress()),this.getPrepareGoToOptionsAfterTerrainLoaded(e))}catch(e){return"AbortError"===e.name&&console.log("sceneView.goTo() Aborted"),!1}yield this.reactiveUtils.whenOnce((()=>!this.sceneView.groundView.updating))}return yield t.prepared.call(this),!0}))}fly(e){const t=Object.create(null,{isEnableToFly:{get:()=>super.isEnableToFly}});return ke(this,void 0,void 0,(function*(){return J(null==e?void 0:e.speedFactor)&&this.liveviewSetting.setSpeedFactor(e.speedFactor),J(null==e?void 0:e.resetCameraWhenFinished)&&(this.resetCameraWhenFinishedFlag=!0),t.isEnableToFly.call(this)?yield this.resume(e.animate):yield Promise.reject(new Error(null))}))}_doFly(){super._doFly(),this.updateAnimat((e=>{this.isLiveviewMode||this.animate.easing(e.deltaTime,this.liveviewSetting.getMappingSpeedFactor()),this.updateProgressBar();if(this.getProgress()>=1)this.animate.reset(),this.stop();else{const e=this.getCameraByProgress(),t=this.getApiCamera(e);J(t)&&this.sceneView.goTo(t,{animate:!1})}}))}resume(e){const t=Object.create(null,{resume:{get:()=>super.resume}});return ke(this,void 0,void 0,(function*(){return t.resume.call(this),yield this._resume(this.resumeCamera(e))}))}clear(){const e=Object.create(null,{clear:{get:()=>super.clear}});return ke(this,void 0,void 0,(function*(){yield e.clear.call(this)}))}handleMapInteractionStart(){return ke(this,void 0,void 0,(function*(){this.pause()}))}handleMapInteractionEnd(){return ke(this,void 0,void 0,(function*(){}))}}class Ee{constructor(e,t,i,s,n){this.geoArrayToCoords=e=>{const t=[];for(let i=0,s=e.length;i<s;i++){let s=e[i];s=G([s[0],s[1],s[2]],null,this.sceneView),t.push(s)}return t},this.getLength=()=>{this.points.length<2&&alert("line.length < 2");let e=0;for(let t=0,i=this.points.length;t<i-1;t++)e+=this.getLineLen(this.points[t+0],this.points[t+1]),e+=Math.abs(V(this.points[t+0],this.points[t+1],this.points[t+2],this.vec3,this.vec3d,this.sceneView,this.esriMathUtils));return this.length=e,e},this.sceneView=t,this.points=this.geoArrayToCoords(e),this.vec3=i,this.vec3d=s,this.esriMathUtils=n,this.points=xe(this.points,5,!0)}destructor(){this.points=null}getLineLen(e,t){return D(e,t)}getPoint(e,t){let i=0;for(let e=0,n=this.points.length;e<n-1;e++){const n=this.points[e+0],r=this.points[e+1],a=this.points[e+2],o=this.getLineLen(n,r);if(t<i+o){const e=t-i;return{type:"line",len:e,point:F(n,r,e/o)}}i+=o;const l=V(n,r,a,this.vec3,this.vec3d,this.sceneView,this.esriMathUtils),h=Math.abs(l);if(t<i+h){return{type:"rotate",angle:(t-i)*((s=l)<0?-1:s>0?1:0),point:r,points:{pre:n,base:r,next:a},lastLineLen:i}}i+=h}var s}}var Ue=function(e,t,i,s){return new(i||(i=Promise))((function(n,r){function a(e){try{l(s.next(e))}catch(e){r(e)}}function o(e){try{l(s.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,o)}l((s=s.apply(e,t||[])).next())}))};class _e extends Ce{constructor(){super(...arguments),this._updateInitCamera=e=>{e=this.queryGeometryElevInfo(e),this._cache.cachedGeo=this.concatGeoPaths(e),this._cache.paths=new Ee(this._cache.cachedGeo,this.sceneView,this.vec3,this.vec3d,this.esriMathUtils);const t=this._cache.paths.getLength();return this.animate.setAmount(t),e},this.getProgress=()=>this.animate.getProgress(),this.getCameraByProgress=e=>{let t,i;0===this.animate.getProgress()?(t=0*this.animate.getAmount(),this.animate.progressForward(),i=this.animate.getAmount()*this.animate.getProgress()):(t=this.animate.getAmount()*this.animate.progressBackward(),i=this.animate.getAmount()*this.animate.getProgress());const s=this._cache.paths.getPoint(0,t),n=this._cache.paths.getPoint(0,i),r=[0,0,0],a=[0,0,0],o=this.vec3d.create();if("line"===s.type){const e=s.point,t=n.point,i=e;let l=this.getCameraPosition(e,t);J(l)||(l=this._cache.cameraGL.pos),this.sceneView.renderCoordsHelper.worldUpAtPosition(l,o),r[0]=l[0],r[1]=l[1],r[2]=l[2],a[0]=i[0],a[1]=i[1],a[2]=i[2]}else if("rotate"===s.type){const e=s.points.pre,t=s.points.base,i=s.points.next,n=this.vec3d.create();this.vec3.subtract(n,t,e);const l=this.vec3d.create();this.vec3.subtract(l,i,t);const h=s.lastLineLen,c=this._cache.paths.getPoint(0,h-.02),d=this._cache.paths.getPoint(0,h-.01);let u=this.getCameraPosition(c.point,d.point);this.sceneView.renderCoordsHelper.worldUpAtPosition(t,o);const p=s.angle;u=this.rotateBySceneMode(u,o,p,t),r[0]=u[0],r[1]=u[1],r[2]=u[2],a[0]=t[0],a[1]=t[1],a[2]=t[2]}return this._cache.cameraGL.pos=r,this._cache.cameraGL.upDir=o,this._cache.lookAtTargetGL.pos=a,this._cache.lookAtTargetGL.upAxis=null,this._cache.lookAtTargetGL.baseAlt=null,{lookAt:a,camPos:r,up:o,type:s.type}},this.getApiCamera=e=>{var t;let i=e.camPos,s=e.lookAt;const n=e.up;if(!J(i)||!J(s)||!J(n))return null;let r=0,a=T(s,1,this.sceneView),o=new this.Point({x:a[0],y:a[1],z:a[2],type:"point",spatialReference:this.sceneView.spatialReference});r=o.z,o.z=parseFloat(o.z)+this.liveviewSetting.getAltitudeFactor(),o.z<0&&(o.z=0),s=G([o.x,o.y,o.z],null,this.sceneView),a=T(i,1,this.sceneView),o=new this.Point({x:a[0],y:a[1],z:a[2],type:"point",spatialReference:this.sceneView.spatialReference}),o.z=r+this.liveviewSetting.getAltitudeFactor()+this.liveviewSetting.getCamOffsetHeight(),i=G([o.x,o.y,o.z],null,this.sceneView),this._isDebug&&(null===(t=this.auxHelper)||void 0===t||t.drawLineGL([i,s],this.sceneView,"yellow"));const l=Se(this.sceneView,{eye:i,center:s,up:n});return this.cameraUtils.internalToExternal(this.sceneView,l)},this.resumeCamera=e=>Ue(this,void 0,void 0,(function*(){const t=e;try{yield this.sceneView.goTo(this.getApiCamera(this.getCameraByProgress()),{animate:t,signal:this.abortSignalHandler.update()})}catch(e){return"AbortError"===e.name&&(console.log("sceneView.goTo() Aborted"),!1)}return!0})),this.stop=e=>{super.stop();const t=e&&e.ignoreResetCameraWhenFinished;this.resetCameraWhenFinishedFlag&&!t&&(this.sceneView.goTo(this.cameraInfo),this.resetCameraWhenFinishedFlag=!1)}}setLiveviewSettingInfo(e){const t=Object.create(null,{setLiveviewSettingInfo:{get:()=>super.setLiveviewSettingInfo}});return Ue(this,void 0,void 0,(function*(){return yield t.setLiveviewSettingInfo.call(this,e,(()=>Ue(this,void 0,void 0,(function*(){const e=this.getApiCamera(this.getCameraByProgress());try{yield this.sceneView.goTo(e,{animate:!1,signal:this.abortSignalHandler.update()})}catch(e){return"AbortError"===e.name&&(console.log("sceneView.goTo() Aborted"),!1)}return!0}))))}))}getLiveViewSettingInfo(){return{tilt:null,altitude:this.liveviewSetting.getAltitudeFactor(),speed:this.liveviewSetting.getSpeedFactor()}}prepare(e){const t=Object.create(null,{preparing:{get:()=>super.preparing},prepared:{get:()=>super.prepared}});return Ue(this,void 0,void 0,(function*(){var i;let s=this.geometry;if("polyline"!==(null==s?void 0:s.type))return alert("Wrong geo type!"),!1;if(J(null==e?void 0:e.duration)&&(this.duration=e.duration),t.preparing.call(this),s=this._updateInitCamera(s),!this.isLiveviewMode){const e=this.animate.computeDuration();this.animate.init(ce.Linear,0,this.animate.getAmount(),null!==(i=this.duration)&&void 0!==i?i:e)}try{yield this.sceneView.goTo(this.getApiCamera(this.getCameraByProgress()),this.getPrepareGoToOptionsBeforeTerrainLoaded(e))}catch(e){return"AbortError"===e.name&&console.log("sceneView.goTo() Aborted"),!1}if(null==e?void 0:e.waitingForTerrain){yield this.reactiveUtils.whenOnce((()=>!this.sceneView.groundView.updating)),s=this._updateInitCamera(s);try{yield this.sceneView.goTo(this.getApiCamera(this.getCameraByProgress()),this.getPrepareGoToOptionsAfterTerrainLoaded(e))}catch(e){return"AbortError"===e.name&&console.log("sceneView.goTo() Aborted"),!1}yield this.reactiveUtils.whenOnce((()=>!this.sceneView.groundView.updating))}return yield t.prepared.call(this),!0}))}fly(e){const t=Object.create(null,{isEnableToFly:{get:()=>super.isEnableToFly}});return Ue(this,void 0,void 0,(function*(){return J(null==e?void 0:e.speedFactor)&&this.liveviewSetting.setSpeedFactor(e.speedFactor),J(null==e?void 0:e.resetCameraWhenFinished)&&(this.resetCameraWhenFinishedFlag=!0),t.isEnableToFly.call(this)?yield this.resume(e.animate):yield Promise.reject(new Error(null))}))}_doFly(){const e=Object.create(null,{_doFly:{get:()=>super._doFly}});return Ue(this,void 0,void 0,(function*(){return e._doFly.call(this),yield this.updateAnimat((e=>{this.isLiveviewMode||this.animate.easing(e.deltaTime,this.liveviewSetting.getMappingSpeedFactor()),this.updateProgressBar();if(this.animate.getProgress()>=1)this.animate.reset(),this.stop();else{const e=this.getCameraByProgress(),t=this.getApiCamera(e);J(t)&&this.sceneView.goTo(t,{animate:!1})}}))}))}getCameraPosition(e,t){var i,s,n;if(e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2])return null;const r=null!==(i=this.liveviewSetting.getCamOffsetHeight())&&void 0!==i?i:100,a=null!==(s=this.liveviewSetting.getCamOffsetDistance())&&void 0!==s?s:100,o=e,l=t,h=this.vec3d.create();this.vec3.subtract(h,o,l);const c=this.vec3.length(h),d=this.vec3d.create();this.vec3.normalize(d,h);const u=c+a,p=this.vec3d.create();this.vec3.scale(p,d,u);const g=this.vec3d.create();this.vec3.add(g,l,p);const v=T(g,1,this.sceneView),m=new this.Point({x:v[0],y:v[1],z:v[2],type:"point",spatialReference:this.sceneView.spatialReference});m.z<r&&(m.z=r),m.z<0&&(m.z=0),this._isDebug&&(null===(n=this.auxHelper)||void 0===n||n.drawPoint(m,"red"));return G([m.x,m.y,m.z],null,this.sceneView)}resume(e){const t=Object.create(null,{resume:{get:()=>super.resume}});return Ue(this,void 0,void 0,(function*(){return t.resume.call(this),yield this._resume(this.resumeCamera(e))}))}clear(){const e=Object.create(null,{clear:{get:()=>super.clear}});return Ue(this,void 0,void 0,(function*(){yield e.clear.call(this)}))}handleMapInteractionStart(){return Ue(this,void 0,void 0,(function*(){this.pause()}))}handleMapInteractionEnd(){return Ue(this,void 0,void 0,(function*(){}))}}var He=function(e,t,i,s){return new(i||(i=Promise))((function(n,r){function a(e){try{l(s.next(e))}catch(e){r(e)}}function o(e){try{l(s.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,o)}l((s=s.apply(e,t||[])).next())}))};class Be extends Ce{constructor(){super(),this.WAIT_TIME={DEFAULT:2e3},this.clearTimer=()=>{clearTimeout(this.waitingTimer),this.waitingTimer=null},this.fly=e=>He(this,void 0,void 0,(function*(){this.initTimer(!0,e)})),this.doFly=e=>He(this,void 0,void 0,(function*(){return J(null==e?void 0:e.speedFactor)&&this.liveviewSetting.setSpeedFactor(e.speedFactor),this.isInited()?this.isEnableToFly()?yield this.resume(null==e?void 0:e.animate):this.waitingTimer&&this.flyState===we.RUNNING?yield this.resume():void 0:(yield this.prepare(),yield this.resume(),!0)})),this.stop=()=>{super.stop(),super.clear()},this.handleMapInteractionStart=e=>He(this,void 0,void 0,(function*(){this._isDebug&&console.log("handleMapInteraction-Start"),this.stopAnimat(),this.clearTimer(),"mouse-wheel"===(null==e?void 0:e.type)&&this._debounceOnMouseWheel()})),this.handleMapInteractionEnd=()=>He(this,void 0,void 0,(function*(){this._isDebug&&console.log("handleMapInteraction-End"),this.clearTimer(),this.flyState===we.RUNNING&&this.initTimer(!1,null)})),this._debounceOnMouseWheel=h.lodash.debounce((()=>{this.handleMapInteractionEnd()}),500),this.pauseTime=this.WAIT_TIME.DEFAULT}prepare(e){const t=Object.create(null,{preparing:{get:()=>super.preparing}});return He(this,void 0,void 0,(function*(){return t.preparing.call(this),this.pauseTime=1e3*e.aroundMapCenterConfig.rotationPauseTime,!0}))}_doFly(){const e=Object.create(null,{_doFly:{get:()=>super._doFly}});return He(this,void 0,void 0,(function*(){return e._doFly.call(this),yield this.updateAnimat((e=>{let t=this.animate.easing(e.deltaTime,this.liveviewSetting.getMappingSpeedFactor()).step;J(this.direction)&&this.direction===s.CW&&(t=-t);const i=this.sceneView.center;this.sceneView.goTo({heading:this.sceneView.camera.heading-t,center:i},{animate:!1}).catch((function(e){if("AbortError"!==e.name)throw new Error(e);console.log("sceneView.goTo() Aborted")}))}))}))}resume(e){const t=Object.create(null,{resume:{get:()=>super.resume}});return He(this,void 0,void 0,(function*(){return t.resume.call(this),yield this._resume(!0)}))}setIsLiveview(e){return He(this,void 0,void 0,(function*(){return Promise.resolve(!0)}))}setLiveviewSettingInfo(e){return He(this,void 0,void 0,(function*(){return Promise.resolve(!0)}))}getLiveViewSettingInfo(){return{tilt:null,altitude:null,speed:null}}getProgress(){return 0}initTimer(e,t){const i=e?0:this.pauseTime;this.waitingTimer=setTimeout((()=>{this.doFly(t)}),i)}pause(){const e=Object.create(null,{pause:{get:()=>super.pause}});return He(this,void 0,void 0,(function*(){return yield e.pause.call(this),this.clearTimer(),!0}))}clear(){const e=Object.create(null,{clear:{get:()=>super.clear}});return He(this,void 0,void 0,(function*(){this.clearTimer(),yield e.clear.call(this)}))}}var ze=function(e,t,i,s){return new(i||(i=Promise))((function(n,r){function a(e){try{l(s.next(e))}catch(e){r(e)}}function o(e){try{l(s.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,o)}l((s=s.apply(e,t||[])).next())}))};class We{static make(e){return ze(this,void 0,void 0,(function*(){let t;const i=e.type;switch(i){case ye.Rotate:t=yield(new be).setup(e);break;case ye.AroundMapCenter:t=yield(new Be).setup(e);break;case ye.RealPath:t=yield(new _e).setup(e);break;case ye.Smoothed:t=yield(new Ne).setup(e);break;default:console.error("ControllerFactory error type:",i)}return t}))}}var Je,$e=function(e,t,i,s){return new(i||(i=Promise))((function(n,r){function a(e){try{l(s.next(e))}catch(e){r(e)}}function o(e){try{l(s.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,o)}l((s=s.apply(e,t||[])).next())}))};!function(e){e.RawData="rawData",e.DsInfo="dsInfo"}(Je||(Je={}));class qe{constructor(){this.Geometry=null,this.Graphic=null}setup(e,t,i,s){return $e(this,void 0,void 0,(function*(){return yield(0,d.loadArcGISJSAPIModules)(["esri/geometry","esri/Graphic"]).then((n=>$e(this,void 0,void 0,(function*(){var r,a,o,l,h;[this.Geometry,this.Graphic]=n,this.recordConfig=e,this.sceneView=t,this.flyCallbacks=i,this.controller=null,this.eventHandlers=[];const c=this.recordConfig.type;switch(c){case ye.Rotate:case ye.AroundMapCenter:case ye.RealPath:case ye.Smoothed:{let n;if((null===(r=e.storedGraphicsInfo)||void 0===r?void 0:r.type)===Je.RawData){const t=null===(o=null===(a=e.storedGraphicsInfo)||void 0===a?void 0:a.rawData)||void 0===o?void 0:o.graphics;t&&t[0]&&(n=this.Graphic.fromJSON(t[0]).geometry)}const c={id:e.idx,type:e.type,geometry:n,direction:e.direction,config:{cameraInfo:null===(l=e.controllerConfig)||void 0===l?void 0:l.cameraInfo,liveviewSettingState:null===(h=e.controllerConfig)||void 0===h?void 0:h.liveviewSettingState},sceneView:t,flyCallbacks:i};if(this.controller=yield We.make(c),s){this.eventHandlers.push(this.sceneView.on("immediate-click",(e=>{this.pause()})));const e=t.zoom,i=t.camera.heading,s=t.camera.tilt;t.goTo({target:n},{animate:!1}).then((function(){return t.goTo({zoom:e,heading:i,tilt:s},{animate:!1})}))}break}default:console.error("error type: ",c)}})))),this}))}destructor(){var e;this.eventHandlers&&this.eventHandlers.forEach((e=>{e.remove()})),null===(e=this.controller)||void 0===e||e.destructor(),this.controller=null,this.recordConfig=null}getConfig(){var e,t;return this.recordConfig.controllerConfig=null===(e=this.controller)||void 0===e?void 0:e.getConfig(),(isNaN(this.recordConfig.duration)||this.recordConfig.duration<0)&&(null===(t=this.controller)||void 0===t?void 0:t.animate.state.amount)>=0&&(this.recordConfig.duration=this.controller.animate.getDuration()/1e3),this.cachingGraphicsInfo&&(this.recordConfig.storedGraphicsInfo.rawData=this.cachingGraphicsInfo.getConfig()),this.recordConfig}prepare(e){return $e(this,void 0,void 0,(function*(){var t;return J(e)&&!J(e.animate)&&Object.assign(e,{animate:!0}),yield null===(t=this.controller)||void 0===t?void 0:t.prepare(e)}))}fly(e){return $e(this,void 0,void 0,(function*(){var t;J(e.animate)||Object.assign(e,{animate:!0}),yield null===(t=this.controller)||void 0===t?void 0:t.fly(e)}))}pause(){return $e(this,void 0,void 0,(function*(){var e;return yield null===(e=this.controller)||void 0===e?void 0:e.pause()}))}stop(e){return $e(this,void 0,void 0,(function*(){var t;null===(t=this.controller)||void 0===t||t.stop(e)}))}setGraphicsInfo(e){this.cachingGraphicsInfo=e}getGraphicsInfo(){return this.cachingGraphicsInfo}setSpeedFactor(e){var t;null===(t=this.controller)||void 0===t||t.liveviewSetting.setSpeedFactor(e)}setIsLiveview(e){return $e(this,void 0,void 0,(function*(){var t;return yield null===(t=this.controller)||void 0===t?void 0:t.setIsLiveview(e)}))}setLiveviewSettingInfo(e){return $e(this,void 0,void 0,(function*(){var t;if("function"==typeof(null===(t=this.controller)||void 0===t?void 0:t.setLiveviewSettingInfo))return yield this.controller.setLiveviewSettingInfo(e)}))}getLiveViewSettingInfo(){var e;return null===(e=this.controller)||void 0===e?void 0:e.getLiveViewSettingInfo()}getDefaultDuration(){var e;return null===(e=this.controller)||void 0===e?void 0:e.getDefaultDuration()}}var Ze=function(e,t,i,s){return new(i||(i=Promise))((function(n,r){function a(e){try{l(s.next(e))}catch(e){r(e)}}function o(e){try{l(s.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,o)}l((s=s.apply(e,t||[])).next())}))};class Xe{constructor(){this._redrawAllRecordGraphics=e=>{const t=H(this.itemConfig.routes,e);null==t||t.records.forEach((e=>{e.mapViewId!==this.jimuMapView.id&&e.mapViewId!==W(this.jimuMapView.id)||this.drawOrUpdateGraphics(e)}))}}setup(t,i,s,n,r,a,o,l,h){return Ze(this,void 0,void 0,(function*(){var c;switch(this.type=t.name,this.itemConfig=t,this.flyStateCallbacks=n,this.jimuMapView=s,this.record=null!=h?h:null,this.recordConfig=null!==(c=null==h?void 0:h.getConfig())&&void 0!==c?c:i,this.drawOrUpdateGraphics=r,this.highlightGraphics=a,this.checkAndSwitchJimuMapBeforePlay=o,this.getCurrentSceneView=l,this.type){case e.Rotate:case e.Path:this.itemConfig=t;break;case e.Route:this.itemConfig=this.itemConfig;break;default:console.error("error type:",this.type)}return this._resetPlayingInfo(),this}))}destructor(){var e;this._resetPlayingInfo(),null===(e=this.record)||void 0===e||e.destructor()}handleUpdateJimuMapView(e){var t,i;this.jimuMapView=e,(null===(t=this.playingInfo.currentIds)||void 0===t?void 0:t.ids)&&this._redrawAllRecordGraphics(null===(i=this.playingInfo.currentIds)||void 0===i?void 0:i.ids)}handleUpdateFlyCallbacks(e){this.flyStateCallbacks=e}_getFlyRecordDynamically(e,t,i){return Ze(this,void 0,void 0,(function*(){this.itemConfig=this.itemConfig;const s=B(this.itemConfig.routes,e.ids);return yield(new qe).setup(s,t,i,e.justForHighlight)}))}_getLimitationParamForPrepare(e,t){var s;const n={},r=e.getConfig().type,a=e.getConfig().duration;let o;if(r===ye.Rotate&&(o=e.getConfig().angle),r===ye.AroundMapCenter&&this.itemConfig.targetMode===i.MapCenter){const e={rotationPauseTime:this.itemConfig.rotationPauseTime||2};Object.assign(n,{aroundMapCenterConfig:e})}if(J(a)&&!isNaN(a)&&a>0&&Object.assign(n,{duration:a*this._computeRouteTaskTimeScale()*1e3}),J(o)&&Object.assign(n,{angleLimit:o}),J(t)){Object.assign(n,{animate:t.animate});const e=null===(s=t.waitingForTerrain)||void 0===s||s;Object.assign(n,{waitingForTerrain:e})}return n}highlightSpecifiedRecord(){return Ze(this,void 0,void 0,(function*(){const e=this.drawOrUpdateGraphics(this.record.getConfig());this.highlightGraphics(e.getGraphics())}))}playSpecifiedRecord(){return Ze(this,void 0,void 0,(function*(){const e=this.drawOrUpdateGraphics(this.record.getConfig());this.highlightGraphics(e.getGraphics()),yield this.record.fly({speedFactor:this.getSpeedFactor()})}))}prepare(t){return Ze(this,void 0,void 0,(function*(){switch(yield this._setSpeed(null),this.type){case e.Rotate:case e.Path:{const e=this._getLimitationParamForPrepare(this.record,t);return yield this.record.prepare(e)}case e.Route:{const e=yield this.prepareSpecifiedRecord(t,this.flyStateCallbacks);return!(!e.isCanPlay||!e.prepareState)}default:return console.error("error type:",this.type),!1}}))}fly(t){return Ze(this,void 0,void 0,(function*(){var i;switch(yield this.setSpeedFactor(t.settingSpeed),this.type){case e.Rotate:case e.Path:yield this.record.fly(Object.assign(Object.assign({},t),{speedFactor:this.getSpeedFactor()}));break;case e.Route:if(J(null===(i=this.playingInfo.currentIds)||void 0===i?void 0:i.ids))return this.flyStateCallbacks.onFly(),void(yield this.playTask());this.flyStateCallbacks.onFly(),!this._isPlayRoute(t.ids)&&t.isPreviewSpecifiedRecord?yield this.playSpecifiedRecord():yield this.playRouteFly({routeUuid:t.ids.routeUuid},0);break;default:console.error("error type:",this.type)}}))}pause(){return Ze(this,void 0,void 0,(function*(){var t;switch(this.type){case e.Rotate:case e.Path:case e.Route:yield null===(t=this.record)||void 0===t?void 0:t.pause();break;default:console.error("fly-route.pause error type:",this.type)}}))}stop(){return Ze(this,arguments,void 0,(function*(t={isUpdate:!1}){var i,s;switch(this.type){case e.Rotate:case e.Path:yield null===(i=this.record)||void 0===i?void 0:i.stop(t);break;case e.Route:if(t.isUpdate)return;yield this.pause(),this.interruptDelayWaiting(),this._onAllRecordsFinish(),yield null===(s=this.record)||void 0===s?void 0:s.stop();break;default:console.error("fly-route.stop error type:",this.type)}}))}setSpeedFactor(t){return Ze(this,void 0,void 0,(function*(){switch(this.type){case e.Rotate:case e.Path:case e.Route:}return yield this._setSpeed(t)}))}getSpeedFactor(){return this.speedFactor}_setSpeed(e){return Ze(this,void 0,void 0,(function*(){var t;if(null===e){e={speed:.5,tilt:0,altitude:0}.speed}this.speedFactor=e,this.playingInfo.isWaiting?(this.interruptDelayWaiting(),yield this.playTask()):null===(t=this.record)||void 0===t||t.setSpeedFactor(e)}))}_computeRouteTaskTimeScale(){let e=1;switch(this.speedFactor){case 0:e=8;break;case.25:e=4;break;case.375:e=2;break;case.5:default:e=1;break;case.59375:e=1/1.5;break;case.625:e=.5;break;case.75:e=1/4;break;case 1:e=1/8}return e}setIsLiveview(t,i){return Ze(this,void 0,void 0,(function*(){var s,n;switch(this.type){case e.Rotate:case e.Path:return yield this.record.setIsLiveview(t);case e.Route:if(t){const e=yield this.prepareSpecifiedRecord({ids:i},this.flyStateCallbacks);return!(!e.isCanPlay||!e.prepareState)&&(yield null===(s=this.record)||void 0===s?void 0:s.setIsLiveview(t))}return yield null===(n=this.record)||void 0===n?void 0:n.setIsLiveview(t);default:console.error("error type:",this.type)}}))}getLiveViewSettingInfo(){switch(this.type){case e.Rotate:case e.Path:case e.Route:return this.record.getLiveViewSettingInfo();default:console.error("error type:",this.type)}}getDefaultDuration(){switch(this.type){case e.Rotate:case e.Path:case e.Route:return this.record.getDefaultDuration();default:console.error("error type:",this.type)}}setLiveviewSettingInfo(t,i){return Ze(this,void 0,void 0,(function*(){var s,n;switch(this.type){case e.Rotate:case e.Path:case e.Route:{yield null===(s=this.record)||void 0===s?void 0:s.setLiveviewSettingInfo(t);(null===(n=null==i?void 0:i.isUpdateLine)||void 0===n||n)&&this.record.setGraphicsInfo(this.drawOrUpdateGraphics(this.record.getConfig()));const e=this.record.getGraphicsInfo();J(null==i?void 0:i.isNeedHighlight)&&i.isNeedHighlight&&J(e.getGraphics())&&this.highlightGraphics(e.getGraphics());break}default:console.error("error type:",this.type)}}))}_isPlayRoute(e){return J(e.routeUuid)&&!J(e.recordUuid)}prepareSpecifiedRecord(e,t){return Ze(this,void 0,void 0,(function*(){const i=e.ids;if(this._isPlayRoute(e.ids)){const t=z(this.itemConfig.routes,e.ids,0);i.recordUuid=null==t?void 0:t.idx}const{isCanPlay:s}=yield this.checkAndSwitchJimuMapBeforePlay(e.ids);if(!s)return console.error("FlyRoute.prepareSpecifiedRecord(): JimuMap is not matched"),{isCanPlay:!1,prepareState:null};this._redrawAllRecordGraphics(e.ids);let n=t;if(!!e.isBuilderSettingFlag&&(n={onFly:()=>{"function"==typeof t.onFly&&t.onFly()},onFinish:()=>{this.highlightGraphics(null),"function"==typeof t.onFinish&&t.onFinish()},onPause:()=>{this.highlightGraphics(null),"function"==typeof t.onPause&&t.onPause()}}),this.record=yield this._getFlyRecordDynamically(e,this.getCurrentSceneView(),n),e.justForHighlight)return this.highlightSpecifiedRecord(),{isCanPlay:!1,prepareState:null};const r=this._getLimitationParamForPrepare(this.record,e);return{isCanPlay:!0,prepareState:yield this.record.prepare(r)}}))}playRouteFly(e,t){return Ze(this,void 0,void 0,(function*(){const i=H(this.itemConfig.routes,e),s=i.records.length-t,n=t,r=z(this.itemConfig.routes,e,t);this.initTask({routeUuid:i.idx,recordUuid:null==r?void 0:r.idx},n,s),yield this.playTask({init:!0})}))}initTask(e,t,i){this._resetPlayingInfo(),this.playingInfo.currentIds={ids:e,orderId:t-1},this.playingInfo.maxRecordLen=i,this.playingInfo.isWaiting=!1,this.playingInfo.continueDelay=0;const s=this.getCurrentSceneView(),n=s.on("drag",(e=>{this.playingInfo.isWaiting&&"start"===e.action&&(this.interruptDelayWaiting(),this.flyStateCallbacks.onPause())})),r=s.on("mouse-wheel",(e=>{this.playingInfo.isWaiting&&(this.interruptDelayWaiting(),this.flyStateCallbacks.onPause())}));this.playingInfo.eventHandlers.push(n),this.playingInfo.eventHandlers.push(r),this._nextPlayingInfo()}_nextPlayingInfo(){var e;this.playingInfo.currentIds.orderId++;const t={routeUuid:null===(e=this.playingInfo.currentIds.ids)||void 0===e?void 0:e.routeUuid,recordUuid:null},i=z(this.itemConfig.routes,t,this.playingInfo.currentIds.orderId);this.playingInfo.currentIds.ids={routeUuid:t.routeUuid,recordUuid:null==i?void 0:i.idx}}playTask(e){return Ze(this,void 0,void 0,(function*(){var t;if(this.playingInfo.isWaiting=!1,this.playingInfo.currentIds.orderId>=this.playingInfo.maxRecordLen)return void this._onAllRecordsFinish();const i={onFinish:this._onOneRecordFinish.bind(this,{}),onPause:this._onPause.bind(this,{})},s=z(this.itemConfig.routes,this.playingInfo.currentIds.ids,this.playingInfo.currentIds.orderId);if((null==e?void 0:e.init)||(null===(t=this.record)||void 0===t?void 0:t.getConfig().idx)!==(null==s?void 0:s.idx)){const e=yield this.prepareSpecifiedRecord({ids:this.playingInfo.currentIds.ids},i);if(!e.isCanPlay)return console.warn("playTask: skip a record"),i.onFinish(),!1;if(!e.prepareState)return i.onPause(),!1}const n=this.record.getConfig().endDelay;J(n)?this.playingInfo.continueDelay=n*this._computeRouteTaskTimeScale():this.playingInfo.continueDelay=0,yield this.record.fly({speedFactor:this.getSpeedFactor()})}))}_onOneRecordFinish(){return Ze(this,void 0,void 0,(function*(){if(this._nextPlayingInfo(),J(this.playingInfo.continueDelay)){this.playingInfo.waitingPromise=this._abortWrapper(this.waitDelay(this.playingInfo.continueDelay));try{yield this.playingInfo.waitingPromise,yield this.playTask()}catch(e){}}else yield this.playTask()}))}waitDelay(e){return Ze(this,void 0,void 0,(function*(){return this.playingInfo.isWaiting=!0,yield new Promise(((t,i)=>{setTimeout((()=>{t({})}),1e3*e)}))}))}interruptDelayWaiting(){var e;J(null===(e=this.playingInfo.waitingPromise)||void 0===e?void 0:e.abort)&&this.playingInfo.waitingPromise.abort(),this.playingInfo.isWaiting=!1,this.playingInfo.continueDelay=0}_abortWrapper(e){return Ze(this,void 0,void 0,(function*(){let t;const i=new Promise(((e,i)=>t=i)),s=Promise.race([e,i]);return s.abort=t,s}))}_onPause(){var e;null===(e=this.flyStateCallbacks)||void 0===e||e.onPause()}_onAllRecordsFinish(){var e,t;this._resetPlayingInfo(),"function"==typeof(null===(e=this.flyStateCallbacks)||void 0===e?void 0:e.onFinish)&&(null===(t=this.flyStateCallbacks)||void 0===t||t.onFinish())}_resetPlayingInfo(){var e;J(null===(e=this.playingInfo)||void 0===e?void 0:e.eventHandlers)&&(this.playingInfo.eventHandlers.forEach((e=>{e.remove()})),this.playingInfo.eventHandlers=null,this.playingInfo.eventHandlers=[]),this.playingInfo={currentIds:{ids:null,orderId:0},maxRecordLen:0,waitingPromise:null,isWaiting:!1,continueDelay:0,eventHandlers:[]}}}var Qe=function(e,t,i,s){return new(i||(i=Promise))((function(n,r){function a(e){try{l(s.next(e))}catch(e){r(e)}}function o(e){try{l(s.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,o)}l((s=s.apply(e,t||[])).next())}))};class Ye{constructor(){this.sceneView=null}setup(e){return Qe(this,void 0,void 0,(function*(){return yield(0,d.loadArcGISJSAPIModules)(["esri/core/reactiveUtils"]).then((t=>{[this.reactiveUtils]=t,this.sceneView=e.sceneView,this.onTerrainLoaded=e.onTerrainLoaded,this.handleTerrainLoaded()})),this}))}handleTerrainLoaded(){return Qe(this,void 0,void 0,(function*(){yield Promise.race([this.getTerrainLoadedPromise(),this.getTimerPromise(1e4)]),this.onTerrainLoaded()}))}getTerrainLoadedPromise(){return Qe(this,void 0,void 0,(function*(){if(!this.sceneView||!this.sceneView.groundView)return!1;try{yield this.reactiveUtils.whenOnce((()=>{var e,t;return null===(t=null===(e=this.sceneView)||void 0===e?void 0:e.groundView)||void 0===t?void 0:t.updating})),yield this.reactiveUtils.whenOnce((()=>{var e,t;return!(null===(t=null===(e=this.sceneView)||void 0===e?void 0:e.groundView)||void 0===t?void 0:t.updating)}))}catch(e){return!1}return!0}))}getTimerPromise(e){return Qe(this,void 0,void 0,(function*(){return yield new Promise((t=>setTimeout(t,e)))}))}}var Ke=function(e,t,i,s){return new(i||(i=Promise))((function(n,r){function a(e){try{l(s.next(e))}catch(e){r(e)}}function o(e){try{l(s.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,o)}l((s=s.apply(e,t||[])).next())}))};class et{constructor(t){this.findFirstUsedItem=()=>{for(let e=0,t=this.itemsList.length;e<t;e++){const t=this.itemsList[e];if(t.config.isInUse)return t}return{config:null,routes:null}},this.findFirstRouteItem=()=>{for(const t of this.itemsList)if(t.config.isInUse&&e.Route===t.config.name)return t;return{config:null,routes:null}},this._findItemIdx=e=>this.itemsList.findIndex((t=>t.config.uuid===e)),this.getActiveItem=()=>this.activatedItem,this.getActiveItemConfig=()=>{var e;return null===(e=this.activatedItem)||void 0===e?void 0:e.config},this.getFlyStyle=()=>{var e;return null===(e=this.activatedItem)||void 0===e?void 0:e.config.name},this.getRouteByIdx=e=>this.getActiveItem().routes,this.getRouteConfigByIdx=e=>{var t;const i=this.getActiveItemConfig();return null===(t=null==i?void 0:i.routes)||void 0===t?void 0:t.find((t=>t.idx===e.routeUuid))},this.getRecordConfigByIds=e=>B(this.getActiveItemConfig().routes,e),this.getRecordByIds=e=>{var t;const i=null===(t=this.activatedItem.routes)||void 0===t?void 0:t.record;return e.recordUuid===(null==i?void 0:i.getConfig().idx)?i:null},this.isUesRouteFlyMode=()=>{const t=this.getActiveItemConfig();return(null==t?void 0:t.name)===e.Route},this.clear=()=>{},this.checkAndSwitchJimuMapBeforePlay=e=>Ke(this,void 0,void 0,(function*(){const t=this.getRecordConfigByIds(e);if(!J(t))return{isCanPlay:!1,hadSwitchedMap:!1};const i=this.isJimuMapViewInGroup(t.mapViewId),s=this.isCurrentJimuMap(t);return s?{isCanPlay:!0,hadSwitchedMap:!1}:i?s?{isCanPlay:!0,hadSwitchedMap:!1}:(this.onBeforeSwitchMap(),yield this.viewGroup.switchMap(),{isCanPlay:!0,hadSwitchedMap:!0}):(console.error("FlyManager.checkAndSwitchJimuMapBeforePlay: this RecordConfig can't fly in this JimuMap"),{isCanPlay:!1,hadSwitchedMap:!1})})),this.isRecordCanPlay=e=>{const t=this.isJimuMapViewInGroup(e.mapViewId),i=this.isCurrentJimuMap(e);return!!i||(!!t||(console.error("FlyManager.isRecordCanPlay: this RecordConfig can't fly in this JimuMap"),!1))},this.isJimuMapViewInGroup=e=>{var t;let i=null!=e?e:this.jimuMapView.id;i=W(i);return!!J(Object.keys(null===(t=this.viewGroup)||void 0===t?void 0:t.jimuMapViews).find((e=>W(e)===i)))},this.isCurrentJimuMap=e=>{var t;return e.mapViewId===W(null===(t=this.jimuMapView)||void 0===t?void 0:t.id)},this.getCurrentSceneView=()=>this.sceneView,this.isAroundMapCenterFlyMode=()=>{const t=this.getActiveItemConfig();return(null==t?void 0:t.name)===e.Rotate&&t.targetMode===i.MapCenter},this.stop(),this.onTerrainLoaded=t.onTerrainLoaded,this.onBeforeSwitchMap=t.onBeforeSwitchMap,this.drawOrUpdateGraphics=t.drawOrUpdateGraphics,this.highlightGraphics=t.highlightGraphics,this.onItemsUpdate=t.onItemsUpdate,this.isBuilderSettingFlag=t.isBuilderSettingFlag,this.updateViewGroup(t.viewGroup),this.updateJimuMapView(t.jimuMapView),this.uiLoadingCallbacks=t.uiLoadingCallbacks,this.flyStateCallbacks=t.flyStateCallbacks,this.updateItems(t.widgetConfig)}updateViewGroup(e){this.viewGroup=e}updateJimuMapView(e){var t;this.jimuMapView=e,this.sceneView=null===(t=this.jimuMapView)||void 0===t?void 0:t.view;const i=this.getActiveItem();J(null==i?void 0:i.routes)&&(null==i||i.routes.handleUpdateJimuMapView(e)),this.getTerrainLoadingHelper(this.sceneView,this.onTerrainLoaded)}updateItems(e){this.itemsList=[];const t=e.itemsList.asMutable({deep:!0});for(const e of t)e.isInUse&&this.itemsList.push({config:e,routes:null});"function"==typeof this.onItemsUpdate&&this.onItemsUpdate(this.itemsList)}destructor(){this.stop()}findItemByUuid(e){var t;let i=null;return i=null===(t=this.itemsList)||void 0===t?void 0:t.find((t=>t.config.uuid===e)),i}registerItem(e){const t=this.findItemByUuid(e);this.activatedItem=t}unRegisterItem(){var e;(null===(e=this.activatedItem)||void 0===e?void 0:e.routes)&&this.activatedItem.routes.destructor(),this.activatedItem=null}getControllerTypeByItemData(t){let i;return t.name===e.Rotate?i=ye.Rotate:t.name===e.Path&&(i=t.style),i}getDefaultSpeedByType(i,s){var n;let r=.5;switch(null!==(n=i.defaultSpeed)&&void 0!==n?n:null){case t.SLOW:r=.25;break;case t.DEFAULT:r=.375;break;case t.FAST:s===e.Rotate?r=.5:s===e.Path&&(r=.625);break;default:r=.5}return r}buildTemporaryRecordConfig(t,i,s){const n=this.getActiveItemConfig(),r=this.getFlyStyle();let a;r===e.Rotate?a=this.isAroundMapCenterFlyMode()?ye.AroundMapCenter:ye.Rotate:r===e.Path&&(a=this.getControllerTypeByItemData(n));return{idx:null,type:a,defaultSpeed:this.getDefaultSpeedByType(n,r),displayName:"runtime",duration:null,startDelay:null,endDelay:null,angle:null,controllerConfig:{cameraInfo:i,liveviewSettingState:null},direction:n.direction,storedGraphicsInfo:{type:Je.RawData,rawData:null==t?void 0:t.getConfig()},mapViewId:s.id}}buildTemporaryRecord(e,t,i,s){return Ke(this,void 0,void 0,(function*(){const n=yield(new qe).setup(e,t,i);return J(s)&&n.setGraphicsInfo(s),n}))}prepareRoutePreview(e,t){return Ke(this,void 0,void 0,(function*(){if(!this.isUesRouteFlyMode())return!1;const i=this.getActiveItem();return yield this.setupFly(i.config,null,null!=t?t:this.flyStateCallbacks),yield this.prepare({ids:{routeUuid:e.routeUuid},waitingForTerrain:!1})}))}previewSpecifiedRoute(e,t,i){return Ke(this,void 0,void 0,(function*(){if(!this.isUesRouteFlyMode())return;const s=this.getActiveItem(),n=null!=i?i:this.flyStateCallbacks;J(s.routes)||(yield this.prepareRoutePreview(t,n)),yield this.fly({ids:t,settingSpeed:e,isPreviewSpecifiedRecord:!1},n)}))}previewSpecifiedRecord(e,t){return Ke(this,void 0,void 0,(function*(){if(!this.isUesRouteFlyMode())return;const{isCanPlay:i}=yield this.checkAndSwitchJimuMapBeforePlay(e);if(!i)return;const s=this.getActiveItem();yield this.setupFly(s.config,null,t);(yield this.prepare({ids:e,isBuilderSettingFlag:this.isBuilderSettingFlag}))&&(yield this.fly({ids:e,settingSpeed:null,isPreviewSpecifiedRecord:!0}))}))}highlightSpecifiedRecord(e,t){return Ke(this,void 0,void 0,(function*(){if(this.highlightGraphics(null),null===e)return;const i=this.getActiveItem();yield this.setupFly(i.config,null,t),yield this.prepare({ids:e,isBuilderSettingFlag:this.isBuilderSettingFlag,justForHighlight:!0})}))}setIsLiveViewSpecifiedRecord(e,t){return Ke(this,void 0,void 0,(function*(){if(!this.isUesRouteFlyMode())return;const i=this.getActiveItem();if(J(i.routes)||(yield this.setupFly(i.config,null),yield this.prepare({ids:e,animate:!1})),yield this.setIsLiveview(t,e),t){const e=this.getLiveViewSettingInfo();this.onLiveViewParamChange(e,{isNeedHighlight:!0})}}))}loadingForUI(e){const t=null!=e?e:this.uiLoadingCallbacks;"function"==typeof t.onLoading&&t.onLoading()}loadedForUI(e){const t=null!=e?e:this.uiLoadingCallbacks;"function"==typeof t.onLoaded&&t.onLoaded()}setupFly(e,t,i,s){return Ke(this,void 0,void 0,(function*(){const n=this.getActiveItem();n.routes&&n.routes.destructor();const r=null!=i?i:this.flyStateCallbacks;return n.routes=yield(new Xe).setup(e,t,this.jimuMapView,r,this.drawOrUpdateGraphics,this.highlightGraphics,this.checkAndSwitchJimuMapBeforePlay,this.getCurrentSceneView,s),n}))}prepare(e){return Ke(this,void 0,void 0,(function*(){var t;const i=this.getActiveItem();return J(i)?yield null===(t=i.routes)||void 0===t?void 0:t.prepare(e):null}))}fly(e,t){return Ke(this,void 0,void 0,(function*(){var i,s;const n=this.getActiveItem();if(!J(n))return null;t&&(null===(i=n.routes)||void 0===i||i.handleUpdateFlyCallbacks(t)),yield null===(s=n.routes)||void 0===s?void 0:s.fly(e)}))}pause(){return Ke(this,void 0,void 0,(function*(){var e;const t=this.getActiveItem();if(!J(t))return null;yield null===(e=t.routes)||void 0===e?void 0:e.pause()}))}stop(){return Ke(this,arguments,void 0,(function*(e={isUpdate:!1}){var t;const i=this.getActiveItem();if(!J(i))return null;yield null===(t=i.routes)||void 0===t?void 0:t.stop(e)}))}getProgress(){}getLiveViewSettingInfo(){const e=this.getActiveItem();if(!J(e))return null;return e.routes.getLiveViewSettingInfo()}getDefaultDuration(){var e;const t=this.getActiveItem();return J(t)?null===(e=t.routes)||void 0===e?void 0:e.getDefaultDuration():null}setIsLiveview(e,t){return Ke(this,void 0,void 0,(function*(){var i;const s=this.getActiveItem();return J(s)?yield null===(i=s.routes)||void 0===i?void 0:i.setIsLiveview(e,t):null}))}onLiveViewParamChange(e,t){return Ke(this,void 0,void 0,(function*(){var i;const s=this.getActiveItem();if(!J(s))return null;yield null===(i=s.routes)||void 0===i?void 0:i.setLiveviewSettingInfo(e,t)}))}setSpeedFactor(e){return Ke(this,void 0,void 0,(function*(){var t;const i=this.getActiveItem();if(!J(i))return null;yield null===(t=i.routes)||void 0===t?void 0:t.setSpeedFactor(e)}))}getTerrainLoadingHelper(e,t){return Ke(this,void 0,void 0,(function*(){this.terrainLoadingHelper=yield(new Ye).setup({sceneView:e,onTerrainLoaded:t})}))}}var tt,it=function(e,t,i,s){return new(i||(i=Promise))((function(n,r){function a(e){try{l(s.next(e))}catch(e){r(e)}}function o(e){try{l(s.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,o)}l((s=s.apply(e,t||[])).next())}))};!function(e){e.RelativeToGround="relative-to-ground",e.OnTheGround="on-the-ground"}(tt||(tt={}));class st{constructor(){this.widgetId="",this.jimuMapView=null,this.GraphicsLayer=null,this.removeAllGraphics=()=>{var e,t;null===(e=this.layersGroup.layerOnTheGround)||void 0===e||e.removeAll(),null===(t=this.layersGroup.layerRelativeToGround)||void 0===t||t.removeAll()}}setup(e,t){return it(this,void 0,void 0,(function*(){return yield(0,d.loadArcGISJSAPIModules)(["esri/layers/GraphicsLayer"]).then((i=>{[this.GraphicsLayer]=i,this.widgetId=t,this.resetJimuMapView(e),this.layersGroup={layerRelativeToGround:null,layerOnTheGround:null},this.resetGraphicsLayers()})),this}))}resetJimuMapView(e){var t,i,s,n;return this.jimuMapView&&(null===(t=this.jimuMapView.view)||void 0===t||t.map.remove(null===(i=this.layersGroup)||void 0===i?void 0:i.layerRelativeToGround),null===(s=this.jimuMapView.view)||void 0===s||s.map.remove(null===(n=this.layersGroup)||void 0===n?void 0:n.layerOnTheGround)),this.jimuMapView=e,this}resetGraphicsLayers(){return this._getGraphicsLayer(tt.RelativeToGround),this._getGraphicsLayer(tt.OnTheGround),this}_getGraphicsLayer(e){var t;let i=null;const s=e+"-draw-layer-"+this.widgetId+"-"+this.jimuMapView.id;(null===(t=this.jimuMapView.view)||void 0===t?void 0:t.map)&&(i=this.jimuMapView.view.map.findLayerById(s),i||(i=new this.GraphicsLayer({id:s,listMode:"hide",title:s,elevationInfo:{mode:e}}),this.jimuMapView.view.map.add(i))),e===tt.RelativeToGround?this.layersGroup.layerRelativeToGround=i:e===tt.OnTheGround&&(this.layersGroup.layerOnTheGround=i)}}var nt=o(48993),rt=function(e,t,i,s){return new(i||(i=Promise))((function(n,r){function a(e){try{l(s.next(e))}catch(e){r(e)}}function o(e){try{l(s.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,o)}l((s=s.apply(e,t||[])).next())}))};class at extends h.React.PureComponent{constructor(e){super(e),this.Graphic=null,this.Geometry=null,this.Point=null,this.handleDrawToolCreated=e=>rt(this,void 0,void 0,(function*(){this.jimuDrawToolsRef=e,yield this.jimuDrawToolsRef.completeOperation(),this.props.onDrawHelperCreated(this)})),this.handleDrawToolsActivated=e=>{null!==e&&this._drawingModeChange(e)},this.handleDrawCancel=()=>{this._drawingModeChange(At.Null),this.props.onDrawCancel()},this._drawingModeChange=e=>{this.drawingMode=e,this.props.onDrawingModeChanged(e)},this.handleDrawStart=()=>{"function"==typeof this.props.onDrawStart&&this.props.onDrawStart()},this.handleDrawEnd=e=>{},this.handleDrawFinish=({type:e,graphics:t})=>{var i,s,n;if("deleted"===e||"modified"===e)return;if(null===(i=this.jimuDrawToolsRef.sketch.layer)||void 0===i||i.removeAll(),"aborted"===e)return void this.handleDrawCancel();const r=null===(n=null===(s=this.sceneView)||void 0===s?void 0:s.camera)||void 0===n?void 0:n.clone().toJSON(),a=t&&t[0],o=new A({graphics:null,isPicked:!1});this.drawingMode===At.Point&&(a.geometry.z&&(a.geometry.z=0),o.setGraphics(this.doDrawPoint(a)),this.props.onDrawFinish({graphicsInfo:o,cameraInfo:r,drawingMode:this.drawingMode}),this._drawingModeChange(At.Null)),this.drawingMode===At.Line&&(o.setGraphics(this.doDrawLine(a)),this.props.onDrawFinish({graphicsInfo:o,cameraInfo:r,drawingMode:this.drawingMode}),this._drawingModeChange(At.Null))},this.getGraphicsByAttrId=e=>{let t=[];const i=this.props.layersGroup.layerOnTheGround.graphics.toArray().filter((t=>t.attributes.jimuDrawId===e));return i.length>0?(t.push(i[0]),t=t.concat(this.props.layersGroup.layerRelativeToGround.graphics.toArray().filter((t=>t.attributes.jimuDrawId===e))),t):this.props.layersGroup.layerRelativeToGround.graphics.toArray().filter((t=>t.attributes.jimuDrawId===e))},this._removeGraphicsByAttrId=e=>{let t=this.props.layersGroup.layerRelativeToGround.graphics.toArray().filter((t=>t.attributes.jimuDrawId===e.attributes.jimuDrawId));t.length>0&&this.props.layersGroup.layerRelativeToGround.removeMany(t),t=this.props.layersGroup.layerOnTheGround.graphics.toArray().filter((t=>t.attributes.jimuDrawId===e.attributes.jimuDrawId)),t.length>0&&this.props.layersGroup.layerOnTheGround.removeMany(t)},this.setGeoZ=(e,t)=>{e.geometry.z=t},this._updateIds=e=>{var t,i;return void 0!==(null===(t=e.attributes)||void 0===t?void 0:t.id)&&void 0===e.attributes.jimuDrawId&&(e.attributes.jimuDrawId=null===(i=e.attributes)||void 0===i?void 0:i.id),e},this.doDrawPoint=e=>{const t=e.clone();return this._removeGraphicsByAttrId(e),this._updateIds(t),t.layer=this.props.layersGroup.layerRelativeToGround,this.props.layersGroup.layerRelativeToGround.addMany([t]),[t]},this.doDrawLine=e=>{const t=e.clone();this._removeGraphicsByAttrId(e),this._updateIds(t),t.layer=this.props.layersGroup.layerOnTheGround,this.props.layersGroup.layerOnTheGround.addMany([t]);const i=this.genStartEndPoint(t);this.props.layersGroup.layerRelativeToGround.addMany(i);let s=[];return s.push(t),s=s.concat(i),s},this.genStartEndPoint=e=>{const t=e.geometry.paths[0];return[this.genExtraPoint(t[0],e,this.materials.startPtMarker),this.genExtraPoint(t[t.length-1],e,this.materials.endPtMarker)]},this.genExtraPoint=(e,t,i)=>{let s=e;return"local"===this.sceneView.viewingMode?s=new this.Point({x:s[0],y:s[1],z:0,spatialReference:this.sceneView.spatialReference}):(s=this.webMercatorUtils.xyToLngLat(s[0],s[1]),s=new this.Point({x:s[0],y:s[1],z:s[2]})),s=new this.Graphic({geometry:s,symbol:i,layer:this.props.layersGroup.layerRelativeToGround,attributes:{jimuDrawId:t.attributes.jimuDrawId}}),s},this.updateLineByAltitude=(e,t)=>{var i;const s=0===t,n=this.getGraphicsByAttrId(e.attributes.jimuDrawId),r=n[0].clone(),a=n[1].clone(),o=n[2].clone();if(this._removeGraphicsByAttrId(r),s)r.layer=this.props.layersGroup.layerOnTheGround,this.props.layersGroup.layerOnTheGround.addMany([r]);else{r.layer=this.props.layersGroup.layerRelativeToGround;const e=r.geometry;e.hasZ=!0,J(null===(i=e.paths)||void 0===i?void 0:i.length)&&(e.paths.forEach((e=>{e.forEach((e=>{e[2]=t}))})),this.props.layersGroup.layerRelativeToGround.addMany([r]))}return a.layer=this.props.layersGroup.layerRelativeToGround,o.layer=this.props.layersGroup.layerRelativeToGround,this.setGeoZ(a,t),this.setGeoZ(o,t),this.props.layersGroup.layerRelativeToGround.addMany([a,o]),[r,a,o]},this.startDrawing=e=>{var t,i,s,n;"function"==typeof(null===(t=this.jimuDrawToolsRef)||void 0===t?void 0:t.sketch.cancel)&&(null===(i=this.jimuDrawToolsRef)||void 0===i||i.sketch.cancel()),At.Point===e&&(this.jimuDrawToolsRef.sketch.viewModel.pointSymbol=this.defaultSymbols.getDefaultPointSymbol([54,213,22]),null===(s=this.jimuDrawToolsRef)||void 0===s||s.sketch.create(e)),At.Line===e&&(this.jimuDrawToolsRef.sketch.viewModel.polylineSymbol=this.defaultSymbols.getDefaultLineSymbol([13,137,255]),null===(n=this.jimuDrawToolsRef)||void 0===n||n.sketch.create(e))},this.cancelDrawing=()=>{var e,t,i;this.handleDrawCancel(),"function"==typeof(null===(e=this.jimuDrawToolsRef)||void 0===e?void 0:e.sketch.cancel)&&J(null===(t=this.jimuDrawToolsRef)||void 0===t?void 0:t.sketch.viewModel)&&(null===(i=this.jimuDrawToolsRef)||void 0===i||i.sketch.cancel())},this.createOrUpdateGraphic=(e,t,i)=>{var s,n;e.geometry.paths?e.symbol=this.materials.lineSymbol.toJSON():e.symbol=this.materials.startPtMarker.toJSON();const r="function"==typeof e.clone?e.clone():this.Graphic.fromJSON(e);if("point"===r.geometry.type)return this.doDrawPoint(r);if("polyline"===r.geometry.type){i&&((null===(s=r.layer)||void 0===s?void 0:s.id)===this.props.layersGroup.layerRelativeToGround.id&&(null===(n=r.layer)||void 0===n?void 0:n.id)===this.props.layersGroup.layerOnTheGround.id||(r.geometry=O(r.geometry,this.sceneView)));let e=this.doDrawLine(r);return J(null==t?void 0:t.fixAltitude)&&!isNaN(null==t?void 0:t.fixAltitude)&&(e=this.updateLineByAltitude(r,null==t?void 0:t.fixAltitude)),e}},this.removeGraphics=e=>{J(e)&&(this.props.layersGroup.layerRelativeToGround.removeMany(e),this.props.layersGroup.layerOnTheGround.removeMany(e))},this.removeAll=()=>{var e,t;null===(e=this.props.layersGroup.layerRelativeToGround)||void 0===e||e.removeAll(),null===(t=this.props.layersGroup.layerOnTheGround)||void 0===t||t.removeAll()},this.drawPickedLineStartEndPoints=e=>this.doDrawLine(e),this.removePickedLineStartEndPoints=e=>{this._removeGraphicsByAttrId(e)},this.state={apiLoaded:!1},this.drawingMode=At.Null}componentDidMount(){var e;this.state.apiLoaded||(0,d.loadArcGISJSAPIModules)(["esri/Graphic","esri/geometry/Geometry","esri/geometry/Point","esri/geometry/support/webMercatorUtils"]).then((e=>rt(this,void 0,void 0,(function*(){[this.Graphic,this.Geometry,this.Point,this.webMercatorUtils]=e,this.defaultSymbols=yield(new x).setup(),this.materials={markerColor:[13,137,255],markerSize:10,outlineColor:"[128, 128, 128, 0.8]",startPtMarker:this.defaultSymbols.getDefaultPointSymbol([54,213,22]),endPtMarker:this.defaultSymbols.getDefaultPointSymbol([255,65,89]),lineColor:[13,137,255,.5],lineSymbol:this.defaultSymbols.getDefaultLineSymbol([13,137,255])},this.setState({apiLoaded:!0})})))),this.sceneView=null===(e=this.props.jimuMapView)||void 0===e?void 0:e.view}componentDidUpdate(e,t){var i;this.props.jimuMapView!==e.jimuMapView&&(this.removeAll(),this.sceneView=null===(i=this.props.jimuMapView)||void 0===i?void 0:i.view)}render(){return this.state.apiLoaded&&this.props.jimuMapView&&this.props.layersGroup.layerOnTheGround&&this.props.layersGroup.layerRelativeToGround&&(0,h.jsx)("div",{style:{display:"none"}},(0,h.jsx)(nt.JimuDraw,{jimuMapView:this.props.jimuMapView,operatorWidgetId:this.props.widgetId,onJimuDrawCreated:this.handleDrawToolCreated,onToolsActivated:this.handleDrawToolsActivated,onDrawingStarted:this.handleDrawStart,onDrawingFinished:this.handleDrawEnd,onDrawingCanceled:this.handleDrawCancel,onDrawingUpdated:this.handleDrawFinish,drawingOptions:{creationMode:nt.JimuDrawCreationMode.Update,updateOnGraphicClick:!1,defaultCreateOptions:{hasZ:!0},defaultUpdateOptions:{enableZ:!1},drawingElevationMode3D:nt.DrawingElevationMode3D.RelativeToGround},disableSymbolSelector:!0,defaultSymbols:{pointSymbol:this.materials.startPtMarker,polylineSymbol:this.materials.lineSymbol}}))}}var ot=o(50313),lt=o.n(ot),ht=function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(s=Object.getOwnPropertySymbols(e);n<s.length;n++)t.indexOf(s[n])<0&&Object.prototype.propertyIsEnumerable.call(e,s[n])&&(i[s[n]]=e[s[n]])}return i};const ct=e=>{const t=window.SVG,{className:i}=e,s=ht(e,["className"]),n=(0,h.classNames)("jimu-icon jimu-icon-component",i);return t?h.React.createElement(t,Object.assign({className:n,src:lt()},s)):h.React.createElement("svg",Object.assign({className:n},s))};class dt extends h.React.PureComponent{constructor(e){super(e),this.onPickBtnClick=()=>{this.props.onPickingStateChanged(!this.props.isPicking)},this.insertAttrId=e=>(J(e)&&(J(e.attributes)||(e.attributes={}),J(e.attributes.id)&&!J(e.attributes.jimuDrawId)?e.attributes.jimuDrawId=e.attributes.id:J(e.attributes.jimuDrawId)||(e.attributes.jimuDrawId=h.utils.getUUID())),e),this.pointerMoveHandler=e=>{var t;this.props.isPicking&&(null===(t=this.props.jimuMapView)||void 0===t||t.view.hitTest(e).then((e=>{const t=e.results.filter((e=>"graphic"===e.type));if((null==t?void 0:t.length)>0){const e=t[0].graphic;this.props.onHoverPicking([e])}})))},this.pointerClickHandler=e=>{var t;this.props.isPicking&&(null===(t=this.props.jimuMapView)||void 0===t||t.view.hitTest(e).then((t=>{this.clickGraphicsByPick(t,e)})))},this.clickGraphicsByPick=(e,t)=>{var i,s;this.props.onPickingStateChanged(!1);const n=(null===(i=this.props.jimuMapView)||void 0===i?void 0:i.view).camera.clone().toJSON(),r=e.results;if((null==r?void 0:r.length)>0){t.stopPropagation();let e=r.filter((e=>"graphic"===e.type))[0].graphic;e=this.insertAttrId(e);const i=e.geometry;if(!i)return;if("polyline"===i.type)this.pickAndClickLine(e,n);else if("point"===i.type){let t;i.hasZ||(t=O(i,null===(s=this.props.jimuMapView)||void 0===s?void 0:s.view)),this.pickAndClickPoint(e,n,t)}}},this.pickAndClickPoint=(e,t,i)=>{const s=new A({graphics:[e],isPicked:!0});this.props.onPicked({graphicsInfo:s,cameraInfo:t,hitPointWithZ:i,pickMode:"point"})},this.pickAndClickLine=(e,t)=>{const i=new A({graphics:[e],isPicked:!0});this.props.onPicked({graphicsInfo:i,cameraInfo:t,hitPointWithZ:null,pickMode:"polyline"})},this.state={isPicking:!1},this._clearEvents(),this._resetEvents()}componentWillUnmount(){this._clearEvents()}_clearEvents(){J(this.pointerMoveEvent)&&(this.pointerMoveEvent.remove(),this.pointerMoveEvent=null),J(this.pointerDownEvent)&&(this.pointerDownEvent.remove(),this.pointerDownEvent=null)}_resetEvents(){var e,t;this.pointerMoveEvent=null===(e=this.props.jimuMapView)||void 0===e?void 0:e.view.on("pointer-move",this.pointerMoveHandler),this.pointerDownEvent=null===(t=this.props.jimuMapView)||void 0===t?void 0:t.view.on("pointer-down",this.pointerClickHandler)}componentDidUpdate(e){this.props.jimuMapView!==e.jimuMapView&&(this._clearEvents(),this._resetEvents())}render(){const e=!this.props.isDrawHelperLoaded||this.props.isPlaying,t=this.props.intl.formatMessage({id:"triggerSelectFeature",defaultMessage:w});return(0,h.jsx)(c.Button,{icon:!0,onClick:e=>{this.onPickBtnClick()},disabled:e,active:this.props.isPicking,"aria-pressed":this.props.isPicking,title:t,"aria-label":t,className:"btns pick-btn",type:"tertiary"},(0,h.jsx)(ct,null))}}class ut extends h.React.PureComponent{constructor(t){super(t),this._resetHighlightCache=()=>{this.highlightCache={hover:{graphic:null,handler:null},selected:{graphics:null,handler:null}}},this.removeHoverHighlightCache=()=>{J(this.highlightCache.hover.handler)&&this.highlightCache.hover.handler.remove(),this.highlightCache.hover.graphic=null,this.highlightCache.hover.handler=null},this.cacheHoverHighlight=(e,t)=>{this.highlightCache.hover.graphic=t,this.highlightCache.hover.handler=e},this.removeSelectedHighlightCache=()=>{J(this.highlightCache.selected.handler)&&this.highlightCache.selected.handler.remove(),this.highlightCache.selected.graphics=null,this.highlightCache.selected.handler=null},this.cacheSelectedHighlight=(e,t)=>{this.highlightCache.selected.graphics=t,this.highlightCache.selected.handler=e},this.highlightGraphicsByHover=t=>{var i,s;const n=J(t)?t[0]:null;if(null===n)return;const r=null===(i=null==n?void 0:n.geometry)||void 0===i?void 0:i.type;("polyline"===r&&this.props.flyStyle===e.Path||"point"===r&&this.props.flyStyle===e.Rotate)&&(null===(s=this.props.jimuMapView)||void 0===s||s.view.whenLayerView(n.layer).then((e=>{const t=e;this.cacheHoverHighlight(t.highlight(n),n)})))},this.highlightGraphicsBySelect=e=>{var t;const i=J(e)?e[0]:null;null!==i&&(null===(t=this.props.jimuMapView)||void 0===t||t.view.whenLayerView(i.layer).then((t=>{const s=t.highlight(i);this.cacheSelectedHighlight(s,e)})))},this.clear=()=>{this.removeHoverHighlightCache(),this.removeSelectedHighlightCache()},this._resetHighlightCache()}componentDidUpdate(e){this.props.hoverPickingGraphics!==e.hoverPickingGraphics&&(this.removeHoverHighlightCache(),this.highlightGraphicsByHover(this.props.hoverPickingGraphics)),this.props.selectedPickingGraphics!==e.selectedPickingGraphics&&(this.removeSelectedHighlightCache(),this.highlightGraphicsBySelect(this.props.selectedPickingGraphics))}componentWillUnmount(){this.clear(),this._resetHighlightCache()}render(){return null}}class pt extends h.React.PureComponent{constructor(e){super(e),this.componentDidMount=()=>{this.props.onPopupHelperCreated(this)},this.componentWillUnmount=()=>{this.restoreMapPopupHighlightState()},this.clearCacheMapState=()=>{this.mapPopupState={popup:null,hightLight:null}},this.enablePopupAndHighlight=()=>{const e=this.props.jimuMapView;J(e)&&(e.enableClickOpenPopup(),e.enableClickHighlight())},this.disablePopupAndHighlight=()=>{const e=this.props.jimuMapView;J(e)&&(e.disableClickOpenPopup(),e.disableClickHighlight())},this.cacheMapPopupHighlightState=()=>{var e,t;this.mapPopupState.popup=null===(e=this.props.jimuMapView)||void 0===e?void 0:e.isClickOpenPopupEnabled(),this.mapPopupState.hightLight=null===(t=this.props.jimuMapView)||void 0===t?void 0:t.isClickHighlightEnabled()},this.restoreMapPopupHighlightState=()=>{const e=this.props.jimuMapView,t=null!==this.mapPopupState.popup&&null!==this.mapPopupState.hightLight;if(J(e)&&(null==e?void 0:e.view)&&t){let t=!1;const i=this.mapPopupState.popup;i?(e.enableClickOpenPopup(),t=!0):i||(e.disableClickOpenPopup(),t=!0);const s=this.mapPopupState.hightLight;s?(e.enableClickHighlight(),t=!0):s||(e.disableClickHighlight(),t=!0),t&&this.clearCacheMapState()}},this.mapPopupState={popup:null,hightLight:null},this.clearCacheMapState()}render(){return null}}class gt extends h.React.PureComponent{constructor(){super(...arguments),this.TRANSPARENT_GIF="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="}render(){const e={borderRadius:"50%",border:"none",backgroundColor:this.props.theme.ref.palette.neutral[600]};return(0,h.jsx)(h.React.Fragment,null,(0,h.jsx)(c.Button,{icon:!0,type:"tertiary",className:"btns "+this.props.className,disabled:!0},(0,h.jsx)(c.Icon,{icon:this.TRANSPARENT_GIF,style:e})))}}var vt=o(74919),mt=o.n(vt),ft=function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(s=Object.getOwnPropertySymbols(e);n<s.length;n++)t.indexOf(s[n])<0&&Object.prototype.propertyIsEnumerable.call(e,s[n])&&(i[s[n]]=e[s[n]])}return i};const yt=e=>{const t=window.SVG,{className:i}=e,s=ft(e,["className"]),n=(0,h.classNames)("jimu-icon jimu-icon-component",i);return t?h.React.createElement(t,Object.assign({className:n,src:mt()},s)):h.React.createElement("svg",Object.assign({className:n},s))};var wt=o(86058),Mt=o.n(wt),Ct=function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(s=Object.getOwnPropertySymbols(e);n<s.length;n++)t.indexOf(s[n])<0&&Object.prototype.propertyIsEnumerable.call(e,s[n])&&(i[s[n]]=e[s[n]])}return i};const St=e=>{const t=window.SVG,{className:i}=e,s=Ct(e,["className"]),n=(0,h.classNames)("jimu-icon jimu-icon-component",i);return t?h.React.createElement(t,Object.assign({className:n,src:Mt()},s)):h.React.createElement("svg",Object.assign({className:n},s))};var Pt=o(3981),bt=o.n(Pt),It=function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(s=Object.getOwnPropertySymbols(e);n<s.length;n++)t.indexOf(s[n])<0&&Object.prototype.propertyIsEnumerable.call(e,s[n])&&(i[s[n]]=e[s[n]])}return i};const xt=e=>{const t=window.SVG,{className:i}=e,s=It(e,["className"]),n=(0,h.classNames)("jimu-icon jimu-icon-component",i);return t?h.React.createElement(t,Object.assign({className:n,src:bt()},s)):h.React.createElement("svg",Object.assign({className:n},s))};var At,Lt,Gt=function(e,t,i,s){return new(i||(i=Promise))((function(n,r){function a(e){try{l(s.next(e))}catch(e){r(e)}}function o(e){try{l(s.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,o)}l((s=s.apply(e,t||[])).next())}))};!function(e){e.Null="null",e.Point="point",e.Line="polyline"}(At||(At={})),function(e){e.Point="point",e.Line="polyline",e.Pick="pick",e.Clear="clear"}(Lt||(Lt={}));class Tt extends h.React.PureComponent{constructor(t){super(t),this._isInCludeShowItem=e=>this.props.showItems.includes(e),this.handleDrawHelperCreated=e=>{this.drawHelperRef=e,this.setState({isDrawHelperLoaded:!0}),this.props.onRef(this)},this.handleDrawingModeChanged=e=>{At.Null!==e&&this.setState({isPicking:!1}),this.setState({drawingMode:e}),"function"==typeof this.props.onDrawingModeChanged&&this.props.onDrawingModeChanged(e)},this.getDrawBtnContent=()=>{const t=this._isInCludeShowItem(Lt.Point),i=this._isInCludeShowItem(Lt.Line),s=!!this.props.isDisabled||(this.props.isPlaying||!this.state.isDrawHelperLoaded),n=this.props.intl.formatMessage({id:"triggerDrawPoint",defaultMessage:f}),r=this.props.intl.formatMessage({id:"triggerDrawPath",defaultMessage:y}),a=this.props.flyStyle;return(0,h.jsx)(h.React.Fragment,null,t&&(a===e.Rotate||null===a)&&(0,h.jsx)(c.Button,{icon:!0,className:"oper-btns btns draw-btn",type:"tertiary",css:this.getBtnStyleForBuilder(),onClick:()=>{this.onDrawBtnClick(At.Point,{isTriggerCancel:!0})},disabled:s,title:n,"aria-label":n,active:At.Point===this.state.drawingMode,"aria-pressed":At.Point===this.state.drawingMode},(0,h.jsx)(yt,null)),i&&(a===e.Path||null===a)&&(0,h.jsx)(c.Button,{icon:!0,className:"oper-btns btns draw-btn",type:"tertiary",css:this.getBtnStyleForBuilder(),onClick:()=>{this.onDrawBtnClick(At.Line,{isTriggerCancel:!0})},disabled:s,title:r,"aria-label":r,active:At.Line===this.state.drawingMode,"aria-pressed":At.Line===this.state.drawingMode},(0,h.jsx)(St,null)))},this.onDrawBtnClick=(e,t)=>{var i,s;(null==t?void 0:t.isTriggerCancel)&&(null===(i=this.drawHelperRef)||void 0===i||i.cancelDrawing());e===this.state.drawingMode||At.Point!==e&&At.Line!==e||null===(s=this.drawHelperRef)||void 0===s||s.startDrawing(e)},this.handleDrawStart=()=>{this.beforInteract()},this.handleDrawEnd=()=>null,this.handleDrawFinish=e=>{var t;const i=e.graphicsInfo.getGraphics();null!==this.state.selectedPickingGraphics&&(null===(t=this.drawHelperRef)||void 0===t||t.removePickedLineStartEndPoints(this.state.selectedPickingGraphics[0])),this.props.onDrawFinish(e,!1),this.highlightGraphics(i),this.focusGraphics(i),this.afterInteract()},this.handleDrawCancel=()=>{this.afterInteract(),"function"==typeof this.props.onDrawCancel&&this.props.onDrawCancel()},this.getPickBtnContent=()=>(0,h.jsx)(dt,{jimuMapView:this.props.jimuMapView,intl:this.props.intl,isPlaying:this.props.isPlaying,isDrawHelperLoaded:this.state.isDrawHelperLoaded,drawingMode:this.state.drawingMode,isPicking:this.state.isPicking,onPicked:this.handlePicked,onPickingStateChanged:this.handlePickingStateCahnged,onHoverPicking:this.handleHoverPicking,hoveredGraphic:this.state.hoveredGraphic}),this.handleHoverPicking=e=>{this.setState({hoverPickingGraphics:e})},this.handlePickingStateCahnged=e=>{e?this.drawHelperRef.cancelDrawing():e||this.setState({hoverPickingGraphics:null}),this.setState({isPicking:e})},this.handlePicked=e=>{if(!this.validPickingByType(e))return;this.clearAll();let t=e.graphicsInfo.getGraphics();const i=t[0];setTimeout((()=>{if("polyline"===i.geometry.type){const e=this.drawHelperRef.drawPickedLineStartEndPoints(i);t=[i,e[1],e[2]]}this.highlightGraphics(t),this.focusGraphics(t),this.props.onPickHandler(e)}),10)},this.validPickingByType=t=>{let i=!1;return(this.props.flyStyle===e.Rotate&&"point"===t.pickMode||this.props.flyStyle===e.Path&&"polyline"===t.pickMode)&&(i=!0),i},this.highlight=e=>{null===e?this.clearHighlightGraphics():(this.highlightGraphics(e),this.focusGraphics(e))},this.clearHighlightGraphics=()=>{this.setState({selectedPickingGraphics:null}),this.setState({hoverPickingGraphics:null})},this.highlightGraphics=e=>{this.setState({selectedPickingGraphics:e})},this.getClearBtnContent=()=>{const e=this.props.intl.formatMessage({id:"triggerClear",defaultMessage:M}),t=this.props.isPlaying||null===this.props.focusedGraphic;return(0,h.jsx)(c.Button,{icon:!0,onClick:this.handleClearBtnClick,disabled:t,title:e,"aria-label":e,className:"btns clear-btn",type:"tertiary"},(0,h.jsx)(xt,null))},this.focusGraphics=e=>{this.props.onFocusedGraphicChanged(null);const t=null===e?null:e[0];this.props.onFocusedGraphicChanged(t)},this.handlePopupHelperCreated=e=>{this.popupHelperRef=e},this.beforInteract=()=>{var e,t;null===(e=this.popupHelperRef)||void 0===e||e.cacheMapPopupHighlightState(),null===(t=this.popupHelperRef)||void 0===t||t.disablePopupAndHighlight()},this.afterInteract=()=>{setTimeout((()=>{this.restoreMapPopupHighlightState()}),10)},this.restoreMapPopupHighlightState=()=>{var e;null===(e=this.popupHelperRef)||void 0===e||e.restoreMapPopupHighlightState()},this.handleClearBtnClick=()=>{this.clearAll(),this.focusGraphics(null),this.props.onClearBtnClick()},this.clearAll=()=>{var e,t;this.highlight(null),null===(e=this.popupHelperRef)||void 0===e||e.restoreMapPopupHighlightState(),null===(t=this.drawHelperRef)||void 0===t||t.removeAll()},this.onRenderStateChange=e=>{void 0!==(null==e?void 0:e.drawingMode)&&(this.handleDrawingModeChanged(e.drawingMode),this.onDrawBtnClick(e.drawingMode,{isTriggerCancel:!1})),null==e||e.isPicking},this.drawOrUpdateGraphics=e=>{var t;const i=e.storedGraphicsInfo.rawData,s=i.graphics[0],n=i.isPicked,r=null===(t=e.controllerConfig)||void 0===t?void 0:t.liveviewSettingState;let a;if(n){const e=s;a="polyline"===e.geometry.type||J(e.geometry.paths)?this.drawHelperRef.createOrUpdateGraphic(e,r,n):i.graphics}else a=this.drawHelperRef.createOrUpdateGraphic(s,r,n);return new A({graphics:a,isPicked:n})},this.removeGraphics=e=>{var t;null===(t=this.drawHelperRef)||void 0===t||t.removeGraphics(e)},this.removeAllGraphics=()=>{var e;null===(e=this.drawLayersGroup)||void 0===e||e.removeAllGraphics()},this.query=()=>null,this.state={apiLoaded:!1,layersGroup:{layerRelativeToGround:null,layerOnTheGround:null},isDrawHelperLoaded:!1,drawingMode:At.Null,isPicking:!1,hoveredGraphic:null,hoverPickingGraphics:null,selectedPickingGraphics:null}}componentDidMount(){return Gt(this,void 0,void 0,(function*(){this.state.apiLoaded||(this.drawLayersGroup=yield(new st).setup(this.props.jimuMapView,this.props.widgetId),this.setState({apiLoaded:!0}),this.setState({layersGroup:this.drawLayersGroup.layersGroup}))}))}componentWillUnmount(){this.clearAll(),this.drawLayersGroup&&(this.drawLayersGroup=null),this.props.onRef(null)}componentDidUpdate(e,t){this.props.jimuMapView!==e.jimuMapView&&(this.setState({hoverPickingGraphics:null}),this.setState({selectedPickingGraphics:null}),setTimeout((()=>{var e,t;null===(e=this.drawLayersGroup)||void 0===e||e.resetJimuMapView(this.props.jimuMapView),null===(t=this.drawLayersGroup)||void 0===t||t.resetGraphicsLayers(),this.state.apiLoaded&&this.setState({layersGroup:this.drawLayersGroup.layersGroup})}),20))}render(){let e=null;return e=(0,h.jsx)("div",null,(0,h.jsx)(h.React.Fragment,null,(!this.state.apiLoaded||!this.state.isDrawHelperLoaded)&&(0,h.jsx)(h.React.Fragment,null,this._isInCludeShowItem(Lt.Point)&&(0,h.jsx)(gt,{theme:this.props.theme,className:"draw-btn"}),this._isInCludeShowItem(Lt.Pick)&&(0,h.jsx)(gt,{theme:this.props.theme,className:"pick-btn"}),this._isInCludeShowItem(Lt.Line)&&(0,h.jsx)(gt,{theme:this.props.theme,className:"clear-btn"})),this.state.apiLoaded&&this.state.isDrawHelperLoaded&&(0,h.jsx)(h.React.Fragment,null,this.getDrawBtnContent(),this._isInCludeShowItem(Lt.Pick)&&this.getPickBtnContent(),this._isInCludeShowItem(Lt.Clear)&&this.getClearBtnContent()),(0,h.jsx)(at,{jimuMapView:this.props.jimuMapView,widgetId:this.props.widgetId,onDrawHelperCreated:this.handleDrawHelperCreated,onDrawingModeChanged:this.handleDrawingModeChanged,onDrawStart:this.handleDrawStart,onDrawEnd:this.handleDrawEnd,onDrawFinish:this.handleDrawFinish,onDrawCancel:this.handleDrawCancel,layersGroup:this.state.layersGroup}),(0,h.jsx)(ut,{jimuMapView:this.props.jimuMapView,flyStyle:this.props.flyStyle,hoverPickingGraphics:this.state.hoverPickingGraphics,selectedPickingGraphics:this.state.selectedPickingGraphics}),(0,h.jsx)(pt,{jimuMapView:this.props.jimuMapView,onPopupHelperCreated:this.handlePopupHelperCreated}))),e}getBtnStyleForBuilder(){var e,t,i;const s=null===(e=this.props.theme)||void 0===e?void 0:e.arcgis,n=null===(t=null==s?void 0:s.components)||void 0===t?void 0:t.button,{default:r}=null!==(i=null==n?void 0:n.variants)&&void 0!==i?i:{},a=null==r?void 0:r.active;return h.css`
      &.btns.active {
        color: ${a.color} !important;
        background-color: ${a.bg} !important;
        border-radius: ${a.borderRadius} !important;
        box-shadow: ${a.shadow} !important;
      }
    `}}var Rt=o(93303),jt=o.n(Rt),Dt=function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(s=Object.getOwnPropertySymbols(e);n<s.length;n++)t.indexOf(s[n])<0&&Object.prototype.propertyIsEnumerable.call(e,s[n])&&(i[s[n]]=e[s[n]])}return i};const Ft=e=>{const t=window.SVG,{className:i}=e,s=Dt(e,["className"]),n=(0,h.classNames)("jimu-icon jimu-icon-component",i);return t?h.React.createElement(t,Object.assign({className:n,src:jt()},s)):h.React.createElement("svg",Object.assign({className:n},s))};var Vt=o(97408),Ot=o.n(Vt),kt=function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(s=Object.getOwnPropertySymbols(e);n<s.length;n++)t.indexOf(s[n])<0&&Object.prototype.propertyIsEnumerable.call(e,s[n])&&(i[s[n]]=e[s[n]])}return i};const Nt=e=>{const t=window.SVG,{className:i}=e,s=kt(e,["className"]),n=(0,h.classNames)("jimu-icon jimu-icon-component",i);return t?h.React.createElement(t,Object.assign({className:n,src:Ot()},s)):h.React.createElement("svg",Object.assign({className:n},s))};var Et=o(40904),Ut=o.n(Et),_t=function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(s=Object.getOwnPropertySymbols(e);n<s.length;n++)t.indexOf(s[n])<0&&Object.prototype.propertyIsEnumerable.call(e,s[n])&&(i[s[n]]=e[s[n]])}return i};const Ht=e=>{const t=window.SVG,{className:i}=e,s=_t(e,["className"]),n=(0,h.classNames)("jimu-icon jimu-icon-component",i);return t?h.React.createElement(t,Object.assign({className:n,src:Ut()},s)):h.React.createElement("svg",Object.assign({className:n},s))};var Bt=o(26900),zt=o.n(Bt),Wt=function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(s=Object.getOwnPropertySymbols(e);n<s.length;n++)t.indexOf(s[n])<0&&Object.prototype.propertyIsEnumerable.call(e,s[n])&&(i[s[n]]=e[s[n]])}return i};const Jt=e=>{const t=window.SVG,{className:i}=e,s=Wt(e,["className"]),n=(0,h.classNames)("jimu-icon jimu-icon-component",i);return t?h.React.createElement(t,Object.assign({className:n,src:zt()},s)):h.React.createElement("svg",Object.assign({className:n},s))};var $t=o(39815),qt=o.n($t),Zt=function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(s=Object.getOwnPropertySymbols(e);n<s.length;n++)t.indexOf(s[n])<0&&Object.prototype.propertyIsEnumerable.call(e,s[n])&&(i[s[n]]=e[s[n]])}return i};const Xt=e=>{const t=window.SVG,{className:i}=e,s=Zt(e,["className"]),n=(0,h.classNames)("jimu-icon jimu-icon-component",i);return t?h.React.createElement(t,Object.assign({className:n,src:qt()},s)):h.React.createElement("svg",Object.assign({className:n},s))};var Qt=o(24362),Yt=o.n(Qt),Kt=function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(s=Object.getOwnPropertySymbols(e);n<s.length;n++)t.indexOf(s[n])<0&&Object.prototype.propertyIsEnumerable.call(e,s[n])&&(i[s[n]]=e[s[n]])}return i};const ei=e=>{const t=window.SVG,{className:i}=e,s=Kt(e,["className"]),n=(0,h.classNames)("jimu-icon jimu-icon-component",i);return t?h.React.createElement(t,Object.assign({className:n,src:Yt()},s)):h.React.createElement("svg",Object.assign({className:n},s))};var ti=function(e,t,i,s){return new(i||(i=Promise))((function(n,r){function a(e){try{l(s.next(e))}catch(e){r(e)}}function o(e){try{l(s.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,o)}l((s=s.apply(e,t||[])).next())}))};class ii extends h.React.PureComponent{constructor(t){super(t),this.onTerrainLoaded=()=>{this.setState({isTerrainLoaded:!0})},this.handleFlyManagerItemsUpdate=e=>{this.setState({flyManagerItems:e})},this.handleRefGraphicInteractionManager=e=>{this.setState({graphicInteractionManagerRef:e}),null!==e?this.setState({subCompsLoaded:!0}):this.setState({subCompsLoaded:!1})},this.isAutoControlWidgetIdChanged=e=>e.autoControlWidgetId&&this.props.autoControlWidgetId!==e.autoControlWidgetId,this.handleAutoControlMapPublish=()=>{(0,h.getAppStore)().dispatch(h.appActions.requestAutoControlMapWidget(this.props.useMapWidgetIds[0],this.props.widgetId))},this.resetDefaultUI=e=>{var t,i;this.setState({isFlyStylePopupOpen:!1}),this.setState({isLiveView:!1}),null===(t=this.state.graphicInteractionManagerRef)||void 0===t||t.onRenderStateChange({drawingMode:At.Null,isPicking:!1}),this.handleStop({ignoreResetCameraWhenFinished:!0}),(null==e?void 0:e.isCleanGraphics)&&(this.handleFocusedGraphicChanged(null),null===(i=this.state.graphicInteractionManagerRef)||void 0===i||i.clearAll())},this.handleFlyStyleChange=e=>{var t;let i,s;null===e?(s=this.flyManager.findFirstUsedItem(),i=s.config.uuid):(s=this.flyManager.findItemByUuid(e),i=e);const n=this.flyManager.isUesRouteFlyMode()&&this.state.activatedItemUuid===e;this.setState({activatedItemUuid:i},(()=>{this.flyManager.isUesRouteFlyMode()||this.handleActivedRouteChange(null)})),n||(this.handleSpeedChange(null),this.resetDefaultUI({isCleanGraphics:!0}),this.flyManager.unRegisterItem(),this.flyManager.registerItem(i),null===(t=this.state.graphicInteractionManagerRef)||void 0===t||t.removeAllGraphics())},this.handlePlayStateBtnClick=()=>{this.state.isPlaying?this.handlePause():this.handlePlay()},this.setPlayStatePlaying=e=>{var t;this.setState({isPlaying:e,isLiveView:!1}),null===(t=this.state.graphicInteractionManagerRef)||void 0===t||t.onRenderStateChange(null)},this.handleFlyLoading=()=>{this.setPlayStatePlaying(!0)},this.handleFlyLoaded=()=>{this.setPlayStatePlaying(!1)},this.handleFlyPlay=()=>{this.state.isLiveView||this.state.isPlaying||this.setPlayStatePlaying(!0)},this.handleFlyPause=()=>{this.setPlayStatePlaying(!1)},this.handleFlyFinish=()=>{this.setPlayStatePlaying(!1),this.state.isSpeedPopupOpen&&this.setState({isSpeedPopupOpen:!1})},this.isLiveviewMode=()=>this.state.isLiveView,this.handleUpdateProgress=e=>{this.setState({progress:e})},this.getFlyStyleContent=()=>{const t=this.flyManager.getFlyStyle();let i=null;if(t===e.Rotate){const e=this.flyManager.getActiveItemConfig();i=this.getRotateIconContent(e)}else t===e.Path?i=(0,h.jsx)(Xt,null):t===e.Route&&(i=(0,h.jsx)(ei,null));return i},this.toggleFlyStylePopup=()=>{N(this.props.config.itemsList)<=1?this.setState({isFlyStylePopupOpen:!1}):this.state.isPlaying||this.setState({isFlyStylePopupOpen:!this.state.isFlyStylePopupOpen})},this.isDisableButton=e=>{const{isPlaying:t,isLiveView:i,focusedGraphic:s}=e;let n=!this.state.subCompsLoaded;return t&&(n=n&&!this.state.isPlaying),i&&(n=n&&!this.state.isLiveView),s&&(n=n||!J(this.state.focusedGraphic)),n},this.handleFocusedGraphicChanged=e=>{this.setState({focusedGraphic:e})},this.handleGraphicsUpdateHandler=t=>ti(this,void 0,void 0,(function*(){this.handleSpeedChange(null);const i=t.graphicsInfo,s=t.cameraInfo,n=this.flyManager.getFlyStyle();n===e.Rotate||n===e.Path&&this.handleAltitudeChange(0,{setToController:!0,isUpdateLine:!1,isNeedHighlight:!1});const r=this.flyManager.buildTemporaryRecordConfig(i,s,this.props.jimuMapView);n!==e.Rotate&&n!==e.Path||!r.defaultSpeed||this.setState({settingSpeed:r.defaultSpeed});const a=yield this.flyManager.buildTemporaryRecord(r,this.props.jimuMapView.view,this.flyStateCallbacks,i),o=this.flyManager.getActiveItemConfig();yield this.flyManager.setupFly(o,null,this.flyStateCallbacks,a),yield this.flyManager.prepare(null)})),this.handlePickHandler=e=>{this.handleGraphicsUpdateHandler(e)},this.handleClearBtnClick=()=>{this.resetDefaultUI({isCleanGraphics:!0}),J(this.flyManager)&&this.handleStop({ignoreResetCameraWhenFinished:!0})},this.toggleLiveviewSettingPopup=()=>ti(this,void 0,void 0,(function*(){if(!J(this.state.focusedGraphic))return;const e=!this.state.isLiveView;yield this.flyManager.setIsLiveview(e);const t=this.flyManager.getLiveViewSettingInfo();J(t)&&(this.handleTiltChange(t.tilt),this.handleAltitudeChange(t.altitude,{isNeedHighlight:!0}),this.setState({isLiveView:e}))})),this.handleSpeedChange=e=>{var t;if(null===e){e={speed:.5,tilt:0,altitude:0}.speed}this.setState({settingSpeed:e}),null===(t=this.flyManager)||void 0===t||t.setSpeedFactor(e)},this.handleTiltChange=(e,t)=>{this.setState({settingTilt:e}),J(this.flyManager)&&(null==t?void 0:t.setToController)&&this.flyManager.onLiveViewParamChange({tilt:e},{isUpdateLine:!1,isNeedHighlight:null==t?void 0:t.isNeedHighlight})},this.handleAltitudeChange=(e,t)=>{const i=function(e){return _((null==e?void 0:e.toFixed)?parseFloat(e.toFixed(L.CALCULATED_VALUE_ROUNDED.ELEV)):NaN)}(e);this.setState({settingAltitude:i}),J(this.flyManager)&&(null==t?void 0:t.setToController)&&this.flyManager.onLiveViewParamChange({altitude:i},{isUpdateLine:null==t?void 0:t.isUpdateLine,isNeedHighlight:null==t?void 0:t.isNeedHighlight})},this.handlePlay=()=>ti(this,void 0,void 0,(function*(){if(!J(this.state.focusedGraphic)&&!this.flyManager.isUesRouteFlyMode()&&!this.flyManager.isAroundMapCenterFlyMode())return;if(!(yield this.flyManager.setIsLiveview(!1))&&!this.flyManager.isAroundMapCenterFlyMode())return;if(this.flyManager.isAroundMapCenterFlyMode()){const e=null,t=null,i=this.flyManager.buildTemporaryRecordConfig(e,t,this.props.jimuMapView),s=yield this.flyManager.buildTemporaryRecord(i,this.props.jimuMapView.view,this.flyStateCallbacks,e),n=this.flyManager.getActiveItemConfig();yield this.flyManager.setupFly(n,null,this.flyStateCallbacks,s),yield this.flyManager.prepare(null)}this.handleAutoControlMapPublish();const t={settingSpeed:this.state.settingSpeed,ids:{routeUuid:this.state.activedRouteUuid,recordUuid:null},isPreviewSpecifiedRecord:!1},i=this.flyManager.getActiveItemConfig();if(i.name===e.Path&&(t.resetCameraWhenFinished=!0),this.flyManager.isAroundMapCenterFlyMode()){const e=this.flyManager.getFlyStyle(),s=this.flyManager.getDefaultSpeedByType(i,e);t.settingSpeed=s||.375}this.flyManager.fly(t)})),this.handleStop=e=>{var t;null===(t=this.flyManager)||void 0===t||t.stop(e)},this.handlePause=()=>{var e;null===(e=this.flyManager)||void 0===e||e.pause()},this.handleClear=()=>{var e;null===(e=this.flyManager)||void 0===e||e.clear()},this.toggleSpeedPopup=()=>{this.setState({isSpeedPopupOpen:!this.state.isSpeedPopupOpen})},this.isShowDropdownButtonArrow=e=>{var t;return e!==a.Palette&&(null===(t=this.state.flyManagerItems)||void 0===t?void 0:t.length)>1},this.isShowDropdownButtonDot=e=>{var t;return e===a.Palette&&(null===(t=this.state.flyManagerItems)||void 0===t?void 0:t.length)>1},this.isAroundMapCenterMode=t=>e.Rotate===t.name&&t.targetMode===i.MapCenter,this.isOnly1FlyModeInUse=()=>{let e=0;return this.state.flyManagerItems.forEach(((t,i)=>{t.config.isInUse&&e++})),1===e},this.isOnlyAroundMapCenterInItems=()=>{let e=0,t=0;return this.state.flyManagerItems.forEach(((i,s)=>{const n=i.config;this.isAroundMapCenterMode(n)?e++:t++})),1===e&&0===t},this.getRotateIconContent=e=>{let t=null;return t=this.isAroundMapCenterMode(e)&&this.isOnlyAroundMapCenterInItems()?(0,h.jsx)(Nt,null):(0,h.jsx)(Jt,null),t},this.handleAroundMapCenterBtnClick=()=>{this.state.isPlaying?this.handlePause():this.handlePlay()},this.handleActivedRouteChange=e=>ti(this,void 0,void 0,(function*(){var t;null===(t=this.state.graphicInteractionManagerRef)||void 0===t||t.clearAll(),this.handleSpeedChange(null),this.setState({activedRouteUuid:e},(()=>ti(this,void 0,void 0,(function*(){J(this.state.activedRouteUuid)&&this.flyManager.isUesRouteFlyMode()&&(yield this.flyManager.prepareRoutePreview({routeUuid:e}))}))))})),this.handleDrawOrUpdateGraphics=e=>{var t;if("function"==typeof(null===(t=this.state.graphicInteractionManagerRef)||void 0===t?void 0:t.drawOrUpdateGraphics))return this.state.graphicInteractionManagerRef.drawOrUpdateGraphics(e)},this.highlightGraphics=e=>{var t;"function"==typeof(null===(t=this.state.graphicInteractionManagerRef)||void 0===t?void 0:t.highlight)&&this.state.graphicInteractionManagerRef.highlight(e)};const s={speed:.5,tilt:0,altitude:0};this.state={graphicInteractionManagerRef:null,flyManagerItems:null,subCompsLoaded:!1,isTerrainLoaded:!1,focusedGraphic:null,isFlyStylePopupOpen:!1,activatedItemUuid:null,isPlaying:!1,isLiveView:!1,settingSpeed:s.speed,settingTilt:s.tilt,settingAltitude:s.altitude,progress:0,isSpeedPopupOpen:!1,activedRouteUuid:null}}_reset(e){this.uiLoadingCallbacks={onLoading:this.handleFlyLoading,onLoaded:this.handleFlyLoaded},this.flyStateCallbacks={onFly:this.handleFlyPlay,onPause:this.handleFlyPause,onFinish:this.handleFlyFinish,onUpdateProgress:this.handleUpdateProgress},J(e)&&this._resetFlyManager()}_resetFlyManager(){var e;null===(e=this.flyManager)||void 0===e||e.destructor(),this.flyManager=new et({widgetConfig:this.props.config,isBuilderSettingFlag:!1,jimuMapView:this.props.jimuMapView,viewGroup:this.props.viewGroup,uiLoadingCallbacks:this.uiLoadingCallbacks,flyStateCallbacks:this.flyStateCallbacks,drawOrUpdateGraphics:this.handleDrawOrUpdateGraphics,highlightGraphics:this.highlightGraphics,onItemsUpdate:this.handleFlyManagerItemsUpdate,onBeforeSwitchMap:this.handleAutoControlMapPublish,onTerrainLoaded:this.onTerrainLoaded}),this.flyManager.unRegisterItem(),this.handleFlyStyleChange(null)}getCurrentActiveItemName(){const e=this.flyManager.getActiveItemConfig();return null==e?void 0:e.name}componentDidMount(){this._reset(this.props.jimuMapView)}componentWillUnmount(){var e;this.resetDefaultUI({isCleanGraphics:!0}),null===(e=this.flyManager)||void 0===e||e.destructor()}componentDidUpdate(e,t){this.props.config!==e.config&&(this._resetFlyManager(),this.handleClearBtnClick());const i=this.props.jimuMapView!==e.jimuMapView,{isTriggeredByFly:s,isTriggeredByMapSelf:n}=(r=this.props.widgetId,a=this.props.autoControlWidgetId,o=this.props.useMapWidgetIds[0],{isTriggeredByFly:a===r,isTriggeredByMapSelf:a===o});var r,a,o;i&&(this.setState({isTerrainLoaded:!1}),!s&&n&&this.handleClearBtnClick(),J(this.flyManager)?this.flyManager.updateJimuMapView(this.props.jimuMapView):this._resetFlyManager()),this.props.viewGroup!==e.viewGroup&&(J(this.flyManager)?this.flyManager.updateViewGroup(this.props.viewGroup):this._resetFlyManager()),i||!this.isAutoControlWidgetIdChanged(e)||n||this.handlePause();!e.isPrintPreview&&this.props.isPrintPreview&&this.handlePause()}renderFlyStyleSelectorContent(t){var i;const s=!!(null===(i=this.flyManager)||void 0===i?void 0:i.isAroundMapCenterFlyMode())&&this.state.isPlaying,n=this.flyManager.getActiveItemConfig(),r=J(n)&&(a=n.name,o=this.props,a===e.Rotate?o.intl.formatMessage({id:"flyStyleRotate",defaultMessage:g}):a===e.Path?o.intl.formatMessage({id:"flyStylePath",defaultMessage:v}):a===e.Route?o.intl.formatMessage({id:"flyStyleRoute",defaultMessage:m}):null);var a,o;const l=this.props.intl.formatMessage({id:"flyStyleRotate",defaultMessage:g}),d=this.props.intl.formatMessage({id:"flyStylePath",defaultMessage:v}),u=this.props.intl.formatMessage({id:"flyStyleRoute",defaultMessage:m}),p=this.isShowDropdownButtonArrow(t),f=this.isShowDropdownButtonDot(t),y=this.getFlyStyleContent();if(!this.isOnly1FlyModeInUse())return(0,h.jsx)(c.Dropdown,{isOpen:this.state.isFlyStylePopupOpen,toggle:this.toggleFlyStylePopup,className:"dropdowns flystyle-btn",activeIcon:!0},(0,h.jsx)(c.DropdownButton,{icon:!0,className:"btns d-flex",title:r,type:"tertiary",arrow:p,dot:f,disabled:s},y),(0,h.jsx)(c.DropdownMenu,{showArrow:!1},this.state.flyManagerItems.map(((t,i)=>{const s=t.config,n=s.name,r=t.config.uuid,a=r===this.state.activatedItemUuid;return s.isInUse?e.Rotate===n?(0,h.jsx)("div",{key:i},(0,h.jsx)(c.DropdownItem,{className:"dropdown-items",title:l,onClick:()=>{this.handleFlyStyleChange(r)},active:a,"aria-pressed":a},this.getRotateIconContent(s),(0,h.jsx)("span",{className:"mx-2"},l))):e.Path===n?(0,h.jsx)("div",{key:i},(0,h.jsx)(c.DropdownItem,{className:"dropdown-items",title:d,onClick:()=>{this.handleFlyStyleChange(r)},active:a,"aria-pressed":a},(0,h.jsx)(Xt,null),(0,h.jsx)("span",{className:"mx-2"},d))):e.Route===n?(0,h.jsx)("div",{key:i},(0,h.jsx)(c.DropdownItem,{className:"dropdown-items",title:u,onClick:()=>{this.handleFlyStyleChange(r)},active:a,"aria-pressed":a},(0,h.jsx)(ei,null),(0,h.jsx)("span",{className:"mx-2"},u))):null:null}))))}renderLiveviewSettingContent(){var t;const i=this.isDisableButton({isPlaying:!0,focusedGraphic:!0}),s=this.props.intl.formatMessage({id:"settings",defaultMessage:c.defaultMessages.settings}),n=this.props.intl.formatMessage({id:"tilt",defaultMessage:c.defaultMessages.tilt}),r=this.props.intl.formatMessage({id:"altitude",defaultMessage:c.defaultMessages.altitude}),a=this.props.intl.formatMessage({id:"degree",defaultMessage:c.defaultMessages.degree}),o=this.props.intl.formatMessage({id:"meter",defaultMessage:c.defaultMessages.meter}),l=this.props.intl.formatMessage({id:"meterAbbr",defaultMessage:c.defaultMessages.meterAbbr}),d=this.props.intl.formatMessage({id:"ground",defaultMessage:c.defaultMessages.ground}),u=this.props.intl.formatMessage({id:"outerSpace",defaultMessage:c.defaultMessages.outerSpace}),p=this.props.intl.formatMessage({id:"relative2Ground",defaultMessage:c.defaultMessages.relative2Ground}),g=null===(t=this.flyManager)||void 0===t?void 0:t.getFlyStyle();return(0,h.jsx)(c.Dropdown,{isOpen:this.state.isLiveView,toggle:this.toggleLiveviewSettingPopup,className:"dropdowns liveview-btn"},(0,h.jsx)(c.DropdownButton,{icon:!0,className:"btns d-flex",disabled:i,arrow:!1,title:s,"aria-label":s,type:"tertiary"},(0,h.jsx)(Ft,null)),(0,h.jsx)(c.DropdownMenu,{showArrow:!1,css:se(this.props.theme)},g===e.Rotate&&(0,h.jsx)("div",{className:"d-flex dropdown-items flex-column"},(0,h.jsx)("span",{className:"d-flex dropdown-item-title"},n),(0,h.jsx)(c.Slider,{id:"setting-tilt",className:"d-flex",value:this.state.settingTilt,min:L.TILT.MIN,max:L.TILT.MAX,step:L.TILT.STEP,onChange:e=>{this.handleTiltChange(e.target.value,{setToController:!0,isNeedHighlight:!0})},title:U(this.state.settingTilt,a),"aria-label":U(this.state.settingTilt,a)})),g===e.Path&&(0,h.jsx)(h.React.Fragment,null,(0,h.jsx)("div",{className:"d-flex dropdown-items flex-column"},(0,h.jsx)("span",{className:"d-flex dropdown-item dropdown-item-title"},r),(0,h.jsx)(c.Slider,{id:"setting-altitude",className:"d-flex dropdown-item",value:this.state.settingAltitude,min:L.ALT.MIN,max:L.ALT.MAX,step:L.ALT.STEP,onChange:e=>ti(this,void 0,void 0,(function*(){this.handleAltitudeChange(parseFloat(e.target.value),{setToController:!0,isNeedHighlight:!0})})),title:U(this.state.settingAltitude,o),"aria-label":U(this.state.settingAltitude,o)}),(0,h.jsx)("div",{className:"d-flex justify-content-between dropdown-item-comment dropdown-item"},(0,h.jsx)("span",null,d),(0,h.jsx)("span",null,u))),(0,h.jsx)("div",{className:"d-flex dropdown-items flex-column"},(0,h.jsx)("div",{className:"d-flex alt-wrapper"},(0,h.jsx)("div",{className:"alt-input"},(0,h.jsx)(c.NumericInput,{defaultValue:"0",size:"sm",value:this.state.settingAltitude,min:L.ALT.MIN,max:L.ALT.MAX,onChange:e=>ti(this,void 0,void 0,(function*(){this.handleAltitudeChange(e,{setToController:!0,isNeedHighlight:!0})}))})),(0,h.jsx)("span",{className:"setting-altitude-separator"},l),p)))))}renderPlayStateContent(){let e=null,t=this.isDisableButton({isPlaying:!0,isLiveView:!0,focusedGraphic:!0})&&null===this.state.activedRouteUuid;this.flyManager.isAroundMapCenterFlyMode()&&(t=!1);let i=null;if(this.state.isPlaying)i=(0,h.jsx)(Ht,null),e=this.props.intl.formatMessage({id:"pause",defaultMessage:c.defaultMessages.pause});else{i=(0,h.jsx)(Nt,null);e=this.isAroundMapCenterMode(this.flyManager.getActiveItemConfig())?this.props.intl.formatMessage({id:"aoundMapCenter",defaultMessage:C}):this.props.intl.formatMessage({id:"play",defaultMessage:c.defaultMessages.play})}return(0,h.jsx)(c.Button,{icon:!0,onClick:this.handlePlayStateBtnClick,disabled:t,className:"btns play-btn",type:"tertiary",title:e,"aria-label":e},i)}renderProgressBarContent(t){var i;const s=t===a.Palette?"circular":"linear";return(null===(i=this.flyManager)||void 0===i?void 0:i.getFlyStyle())===e.Path?(0,h.jsx)(c.Progress,{type:s,value:this.state.progress,className:"w-100"}):null}renderSpeedControllerContent(){const e=this.props.intl.formatMessage({id:"speed",defaultMessage:c.defaultMessages.speed})+": "+this.props.intl.formatNumber(E(this.state.settingSpeed))+"x",t=[0,.25,.375,.5,.59375,.625,.75,1],i=t.length;return(0,h.jsx)("div",{className:"d-flex item align-items-center h-100"},(0,h.jsx)(c.Slider,{id:"setting-speed",className:"d-flex speed-controller",value:t.indexOf(this.state.settingSpeed),min:0,max:i-1,step:1,onChange:e=>{this.handleSpeedChange(t[e.target.value])},title:e}))}renderSpeedControllerContentPalette(){const e=this.props.intl.formatMessage({id:"speed",defaultMessage:c.defaultMessages.speed}),t=E(this.state.settingSpeed),i=this.props.intl.formatNumber(t),s=e+": "+i+"x";return(0,h.jsx)(c.Dropdown,{isOpen:this.state.isSpeedPopupOpen,toggle:this.toggleSpeedPopup,className:"speed-controller-btn",direction:"up"},(0,h.jsx)(c.DropdownButton,{icon:!0,className:"d-flex speed-controller-text",title:s,type:"tertiary",arrow:!1},i+"x"),(0,h.jsx)(c.DropdownMenu,{showArrow:!1,css:h.css`
    min-width: 60px;
    padding: 0;

    .speed-popup-wrapper{
      font-size: 12px;

      .dropdown-item{
        padding-left: 0;
        padding-right: 0;
      }
    }`},(0,h.jsx)("div",{className:"speed-popup-wrapper"},[0,.25,.375,.5,.59375,.625,.75,1].map(((e,t)=>{const i=e===this.state.settingSpeed,s=this.props.intl.formatNumber(E(e));return(0,h.jsx)("div",{key:t},(0,h.jsx)(c.DropdownItem,{onClick:()=>{this.handleSpeedChange(e)},active:i,"aria-pressed":i},(0,h.jsx)("span",{className:"mx-2"},s+"x")))})))))}render(){if(!this.state.flyManagerItems)return null;const e=this.props.config.layout,t=this.flyManager.getFlyStyle(),i=this.renderFlyStyleSelectorContent(e),s=this.renderLiveviewSettingContent(),n=this.renderPlayStateContent(),r=this.renderProgressBarContent(e),o=this.renderSpeedControllerContent(),l=this.renderSpeedControllerContentPalette(),c=this.flyManager.isUesRouteFlyMode(),d=this.renderRouteFlyModeContent(e),u=c?[]:[Lt.Point,Lt.Line,Lt.Pick,Lt.Clear],p=(0,h.jsx)(Tt,{onRef:this.handleRefGraphicInteractionManager,widgetId:this.props.widgetId,theme:this.props.theme,intl:this.props.intl,jimuMapView:this.props.jimuMapView,showItems:u,isDisabled:!this.state.isTerrainLoaded,flyStyle:t,isPlaying:this.state.isPlaying,focusedGraphic:this.state.focusedGraphic,onFocusedGraphicChanged:this.handleFocusedGraphicChanged,onDrawFinish:this.handleGraphicsUpdateHandler,onClearBtnClick:this.handleClearBtnClick,onPickHandler:this.handlePickHandler}),g=this.isOnly1FlyModeInUse();let v=null;const m=this.isAroundMapCenterMode(this.flyManager.getActiveItemConfig());return e===a.Horizontal?v=(0,h.jsx)(Y,{flyStyleContent:i,graphicInteractionManager:p,liveViewSettingContent:s,playStateContent:n,progressBar:r,speedController:o,theme:this.props.theme,isPlaying:this.state.isPlaying,isRouteMode:c,routeListContent:d,isOnly1FlyModeInUse:g,isAroundMapCenterMode:m}):e===a.Palette&&(v=(0,h.jsx)(ie,{flyStyleContent:i,graphicInteractionManager:p,liveViewSettingContent:s,playStateContent:n,progressBar:r,speedController:l,theme:this.props.theme,isPlaying:this.state.isPlaying,isRouteMode:c,routeListContent:d,isOnly1FlyModeInUse:g,isAroundMapCenterMode:m,isInController:this.props.isInController})),(0,h.jsx)("div",{css:h.css`
    height: 100%;

    .fly-error-tips {
      display: flex;
      height: 100%;
      justify-content: center;
      align-items: center;
    }

    .fly-controller {
      height: 32px;
    }

    .fly-wrapper  {
      white-space: nowrap;
    }
    `,className:"d-flex align-items-center justify-content-center"},v)}renderRouteFlyModeContent(e){const t=this.state.subCompsLoaded;return(0,h.jsx)(le,{theme:this.props.theme,intl:this.props.intl,layout:e,isEnable:t,itemsList:this.state.flyManagerItems,activatedItemUuid:this.state.activatedItemUuid,activedRouteUuid:this.state.activedRouteUuid,graphicInteractionManagerRef:this.state.graphicInteractionManagerRef,isRouteMode:this.flyManager.isUesRouteFlyMode(),onActivedRouteChange:this.handleActivedRouteChange})}}class si extends h.BaseVersionManager{constructor(){super(...arguments),this.versions=[{version:"1.2.0",description:"rename RECORD.records to RECORD.routes",upgrader:e=>{let t=e;const i=t.getIn(["itemsList"]).asMutable({deep:!0});return i.map(((e,t)=>("RECORD"===e.name&&(void 0!==e.records&&delete e.records,e.routes=[]),Object.assign({},e)))),t=t.set("itemsList",i),t}},{version:"1.5.0",description:"config upgrade for 9.2",upgrader:t=>{let i=t;const s=i.getIn(["itemsList"]).asMutable({deep:!0});if(2===s.length){const t={uuid:"2",name:e.Route,isInUse:!1,routes:[]};s.push(t)}return s.map(((t,i)=>(void 0===t.uuid&&(t.uuid=i.toString()),"RECORD"===t.name&&(t.name=e.Route),e.Route===t.name&&(void 0!==t.records&&delete t.records,t.routes=[],t.isInUse=!1),Object.assign({},t)))),i=i.set("itemsList",s),i}},{version:"1.12.0",description:"support default speed in setting ,#9630",upgrader:i=>{let s=i;const n=s.getIn(["itemsList"]).asMutable({deep:!0});return n.map(((i,s)=>(i.name!==e.Rotate&&i.name!==e.Path||(i.defaultSpeed=t.DEFAULT),Object.assign({},i)))),s=s.set("itemsList",n),s}},{version:"1.13.0",description:"support Fly around map center ,#14462",upgrader:t=>{let s=t;const n=s.getIn(["itemsList"]).asMutable({deep:!0});return n.map(((t,s)=>(t.name===e.Rotate&&(t.targetMode||(t.targetMode=i.Point),t.rotationPauseTime||(t.rotationPauseTime="2.0")),Object.assign({},t)))),s=s.set("itemsList",n),s}},{version:"1.15.0",description:"remove default useMapWidgetIds[] for auto-select map ,#19299",upgrader:e=>{let t=e;const i=t.getIn(["useMapWidgetIds"]);return i&&"undefined"!==i.length&&0===i.length&&(t=h.Immutable.without(t,"useMapWidgetIds")),t}}]}}const ni=new si;var ri=o(29316),ai=o.n(ri);class oi extends h.React.PureComponent{constructor(e){super(e),this.handleActiveViewChange=e=>null==e||"2d"===e.view.type?(this.errorTipsManager.setErrorByType($.Choose3DMap),void this.setState({jimuMapView:null})):(this.errorTipsManager.setError(""),void this.setState({jimuMapView:e})),this.handleViewGroupCreate=e=>{this.setState({viewGroup:e})},this.errorTipsManager=new q({widget:this}),this.state={errorTip:this.errorTipsManager.getDefaultError(),jimuMapView:null,viewGroup:null}}componentDidMount(){const{layoutId:e,layoutItemId:t,id:i}=this.props;this.props.dispatch(h.appActions.widgetStatePropChange(i,"layoutInfo",{layoutId:e,layoutItemId:t}))}componentDidUpdate(e,t){this.errorTipsManager.isError()&&this.errorTipsManager.checkErrorInConfig()}renderWidgetPlaceholder(){const e=this.props.config.layout,t=L.ControllerStyleSize[e];return(0,h.jsx)(c.Tooltip,{showArrow:!0,placement:"bottom",title:(0,h.jsx)("div",{className:"p-2",style:{background:"var(--ref-palette-neutral-300)",border:"1px solid var(--ref-palette-neutral-700)"}},this.state.errorTip),arrowStyle:{background:"var(--ref-palette-neutral-300)",border:{color:"var(--ref-palette-neutral-700)",width:"1px"}}},(0,h.jsx)("div",{className:"h-100 w-100",css:{minWidth:t.w,minHeight:t.h}},(0,h.jsx)(c.WidgetPlaceholder,{icon:ai(),widgetId:this.props.id,css:h.css`
    &.jimu-widget-placeholder {
      display: flex;
      justify-content: center;
      align-items: center;

      min-height: inherit;

      .thumbnail-wrapper {
        flex-direction: inherit;
      }
    }
  `})))}render(){var e;const t=(0,h.jsx)(d.JimuMapViewComponent,{useMapWidgetId:null===(e=this.props.useMapWidgetIds)||void 0===e?void 0:e[0],onActiveViewChange:this.handleActiveViewChange,onViewGroupCreate:this.handleViewGroupCreate}),{config:i,intl:s,theme:n}=this.props;let r=null;r=this.errorTipsManager.isError()?this.renderWidgetPlaceholder():(0,h.jsx)(ii,{config:i,widgetId:this.props.id,theme:n,intl:s,jimuMapView:this.state.jimuMapView,viewGroup:this.state.viewGroup,useMapWidgetIds:this.props.useMapWidgetIds,autoControlWidgetId:this.props.autoControlWidgetId,isPrintPreview:this.props.isPrintPreview,isInController:!!this.props.controllerWidgetId});const a=this.errorTipsManager.isError()?" h-100":"";return(0,h.jsx)("div",{className:"d-flex align-items-center justify-content-center"+a},r,(0,h.jsx)("div",{className:"fly-map"},(0,h.jsx)("div",null,t)))}}oi.versionManager=ni,oi.mapExtraStateProps=(e,t)=>{var i,s,n;const{useMapWidgetIds:r}=t,a=r&&0!==r.length?r[0]:void 0,o=e&&e.mapWidgetsInfo,l=null!==(s=null===(i=null==e?void 0:e.appRuntimeInfo)||void 0===i?void 0:i.isPrintPreview)&&void 0!==s&&s;return{autoControlWidgetId:a?null===(n=o[a])||void 0===n?void 0:n.autoControlWidgetId:void 0,isPrintPreview:l}};const li=oi;function hi(e){o.p=e}})(),l})())}}}));